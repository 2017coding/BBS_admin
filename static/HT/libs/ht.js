!function(f,$,P){"use strict";var I="ht";if(!f[I]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),f.performance&&f.performance.now||function(){var M=Date.now();f.performance||(f.performance={}),f.performance.now=function(){return Date.now()-M}}();for(var k=Date.now(),X=16,_=["ms","moz","webkit","o"],H=0;H<_.length&&!f.requestAnimationFrame;++H)f.requestAnimationFrame=f[_[H]+"RequestAnimationFrame"],f.cancelAnimationFrame=f[_[H]+"CancelAnimationFrame"]||f[_[H]+"CancelRequestAnimationFrame"];f.requestAnimationFrame||(f.requestAnimationFrame=function(N){var q=Date.now(),g=X+k-q;return 0>g&&(g=0),k=q,f.setTimeout(function(){k=Date.now(),N(performance.now())},g)}),f.cancelAnimationFrame||(f.cancelAnimationFrame=function(L){return f.clearTimeout(L)}),$.assign===P&&($.assign=function(F){if(F===P||null===F)throw new TypeError("Cannot convert undefined or null to object");for(var W=$(F),E=1;E<arguments.length;E++){var b=arguments[E];if(b!==P&&null!==b)for(var t in b)$.prototype.hasOwnProperty.call(b,t)&&(W[t]=b[t])}return W})}();var H=f.document,Y=null,C=f[I]={},o=f[I+"config"],k=C.Default=o&&o.Default||{},j=C.Style=o&&o.Style||{},V=C.Attr=o&&o.Attr||{},y=C.Color=o&&o.Color||{},e=C.IsGetter=o&&o.IsGetter||{};!function(){var p=!1;try{var Y=$.defineProperty({},"passive",{get:function(){p=!0}});f.addEventListener("test",Y,Y),f.removeEventListener("test",Y,Y)}catch(V){p=!1}k.passiveSupported=p}();var E,m,A,S,M=k.passiveSupported,p=k.eventListenerOptionsFalse=M?{passive:!1,capture:!1}:!1,b=k.eventListenerOptionsTrue=M?{passive:!1,capture:!0}:!0,l=Math,R=l.round,s=l.floor,_=l.ceil,i=l.sqrt,B=l.max,D=l.min,L=l.abs,T=l.cos,q=l.acos,c=l.sin,t=l.pow,x=l.asin,O=l.PI,r=2*O,F=O/2,G=l.tan,d=l.atan2,u=l.random,Z=l.log,K=!1,v=!1,n=f.parseInt||global.parseInt,U="2018-12-31",g=f.navigator?f.navigator.platform.indexOf("Win")>-1:!1,W=function(Z){return Z*Z},N=f.setTimeout,z=f.clearTimeout,J=f.location,w=f.navigator?f.navigator.userAgent.toLowerCase():"",X=function(g){return g.test(w)},a=X(/msie/),Q=X(/msie/)||X(/trident/),h=X(/msie 10/),dd=X(/edge/),Oi=X(/firefox/),xf=X(/mac/),hc=k.isTouchable===P?g?!1:H?"ontouchend"in H:!1:k.isTouchable,Pp="default",pn="single",Rp="multiple",Wh="front",Bc="back",wp="left",lh="right",Gc="top",Xh="bottom",fg="center",Cj="eye",gg="middle",Xc="east",zc="west",Ch="north",Cp="none",Md="px",Oe="absolute",Ag="border",Rl="triangle",xo="rect",zq="circle",Eg="cylinder",ak="shape",dn="items",aj="normal",Kn="remove",Qb="clear",wl="width",Gb="height",Jg="ingroup",Ri="check",Bo="uncheck",rg="radio",he="radioOn",te="radioOff",Ap="points",Rh="values",Rk="series",Tk="body",lb="label",Jl="label2",Di="note",pi="note2",jn="icons",Zp="labelFont",ln="labelColor",Mi="labelSelectColor",Pi="note.expanded",kf="note2.expanded",Xb="edge.expanded",Hj="edge.points",_r="edge.type",Hd="rotation",Wb="hidden",hq="visible",$d="tuv",pd="no",Co="draw",Uj="select",qn="currentSubGraph",dc="selectBackground",bk="autoMakeVisible",ks="autoHideScrollBar",Yq="scrollBarColor",bb="scrollBarSize",Tg="indent",Kf="rowHeight",yh="columnLineColor",sd="rowLineColor",nm="columnLineVisible",Un="rowLineVisible",df="visibleFunc",bm="expandIcon",Dn="collapseIcon",tm="checkMode",To="sortFunc",Jq="editable",Nl="batchEditable",ff="tristate",Oo="asc",ws="desc",kr="position",Xg="elevation",Fo="children",mb="translateX",Bh="translateY",br="dataModel",Bk="maxSize",Ep="shape3d",im="shape3d.resolution",Pm="shape3d.visible",rr="shape3d.from.visible",gm="shape3d.to.visible",dg="shape3d.top.visible",qs="shape3d.bottom.visible",Fk="repeat.uv.length",Rf="serializeValue",al="deserializeValue",Ih="centerUniform",oq="uniform",oi="rgba(255,255,255,0)",vq="style",Nn="attr",so="field",ss="string",Xq="boolean",Ym="color",hs="int",vl="number",Jn="ew-resize",pj="ns-resize",uc="pointer",cb="auto",Ac="mousedown",Vb="mousemove",cd="mouseup",td="mouseout",Hk="touchstart",sc="touchmove",qm="touchend",um="keydown",Qh="keyup",bo=["DOMMouseScroll","mousewheel"],$p=Oi?bo[0]:bo[1],Be=hc?[Hk,sc,qm,um,Qh,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"]:[um,Qh,"keypress","input",Ac,Vb,cd,td,$p,"wheel","contextmenu","mouseenter","mouseleave","mouseover","compositionstart","compositionupdate","compositionend"],Oq=Y,gc=Y,Tj=Y,ib=cd.length,Ub=function(){Tj&&(z(Tj.timeout),Tj=Y)},Mr=function(){Tj&&_g(Tj.e,Tj.info)};f.addEventListener&&(hc||(f.addEventListener(td,function(){Ub()},p),f.addEventListener($p,function(){Xk()},p)),f.addEventListener(Qh,function(d){91===d.keyCode?ii={}:delete ii[d.keyCode]},b),f.addEventListener(um,function(r){ii[r.keyCode]=!0},b),f.addEventListener("blur",function(){ii={}},p));var od,ab,nk,Zn=0,jm=Y,tp=function(D,Q){var I=N(function(){delete jm[I],Cr(jm)&&(jm=Y),D()},Q);return I},ni=Y,hr=Y,Vr={},Tp={},Mc={},Wi={},gi={},ii={},iq={},Wq={},wh={},Lf={},gd=/.json$/,Eh=/^data:image\/svg\+xml/,mo={},$j=[],cs={},wr=Y,dr=Y,ci=function(){},xn=function(){throw"Oops!"},Me=[0,0,0],ym=[0,0,0,0],Zc={x:0,y:0,width:0,height:0},Dg=Y,dm=Y,Gm=Y,to=function(Q){dm&&!Q._72O&&(Gm||(Gm={}),Gm[Q._72O=yi()]=Q),od!=Y?zb()<.05&&S&&!ab&&($r=Ub):$r=sr},xk=function(m,q,o,t){dm||(dm={});var f=dm[m];if(f){if(f.url===q)return;f.image?(f.image.onload=ci,f.image.onerror=ci):f.request&&(f.request.onload=ci,f.request.onerror=ci)}if(gd.test(q)){var F=new If;if(dm[m]={request:F,url:q},q=k.beforeLoadURL(q),q.data){var D=k.parse(q.data);ke(m,D),k.handleImageLoaded(m,D)}else{F.onload=function(l){if(200===this.status||0===this.status){var O=k.parse(l.target.response||l.target.responseText);ke(m,O),k.handleImageLoaded(m,O)}else ke(m,k.handleUnfoundImage(m,q)||Y)},F.onerror=function(){ke(m,k.handleUnfoundImage(m,q)||Y)};var U={};U.url=encodeURI(q),U.sync=!1,F.send(U)}}else{var D=new Image;dm[m]={image:D,url:q},/^data:image/.test(q)||(q=k.beforeLoadURL(q),q=k.appendTimeStamp(q),q=encodeURI(q),D.crossOrigin=k.crossOrigin),k.convertImageSrc(q,function(u){Q&&(q.toLowerCase().indexOf(".svg")>0||Eh.test(q))?(H.body.appendChild(D),D.style.visibility="hidden",D.onload=function(){N(function(){if(o&&(D.width=o),t&&(D.height=t),!D.width||!D.height){var b=D.width||D.clientWidth,c=D.height||D.clientHeight;D.width=b,D.height=c}k.handleImageLoaded(m,D),ke(m,D),H.body.removeChild(D),D.style.visibility=""},180)},D.onerror=function(){ke(m,k.handleUnfoundImage(m,q)||Y),H.body.removeChild(D),D.style.visibility=""}):(D.onload=function(){o&&(D.width=o),t&&(D.height=t),k.handleImageLoaded(m,D),ke(m,D)},D.onerror=function(){ke(m,k.handleUnfoundImage(m,q)||Y)}),D.src=u})}},ke=function(g,W){if(Tp[g]=W,delete dm[g],Cr(dm)&&(dm=Y,Gm)){for(var r in Gm){var S=Gm[r];S._2O&&(S._2O={}),S.invalidateAll&&S.invalidateAll(P,"imageLoaded",g),S.redraw&&S.redraw(),S.iv(),delete S._72O}Gm=Y}if(W&&Gm)for(var r in Gm){var S=Gm[r];S.invalidateAll&&S.invalidateAll(P,"imageLoading",g),S.redraw&&S.redraw(),S.iv()}},Pe=function(){return Z=l&&Date,function(){return f.performance&&f.performance.now?f.performance.now():Date.now()}}(),ic=function(N,j){j?z(N):f.cancelAnimationFrame(N)},Ai=function(c,o,M){return{width:c,height:o,comps:fk(M)?M:[M]}},Np=function(g,F){return{type:zq,rect:[g,F,1.6,1.6],borderWidth:1,borderColor:zh,gradient:xm,gradientColor:pg,background:zh}},Ul=function(p,z){return Ai(16,16,{type:Rl,rect:[4,4,10,8],background:p,rotation:z?1.57:3.14})},Or=function(D,M){return Ai(16,16,{type:Rl,rect:[4,4,8,7],background:D,rotation:M?3.14:0})},co=function(e){var n=e._orientation;return"horizontal"===n||"h"===n},Yk=function(M){var A=Y||4,Q=Y||1,t=Y||1;0>A?A=0:A>.25&&(A=.25);var w,R,C,L,E,G,X,e=.5,V=[],s=[],b=[],i=r/t,f=r/Q,x=e-A;for(R=0;Q>=R;R++)for(L=-O+R*f,G=T(L),E=c(L),w=0;t>=w;w++)C=w*i,X=x+A*G,V.push(T(C)*X,E*A,-c(C)*X),(m=M)&&s.push(w/t,1-R/Q);for(R=0;Q>R;R++){var H=R*(t+1),j=(R+1)*(t+1);for(w=0;t>w;w++)b.push(H+w,j+w+1,j+w,H+w,H+w+1,j+w+1),Hh.z=Qn.z=M}},gj=function(B){var v=2,P=0;for(var J in B)J.length===v&&n(J,32)===Sp&&(wr=dr=B[J]),P++;return P},bn=function(X,f,Q,d){return Q||(Q=hc?5:3,Q/=d||1),{x:X-Q,y:f-Q,width:2*Q,height:2*Q}},_q=function(q,r,p,h){var S=this;r||(r=hc?5:3,p=20,h=20);var k={x:q,y:r,width:p,height:h};if(p)for(var t=0;p>t;t++)if(3===p)h=20;else for(var i=0;h>i;i++)S=f?f:p;var v={x:O,y:2*O};if(Gr(k,v)){var g=Gb[0]+Gc[0]+Qb[1]+(Oo.length-1);ne[Cj]=S[g],S[g]=Bb[Cj]}},Gq=function(L){return(/ble$/.test(L)||/ed$/.test(L)||e[L]?"is":"get")+L.charAt(0).toUpperCase()+L.slice(1)},Bb=function(X){return"set"+X.charAt(0).toUpperCase()+X.slice(1)},Xd=function(w){return typeof w===ss||w instanceof String},mn=function(F){return typeof F===vl},sr=function(J){return typeof J===Xq},Vl=function(c){return c&&"object"==typeof c},Lj=function(p){return"function"==typeof p},fk=function(v){return v instanceof Array},Rb=function(P){return P instanceof rp},vb=function(l){return fk(l)?new rp(l):l},fr=function(n){return n instanceof Dh},ad=function(G){return G instanceof vn},lk=function(a){return a instanceof wi},ao=function(j,v){if(!(j instanceof C.Group))return!1;if(!v)return j.isExpanded();var k=v.getDataUI(j);return k&&k._88I?!0:!1},Yj=function(g){return g instanceof Ff},gr=function(c){return c&&"IFRAME"===c.tagName},Wg=function(S){return S==Y||k.numberDigits==Y?S:parseFloat(S.toFixed(k.numberDigits))},ob=function(l,I,G){var h,T=I.length;if(G)for(var k=0;G>k;k++)if(3===T)l.push(I[0]),l.push(I[1]),l.push(I[2]);else for(h=0;T>h;h++)l.push(I[h]);else if(3===T)l.push(I[0]),l.push(I[1]),l.push(I[2]);else for(h=0;T>h;h++)l.push(I[h])},Zj=function(r){return r?Vl(r)?r:{}:!1},yl=function(b,I,o){var f,n=Vl(b)?b:b.prototype;for(f in I)o&&n[f]!==P||(n[f]=I[f]);return b},Rd=function(c){return String.fromCharCode(c)},Pd=function(x){for(var M,k=0,N="";k<x.length;k++)M=x[x.length-1-k],"%"===M?M="'":"a"===M?M='"':"]"===M&&(M="\\"),N+=Rd(M.charCodeAt(0)-1);return N},wj=function(Y,e,g){Y.superClass.constructor.apply(e,g)},Cr=function(o){for(var u in o)return!1;return!0},ti=function(z){return z?0===z.length:!0},Sj=function(){var e="";return[Bo[0],sd[0],lb[0]].forEach(function(n){e+=Bb(n).slice(3)}),oq=H&&H[e]||Ih,function(O,C){return O===C?!0:O.x===C.x&&O.y===C.y&&O.width===C.width&&O.height===C.height}}(),lm=function(M,t,d){return t>M?t:M>d?d:M},Pb=function(U){return 0>U?-1:U>0?1:0},zb=function(){var e=1e4*c(ib++);return e-s(e)},yo=function(m,M,r){return Fe(m.x,m.y,M.x,M.y,r.x,r.y,r.x+r.width,r.y,!0)||Fe(m.x,m.y,M.x,M.y,r.x+r.width,r.y,r.x+r.width,r.y+r.height,!0)||Fe(m.x,m.y,M.x,M.y,r.x+r.width,r.y+r.height,r.x,r.y+r.height,!0)||Fe(m.x,m.y,M.x,M.y,r.x,r.y+r.height,r.x,r.y,!0)},Fe=function(f,_,M,v,F,n,L,j,R){var s=(L-F)*(_-n)-(j-n)*(f-F),c=(j-n)*(M-f)-(L-F)*(v-_);if(0!==c){var o=s/c,$=f+o*(M-f),N=_+o*(v-_);return R&&($+Ui<D(f,M)||$-Ui>B(f,M)||$+Ui<D(F,L)||$-Ui>B(F,L)||N+Ui<D(_,v)||N-Ui>B(_,v)||N+Ui<D(n,j)||N-Ui>B(n,j))?Y:[$,N]}return Y},Ij=function($,t,s){if($&&s)if(t){if(t===vq)return $.getStyle(s);if(t===Nn)return $.getAttr(s);if(t===so)return $[s]}else if(s=Gq(s),$[s])return $[s]();return P},ah=function(i,b,u,f){if(i&&u)if(b){if(b===vq)i.s(u,f);else if(b===Nn)i.a(u,f);else if(b===so){var y=i[u];i[u]=f,i.fp("f:"+u,y,f)}}else u=Bb(u),i[u]&&i[u](f)},Ig=function(m,F,X){return F&&"top"!==F?"bottom"===F?{x:m.x,y:m.y,width:m.width,height:m.height*X}:"right"===F?{x:m.x,y:m.y,width:m.width*X,height:m.height}:"left"===F?{x:m.x+m.width*(1-X),y:m.y,width:m.width*X,height:m.height}:void 0:{x:m.x,y:m.y+m.height*(1-X),width:m.width,height:m.height*X}},Sc=function(d,j,E,B,M){j&&_e(d,E,B,1,M,j)},Ln=function(A,f,s,Z){var k=1-A;return k*k*f+2*A*k*s+A*A*Z},Hh=function(r,B,T,e,W){var C=1-r;return C*C*C*B+3*C*C*r*T+3*C*r*r*e+r*r*r*W},Um=function(m){var I,e,o,H,u=0;return m.forEach(function(D){if(I=D.length,I>0)for(e=D[0],H=1;I>H;H++)o=D[H],u+=Qf(e,o),e=o}),u},el=function(T,l,x){var F="__"+T,E=function(K){x.disabled||x["handle_"+T](K)};x[F]||(x[F]=E,l.addEventListener(T,E,p))},ch=function(L,A,q){var B="__"+L,E=q[B];E&&(A.removeEventListener(L,E,p),delete q[B])},Im=function(V,N){var g="_"+N;V[Gq(N)]=function(){return this[g]},V[Bb(N)]=function(_){var d=this[g];this[g]=_,this.fp(N,d,_)}},xp=function(V){return $.create(V)},_i=function(Z){if(!Z.element){var z,P;(z=Z.textField)?P=se(Cf.TextField,z):(z=Z.textArea)?P=se(Cf.TextArea,z):(z=Z.button)?P=se(Cf.Button,z):(z=Z.comboBox)?P=se(Cf.ComboBox,z):(z=Z.checkBox)?P=se(Cf.CheckBox,z):(z=Z.radioButton)?P=se(Cf.RadioButton,z):(z=Z.slider)?P=se(Cf.Slider,z):(z=Z.colorPicker)?P=se(Cf.ColorPicker,z):(z=Z.image)&&(P=se(Cf.Image,z)),P&&(Z.element=P)}},kk=function(L,r){var n=Aj(L);return n._ht=r,n},Aj=function(l,U){var J=H.createElement("div"),g=J.style;return J.tabIndex=-1,J.onkeydown=vj,g.msTouchAction=Cp,Nq(J,Y,0),hc&&g.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",Y),l&&(g.overflow=Wb),U&&Hb(U,J),J},eq=function(u,L){var G=H.createElement("canvas"),v=G.style;return v.msTouchAction=Cp,L||(v.pointerEvents=Cp),Nq(G,Y,0),u&&Hb(u,G),G},Nq=function(I,q,A){var w=I.style;w.border=q?q+" solid 1px":0,w.outline=0,w.padding=A?"0 "+A+Md:0,xb(I)},xb=function(b){var Z=b.style;Z.position=Oe,Z.margin=0,Z.setProperty("box-sizing","border-box",Y),Z.setProperty("-moz-box-sizing","border-box",Y)},hn=function(C,F,S,I){I||(I=es),F!=Y&&(C.width=F*I,C.style.width=F+Md),S!=Y&&(C.height=S*I,C.style.height=S+Md)},Hb=function(R,y,X){R.appendChild(y),X&&(y.style.position=Oe)},Dc=function(X,N){N.split||(N+="");for(var a,F=N.split("\n"),o=0,r=F.length,Q=0;r>Q;Q++){var R=Ie(X.font,F[Q]);R.width>o&&(o=R.width),a||(a=R.height)}return X.ss=F,{width:o,height:a*r}},Rc=function(S,y,E,H,X,R){var F=y.length;if(1===F)yj(S,y[0],E,H,X);else for(var c=E.height/F,g={x:E.x,y:E.y,width:E.width,height:c},v=0;v<y.length;v++)R?qq(S,y[v],H,X,g.x,g.y,g.width,g.height,R):yj(S,y[v],g,H,X),g.y+=c},yj=function(S,W,B,p,h){S.font=p?p:fi,S.fillStyle=h?h:bl,S.textAlign=fg,S.textBaseline=gg;var f,D;B?B.width===P?(f=B.x,D=B.y):(f=B.x+B.width/2,D=B.y+B.height/2):(f=0,D=0),S.fillText(W,R(f),R(D))},jc=function(m){m.getView&&(m=m.getView());var e=m.offsetWidth||m.scrollWidth;return!e&&m.style.width&&(e=n(m.style.width)),e},em=function(H){H.getView&&(H=H.getView());var h=H.offsetHeight||H.scrollHeight;return!h&&H.style.height&&(h=n(H.style.height)),h},Fq=function(D,t,B){var O=t[0].toUpperCase()+t.substring(1,t.length);D["webkit"+O]=B,D["moz"+O]=B,D["ms"+O]=B,D["o"+O]=B,D[t]=B},$g=function(){var L=function(J){vj(J),J.stopPropagation()},S=function(n){vj(n)},F=hc?[Hk]:[um,Ac];return function(K,j){var w=Aj(),Z=w.style;return Z.backgroundColor=k.disabledBackground,K&&(Z.backgroundImage="url("+K+")",Z.backgroundPosition="50% 50%",Z.backgroundRepeat="no-repeat no-repeat"),j===!1?F.forEach(function(J){w.addEventListener(J,S,p)}):F.forEach(function(s){w.addEventListener(s,L,p)}),w}}(),sf=function(i){var y=i.getContext("2d");return y.save(),y.lineCap=Ue,y.lineJoin=Ok,y},$r=function(l,z,Y,u){Jd(l,z*es,Y*es),u*=es,1!==u&&l.scale(u,u)},Jd=function(U,E,H){U.translate(E,H)},hh=function(T,l){l&&T.rotate(l)},Ro=function(r,m,L){m===P&&(m=1),L===P&&(L=1),(1!==m||1!==L)&&r.scale(m,L)},cl=!1,_c=function(t){var q=H.activeElement;if(H.activeElement!==t){q&&q.forceOnblur&&q.forceOnblur();for(var v=[],r=t.parentNode;r;)v.push([r,r.scrollLeft,r.scrollTop]),r=r.parentNode;if(!cl){var p=[],E=[];try{for(var X=f.parent,g=f;X!==g;)p.push([X,X.scrollX,X.scrollY]),g=X,X=f.parent;var h=f.frameElement;if(h)for(var I=h.parentNode;I;)E.push([I,I.scrollLeft,I.scrollTop]),I=I.parentNode}catch(B){cl=!0}}if(hc)t.focus();else{var m=bh(),U=m.target;t.focus(),U.scrollLeft=m.left,U.scrollTop=m.top}v.forEach(function(w){w[0].scrollLeft=w[1],w[0].scrollTop=w[2]}),cl||(p.forEach(function(u){u[0].scrollTo(u[1],u[2])}),E.forEach(function(Q){Q[0].scrollLeft=Q[1],Q[0].scrollTop=Q[2]}))}},Mn=function(e){return e&&e.getView?e.getView():e},dk=function(C,y,l,S,Y){if(2===arguments.length&&(l=y.y,S=y.width,Y=y.height,y=y.x),C.isSelfViewEvent)C.setX(y),C.setY(l),C.setWidth(S),C.setHeight(Y);else{var c=Mn(C),K=c.style;if((H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement)!==c)y!==P&&(K.left=y+Md),l!==P&&(K.top=l+Md),S!==P&&(K.width=S+Md),Y!==P&&(K.height=Y+Md);else{var D=k.getWindowInfo();K.left=(y=D.left)+Md,K.top=(l=D.top)+Md,K.width=(S=D.width)+Md,K.height=(Y=D.height)+Md}C.endEditing&&!hc&&C.endEditing(),C.redraw&&C.redraw(),C.invalidate&&C.invalidate(),C.onLayouted&&C.onLayouted(y,l,S,Y),C.fireViewEvent&&C.fireViewEvent("layout")}},ip=function(w){if(!w.touches)return w;var C=w.touches[0];return C?C:w.changedTouches[0]},cc=function(V){return hc?ip(V).target:V.target},yg=function(_){k.popup&&k.popup.close(),k.popup=_},no=Y,Ak=function(L){no.handleWindowTouchMove(L)},ce=function(O){no.handleWindowTouchEnd(O),f.removeEventListener(sc,Ak,p),f.removeEventListener(qm,ce,p),no=Y},Hp=function(P){no.handleWindowMouseMove(P)},mk=function(L){no.handleWindowMouseUp(L),f.removeEventListener(Vb,Hp,p),f.removeEventListener(cd,mk,p),no=Y},sj=function(w){return 1===Lc(w)},mg=function(L,b){return b?b.keyCode===L:ii[L]},Lq=function(E){return En(E)&&mg(65,E)},gq=function(K){return mg(46,K)||mg(8,K)},$q=function(W){return function(F){return F?F.keyCode===W:ii[W]}},Sp=573,Tq=[65,83,68,87,37,38,39,40,32,13,27],Kj=$q(Tq[0]),Cn=$q(Tq[1]),ts=$q(Tq[2]),Ib=$q(Tq[3]),Ml=$q(Tq[4]),Kb=$q(Tq[5]),Tb=$q(Tq[6]),Db=$q(Tq[7]),Qg=$q(Tq[8]),Jf=$q(Tq[9]),xs=$q(Tq[10]),Yr={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},As=[2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,5,5,5,5,5,2237],kc=Y,Ng=Y,Ph=function(p,V){kc||(kc=eq()),hn(kc,p,V,1);var U=sf(kc);return U.clearRect(0,0,p,V),U},fj=function(){var c,V={};for(var A in f){var G=Rp.length;if(A.length==G&&A[0]===Rp[2]&&A[1]===Cp[1]&&A[4]===Rp[3]&&A[5]===Rp[4]&&A.substr(G-2)===Cp[1]+Cp[2]){var X=f[A];for(var q in X)q.length===G&&q.substr(0,3)===lh[3]+Kn[3]+Uj[0]&&q.substr(G-2)===Rp[0]+Di[3]&&(bo=X[q])}}return function(e){var p,P=V[e];return P||(c||(c=eq(),hn(c,1,1,1)),p=c.getContext("2d"),p.clearRect(0,0,1,1),_e(p,0,0,1,1,e),P=p.getImageData(0,0,1,1).data,P=V[e]=[P[0],P[1],P[2],P[3]]),P}}(),lg=function(u){if(!Xd(u))return u;var D=fj(u);return D.CA||(D.CA=[D[0]/255,D[1]/255,D[2]/255,D[3]/255]),D.CA},Wd=function(h,q,B,v,I){var K=eq();K.width=B,K.height=v;var k=K.getContext("2d");k.drawImage(h,0,0,B,v);try{for(var P=k.getImageData(0,0,B,v),E=P.data,H=0,b=E.length;b>H;H+=4){var l=E[H+0],w=E[H+1],p=E[H+2],Y=E[H+3];"override_a"===I?E[H+3]=255*q[3]:"override_rgb"===I?(E[H+0]=255*q[0],E[H+1]=255*q[1],E[H+2]=255*q[2]):"override"===I?(E[H+0]=255*q[0],E[H+1]=255*q[1],E[H+2]=255*q[2],E[H+3]=255*q[3]):(E[H+0]=q[0]*l,E[H+1]=q[1]*w,E[H+2]=q[2]*p,E[H+3]=q[3]*Y)}k.putImageData(P,0,0)}catch(D){return h}return K},ne=function(H,l,d){return l&&(l="miter"===d?8*l+20:l+1,H&&El(H,l)),l},wc=function(c,y){if(y){var P=new cq(y),o=c.width/2,U=c.height/2,A=ig([P.tf(-o,-U),P.tf(o,-U),P.tf(o,U),P.tf(-o,U)]);return A.x+=c.x+o,A.y+=c.y+U,A}return c},Ll=function(E,x,S,Q,g,C,l,i){Q*=Math.PI/180;var T={x:Math.cos(Q)*(E.x-l.x)/2+Math.sin(Q)*(E.y-l.y)/2,y:-Math.sin(Q)*(E.x-l.x)/2+Math.cos(Q)*(E.y-l.y)/2},L=Math.pow(T.x,2)/Math.pow(x,2)+Math.pow(T.y,2)/Math.pow(S,2);L>1&&(x*=Math.sqrt(L),S*=Math.sqrt(L));var U=(g==C?-1:1)*Math.sqrt((Math.pow(x,2)*Math.pow(S,2)-Math.pow(x,2)*Math.pow(T.y,2)-Math.pow(S,2)*Math.pow(T.x,2))/(Math.pow(x,2)*Math.pow(T.y,2)+Math.pow(S,2)*Math.pow(T.x,2)));isNaN(U)&&(U=0);var d={x:U*x*T.y/S,y:U*-S*T.x/x},a={x:(E.x+l.x)/2+Math.cos(Q)*d.x-Math.sin(Q)*d.y,y:(E.y+l.y)/2+Math.sin(Q)*d.x+Math.cos(Q)*d.y},r=function(f){return Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2))},P=function(q,g){return(q[0]*g[0]+q[1]*g[1])/(r(q)*r(g))},Z=function(s,b){return(s[0]*b[1]<s[1]*b[0]?-1:1)*Math.acos(P(s,b))},Y=Z([1,0],[(T.x-d.x)/x,(T.y-d.y)/S]),z=[(T.x-d.x)/x,(T.y-d.y)/S],O=[(-T.x-d.x)/x,(-T.y-d.y)/S],o=Z(z,O);P(z,O)<=-1&&(o=Math.PI),P(z,O)>=1&&(o=0);var P=x>S?x:S,$=x>S?1:x/S,j=x>S?S/x:1;if(null==i){var J={x:0,y:0,width:0,height:0};El(J,P),J.x*=$,J.width*=$,J.y*=j,J.height*=j;var F=new cq(Q);return J=ig([F.tf(J.x,J.y),F.tf(J.x+J.width,J.y),F.tf(J.x+J.width,J.y+J.height),F.tf(J.x,J.y+J.height)]),J.x+=a.x,J.y+=a.y,[{x:J.x,y:J.y},{x:J.x+J.width,y:J.y},{x:J.x+J.width,y:J.y+J.height},{x:J.x,y:J.y+J.height}]}i.translate(a.x,a.y),i.rotate(Q),i.scale($,j),i.arc(0,0,P,Y,Y+o,1-C),i.scale(1/$,1/j),i.rotate(-Q),i.translate(-a.x,-a.y)},dj=function($,F){$&&$.beginPath();for(var G,x,X,y=[],c=function(q){for(var w,K=/(\-{0,1}[\d\.]+)/gi,R=[];w=K.exec(q);)R.push(parseFloat(w[0]));return R},L=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,n={x:0,y:0};G=L.exec(F);){var P=G[0],j=P.substr(0,1);if("M"===j||"m"===j){for(var e=c(P),h=0;h<e.length;h+=2){var b=e[h],w=e[h+1];"m"===j&&(b+=n.x,w+=n.y),$&&$.moveTo(b,w),y.push({x:b,y:w}),n.x=b,n.y=w}x=X=null}else if("H"===j||"h"===j){for(var e=c(P),h=0;h<e.length;h+=1){var b=e[h];"h"===j&&(b+=n.x),$&&$.lineTo(b,n.y),y.push({x:b,y:n.y}),n.x=b}x=X=null}else if("C"===j||"c"===j){for(var e=c(P),h=0;h<e.length;h+=6){var D=e[h],B=e[h+1],W=e[h+2],S=e[h+3],b=e[h+4],w=e[h+5];"c"===j&&(D+=n.x,B+=n.y,W+=n.x,S+=n.y,b+=n.x,w+=n.y),$&&$.bezierCurveTo(D,B,W,S,b,w),y.push({x:D,y:B}),y.push({x:W,y:S}),y.push({x:b,y:w}),n.x=b,n.y=w}x=[D,B,W,S,b,w],X=null}else if("S"===j||"s"===j){for(var e=c(P),h=0;h<e.length;h+=4){var D,B;x?(D=2*x[4]-x[2],B=2*x[5]-x[3]):(D=n.x,B=n.y);var W=e[h],S=e[h+1],b=e[h+2],w=e[h+3];"s"===j&&(W+=n.x,S+=n.y,b+=n.x,w+=n.y),$&&$.bezierCurveTo(D,B,W,S,b,w),y.push({x:D,y:B}),y.push({x:W,y:S}),y.push({x:b,y:w}),n.x=b,n.y=w}x=[D,B,W,S,b,w],X=null}else if("Q"===j||"q"===j){for(var e=c(P),h=0;h<e.length;h+=4){var D=e[h],B=e[h+1],b=e[h+2],w=e[h+3];"q"===j&&(D+=n.x,B+=n.y,b+=n.x,w+=n.y),$&&$.quadraticCurveTo(D,B,b,w),y.push({x:D,y:B}),y.push({x:b,y:w}),n.x=b,n.y=w}x=null,X=[D,B,b,w]}else if("T"===j||"t"===j){for(var e=c(P),h=0;h<e.length;h+=2){var D,B;X?(D=2*X[2]-X[0],B=2*X[3]-X[1]):(D=n.x,B=n.y);var b=e[h],w=e[h+1];"t"===j&&(b+=n.x,w+=n.y),$&&$.quadraticCurveTo(D,B,b,w),y.push({x:D,y:B}),y.push({x:b,y:w}),n.x=b,n.y=w}x=null,X=[D,B,b,w]}else if("V"===j||"v"===j){for(var e=c(P),h=0;h<e.length;h+=1){var w=e[h];"v"===j&&(w+=n.y),$&&$.lineTo(n.x,w),y.push({x:n.x,y:w}),n.y=w}x=X=null}else if("L"===j||"l"===j){for(var e=c(P),h=0;h<e.length;h+=2){var b=e[h],w=e[h+1];"l"===j&&(b+=n.x,w+=n.y),$&&$.lineTo(b,w),y.push({x:b,y:w}),n.x=b,n.y=w}x=X=null}else if("A"===j||"a"===j){for(var e=c(P),h=0;h<e.length;h+=7){var H=e[h],I=e[h+1],l=e[h+2],q=e[h+3],u=e[h+4],b=e[h+5],w=e[h+6];"a"===j&&(b+=n.x,w+=n.y);var V=Ll(n,H,I,l,q,u,{x:b,y:w},$);V&&(y=y.concat(V)),n.x=b,n.y=w}x=X=null}var g=P.substr(P.length-1);("z"===g||"Z"===g)&&$&&$.closePath()}return y},gn=function(t,K){var P,B,$="L"===K[0],A=K.length;t.save(),$?(t.transform(K[5],K[6],K[7],K[8],K[9],K[10]),P=t.createLinearGradient(K[1],K[2],K[3],K[4]),B=11):(t.transform(K[7],K[8],K[9],K[10],K[11],K[12]),P=t.createRadialGradient(K[1],K[2],K[3],K[4],K[5],K[6]),B=13);for(var h=t.compGray;A>B;)P.addColorStop(K[B],h?k.toGrayColor(K[B+1]):K[B+1]),B+=2;t.fillStyle=P},Qn=function(n,r){var Y=n.s("shape.gradient.pack");if(Y){for(var s=Y.length,l=new Array(s),j=0;s>j;j++)l[j]=Y[j];var m,b,L,A,i,S,C,d,G,k,X,v,R,O="L"===l[0];m=O?5:7,b=l[m],L=l[m+1],A=l[m+2],i=l[m+3],S=l[m+4],C=l[m+5],d=r[0],G=r[1],k=r[2],X=r[3],v=r[4],R=r[5],l[m]=d*b+k*L,l[m+1]=G*b+X*L,l[m+2]=d*A+k*i,l[m+3]=G*A+X*i,l[m+4]=d*S+k*C+v,l[m+5]=G*S+X*C+R,n.s("shape.gradient.pack",l)}},Er=function(L,X,R,h){var f=!1;if(L.beginPath?L.beginPath():f=!0,Rb(X)&&(X=X._as),Rb(R)&&(R=R._as),R&&R.length){for(var j,Q,K,t,m=0,z=0,k=R.length;k>z;z++)j=R[z],1===j?(Q=X[m++],L.moveTo(Q.x,f?-Q.y:Q.y)):2===j?(Q=X[m++],L.lineTo(Q.x,f?-Q.y:Q.y)):3===j?(Q=X[m++],K=X[m++],L.quadraticCurveTo(Q.x,f?-Q.y:Q.y,K.x,f?-K.y:K.y)):4===j?(Q=X[m++],K=X[m++],t=X[m++],L.bezierCurveTo(Q.x,f?-Q.y:Q.y,K.x,f?-K.y:K.y,t.x,f?-t.y:t.y)):5===j&&L.closePath();h&&5!==j&&L.closePath()}else{var O,g,$,P=X.length;if(P>0){for(O=X[0],L.moveTo(O.x,f?-O.y:O.y),g=1;P>g;g++)$=X[g],L.lineTo($.x,f?-$.y:$.y);h&&L.closePath()}}},om=function(A,h,V,I){if(Rb(A)&&(A=A._as),Rb(h)&&(h=h._as),h&&h.length){V=V||be;for(var t,P,z,l,M,Q,u,x,E=[],w=Y,s=0,r=0,b=h.length;b>r;r++)if(t=h[r],1===t)E.push(w=[]),w.push(A[s++]);else if(2===t)w.push(A[s++]);else if(3===t){for(P=w[w.length-1],z=A[s++],l=A[s++],Q=1;V>Q;Q++)u=Ln(Q/V,P.x,z.x,l.x),x=Ln(Q/V,P.y,z.y,l.y),w.push({x:u,y:x,b:!0});w.push(l)}else if(4===t){for(P=w[w.length-1],z=A[s++],l=A[s++],M=A[s++],Q=1;V>Q;Q++)u=Hh(Q/V,P.x,z.x,l.x,M.x),x=Hh(Q/V,P.y,z.y,l.y,M.y),w.push({x:u,y:x,b:!0});w.push(M)}else 5===t&&w.push(w[0]);return I&&5!==t&&w&&w.length>2&&w.push(w[0]),E}return I&&A.length>2&&(A=A.slice(),A.push(A[0])),A?[A]:[]},wq=function(j,r,M,V,I,$){var C,t,E,d=fj(r),e=V,Y=d[0],f=d[1],L=d[2];if(M){var z=fj(M);C=z[0]-Y,t=z[1]-f,E=z[2]-L}else C=255-Y,t=255-f,E=255-L;for($||($=V>10?1:.5,$=1>I?D($/I,2):$);(V-=$)>0;){var T=1-V/e,p=Y+C*T,u=f+t*T,v=L+E*T;p=D(_(p),255),u=D(_(u),255),v=D(_(v),255),j.strokeStyle="rgb("+p+","+u+","+v+")",j.lineWidth=V,j.stroke()}},tn=function(){var Z={};return function(v,F){var o=v+"-"+F,g=Z[o];if(g)return g;var Q,O,T,c=fj(v);return 0>F?(F=(100+F)/100,Q=_(c[0]*F),O=_(c[1]*F),T=_(c[2]*F)):(F/=100,Q=c[0],O=c[1],T=c[2],Q+=(255-Q)*F,O+=(255-O)*F,T+=(255-T)*F,Q=D(_(Q),255),O=D(_(O),255),T=D(_(T),255)),Z[o]="rgb("+Q+","+O+","+T+")"}}(),_e=function(B,m,C,_,j,V){V&&(B.fillStyle=V),B.beginPath(),B.rect(m,C,_,j),B.fill()},hm=function(e,F,Y,V,X,k,x){e.beginPath(),Re[F](e,Y.x,Y.y,Y.width,Y.height,V,X,k,x)},wo=function(f,b,g,I,O){var w=Re[g];f.fillStyle=w?w(f,b,I?I:pg,O.x,O.y,O.width,O.height):b},ol=function(G,L,W,g,R,v){try{if(!L.tagName&&L.comps){L._cacheImage_||(L._cacheImage_={});var I;I="override"===g?"colors_override":"override_rgb"===g?"colors_override_rgb":"override_a"===g?"colors_override_a":"colors",L._cacheImage_[I]||(L._cacheImage_[I]={__count__:0});var r=L._cacheImage_[I][W];r||(L._cacheImage_[I].__count__>k.imageCacheThreshold&&(L._cacheImage_[I]={__count__:0}),r=C.Default.toCanvas(L,re(L),dp(L),null,R,v,W,null,g),L._cacheImage_[I][W]=r,L._cacheImage_[I].__count__++),L=r}G.fillStyle=G.createPattern(L,"repeat")}catch(c){G.fillStyle="black"}},Eq=function(I,T,K,G,U,v,C){I.save(),I.translate(T,K),I.scale(1,C/v),I.arc(0,0,v,G,U),I.restore()},Ee=function(P,e,A,n,g,W,f,I){var F,r,t,Q,B,K,y,l,q,V,h;if(L(g)>2*O&&(g=2*O),B=_(L(g)/(O/4)),F=g/B,r=-F,t=-n,B>0){K=e+T(n)*W,y=A+c(-n)*f,I?P.lineTo(K,y):P.moveTo(K,y);for(var a=0;B>a;a++)t+=r,Q=t-r/2,l=e+T(t)*W,q=A+c(t)*f,V=e+T(Q)*(W/T(r/2)),h=A+c(Q)*(f/T(r/2)),P.quadraticCurveTo(V,h,l,q)}},Rj=function(I,U,v,i,Z,y,_,P,l){6===arguments.length&&(_=y,P=y,l=y);var V=U+i,s=v+Z,b=Z>i?2*i:2*Z;y=b>y?y:b,_=b>_?_:b,P=b>P?P:b,l=b>l?l:b;var e=.29*l,m=.58*l;I.moveTo(V,s-l),I.quadraticCurveTo(V,s-m,V-e,s-e),I.quadraticCurveTo(V-m,s,V-l,s),e=.29*P,m=.58*P,I.lineTo(U+P,s),I.quadraticCurveTo(U+m,s,U+e,s-e),I.quadraticCurveTo(U,s-m,U,s-P),e=.29*y,m=.58*y,I.lineTo(U,v+y),I.quadraticCurveTo(U,v+m,U+e,v+e),I.quadraticCurveTo(U+m,v,U+y,v),e=.29*_,m=.58*_,I.lineTo(V-_,v),I.quadraticCurveTo(V-m,v,V-e,v+e),I.quadraticCurveTo(V,v+m,V,v+_),I.lineTo(V,s-l)},sb=function(D,g,l,T,x,K,H){g&&(l=R(l),T=R(T),H||(H=1),D.fillStyle=g,D.beginPath(),D.rect(l,T,H,K),D.rect(l,T,x,H),K-H>0&&D.rect(l,T+K-H,x,H),x-H>0&&D.rect(l+x-H,T,H,K),D.fill())},Ae=function(K,y,j,P){var I=P.x,Q=P.y,R=P.width,n=P.height;if(!(!y||!j||0>=R||0>=n)){var Y,_=kp(y),q=ac(y),u=j>0;1===j||-1===j?(K.fillStyle=u?_:q,K.beginPath(),K.rect(I,Q,1,n),K.rect(I,Q,R,1),K.fill(),K.fillStyle=u?q:_,K.beginPath(),K.rect(I,Q+n-1,R,1),K.rect(I+R-1,Q,1,n),K.fill()):(j=D(L(j),D(R/2,n/2)),Y=K.createLinearGradient(I,Q,I+j,Q),Y.addColorStop(0,u?_:q),Y.addColorStop(1,y),K.fillStyle=Y,K.beginPath(),K.moveTo(I,Q),K.lineTo(I+j,Q+j),K.lineTo(I+j,Q+n-j),K.lineTo(I,Q+n),K.lineTo(I,Q),K.fill(),Y=K.createLinearGradient(I,Q,I,Q+j),Y.addColorStop(0,u?_:q),Y.addColorStop(1,y),K.fillStyle=Y,K.beginPath(),K.moveTo(I,Q),K.lineTo(I+j,Q+j),K.lineTo(I+R-j,Q+j),K.lineTo(I+R,Q),K.lineTo(I,Q),K.fill(),Y=K.createLinearGradient(I,Q+n,I,Q+n-j),Y.addColorStop(0,u?q:_),Y.addColorStop(1,y),K.fillStyle=Y,K.beginPath(),K.moveTo(I,Q+n),K.lineTo(I+j,Q+n-j),K.lineTo(I+R-j,Q+n-j),K.lineTo(I+R,Q+n),K.lineTo(I,Q+n),K.fill(),Y=K.createLinearGradient(I+R,Q,I+R-j,Q),Y.addColorStop(0,u?q:_),Y.addColorStop(1,y),K.fillStyle=Y,K.beginPath(),K.moveTo(I+R,Q),K.lineTo(I+R-j,Q+j),K.lineTo(I+R-j,Q+n-j),K.lineTo(I+R,Q+n),K.lineTo(I+R,Q),K.fill())}},Dp=function(G,j,g,_,o,e,K){var $=G.createLinearGradient(_,o,e,K);return $.addColorStop(0,g),$.addColorStop(1,j),$},Gl=function(f,K,$,J,h,d,I){var r=f.createLinearGradient(J,h,d,I);return r.addColorStop(0,K),r.addColorStop(.5,$),r.addColorStop(1,K),r},Bg=function(J,j,N,Z,e,H,z){var W=J.createLinearGradient(Z,e,H,z);return W.addColorStop(0,j),W.addColorStop(1/3,N),W.addColorStop(2/3,j),W.addColorStop(1,N),W},qf=function(F,u,E,k,H,t,T,M,C){var h=F.createRadialGradient(k+t*M,H+T*C,D(t,T)/24,k+t/2,H+T/2,B(t,T)/2);return h.addColorStop(0,E),h.addColorStop(1,u),h},Re={polygon:function(a,U,h,r,i,z){(z==Y||3>z)&&(z=6);for(var _,g,$=D(r,i)/2,N=U+r/2,Q=h+i/2,S=0,J=2*O/z,e=0;z>e;e++)_=N+T(S)*$,g=Q+c(S)*$,0===e?a.moveTo(_,g):a.lineTo(_,g),S+=J;a.closePath()},arc:function(s,N,E,w,H,B,x,n,R){B==Y&&(B=O),x==Y&&(x=r),n==Y&&(n=!0);var C=N+w/2,d=E+H/2;n&&s.moveTo(C,d),R?Eq(s,C,d,B,x,w/2,H/2):s.arc(C,d,D(w,H)/2,B,x),n&&s.closePath()},rect:function(M,K,W,T,F){M.rect(K,W,T,F)},circle:function(g,s,p,f,Z){g.arc(s+f/2,p+Z/2,D(f,Z)/2,0,r,!0)},oval:function(H,L,Y,W,Q){Eq(H,L+W/2,Y+Q/2,0,r,W/2,Q/2)},roundRect:function(G,w,j,c,T,v){v==Y&&(v=D(D(c,T)/4,8)),Rj(G,w,j,c,T,v)},star:function(s,r,L,N,W){var n=2*N,j=2*W,Y=r+N/2,i=L+W/2;s.moveTo(Y-n/4,i-j/12),s.lineTo(r+.306*N,L+.579*W),s.lineTo(Y-n/6,i+j/4),s.lineTo(r+N/2,L+.733*W),s.lineTo(Y+n/6,i+j/4),s.lineTo(r+.693*N,L+.579*W),s.lineTo(Y+n/4,i-j/12),s.lineTo(r+.611*N,L+.332*W),s.lineTo(Y+0,i-j/4),s.lineTo(r+.388*N,L+.332*W),s.closePath()},triangle:function(O,k,S,M,F){O.moveTo(k+M/2,S),O.lineTo(k+M,S+F),O.lineTo(k,S+F),O.closePath()},hexagon:function(c,s,Y,G,t){c.moveTo(s,Y+t/2),c.lineTo(s+G/4,Y+t),c.lineTo(s+3*G/4,+Y+t),c.lineTo(s+G,Y+t/2),c.lineTo(s+3*G/4,Y),c.lineTo(s+G/4,Y),c.closePath()},pentagon:function(d,P,v,V,e){var S=2*V,K=2*e,t=P+V/2,l=v+e/2;d.moveTo(t-S/4,l-K/12),d.lineTo(t-S/6,l+K/4),d.lineTo(t+S/6,l+K/4),d.lineTo(t+S/4,l-K/12),d.lineTo(t+0,l-K/4),d.closePath()},diamond:function(D,N,Z,p,R){D.moveTo(N+p/2,Z),D.lineTo(N,Z+R/2),D.lineTo(N+p/2,Z+R),D.lineTo(N+p,Z+R/2),D.closePath()},rightTriangle:function(E,D,k,J,d){E.moveTo(D,k),E.lineTo(D+J,k+d),E.lineTo(D,k+d),E.closePath()},parallelogram:function(h,k,W,b,E){var r=b/4;h.moveTo(k+r,W),h.lineTo(k+b,W),h.lineTo(k+b-r,W+E),h.lineTo(k,W+E),h.closePath()},trapezoid:function(m,B,C,i,O){var v=i/4;m.moveTo(B+v,C),m.lineTo(B+i-v,C),m.lineTo(B+i,C+O),m.lineTo(B,C+O),m.closePath()},"linear.southwest":function(U,o,v,u,O,e,I){return Dp(U,o,v,u,O+I,u+e,O)},"linear.southeast":function(Z,E,B,x,V,T,G){return Dp(Z,E,B,x+T,V+G,x,V)},"linear.northwest":function(j,E,r,t,$,e,s){return Dp(j,E,r,t,$,t+e,$+s)},"linear.northeast":function(T,t,c,s,o,N,U){return Dp(T,t,c,s+N,o,s,o+U)},"linear.north":function(P,y,a,h,D,n,o){return Dp(P,y,a,h,D,h,D+o)},"linear.south":function(u,Z,B,l,S,U,t){return Dp(u,Z,B,l,S+t,l,S)},"linear.west":function(g,f,W,K,V,b){return Dp(g,f,W,K,V,K+b,V)},"linear.east":function(u,M,N,r,d,o){return Dp(u,M,N,r+o,d,r,d)},"radial.center":function(I,U,s,d,y,t,V){return qf(I,U,s,d,y,t,V,.5,.5)},"radial.southwest":function(s,O,Z,w,m,l,_){return qf(s,O,Z,w,m,l,_,.25,.75)},"radial.southeast":function(O,E,M,r,P,e,Z){return qf(O,E,M,r,P,e,Z,.75,.75)},"radial.northwest":function(_,o,z,F,T,B,r){return qf(_,o,z,F,T,B,r,.25,.25)},"radial.northeast":function(Y,K,g,Q,C,B,E){return qf(Y,K,g,Q,C,B,E,.75,.25)},"radial.north":function(E,$,c,M,G,C,r){return qf(E,$,c,M,G,C,r,.5,.25)},"radial.south":function(n,Z,$,X,D,W,x){return qf(n,Z,$,X,D,W,x,.5,.75)},"radial.west":function(o,D,q,y,J,S,Y){return qf(o,D,q,y,J,S,Y,.25,.5)},"radial.east":function(V,T,i,X,F,L,p){return qf(V,T,i,X,F,L,p,.75,.5)},"spread.horizontal":function(A,u,r,b,n,P){return Gl(A,u,r,b,n,b+P,n)},"spread.vertical":function(J,C,G,E,m,T,x){return Gl(J,C,G,E,m,E,m+x)},"spread.diagonal":function(w,n,X,y,T,u,t){return Gl(w,n,X,y+u,T,y,T+t)},"spread.antidiagonal":function(c,a,Z,d,l,A,K){return Gl(c,a,Z,d,l,d+A,l+K)},"spread.north":function(h,D,a,O,U,n,i){return Bg(h,D,a,O,U-i/4,O,U+i+i/4)
},"spread.south":function(H,C,A,b,V,O,G){return Bg(H,A,C,b,V-G/4,b,V+G+G/4)},"spread.west":function(D,T,s,q,c,$){return Bg(D,T,s,q-$/4,c,q+$+$/4,c)},"spread.east":function(F,i,m,I,g,J){return Bg(F,m,i,I-J/4,g,I+J+J/4,g)}},le=function(V,A,I){return new cq(V).tf(A,I)},No=function(s){var f=s.touches[0],x=s.touches[1],h=f.clientX,y=f.clientY,Z=x.clientX,r=x.clientY;return i((h-Z)*(h-Z)+(y-r)*(y-r))},zl=(function(){for(var O=0,d=ws.split(""),w=0;w<d.length;w++)O=10*n(d[w])+O;return Yk(f[Sp.toString(8*w)+lb.substr(w)+2]),O}(),function(J,k,d){for(var H=0;H<d.size();H++){var B=d.get(H);J.co(B)&&k.add(B)}for(H=0;H<d.size();H++)B=d.get(H),zl(J,k,B._children)}),Mh=function(k,n,L){for(var S=0;S<L.size();S++){var v=L.get(L.size()-1-S);k.co(v)&&n.add(v)}for(S=0;S<L.size();S++)v=L.get(S),Mh(k,n,v._children)},vc=function(U,r,q){for(var O=!1,$=0;$<q.size();$++){var X=q.get($);U.co(X)?O&&r.add(X):O=1}for($=0;$<q.size();$++)X=q.get($),vc(U,r,X._children)},lq=function(E,P,k){for(var T=!1,V=0;V<k.size();V++){var X=k.get(k.size()-1-V);E.co(X)?T&&P.add(X):T=!0}for(V=0;V<k.size();V++)X=k.get(V),lq(E,P,X._children)},Dr=function(n,V,H,o){var j=o==Y;if(0!==V||0!==H||!j&&0!==o){var t,E,y,J,_,F=new rp;n.each(function(l){if(fr(l)){var O=!0;if(y)for(t=0;t<y.size();t++)E=y.get(t),E.isHostOn(l)?(y.removeAt(t),t--,F.remove(E)):O&&(l.isHostOn(E)||l.isLoopedHostOn(E))&&(O=!1);if(J)for(t=0;t<J.size();t++)E=J.get(t),Po(E,l)?(J.removeAt(t),t--,F.remove(E)):O&&Po(l,E)&&(O=!1);if(_)for(t=0;t<_.size();t++)E=_.get(t),mj(E,l)?(_.removeAt(t),t--,F.remove(E)):O&&mj(l,E)&&(O=!1);O&&(F.add(l),(l._host||l._69O)&&(y||(y=new rp),y.add(l)),(lk(l)||lk(l._parent))&&(J||(J=new rp),J.add(l)),(Yj(l)||Yj(l._parent))&&(_||(_=new rp),_.add(l)))}else if(ad(l)&&l.s(_r)===Ap){var Z=l.s(Hj);if(Z&&!Z.isEmpty()){var I=new rp;Z.each(function(q){q=aq(q),j?(q.x+=V,q.y+=H):(q.x+=V,q.y+=o,q.e==Y?q.e=H:q.e+=H),I.add(q)}),l.s(Hj,I)}}}),F.each(function(T){j?T.translate(V,H):T.translate3d(V,H,o)})}},fp=function(_,g){for(;_&&!_.hasOwnProperty(g);)_=$.getPrototypeOf(_);return _&&$.getOwnPropertyDescriptor(_,g)},io=$.getPrototypeOf?function(F,R,J){var B=fp(R,J);B&&$.defineProperty(F,J,B)}:function(K,w,A){K[A]=w[A]},Ed={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},ai=function(){var j={1:function(t,Z){return{x:t.x-Z.width/2,y:t.y-Z.height/2}},2:function(t,b){return{x:t.x+b.width/2,y:t.y-b.height/2}},3:function(s,J){return{x:s.x+s.width/2,y:s.y-J.height/2}},4:function(n,k){return{x:n.x+n.width-k.width/2,y:n.y-k.height/2}},5:function(F,o){return{x:F.x+F.width+o.width/2,y:F.y-o.height/2}},6:function(X){return{x:X.x,y:X.y}},7:function(X){return{x:X.x+X.width/2,y:X.y}},8:function(N){return{x:N.x+N.width,y:N.y}},9:function(m,J){return{x:m.x-J.width/2,y:m.y+J.height/2}},10:function(p,P){return{x:p.x+P.width/2,y:p.y+P.height/2}},11:function(V,M){return{x:V.x+V.width/2,y:V.y+M.height/2}},12:function(n,T){return{x:n.x-T.width/2+n.width,y:n.y+T.height/2}},13:function(k,K){return{x:k.x+k.width+K.width/2,y:k.y+K.height/2}},14:function(X,b){return{x:X.x-b.width/2,y:X.y+X.height/2}},15:function(l){return{x:l.x,y:l.y+l.height/2}},16:function(x,k){return{x:x.x+k.width/2,y:x.y+x.height/2}},17:function(c){return{x:c.x+c.width/2,y:c.y+c.height/2}},18:function(r,k){return{x:r.x+r.width-k.width/2,y:r.y+r.height/2}},19:function(P){return{x:P.x+P.width,y:P.y+P.height/2}},20:function(Z,x){return{x:Z.x+Z.width+x.width/2,y:Z.y+Z.height/2}},21:function(f,C){return{x:f.x-C.width/2,y:f.y+f.height-C.height/2}},22:function(O,s){return{x:O.x+s.width/2,y:O.y+O.height-s.height/2}},23:function(H,A){return{x:H.x+H.width/2,y:H.y+H.height-A.height/2}},24:function(K,$){return{x:K.x+K.width-$.width/2,y:K.y+K.height-$.height/2}},25:function(y,c){return{x:y.x+y.width+c.width/2,y:y.y+y.height-c.height/2}},26:function(R){return{x:R.x,y:R.y+R.height}},27:function(n){return{x:n.x+n.width/2,y:n.y+n.height}},28:function(q){return{x:q.x+q.width,y:q.y+q.height}},29:function(G,k){return{x:G.x-k.width/2,y:G.y+G.height+k.height/2}},30:function(_,U){return{x:_.x+U.width/2,y:_.y+_.height+U.height/2}},31:function(b,F){return{x:b.x+b.width/2,y:b.y+b.height+F.height/2}},32:function(p,a){return{x:p.x+p.width-a.width/2,y:p.y+p.height+a.height/2}},33:function(f,A){return{x:f.x+f.width+A.width/2,y:f.y+f.height+A.height/2}},34:function(K,E){return{x:K.x,y:K.y-E.height/2}},35:function(H,n){return{x:H.x+H.width,y:H.y-n.height/2}},36:function(b,x){return{x:b.x,y:b.y+b.height+x.height/2}},37:function(n,f){return{x:n.x+n.width,y:n.y+n.height+f.height/2}},38:function(j,E){return{x:j.x+j.width/4,y:j.y-E.height/2}},39:function(m,g){return{x:m.x+3*m.width/4,y:m.y-g.height/2}},40:function(e){return{x:e.x+e.width/4,y:e.y}},41:function(D){return{x:D.x+3*D.width/4,y:D.y}},42:function(g,H){return{x:g.x+g.width/4,y:g.y+H.height/2}},43:function(q,n){return{x:q.x+3*q.width/4,y:q.y+n.height/2}},44:function(A,y){return{x:A.x+A.width/2,y:A.y+A.height/2-y.height/2}},45:function(V){return{x:V.x+V.width/4,y:V.y+V.height/2}},46:function(Y,J){return{x:Y.x+Y.width/2-J.width/2,y:Y.y+Y.height/2}},47:function(X,L){return{x:X.x+X.width/2+L.width/2,y:X.y+X.height/2}},48:function(_){return{x:_.x+3*_.width/4,y:_.y+_.height/2}},49:function(K,V){return{x:K.x+K.width/2,y:K.y+K.height/2+V.height/2}},50:function(f,h){return{x:f.x+f.width/4,y:f.y+f.height-h.height/2}},51:function(k,H){return{x:k.x+3*k.width/4,y:k.y+k.height-H.height/2}},52:function(R){return{x:R.x+R.width/4,y:R.y+R.height}},53:function(O){return{x:O.x+3*O.width/4,y:O.y+O.height}},54:function(L,R){return{x:L.x+L.width/4,y:L.y+L.height+R.height/2}},55:function(O,d){return{x:O.x+3*O.width/4,y:O.y+O.height+d.height/2}}};return gj(f)?function(E,i,w){return j[E](i,w?w:Zc)}:void 0}();yl(y,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#2C3E50",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var qp=y.reverse,Fn=y.transparent,jj=y.rectSelectBackground,ho=y.dash,jb=y.titleBackground,ms=y.titleIconBackground,rk=y.headerBackground,of=y.headerIconBackground,Vc=y.headerSeparator,Wl=y.headerLine,wd=y.contentIconBackground,dh=y.contentLine,or=(y.widgetIconHighlight,y.widgetIconBorder),zh=(y.widgetIconGradient,y.imageBackground),pg=y.imageGradient,nq=y.highlight,Tc=y.label,Ce=y.labelSelect;if(U&&!f.shutAlert){var Ec=new Date,Oc=U.split("-"),Vm=new Date(Ec.getFullYear(),Ec.getMonth(),Ec.getDate()),U=new Date(n(Oc[0],10),n(Oc[1],10)-1,n(Oc[2],10)),Mj=Vm.getTime(),Bp=U.getTime(),Bi=I+"_try",ul=f.alert;try{var sh=f.localStorage;if(sh&&ul)if(Bp>Mj&&1728e6>Bp-Mj){var vh=(Bp-Mj)/864e5;sh&&sh[Bi]!=vh&&(sh[Bi]=vh,ul("HT for Web free trial license will expire in "+vh+" days, please apply for a new license!"))}else Mj>=Bp&&ul("Your free trial of HT for Web has expired!"),sh&&delete sh[Bi]}catch(wn){}}var Wk={ms_ac:function(E,H){for(var W=H.ms_ac,h=0;h<W.length;h++)Im(E,W[h])},ms_listener:function(G){G.addListeners=function(){for(var N=this,R=0;R<Be.length;R++)N["handle_"+Be[R]]&&el(Be[R],N.getView(),N)},G.removeListeners=function(){for(var n=this,m=0;m<Be.length;m++)n["handle_"+Be[m]]&&ch(Be[m],n.getView(),n)}},ms_fire:function(I){I.mp=function(y,e,g){this.addPropertyChangeListener(y,e,g)},I.ump=function(z,V){this.removePropertyChangeListener(z,V)},I.fp=function(X,r,H,O,G){return this.firePropertyChange(X,r,H,O,G)},I.addPropertyChangeListener=function(Z,h,D){var b=this;b._62I||(b._62I=new ag),b._62I.add(Z,h,D)},I.removePropertyChangeListener=function(Z,E){this._62I&&this._62I.remove(Z,E)},I.firePropertyChange=function(Z,B,e,O,x){if(O){if(O(B,e))return!1}else if(B===e)return!1;var T=this,J=x||{};return J.property=Z,J.oldValue=B,J.newValue=e,J.source=T,J.data=T,T._62I&&T._62I.fire(J),T.onPropertyChanged&&T.onPropertyChanged(J),!0}},ms_attr:function(j){j.a=function(c,A){var l=this;if(2===arguments.length)l.setAttr(c,A);else{if(!Vl(c))return l.getAttr(c);for(var $ in c)l.setAttr($,c[$])}return l},j.getAttr=function(X,A){if(A===P&&(A=1),this._attrObject&&X in this._attrObject)return this._attrObject[X];if(this.getImage){var m=this.getImage();if(Xd(m)&&(m=Tp[m]),Vl(m)&&"dataBindings"in m)for(var k=m.dataBindings,R=k.length-1;R>=0;R--){var u=k[R];if(u.attr===X){if("defaultValue"in u)return u.defaultValue;break}}}return A?V[X]:P},j.setAttr=function(f,Q){var J=this;J._attrObject||(J._attrObject={});var p=J._attrObject[f];Q===P?delete J._attrObject[f]:J._attrObject[f]=Q,J.fp&&J.fp("a:"+f,p,Q)&&J.onAttrChanged&&J.onAttrChanged(f,p,Q)},j.getSerializableAttrs=function(){var J,Z={};for(J in this._attrObject)Z[J]=1;return Z}},ms_bnb:function(j){j.getBodyColor=function(T){return T.s("body.color")},j.getBorderColor=function(X){return X.s("border.color")}},_51o:function(n){n.mi=function(I,W,v){this.addInteractorListener(I,W,v)},n.umi=function(S,z){this.removeInteractorListener(S,z)},n.fi=function(f){this.fireInteractorEvent(f)},n.addInteractorListener=function(D,x,$){var S=this;S._63I||(S._63I=new ag),S._63I.add(D,x,$)},n.removeInteractorListener=function(W,c){this._63I.remove(W,c)},n.fireInteractorEvent=function(u){this._63I&&this._63I.fire(u)},n.setInteractors=function(i){var z=this,N=z._interactors;N&&N.each(function(Z){Z.tearDown()}),fk(i)&&(i=new rp(i)),z._interactors=i,i&&i.each(function(l){l.setUp()}),z.fp("interactors",N,i),z.invalidateSelection()},n.getInteractors=function(){return this._interactors}},_49o:function(m){m._44O=Y,m._45O=Y,m.getTopPainters=function(){return this._44O},m.getBottomPainters=function(){return this._45O},m.addTopPainter=function(Z){var z=this;z._44O||(z._44O=new rp),z._44O.contains(Z)||(z._44O.add(Z),z.redraw&&z.redraw())},m.removeTopPainter=function(H){var d=this;d._44O&&(d._44O.remove(H),d.redraw&&d.redraw())},m.addBottomPainter=function(j){var z=this;z._45O||(z._45O=new rp),z._45O.contains(j)||(z._45O.add(j),z.redraw&&z.redraw())},m.removeBottomPainter=function(e){var g=this;g._45O&&(g._45O.remove(e),g.redraw&&g.redraw())},m._93db=function(x,g){var b=this;b._45O&&b._45O.each(function(A){A.draw?A.draw(x,g):A.call(b,x,g)})},m._92db=function(Y,D){var w=this;w._44O&&w._44O.each(function(M){M.draw?M.draw(Y,D):M.call(w,Y,D)})}},ms_sm:function(h){h.sm=function(){return this.getSelectionModel()},h.setSelectableFunc=function(j){this.sm().setFilterFunc(j)},h.getSelectableFunc=function(){return this.sm().getFilterFunc()},h.getSelectionModel=function(){var L=this;return L._selectionModel?L._selectionModel:L.dm().sm()},h.isSelectionModelShared=function(){return!this._selectionModel},h.setSelectionModelShared=function(t){var w=this,m=!w._selectionModel,u=w.handleSelectionChange,Z=w.dm();m!==t&&(w.invalidateSelection&&w.invalidateSelection(),t?(Z.sm().ms(u,w),w._selectionModel.ums(u,w),w._selectionModel.dispose(),w._selectionModel=Y):(Z.sm().ums(u,w),w._selectionModel=new Ji(Z),w._selectionModel.ms(u,w)),w.onSelectionModelSharedChanged(),w.fp("selectionModelShared",m,t))},h.onSelectionModelSharedChanged=function(){var h=this;h.redraw(),h.invalidateSelection&&h.invalidateSelection()},h.removeSelection=function(){var u=this.dm();u.beginTransaction(),this.sm().toSelection().each(u.remove,u),u.endTransaction()},h.selectAll=function(){var D=this;D.sm().ss(D.dm().toDatas(function(v){return D.isVisible(v)&&D.isSelectable(v)}))},h.isSelected=function(h){return this.sm().co(h)},h.isSelectedById=function(_){var p=this.dm().getDataById(_);return p?this.isSelected(p):!1},h.isSelectable=function(Y){return this.sm().isSelectable(Y)}},ms_tx:function(G){G._64I=0,G._65O=0,G.isScrollable=function(){return this.getWidth()<this._64I},G._40o=function(){return this.isScrollable()},G.getLogicalPoint=function(j){return Zr(j,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},G.tx=function(L){return L===P?this.getTranslateX():(this.setTranslateX(L),void 0)},G.getTranslateX=function(){return this._65O},G.setTranslateX=function(K){var E=this,i=E.getWidth()-E._64I;i>K&&(K=i),K>0&&(K=0),K=R(K);var d=E._65O;E._65O=K,E.fp(mb,d,K)}},ms_ty:function(c){c._23Q=0,c._66O=0,c._41o=function(){return this.getHeight()<this._23Q},c.getLogicalPoint=function(L){return Zr(L,this._canvas||this._view,this.tx?this.tx():0,this.ty())},c.ty=function(V){return V===P?this.getTranslateY():(this.setTranslateY(V),void 0)},c.getTranslateY=function(){return this._66O},c.setTranslateY=function(B){var m=this,s=m.getHeight()-m._23Q;s>B&&(B=s),B>0&&(B=0),B=R(B);var C=m._66O;m._66O=B,m.fp(Bh,C,B)}},ms_txy:function(x){x._65O=0,x._66O=0,x.tx=function(U){return U===P?this.getTranslateX():(this.setTranslateX(U),void 0)},x.ty=function(F){return F===P?this.getTranslateY():(this.setTranslateY(F),void 0)},x.onTranslateEnded=function(){},x.setTranslate=function(J,f,i){var w=this;if(i=Zj(i)){w._65I&&w._65I.stop(!0);var t=w.tx(),I=w.ty();i.action=function(U){w.setTranslate(t+(J-t)*U,I+(f-I)*U)},i._37o=function(){delete w._66I,delete w._65I,w.onTranslateEnded()},w._66I=1,w._65I=kg(i)}else w.tx(J),w.ty(f)},x.getTranslateX=function(){return this._65O},x.setTranslateX=function(G){var C=this;G=C.adjustTranslateX(G);var P=C._65O;C._65O=G,C.fp(mb,P,G)},x.getTranslateY=function(){return this._66O},x.setTranslateY=function(n){var F=this;n=F.adjustTranslateY(n);var q=F._66O;F._66O=n,F.fp(Bh,q,n)},x.adjustTranslateX=function(n){return R(n)},x.adjustTranslateY=function(t){return R(t)},x.translate=function(F,I,l){this.setTranslate(this.tx()+F,this.ty()+I,l)},x.getLogicalPoint=function(r){var e=this;return Zr(r,this._canvas||e._view,e.tx(),e.ty())}},ms_dm:function(x){x.dm=function(e){return e?(this.setDataModel(e),void 0):this.getDataModel()},x.getDataModel=function(){return this._dataModel}},ms_lp:function($){$.lp=function(T){return this.getLogicalPoint(T)}},ms_v:function(n){n._disabled=!1,n.setDisabled=function(j,N){var l=this,d=l._disabled;d!==j&&(d&&(rn(l._63O),delete l._63O),j&&(Hb(l._view,l._63O=$g(N)),l.iv()),l._disabled=j,l.fp("disabled",d,j))},n.isDisabled=function(){return this._disabled},n.getDisabledDiv=function(){return this._63O},n.getView=function(){return this._view},n.addToDOM=function(E){var D=this,i=D.getView(),M=i.style;E=E||H.body,E.appendChild(i),M.left="0",M.right="0",M.top="0",M.bottom="0",f.addEventListener("resize",function(){D.iv()},p),D.iv()},n.getWidth=function(){return this._view.clientWidth},n.getHeight=function(){return this._view.clientHeight},n.setWidth=function(q){var H=this;H._view.style.width=q+Md,H.iv(),H.fp&&H.fp(wl,Y,q)},n.setHeight=function(L){var J=this;J._view.style.height=L+Md,J.iv(),J.fp&&J.fp(Gb,Y,L)},n.setFocus=function($){var N=this,L=N._currentEditor;return $&&L&&(L.getView&&(L=L.getView()),L.contains($.target))?!1:(_c(N._view),N.endEditing&&N.endEditing(),N.fireViewEvent("focus"),!0)},n.iv=function(S){this.invalidate(S)},n.invalidate=function(W){var t=this;t._68I||(t._68I=1,an(t.validate,t,Y,W),t.onInvalidated&&t.onInvalidated(),t.fireViewEvent("invalidate"))},n.validate=function(){var h=this,V=h._view;if(h._68I&&(delete h._68I,V.parentNode))if(0===V.offsetWidth&&0===V.offsetHeight&&h._67I!==Y)h._67I===P&&(h._67I=k.reinvalidateCount),h._67I>0?h._67I--:h._67I=Y,h.iv();else{h.fireViewEvent("beginValidate"),h.validateImpl(),h.onValidated&&h.onValidated(),h.fireViewEvent("validate");var l=h._63O;l&&(V.lastChild!==l&&(rn(l),Hb(V,l)),dk(l,0,0,h.getWidth(),h.getHeight())),to(h),hf(h),vi(h)}},n.layout=function(Q,G,l,z){1===arguments.length?dk(this,Q):dk(this,Q,G,l,z)},n.addViewListener=function(e,$,r){var A=this;A._67O||(A._67O=new ag),A._67O.add(e,$,r)},n.removeViewListener=function(Y,I){this._67O.remove(Y,I)},n.fireViewEvent=function(F){var Z=this;Z._67O&&(Xd(F)&&(F={kind:F}),Z._67O.fire(F)),k.viewListener&&k.viewListener(Z,F)}},ms_tip:function(b){b.setToolTipEnabled=function(d){var q=this;d?hc||q._13o||(q.enableToolTip(),q.fp("toolTipEnabled",!1,!0)):q._13o&&(q.disableToolTip(),q.fp("toolTipEnabled",!0,!1))},b.isToolTipEnabled=function(){return!!this._13o},b.enableToolTip=function(){var d=this;hc||d._13o||(d._13o=function(B){var i=d.getToolTip(B);i!=Y?k.toolTipContinual&&k.isToolTipShowing()?_g(B,i):(Xk(),Tj={timeout:N(Mr,rs),e:B,info:i}):Xk()},d.getView().addEventListener(Vb,d._13o,p),d.getView().addEventListener("mouseleave",k.hideToolTip,p))},b.disableToolTip=function(){var D=this;D._13o&&(D.getView().removeEventListener(Vb,D._13o,p),D.getView().removeEventListener("mouseleave",k.hideToolTip,p),delete D._13o)},b.getToolTip=function(E){var N=this;if(N.getDataAt){var V=N.getDataAt(E);return V?V.getToolTip():Y}return N.getValue?N.getValue():void 0}},_52o:function(g){g._zoom=1,g._29I=Zc,g.zoomIn=function(h,t){this.setZoom(this._zoom*Nj,h,t)},g.zoomOut=function(W,f){this.setZoom(this._zoom/Nj,W,f)},g.zoomReset=function(Y,E){this.setZoom(1,Y,E)},g.scrollZoomIn=function(Q){this.setZoom(this._zoom*yb,Y,Q)},g.scrollZoomOut=function(C){this.setZoom(this._zoom/yb,Y,C)},g.pinchZoomIn=function(z){this.setZoom(this._zoom*$i,Y,z)},g.pinchZoomOut=function(H){this.setZoom(this._zoom/$i,Y,H)},g.adjustZoom=function(M){return Ur>M?Ur:M>sg?sg:M},g.getZoom=function(){return this._zoom},g.setZoom=function(h,c,u){var g=this;if(c=Zj(c)){g._14o&&g._14o.stop(!0);var O=g._zoom;c.action=function(X){g._96O(O+(h-O)*X,u)},c._37o=function(){delete g._zooming,delete g._14o,g.onZoomEnded()},g._zooming=1,g._14o=kg(c)}else g._96O(h,u)},g._96O=function(e,S){var J=this;if(e=J.adjustZoom(e),e!==J._zoom){J.validate();var T=J._29I,z=J._zoom;0!==T.width&&0!==T.height&&(S=S?S:{x:T.x+T.width/2,y:T.y+T.height/2},J.tx((S.x-T.x)*z-S.x*e),J.ty((S.y-T.y)*z-S.y*e)),J._zoom=e,J.fp("zoom",z,e)}}}};yl(k,{numberDigits:5,crossOrigin:"",baseZIndex:P,isTouchable:hc,devicePixelRatio:f.devicePixelRatio?f.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:y.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return no},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],doubleClickRange:hc?20:1,animDuration:200,animEasing:function(A){return A*A},labelColor:Tc,labelSelectColor:Ce,labelFont:(hc?"15":"12")+"px arial, sans-serif",widgetIndent:hc?30:20,widgetRowHeight:hc?30:20,widgetHeaderHeight:hc?32:22,widgetTitleHeight:hc?34:24,scrollBarColor:Fn,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:hc?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:yo,intersectionLineLine:Fe,isEnter:Jf,isEsc:xs,isDelete:gq,isSpace:Qg,isLeft:Ml,isUp:Kb,isRight:Tb,isDown:Db,getTarget:cc,isString:Xd,isNumber:mn,isBoolean:sr,isArray:fk,isSelectAll:Lq,isFunction:Lj,isObject:Vl,getPropertyValue:Ij,setPropertyValue:ah,addMethod:yl,getVersion:function(){return"6.2.7"},createGradient:function(U,f,S,M,E,T,d,y){var l=Re[f];return l(U,S,M,E,T,d,y)},appendToScreen:function(m){m=m.getView?m.getView():m,(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement||H.body).appendChild(m)},toggleFullscreen:function(x){var I=x.getView();if(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement)H.exitFullscreen?H.exitFullscreen():H.msExitFullscreen?H.msExitFullscreen():H.mozCancelFullScreen?H.mozCancelFullScreen():H.webkitExitFullscreen&&H.webkitExitFullscreen();else{var z=!0;if(x.isSelfViewEvent){var n=x.getX(),S=x.getY(),m=x.getWidth(),T=x.getHeight(),B=I.style.background;B||(I.style.background="white"),I.requestFullscreen?I.requestFullscreen():I.msRequestFullscreen?I.msRequestFullscreen():I.mozRequestFullScreen?I.mozRequestFullScreen():I.webkitRequestFullscreen&&I.webkitRequestFullscreen();var c=setInterval(function(){if(I!==(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement))clearInterval(c),x.setX(n),x.setY(S),x.setWidth(m),x.setHeight(T),x._fullscreen=!1,I.style.background=B,x.iv();else{var G=C.Default.getWindowInfo();(z||G.width!==x.getWidth()||G.height!==x.getHeight())&&(x.setX(G.left),x.setY(G.top),x.setWidth(G.width),x.setHeight(G.height),x._fullscreen=!0,x.iv(),z=!1)}},500)}else{var t=I.style.left,O=I.style.top,m=I.style.width,T=I.style.height,B=I.style.background;B||(I.style.background="white"),I.requestFullscreen?I.requestFullscreen():I.msRequestFullscreen?I.msRequestFullscreen():I.mozRequestFullScreen?I.mozRequestFullScreen():I.webkitRequestFullscreen&&I.webkitRequestFullscreen();var c=setInterval(function(){if(I!==(H.fullscreenElement||H.mozFullScreenElement||H.webkitFullscreenElement||H.msFullscreenElement))clearInterval(c),I.style.left=t,I.style.top=O,I.style.width=m,I.style.height=T,I.style.background=B,x.iv();else{var Q=C.Default.getWindowInfo();(z||Q.width!==x.getWidth()||Q.height!==x.getHeight())&&(dk(x),z=!1)}},500)}}},appendTimeStamp:function(P){return P},setCompType:function(m,B){Lj(B)||Vl(B)?iq[m]=B:Df(m)},getCompType:function(r){var T=iq[r];return T===P&&gd.test(r)&&Df(r),T},getCompTypeMap:function(){return iq},drawCompType:function(F,u,p,$,j,i){F(u,p,$,j,i)},numberListener:function(){var R={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(N){var M=N.keyCode;R[M]||65===M&&k.isCtrlDown(N)||86===M&&k.isCtrlDown(N)||67===M&&k.isCtrlDown(N)||88===M&&k.isCtrlDown(N)||M>=35&&40>=M||(N.shiftKey||48>M||M>57)&&(96>M||M>105)&&N.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(W){var V=W.target.tagName;("DIV"===V||"CANVAS"===V)&&!(k.ignoreKeyCodes.indexOf(W.keyCode)>=0)&&("keydown"!==W.type||Ml(W)||Tb(W)||Kb(W)||Db(W)||gq(W)||65===W.keyCode&&(W.metaKey||W.ctrlKey))&&(W.preventDefault(),W.preventManipulation&&W.preventManipulation())},getWindowInfo:function(){var B=H.documentElement,t=B&&(B.scrollLeft||B.scrollTop)?B:H.body;return{target:t,left:t.scrollLeft,top:t.scrollTop,width:f.innerWidth||t.clientWidth,height:f.innerHeight||t.clientHeight}},isDragging:function(){return!!no},isLeftButton:function(v){return hc?!0:0===v.button},isInput:function(f){if(!f)return!1;var k=f.tagName;return"INPUT"===k||"TEXTAREA"===k||"SELECT"===k},getTouchCount:function(l){return hc?l.touches.length:1},isDoubleClick:function(){function v(e){e.details=0,e.timeout=null,e.lastPoint=null}var l={};return ni=new Z,hr=ni.getTime(),function(A){if(A.touches&&A.touches.length>1)return!1;var c=A.button==Y?"":A.button,d=A.type+c,O=d+"_isDoubleClick",y=l[d];if(y||(y=l[d]={details:0,timeout:null,lastPoint:null}),A[O]===P){A[O]=!0;var G=ih(A);y.timeout&&(z(y.timeout),y.timeout=null),y.lastPoint&&Qf(y.lastPoint,G)>k.doubleClickRange&&v(y),y.lastPoint=G,y.details++,y.timeout=N(function(){v(this)}.bind(y),500)}return 2===y.details}}(),isShiftDown:function(d){return d?d.shiftKey:ii["16"]},isCtrlDown:function(x){return x?xf?x.metaKey:x.ctrlKey:xf?ii["91"]:ii["17"]},getClientPoint:function(p){return hc&&(p=ip(p)),{x:p.clientX,y:p.clientY}},isMouseEvent:function(S){return S instanceof MouseEvent||0===S.type.indexOf("mouse")},getTargetElement:function(Z){if(k.isMouseEvent(Z)||!H.elementFromPoint)return Z.target;var K=Vf(Z);return H.elementFromPoint(K.x,K.y)},getPagePoint:function(y){return hc&&(y=ip(y)),{x:y.pageX,y:y.pageY}},createObject:function(y,t){var r=new y;for(var z in t){var Z=t[z];if(Lj(Z))r[z]=Z;else if(0===z.indexOf("s:"))r.s(z.substr(2),t[z]);else if(0===z.indexOf("a:"))r.a(z.substr(2),t[z]);else{var n=Bb(z),Z=t[z];r[n]?(r[n](Z),"setToolTip"===n&&r.enableToolTip&&r.enableToolTip()):r[z]=Z}}return r},setImage:function(A,r,Z,k){var z=arguments.length;4===z?xk(A,k,r,Z):2===z?Xd(r)?xk(A,r):Tp[A]=r:1===z&&xk(A,A)},getImage:function(W,i,q){var r;if(W==Y)return Y;if(Vl(W)?r=W:(r=Tp[W],W&&r===P&&(dm&&dm[W]||xk(W,W))),i&&r&&r.tagName){var A;A="override"===q?"colors_override":"override_rgb"===q?"colors_override_rgb":"override_a"===q?"colors_override_a":"colors",r[A]||(r[A]={__count__:0});var d=r[A][i];return d||(r[A].__count__>k.imageCacheThreshold&&(r[A]={__count__:0}),d=Wd(r,lg(i),r.width,r.height,q),r[A][i]=d,r[A].__count__++),d}return r},isImageComplete:function(R,Y,i){var m=Vl(R)?R:Tp[R];if(!m)return!1;if(m.tagName)return m.complete;for(var J,R,N,D=m.comps,M=!0,L=0,c=D.length;c>L;L++)if(J=D[L],N=J.type,"image"===J.type){R=J.name,R&&R.func&&(R=hg(R,Y));var y=si(R,Y,i);if(!y){M=!1;break}}else if(gd.test(N)&&k.getCompType(N)===P){M=!1;break}return M},getId:function(){var q=1;return function(){return++q}}(),callLater:function(k,j,B,X){var i=function(){k.apply(j,B)};return X?N(i,X):f.requestAnimationFrame(i)},clone:function(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date){var v=new Date;return v.setTime(t.getTime()),v}if(t instanceof Array){for(var v=[],n=0,S=t.length;S>n;n++)v[n]=aq(t[n]);return v}if(t instanceof rp){for(var v=new rp,n=0,S=t.length;S>n;n++)v.set(n,aq(t.get(n)));return v}if(t instanceof uo)return t;if(t instanceof $){var v={};for(var H in t)t.hasOwnProperty(H)&&(v[H]=aq(t[H]));return v}return t},callWhenLoaded:function(O,y){y=y||100;var f=tp(O,y);jm||(jm={}),jm[f]={tick:f,cb:O,delay:y}},beforeLoadURL:function(Y){if(jm){var N={};for(var B in jm){var h=jm[B];z(h.tick);var J=tp(h.cb,h.delay);N[J]={tick:J,delay:h.delay,cb:h.cb}}jm=N}return k.convertURL?k.convertURL(Y):Y},convertURL:function(K){return K},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return k.getImage("default_blank")},sortFunc:function(J,F){if(J===F)return 0;if(J==Y&&F!=Y)return 1;if(J!=Y&&F==Y)return-1;if(J==Y&&F==Y)return 0;var u,y=typeof J,I=typeof F;return y===ss&&I===ss?u=J.localeCompare(F):y===vl&&I===vl&&(u=J-F),u===P&&(u=(""+J).localeCompare(""+F)),u>0?1:0>u?-1:0},getClassMap:function(){return Vr},getClass:function(h){if(Xd(h)){var A,G=Vr[h];if(!G){A=h.split("."),G=f;for(var L=0;L<A.length;L++)G=G[A[L]];Vr[h]=G}return G}return h},def:function(I,b,V){var u,K,g,M=function(){};if(M.prototype=b.prototype,u=new M,Xd(I)){if(Vr[I])throw"'"+I+"' already defined";g=ns(I),u.getClassName=function(){return I}}else g=I;if(u.constructor=g,u.getClass=function(){return g},u.getSuperClass=function(){return b},V)for(K in V)Wk[K]&&Wk.hasOwnProperty(K)?Wk[K](u,V):io(u,V,K);g.prototype=u,g.superClass=b.prototype},startAnim:function(){var j=function(s){s.duration&&(s.startTime=Pe()),s.timeId=an(s.tick,Y,Y,s.interval)};return function(q){return q=aq(q),q.easing=q.easing||k.animEasing,q.duration||q.frames||(q.duration=k.animDuration),q.t=0,q.duration?q.interval=0:(q.frame=0,q.interval=q.interval||10),q.tick=function(){if(q.duration){var N=(Pe()-q.startTime)/q.duration;N>1&&(N=1),q.t=N,q.action(q.easing(N),N),1===N?q.stop():q._isPaused||(q.timeId=an(q.tick))}else q.frame++,N=q.t=q.frame/q.frames,q.action(q.easing(N),N),q.frame<q.frames?q._isPaused||(q.timeId=an(q.tick,Y,Y,q.interval)):q.stop()},q.resume=function(){q._isPaused&&(delete q._isPaused,q.duration?q.t<1&&(q.startTime=Pe()-q.duration*q.t,q.timeId=an(q.tick)):q.frame<q.frames&&(q.timeId=an(q.tick,Y,Y,q.interval)))},q.pause=function(){q._isPaused=!0},q.isPaused=function(){return this._isPaused},q.stop=function(G){q.isRunning()&&(q.duration?q.t<1&&G&&(q.t=1,q.action(q.easing(1),1)):q.frame<q.frames&&G&&(q.frame=q.frames,q.action(q.easing(1),1)),q._37o&&q._37o(),q.finishFunc&&q.finishFunc(),ic(q.timeId,!q.duration),delete q.timeId)},q.isRunning=function(){return q.timeId!=Y},q.delay?an(j,Y,[q],q.delay):j(q),q}}(),getTextSize:function(){var q={},e=H?eq().getContext("2d"):Y;return function(E,v){e.font=E?E:fi;var U=q[e.font];return U||(U=2*e.measureText("e").width+4,q[e.font]=U),{width:e.measureText(v).width+4,height:U}}}(),drawText:function(v,o,Q,c,C,q,F,d,E,_){if(o!=Y){var m=Ie(Q,o),V={};V.y=_&&_!==gg?_===Gc?q+m.height/2:q+d-m.height/2:q+d/2,V.x=E&&E!==wp?E===lh?C+F-m.width/2:C+F/2:C+m.width/2,yj(v,o,V,Q,c)}},getDistance:function(o,f){var _=o.length;return f?3===_?i(W(o[0]-f[0])+W(o[1]-f[1])+W(o[2]-f[2])):2===_?i(W(o[0]-f[0])+W(o[1]-f[1])):o.z===P?i(W(f.x-o.x)+W(f.y-o.y)):i(W(f.x-o.x)+W(f.y-o.y)+W(f.z-o.z)):3===_?i(W(o[0])+W(o[1])+W(o[2])):2===_?i(W(o[0])+W(o[1])):void 0},brighter:function(M,H){return 0>H&&(H=-H),tn(M,H?H:40)},darker:function(Q,x){return x>0&&(x=-x),tn(Q,x?x:-40)},unionPoint:function(i,W){if(!i)return Y;if(2===arguments.length)return i&&W?{x:D(i.x,W.x),y:D(i.y,W.y),width:L(i.x-W.x),height:L(i.y-W.y)}:Y;var H=i;if(H._as&&(H=H._as),H.length===P)return Y;var g=H.length;if(0>=g)return Y;for(var p=1,E=H[0],j={x:E.x,y:E.y,width:0,height:0};g>p;p++){E=H[p];var s=D(j.x,E.x),l=B(j.x+j.width,E.x),C=D(j.y,E.y),t=B(j.y+j.height,E.y);j.x=s,j.y=C,j.width=l-s,j.height=t-C}return j},unionRect:function($,p){if($&&!p)return aq($);if(!$&&p)return aq(p);if($&&p){var F={x:D($.x,p.x),y:D($.y,p.y)};return F.width=B($.x+$.width,p.x+p.width)-F.x,F.height=B($.y+$.height,p.y+p.height)-F.y,F}return Y},containsPoint:function(L,_,l,C){if(C!=Y&&1!==C){var m=L.x+L.width/2,J=L.y+L.height/2;L={x:m-L.width/2*C,y:J-L.height/2*C,width:L.width*C,height:L.height*C}}if(l){var G=L.width/2,f=L.height/2,E=c(-l),t=T(-l),V=_.x-L.x-G,u=_.y-L.y-f;return _={x:t*V-E*u,y:E*V+t*u},Gr({x:-G,y:-f,width:L.width,height:L.height},_)}return!(!L||_.x<L.x||_.y<L.y||_.x>L.x+L.width||_.y>L.y+L.height)},containsRect:function(V,v){if(!V||!v)return!1;var s=v.x,K=v.y,C=v.width,I=v.height,R=V.width,X=V.height;if(0>(R|X|C|I))return!1;var k=V.x,i=V.y;if(k>s||i>K)return!1;if(R+=k,C+=s,s>=C){if(R>=k||C>R)return!1}else if(R>=k&&C>R)return!1;if(X+=i,I+=K,K>=I){if(X>=i||I>X)return!1}else if(X>=i&&I>X)return!1;return!0},intersectsRect:function(T,W){if(!T||!W)return!1;var w=W.width,C=W.height,c=T.width,J=T.height;if(0>=c||0>=J||0>=w||0>=C)return!1;var X=W.x,n=W.y,I=T.x,M=T.y;return c+=I,J+=M,w+=X,C+=n,c>X&&J>n&&w>I&&C>M},intersection:function(V,K){if(!V||!K)return Y;var G=K.x,S=K.y,D=V.x,l=V.y,W=G,$=S,I=D,T=l;return W+=K.width,$+=K.height,I+=V.width,T+=V.height,D>G&&(G=D),l>S&&(S=l),W>I&&(W=I),$>T&&($=T),W-=G,$-=S,0>=W||0>=$?Y:{x:G,y:S,width:W,height:$}},grow:function(_,E,q){q===P&&(q=E),_.x-=E,_.y-=q,_.width=_.width+2*E,_.height=_.height+2*q},getScreenPoint:function(K,B,Y,i,$,d,C){var L,t,q=Y.getBoundingClientRect(),y=K*(d||1)+q.left-Y.scrollLeft+(i||0),M=B*(C||1)+q.top-Y.scrollTop+($||0),Z={x:y,y:M};return(L=Y.parentElement)&&(t=L.maxtrixAppend)?t.applyInverse(Z,{}):Z},getLogicalPoint:function(j,X,m,Z,o,p){var w,r,C=X.getBoundingClientRect();j.target?(En(j)?xf?ii["91"]=!0:ii["17"]=!0:xf?ii["91"]=!1:ii["17"]=!1,ii["16"]=Bm(j)?!0:!1,j=hc?ip(j):j,w=j.clientX,r=j.clientY):(w=j.x,r=j.y);var M,E;if((M=X.parentElement)&&(E=M.maxtrixAppend)){var S=E.apply({x:w,y:r},{});return S.x=(S.x+X.scrollLeft-(m||0))/(o||1),S.y=(S.y+X.scrollTop-(Z||0))/(p||1),S}return{x:(w-C.left+X.scrollLeft-(m||0))/(o||1),y:(r-C.top+X.scrollTop-(Z||0))/(p||1)}},removeHTML:function(){var k;return function(f){return f&&f.getView&&(f=f.getView()),f&&f.parentNode?k===f?!0:(k=f,f.parentNode.removeChild(f),k=Y,!0):!1}}(),getToolTipDiv:function(){if(!Oq){Oq=Aj(),gc=Aj();var d=Oq.style;k.baseZIndex!=Y&&(d.zIndex=n(k.baseZIndex)+3+""),d.whiteSpace="nowrap",d.color=k.toolTipLabelColor,d.background=k.toolTipBackground,d.font=k.toolTipLabelFont,d.padding="5px",d.boxShadow="0px 0px 3px "+k.toolTipShadowColor
}return Oq},isToolTipShowing:function(){return Oq&&Oq.parentNode?!0:gc&&gc.parentNode?!0:!1},hideToolTip:function(){rn(Oq),rn(gc),Ub()},showToolTip:function(S,o){if(!S||o==Y)return Xk(),void 0;k.getToolTipDiv();var X,W;if(o.html?(o=o.html,X=gc,rn(Oq)):(X=Oq,rn(gc)),W=X.style,X.innerHTML=o,X.parentNode||C.Default.appendToScreen(X),S.target){S=Vf(S);var n=bh(),I=S.x,D=S.y,d=hc?60:12;if(hc){var w=X.getBoundingClientRect();W.left=I-w.width/2+Md,W.top=D-w.height-d<n.top?D+d+Md:D-w.height-d+Md}else{W.left=I+d+Md,W.top=D+d+Md;var w=X.getBoundingClientRect();w.left+w.width>n.width&&(W.left=I-d-w.width+Md),w.top+w.height>n.height&&(W.top=D-d-w.height+Md),w.left<0&&(W.left=I+d+Md),w.top<0&&(W.top=D+d+Md)}}else W.left=S.x+Md,W.top=S.y+Md;Ub()},startDragging:function(O,y,j){j==P&&(j=!0),O!==no&&(no?j&&(hc?no.handleWindowTouchEnd(y):no.handleWindowMouseUp(y)):hc?(f.addEventListener(sc,Ak,p),f.addEventListener(qm,ce,p)):(f.addEventListener(Vb,Hp,p),f.addEventListener(cd,mk,p)),no=O)},getImageMap:function(){return Tp},toBoundaries:function(M,j,i,F){var H=[];return om(M,j,i,F).forEach(function(R){var l=[];R.forEach(function(T){l.push(T.x,T.y)}),H.push(l)}),H},getCurrentKeyCodeMap:function(){return ii},drawCenterImage:function(O,i,b,x,y,X,Q,L){var H=re(i,y,X),g=dp(i,y,X);mf(O,i,R(b-H/2),R(x-g/2),H,g,y,X,Q,L)},drawStretchImage:function(g,w,F,S,V,i,k,s,v,T,o,u){var U,l=re(w,s,v,i),O=dp(w,s,v,k);"uniform"===F?(U=D(i/l,k/O),l*=U,O*=U,S+=R((i-l)/2),V+=R((k-O)/2),i=l,k=O):"centerUniform"===F&&((l>i||O>k)&&(U=D(i/l,k/O),l*=U,O*=U),S+=R((i-l)/2),V+=R((k-O)/2),i=l,k=O);var Z=g.interactiveInfo;if(Z){var c;if(c="center"===F?{x:S+i/2-l/2,y:V+k/2-O/2,width:l,height:O}:{x:S,y:V,width:i,height:k},Z.rect){var r=Z.compInfos,Q=r.length;Q&&(r[Q-1].rect.image=w)}else Z.rect=c}if("center"===F){var C=o!==!1&&(l>i||O>k);C&&(g.save(),g.beginPath(),g.rect(S,V,i,k),g.clip()),mf(g,w,S+i/2-l/2,V+k/2-O/2,l,O,s,v,T,u),C&&g.restore()}else mf(g,w,S,V,i,k,s,v,T,u)},toCanvas:function(c,$,M,W,G,Q,T,F,N){c=km(c,T),$=$||re(c,G),M=M||dp(c,G);var Z=eq(),L=sf(Z);return F?(hn(Z,$,M,F),L.scale(F,F)):hn(Z,$,M,1),Cq(L,c,W,0,0,$,M,G,Q,T,N),c&&c.clampToEdge&&(Z.clampToEdge=c.clampToEdge),L.restore(),Z},toGrayColor:function(n){if(!n)return n;var d=fj(n),u=.299*d[0]+.587*d[1]+.114*d[2];return"rgba("+u+","+u+","+u+","+d[3]/255+")"},createGradientImage:function(e,m,o,S){for(var u=["L",0,0,e,0,1,0,0,1,0,0],w=0,c=Math.min(m.length,o.length);c>w;w++)u.push(o[w],m[w]);var F=C.Default.toCanvas({width:e,height:e,clampToEdge:!0,comps:[{type:"shape",rotation:S||0,points:[0,0,e,0,e,e,0,e],background:"#ffffff",gradientPack:u}]});return F},createElement:function(N,e,M,r){var v=H.createElement(N);return Nq(v,e||y.widgetBorder,2),v.style.font=M?M:fi,r!=Y&&(v.value=r),k.onElementCreated&&k.onElementCreated(v),v},containedInView:function(c,q){var t=Mn(q).getBoundingClientRect();return Gr({x:t.left,y:t.top,width:t.width,height:t.height},ih(c))},isIsolating:function(){return Zn>0},setIsolating:function(o){o?Zn++:Zn--},getMSMap:function(){return Wk},stringify:function(Q,R){var K=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var j=JSON.stringify(Q,function(W,f){return"function"==typeof f?"__ht__"+(f.__ht__||f.toString()):mn(f)?Wg(f):f instanceof C.List?"__ht__list"+(f.__ht__list||k.stringify(f._as)):f},R==Y?2:R);return Date.prototype.toJSON=K,j},parse:function(l){return Xd(l)?JSON.parse(l,function(x,p){if(Xd(p))if("__ht__function"==p.substr(0,14)){var f=p.indexOf("{")+1,v=p.lastIndexOf("}"),R=p.indexOf("(")+1,s=p.indexOf(")");if(f&&v&&R&&s){var O=new Function(p.substring(R,s),p.substring(f,v));return O.__ht__=p.substr(6),O}}else{if("__ht__date"==p.substr(0,10))return new Date(n(p.substr(10)));if("__ht__list"===p.substr(0,10))return new rp(k.parse(p.substr(10)))}return p}):l},loadJS:function(X,y){y&&X.push(y);var t=X.shift();if(fk(t))X=t.contact(X),k.loadJS(X);else if(Lj(t))t(),k.loadJS(X);else if(Xd(t)){var B=H.createElement("script");B.onload=function(){k.loadJS(X)},B.setAttribute("src",t),H.getElementsByTagName("head")[0].appendChild(B)}else X.length&&k.loadJS(X)},toRoundedCorner:function(L,a){var z=L.size();if(0>=a)return{points:L};var i,p=new rp,V=new rp,u=L.get(0);p.add(u),V.add(1);for(var K=1;z>K;K++)if(z>K+1){var E=L.get(K),R=L.get(K+1),S=u.x,y=u.y,G=E.x,r=E.y,W=r-y,A=G-S,N=d(W,A);i=D(.99*Qf(u,E),a),p.add({x:G-i*T(N),y:r-i*c(N)}),p.add(E),S=E.x,y=E.y,G=R.x,r=R.y,W=r-y,A=G-S,N=d(W,A),i=D(.99*Qf(E,R),a),u={x:S+i*T(N),y:y+i*c(N)},p.add(u),V.addAll([2,3])}else p.add(L.get(K)),V.add(2);return{points:p,segments:V}},toColorData:fj,setCanvas:hn,createDiv:Aj,createDisabledDiv:$g,createView:kk,createCanvas:eq,appendChild:Hb,initContext:sf,checkLoadingImage:to,translateAndScale:$r,layout:dk,getPosition:ai,drawPoints:Er,drawRoundRect:Rj,drawBorder:sb,setFocus:_c,getter:Gq,setter:Bb,isEmptyObject:Cr},!0),yl(e,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var Xo=k.disabledOpacity,rs=k.toolTipDelay,es=k.devicePixelRatio,nj=k.autoMakeVisible,Vn=k.autoHideScrollBar,xm=k.imageGradient,_g=k.showToolTip,Xk=k.hideToolTip,Ld=k.dashPattern,Ue=k.lineCap,Ok=k.lineJoin,bl=k.labelColor,Eo=k.labelSelectColor,fi=k.labelFont,ap=k.widgetIndent,Gf=k.widgetRowHeight,je=k.widgetHeaderHeight,Yn=k.widgetTitleHeight,Ge=k.scrollBarColor,Yd=k.scrollBarSize,dl=k.scrollBarTimeout,Qd=k.scrollBarMinLength,_b=k.scrollBarInteractiveSize,Nj=k.zoomIncrement,yb=k.scrollZoomIncrement,$i=k.pinchZoomIncrement,sg=k.zoomMax,Ur=k.zoomMin,se=k.createObject,vj=k.preventDefault,Hq=k.setImage,km=k.getImage,si=k.isImageComplete,vr=k.drawCenterImage,Cq=k.drawStretchImage,yi=k.getId,an=k.callLater,Tr=k.sortFunc,aq=k.clone,ns=k.getClass,kg=k.startAnim,kp=k.brighter,ac=k.darker,qq=k.drawText,Ie=k.getTextSize,Qe=k.isLeftButton,Lc=k.getTouchCount,Bs=k.isDoubleClick,Bm=k.isShiftDown,En=k.isCtrlDown,ih=k.getClientPoint,Vf=k.getPagePoint,Qf=k.getDistance,ig=k.unionPoint,Si=k.unionRect,Gr=k.containsPoint,pq=k.containsRect,po=k.intersectsRect,as=k.intersection,bh=k.getWindowInfo,El=k.grow,Zr=k.getLogicalPoint,wf=k.getScreenPoint,rc=k.startDragging,rn=k.removeHTML,di=k.createElement,be=k.segmentResolution,Em=k.shapeResolution,Kk=k.shapeSide,jq=k.def,Lg=function(Q,m,o){jq(I+"."+Q,m,o)},mr=function(p,k){p.childNodes.forEach(function(Q){k(Q),mr(Q,k)})};yl(k,{toolTipLabelColor:bl,toolTipLabelFont:fi,toolTipBackground:y.toolTipBackground,toolTipShadowColor:Fn,drawBreakableText:Rc,setDevicePixelRatio:function(l){es=k.devicePixelRatio="number"==typeof l?l:f.devicePixelRatio,mr(H.body,function(Z){var N=Z._ht;N&&N._canvas&&(hn(N._canvas,N.getWidth(),N.getHeight()),N.redraw?N.redraw():N.iv())})}},!0);var Ui=1e-6,Io="undefined"!=typeof Uint16Array?Uint16Array:Array,Ve="undefined"!=typeof Float32Array?Float32Array:Array,Lh=function(H,j,I){var o=[H[0]-j[0],H[1]-j[1],H[2]-j[2]];if(I){var d=Qf(o);d>0&&(o[0]/=d,o[1]/=d,o[2]/=d)}return o},Nh=function(){var R="charCodeAt",n=2*(2*Oe.length+1);for(var j in f)if(j===I+wp[0]+Md.length){var q=f[j];if(!q)break;for(var c=q.length,S=0;c>S;S++)if(q[S][R](0)===n&&q[S+1]!=Y&&q[S+1]===Md[0]&&q[S+2]!=Y&&q[S+2][R](0)===n){for(var W=S+3;c>W;W++)if(q[W][R](0)===n){if(0==q[W+1])for(var t,X=W+2;c>X;X++){if(q[X][R](0)===n){0==q[X-1]&&t&&(a=t.substr(0,t.length-1));break}t==Y?t=q[X]:t+=q[X]}break}break}break}return function(P){return[-P[0],-P[1],-P[2]]}}(),sp=function(n,q){return 3===n.length?n[0]*q[0]+n[1]*q[1]+n[2]*q[2]:n[0]*q[0]+n[1]*q[1]},ck=function(){var R=new Ve(16);return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R},Mg=ck(),mh=function(u){var K=new Ve(16);return K[0]=u[0],K[1]=u[1],K[2]=u[2],K[3]=u[3],K[4]=u[4],K[5]=u[5],K[6]=u[6],K[7]=u[7],K[8]=u[8],K[9]=u[9],K[10]=u[10],K[11]=u[11],K[12]=u[12],K[13]=u[13],K[14]=u[14],K[15]=u[15],K},Se=function(d,w){return d[0]=w[0],d[1]=w[1],d[2]=w[2],d[3]=w[3],d[4]=w[4],d[5]=w[5],d[6]=w[6],d[7]=w[7],d[8]=w[8],d[9]=w[9],d[10]=w[10],d[11]=w[11],d[12]=w[12],d[13]=w[13],d[14]=w[14],d[15]=w[15],d},pc=function(j){return j[0]=1,j[1]=0,j[2]=0,j[3]=0,j[4]=0,j[5]=1,j[6]=0,j[7]=0,j[8]=0,j[9]=0,j[10]=1,j[11]=0,j[12]=0,j[13]=0,j[14]=0,j[15]=1,j},uh=function(J,Z){var u=J[0],z=J[1],r=J[2];return J[0]=Z[0]*u+Z[4]*z+Z[8]*r+Z[12],J[1]=Z[1]*u+Z[5]*z+Z[9]*r+Z[13],J[2]=Z[2]*u+Z[6]*z+Z[10]*r+Z[14],J},Ej=function(V,i){var c=V[0],Q=V[1],k=V[2],u=V[3];return V[0]=i[0]*c+i[4]*Q+i[8]*k+i[12]*u,V[1]=i[1]*c+i[5]*Q+i[9]*k+i[13]*u,V[2]=i[2]*c+i[6]*Q+i[10]*k+i[14]*u,V[3]=i[3]*c+i[7]*Q+i[11]*k+i[15]*u,V},Je=function(){var D,_,l,g,z=Rd(Tq[1]+Tq[7]),P=Rd(Tq[0]+Tq[3]-Tq[10]),K=Rd(Tq[8]+2),I=function(){return _=l.charAt(D),D+=1,_},V=function(){var y="";if(_===K)for(;I();){if(_===K)return I(),y;y+=_}else I()},U=function(){for(;_&&" ">=_;)I()},p=function(){var M,$={};if(_===z){if(I(),U(),_===P)return I(),$;for(;_;){if(M=V(),U(),I(),$[M]=g(),U(),_===P)return I(),$;I(),U()}}};return g=function(){switch(U(),_){case z:return p();default:return V()}},function(T){if(S={},T){var Y;if(l=T,D=0,_=" ",Y=g(),U(),!_)return Y}}}(),Ir=function(m,K){if(K){var X=c(K),f=T(K),L=m[4],x=m[5],b=m[6],s=m[7],Z=m[8],W=m[9],C=m[10],p=m[11];m[4]=L*f+Z*X,m[5]=x*f+W*X,m[6]=b*f+C*X,m[7]=s*f+p*X,m[8]=Z*f-L*X,m[9]=W*f-x*X,m[10]=C*f-b*X,m[11]=p*f-s*X}},Sq=function(I,Q){if(Q){var E=c(Q),l=T(Q),x=I[0],o=I[1],S=I[2],t=I[3],K=I[8],q=I[9],M=I[10],D=I[11];I[0]=x*l-K*E,I[1]=o*l-q*E,I[2]=S*l-M*E,I[3]=t*l-D*E,I[8]=x*E+K*l,I[9]=o*E+q*l,I[10]=S*E+M*l,I[11]=t*E+D*l}},ur=function(N,x){if(x){var n=c(x),b=T(x),I=N[0],e=N[1],r=N[2],D=N[3],E=N[4],v=N[5],F=N[6],G=N[7];N[0]=I*b+E*n,N[1]=e*b+v*n,N[2]=r*b+F*n,N[3]=D*b+G*n,N[4]=E*b-I*n,N[5]=v*b-e*n,N[6]=F*b-r*n,N[7]=G*b-D*n}},Hg=function(K,M,U){return Nk(Y,U===!1?Y:K.getFinalScale3d(),K.getFinalRotation3d(),K.getRotationMode(),K.p3(),Y,M)},Nk=function(x,r,f,I,N,n,d){return n||(n=ck()),N&&vf(n,N),ud(n,f,I),d&&Xi(n,n,d),r&&bc(n,r),x&&Xi(n,n,x),n},lr=function(s,h,j){h=n(h),j=n(j);var L=this;L.g=s,L._84O=h,L._85O=j,L._70I=!0,L.F=0,L._83O=h+j,L.pen={x:0,y:0}},Dq="lineDashOffset",Jo="setLineDash",sm=function(C){for(var I in C)1===I.length&&(Dq=C[I]);return I?1:0},ro=function(q,J,e){return ti(J)?q:q[Jo]?(q[Jo](J),e&&(q.lineDashOffset=e),q):new lr(q,J[0],J.length>1?J[1]:J[0])},zi=function(h,c){!ti(c)&&h[Jo]&&(h[Jo]($j),h.lineDashOffset=0)};if(jq(lr,$,{_69I:6,moveTo:function(k,Y){var n=this,Z=n.pen;Z.x=k,Z.y=Y,n.g.moveTo(k,Y),n.start||(n.start={x:k,y:Y})},lineTo:function($,S){var e=this,U=e.pen,m=$-U.x,B=S-U.y,a=d(B,m),F=T(a),D=c(a),u=e._23O(U.x,U.y,$,S),X=e._85O,P=e._84O,M=e._83O;if(e.F){if(e.F>u)return e._70I?e._72I($,S):e.moveTo($,S),e.F-=u,void 0;if(e._70I?e._72I(U.x+F*e.F,U.y+D*e.F):e.moveTo(U.x+F*e.F,U.y+D*e.F),u-=e.F,e.F=0,e._70I=!e._70I,!u)return}var t=s(u/M);if(t){for(var p=F*P,x=D*P,q=F*X,o=D*X,n=0;t>n;n++)e._70I?(e._72I(U.x+p,U.y+x),e.moveTo(U.x+q,U.y+o)):(e.moveTo(U.x+q,U.y+o),e._72I(U.x+p,U.y+x));u-=M*t}e._70I?u>P?(e._72I(U.x+F*P,U.y+D*P),e.moveTo($,S),e.F=X-(u-P),e._70I=!1):(e._72I($,S),u===P?(e.F=0,e._70I=!e._70I):(e.F=P-u,e.moveTo($,S))):u>X?(e.moveTo(U.x+F*X,U.y+D*X),e._72I($,S),e.F=P-(u-X),e._70I=!0):(e.moveTo($,S),u===X?(e.F=0,e._70I=!e._70I):e.F=X-u)},quadraticCurveTo:function(j,S,u,H){var t,N=this,U=N.pen,I=U.x,q=U.y,L=N._22O(I,q,j,S,u,H),b=0,J=0,v=N._85O,A=N._84O;if(N.F){if(N.F>L)return N._70I?N._71I(j,S,u,H):N.moveTo(u,H),N.F-=L,void 0;if(b=N.F/L,t=N._20O(I,q,j,S,u,H,b),N._70I?N._71I(t[2],t[3],t[4],t[5]):N.moveTo(t[4],t[5]),N.F=0,N._70I=!N._70I,!L)return}var y=L-L*b,l=s(y/N._83O),h=A/L,T=v/L;if(l)for(var m=0;l>m;m++)N._70I?(J=b+h,t=N._21O(I,q,j,S,u,H,b,J),N._71I(t[2],t[3],t[4],t[5]),b=J,J=b+T,t=N._21O(I,q,j,S,u,H,b,J),N.moveTo(t[4],t[5])):(J=b+T,t=N._21O(I,q,j,S,u,H,b,J),N.moveTo(t[4],t[5]),b=J,J=b+h,t=N._21O(I,q,j,S,u,H,b,J),N._71I(t[2],t[3],t[4],t[5])),b=J;y=L-L*b,N._70I?y>A?(J=b+h,t=N._21O(I,q,j,S,u,H,b,J),N._71I(t[2],t[3],t[4],t[5]),N.moveTo(u,H),N.F=v-(y-A),N._70I=!1):(t=N._19O(I,q,j,S,u,H,b),N._71I(t[2],t[3],t[4],t[5]),L===A?(N.F=0,N._70I=!N._70I):(N.F=A-y,N.moveTo(u,H))):y>v?(J=b+T,t=N._21O(I,q,j,S,u,H,b,J),N.moveTo(t[4],t[5]),t=N._19O(I,q,j,S,u,H,J),N._71I(t[2],t[3],t[4],t[5]),N.F=A-(y-v),N._70I=!0):(N.moveTo(u,H),y===v?(N.F=0,N._70I=!N._70I):N.F=v-y)},bezierCurveTo:function(){var y=arguments;this.pen={x:y[4],y:y[5]},this.g.bezierCurveTo(y[0],y[1],y[2],y[3],y[4],y[5])},arc:function(j,k,v,o,m,s){s||(o=-o,m=-m),Ee(this,j,k,o,m-o,v,v,!1)},rect:function(B,V,m,h){var K=this;K.pen={x:B,y:V},K.moveTo(B,V),K.lineTo(B,V+h),K.lineTo(B+m,V+h),K.lineTo(B+m,V),K.lineTo(B,V)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(B,z,o,D){var L=o-B,H=D-z;return i(L*L+H*H)},_22O:function(V,h,p,O,M,l,N){for(var n,S,H,t,j,A,C,T=0,I=V,z=h,X=N>0?N:this._69I,_=1;X>=_;_++)H=_/X,t=1-H,j=t*t,A=2*H*t,C=H*H,n=j*V+A*p+C*M,S=j*h+A*O+C*l,T+=this._23O(I,z,n,S),I=n,z=S;return T},_21O:function(c,Y,z,e,_,n,k,Q){var K=this;if(0===k)return K._20O(c,Y,z,e,_,n,Q);if(1===Q)return K._19O(c,Y,z,e,_,n,k);var l=K._20O(c,Y,z,e,_,n,Q);return l.push(k/Q),K._19O.apply(K,l)},_20O:function(X,P,_,G,q,r,b){if(1!==b){var U=_+(q-_)*b,R=G+(r-G)*b;_=X+(_-X)*b,G=P+(G-P)*b,q=_+(U-_)*b,r=G+(R-G)*b}return[X,P,_,G,q,r]},_19O:function(v,o,C,J,w,i,l){if(1!==l){var D=v+(C-v)*l,U=o+(J-o)*l;C+=(w-C)*l,J+=(i-J)*l,v=D+(C-D)*l,o=U+(J-U)*l}return[v,o,C,J,w,i]},_72I:function(j,O){var Q=this.pen;(j!==Q.x||O!==Q.y)&&(Q.x=j,Q.y=O,this.g.lineTo(j,O))},_71I:function(F,A,L,t){var q=this.pen;(F!==L||A!==t||L!==q.x||t!==q.y)&&(q.x=L,q.y=t,this.g.quadraticCurveTo(F,A,L,t))}}),K&&J){var Cc=J.toString();v=Cc.indexOf(Wb.substr(0,2))>0&&Cc.indexOf(Gc+Gc.substr(1,1))>1||Cc.indexOf(so.substr(0,2)+Wb.substr(2,2)+wp[0]+Wb[4])>1?!0:!1}var Li=Y,Wj=Y,hf=function(s){Li&&!s._72O&&(Wj||(Wj={}),Wj[s._72O=yi()]=s)},Df=function(D,n){if(n||(n=D),n&&(Li||(Li={}),!Li[D])){var $=new If;if(Li[n]={request:$,url:n},n=k.beforeLoadURL(n),n.data){var L=k.parse(n.data);Sn(D,L),k.handleCompTypeLoaded(D,L)}else{$.onload=function(v){if(200===this.status||0===this.status){var u=k.parse(v.target.response||v.target.responseText);Sn(D,u),k.handleCompTypeLoaded(D,u)}else Sn(D,Y)},$.onerror=function(){Sn(D,Y)};var o={};o.url=encodeURI(n),o.sync=!1,$.send(o)}}},Sn=function(Q,T){if(iq[Q]=T,delete Li[Q],Cr(Li)&&(Li=Y,Wj)){for(var N in Wj){var v=Wj[N];v.invalidateAll&&v.invalidateAll(P,"compTypeLoaded",Q),v.redraw&&v.redraw(),v.iv(),delete v._72O}Wj=Y}if(T&&Wj)for(var N in Wj){var v=Wj[N];v.invalidateAll&&v.invalidateAll(P,"compTypeLoading",Q),v.redraw&&v.redraw(),v.iv()}},hl=y.chart,Ip=k.compStack=[],fe=/^style@/,fc=/^attr@/,Pf=/^field@/,we={x:.5,y:.5},re=function(b,K,o,f){if(!b)return 0;if(hg(b.fitSize,K,o)&&f)return f;var F=hg(b.width,K,o);return null==F?20:F},dp=function(Q,B,J,H){if(!Q)return 0;if(hg(Q.fitSize,B,J)&&H)return H;var u=hg(Q.height,B,J);return null==u?20:u},hg=function(q,F,r){if(!q||!q.func)return q;var H,I=q.func,_=q.value;return H=Lj(I)?r&&r.vectorDataBindingDisabled&&!q.isSafeFunc?_:I(F,r):F instanceof uo?fc.test(I)?F.a(I.slice(5)):fe.test(I)?F.s(I.slice(6)):Pf.test(I)?F[I.slice(6)]:F[I]?F[I](r):_:_,_!==P&&H==Y?_:H},mf=k.drawImage=function(){var M,N,j,p,u,W,d=function(G,b){G.getValue&&G.getValue.compType===b||(G.getValue=function(E){var g=V(G,E);if(g===P&&b.properties){var A=b.properties[E];A&&(g=A.defaultValue)}return g},G.getValue.compType=b)},V=function(E,L,Y){var s=E[L];return s&&s.func?(s=hg(s,N,j),Y&&(s=Y(s))):Y&&(s=E[L]=Y(s)),s},t=function(v,Z){var X;if(X=Z?V(v,Z):v,M&&M.compGray&&X)return k.toGrayColor(X);if(u&&X){if("override"===W)return u;if("override_rgb"===W){var Y=lg(u);return X=fj(X),"rgba("+s(255*Y[0])+","+s(255*Y[1])+","+s(255*Y[2])+","+X[3]/255+")"}if("override_a"===W){var Y=lg(u);return X=fj(X),"rgba("+X[0]+","+X[1]+","+X[2]+","+Y[3]+")"}var Y=lg(u);return X=fj(X),"rgba("+s(X[0]*Y[0])+","+s(X[1]*Y[1])+","+s(X[2]*Y[2])+","+X[3]/255*Y[3]+")"}return X},g=function(B){if(fk(B)){for(var o=new rp,s=B.length,m=0;s>m;m+=2)o.add({x:B[m],y:B[m+1]});B=o}return B},y=function(S){var v=V(S,"anchorX"),L=V(S,"anchorY");if(v!==P||L!==P)return{x:v===P?we.x:v,y:L===P?we.y:L};var f=V(S,"type"),w=V(S,"name");if("image"!==f||!w)return we;var T=km(w);return T&&T.anchorX!==P&&T.anchorY!==P?{x:T.anchorX,y:T.anchorY}:we},X=function(c,B){var J=V(c,xo),A=y(c);if(fk(J)){var e=J.length,v=V(c,"relative"),_=B.width,H=B.height;if(4===e)J={x:J[0],y:J[1],width:J[2],height:J[3]},v?(J.x*=_,J.y*=H,J.width*=_,J.height*=H):B.fitSize&&(J.x*=B.widthScale,J.width*=B.widthScale,J.y*=B.heightScale,J.height*=B.heightScale);else if(3===e){var L=J[0];J={width:J[1],height:J[2]},v?(J.width*=_,J.height*=H):B.fitSize&&(J.width*=B.widthScale,J.height*=B.heightScale),"object"==typeof L?L.length&&(L={x:L[0],y:L[1]}):L=ai(L,B,J),J.x=L.x-J.width*A.x,J.y=L.y-J.height*A.y}var p=V(c,"offsetX");p&&(B.fitSize&&(p*=B.widthScale),J.x+=p),p=V(c,"offsetY"),p&&(B.fitSize&&(p*=B.heightScale),J.y+=p)}return J},O=function(Q){return fk(Q)?new rp(Q):Q},F=function($,e,X,f,Y,w,r){var b=M.interactiveInfo,m=$.transform;if(m)return M.save(),M.setTransform(m.a,m.b,m.c,m.d,m.tx,m.ty),b&&b.compInfos.push({comp:$,rect:e,matrix:m.clone()}),!0;Y===P&&(Y=1),w===P&&(w=1);var o=V($,"clipPercentage"),C=Sj(X,e);if(C&&!f&&1===Y&&1===w&&!(1>o))return b&&b.compInfos.push({comp:$,rect:e,matrix:b.matrix.clone()}),!1;r=r||we;var u=e.x+e.width*r.x,t=e.y+e.height*r.y,F=X.x+X.width*r.x,h=X.y+X.height*r.y,G=X.width?Y*(e.width/X.width):1,E=X.height?w*(e.height/X.height):1;if(M.save(),b&&(b.matrix.appendTranslate(u,t).appendRotate(f).appendScale(G,E).appendTranslate(-F,-h),b.compInfos.push({comp:$,rect:e,matrix:b.matrix.clone()})),Jd(M,u,t),hh(M,f||0),Ro(M,G,E),Jd(M,-F,-h),1>o){0>o&&(o=0);var x=Ig(X,V($,"clipDirection"),o);M.beginPath(),M.rect(x.x,x.y,x.width,x.height),M.clip()}return!0},Z=function(){M.restore()},K=function(h,m,d){var n=V(h,"path"),l=V(h,Hd),o=V(h,"scaleX"),W=V(h,"scaleY"),G=y(h),v=Y,K=dj(null,n);if(d||(d=h.unionRect,d||(d=ig(K),h.path.func||(h.unionRect=d)),v=d),d){v||(v=h.unionRect,v||(v=ig(K),h.path.func||(h.unionRect=v)));var I=F(h,d,v,l,o,W,G),X=V(h,"borderPattern"),z=ro(M,X),x=t(h,"background"),D=t(h,"borderColor"),C=V(h,"borderWidth"),P=V(h,"gradient"),R=t(h,"gradientColor"),H=V(h,"border3d"),$=V(h,"border3dColor"),f=V(h,"border3dAccuracy"),r=M.lineJoin,g=M.lineCap;if(M.lineJoin=V(h,"borderJoin")||Ok,M.lineCap=V(h,"borderCap")||Ue,x?(wo(M,x,P,R,v),dj(M,n),M.fill(),z!==M&&dj(M,n)):dj(M,n),C&&D){var J=V(h,"borderWidthAbsolute");J&&(M.save(),M.setTransform(1,0,0,1,0,0)),M.lineWidth=C,M.strokeStyle=D,M.stroke(),J&&M.restore(),H&&wq(M,D,$,C,p,f)}if(zi(M,X),V(h,"dash")){var u=V(h,"dashWidth")||C;if(u>0){X=V(h,"dashPattern")||Ld;var z=ro(M,X,V(h,"dashOffset")),w=t(h,"dashColor")||t(ho);z!==M&&dj(M,n),M.strokeStyle=w,M.lineWidth=u,M.stroke(),V(h,"dash3d")&&wq(M,w,t(h,"dash3dColor"),u,p,V(h,"dash3dAccuracy")),zi(M,X)}}m===xo&&Ae(M,x,V(h,"depth"),v),M.lineJoin=r,M.lineCap=g,I&&Z()}},H=function(v,c,r,T){var P=V(v,Ap,g),i=V(v,Hd),s=y(v);if(P&&T.fitSize){var H=Math.abs(Math.cos(i))<.001,K=new rp,m=ig(P),_=T.widthScale,e=T.heightScale,k=m.x+s.x*m.width,l=m.y+s.y*m.height,h=k*_,D=l*e;P.each(function(r){var A=r.x-k,w=r.y-l;K.add({x:h+A*(H?e:_),y:D+w*(H?_:e)})}),P=K,v.unionRect=null}var S=V(v,"scaleX"),A=V(v,"scaleY"),d=c===ak,f=Y;if(!r&&d&&(r=v.unionRect,r||(r=ig(P),v.points.func||(v.unionRect=r)),f=r),r){d?f||(f=v.unionRect,f||(f=ig(P),v.points.func||(v.unionRect=f))):f=r;var G,C,o,z,Q=F(v,r,f,i,S,A,s),w=V(v,"borderPattern"),R=ro(M,w),J=t(v,"background"),n=km(V(v,"repeatImage"),u,W),b=V(v,"gradientPack"),$=t(v,"borderColor"),L=V(v,"borderWidth"),B=V(v,"segments",O),X=V(v,"gradient"),E=t(v,"gradientColor"),I=V(v,"border3d"),q=V(v,"border3dColor"),x=V(v,"border3dAccuracy"),a=V(v,"closePath"),U=V(v,"fillRule")||"nonzero",hb=M.lineJoin,Tp=M.lineCap;if(M.lineJoin=V(v,"borderJoin")||Ok,M.lineCap=V(v,"borderCap")||Ue,d)if(J||n||b){var rn=V(v,"fillClipPercentage");if(1>rn){0>rn&&(rn=0);var ci=Ig(f,V(v,"fillClipDirection"),rn);M.save(),M.beginPath(),M.rect(ci.x,ci.y,ci.width,ci.height),M.clip()}if(Er(M,P,B,a),b)gn(M,b);else if(n){var Th=M,Te=u,bc=W;ol(M,n,u,W,N,j),M=Th,u=Te,W=bc}else{var Th=M;wo(M,J,X,E,f),M=Th}M.fill(U),1>rn&&M.restore(),b&&M.restore(),R!==M&&Er(R,P,B,a)}else Er(R,P,B,a);else if("roundRect"===c?G=V(v,"cornerRadius"):"polygon"===c?G=V(v,"polygonSide"):"arc"===c&&(G=V(v,"arcFrom"),C=V(v,"arcTo"),o=V(v,"arcClose"),z=V(v,"arcOval")),J||n||b){var rn=V(v,"fillClipPercentage");if(1>rn){0>rn&&(rn=0);var ci=Ig(f,V(v,"fillClipDirection"),rn);M.save(),M.beginPath(),M.rect(ci.x,ci.y,ci.width,ci.height),M.clip()}if(hm(M,c,f,G,C,o,z),b)gn(M,b);else if(n){var Th=M,Te=u,bc=W;ol(M,n,u,W,N,j),M=Th,u=Te,W=bc}else wo(M,J,X,E,f);M.fill(U),1>rn&&M.restore(),b&&M.restore(),M!==R&&hm(R,c,f,G,C,o,z)}else hm(R,c,f,G,C,o,z);if(L&&$){var Xh=V(v,"borderWidthAbsolute");Xh&&(M.save(),M.setTransform(1,0,0,1,0,0)),M.lineWidth=L,M.strokeStyle=$,M.stroke(),Xh&&M.restore(),I&&wq(M,$,q,L,p,x)}if(zi(M,w),V(v,"dash")){var Yp=V(v,"dashWidth")||L;if(Yp>0){w=V(v,"dashPattern")||Ld;var R=ro(M,w,V(v,"dashOffset")),hg=t(v,"dashColor")||t(ho);R!==M&&(d?Er(R,P,B,a):hm(R,c,f,G,C,o,z)),M.strokeStyle=hg,M.lineWidth=Yp,M.stroke(),V(v,"dash3d")&&wq(M,hg,t(v,"dash3dColor"),Yp,p,V(v,"dash3dAccuracy")),zi(M,w)}}c===xo&&Ae(M,J,V(v,"depth"),f),M.lineJoin=hb,M.lineCap=Tp,Q&&Z()}},o=function(D,B){var r=u,n=W,b=u||V(D,Ym),S=W||V(D,"blendMode"),C=km(V(D,"name"),b,S);C&&(Cq(M,C,V(D,"stretch"),B.x,B.y,B.width,B.height,N,j,b,null,S),u=r,W=n)},l=function(D,W){var v=V(D,"text");v!=Y&&qq(M,v,V(D,"font"),t(D,Ym),W.x,W.y,W.width,W.height,V(D,"align"),V(D,"vAlign"))},I=function($,v){sb(M,t($,Ym),v.x,v.y,v.width,v.height,V($,"width"))},e=function(m,Q){var H=V(m,Rh),R=0;if(H&&(H.forEach(function(y){R+=y}),R>0)){for(var w=V(m,"colors")||hl,X=V(m,"startAngle")||0,x=V(m,"hollow"),g=V(m,lb),L=V(m,Zp),O=V(m,ln),v=g?new rp:Y,o=Q.x,K=Q.y,t=Q.width,A=Q.height,k=o+t/2,P=K+A/2,d=D(t,A)/2,q=0,u=0;u<H.length;u++){var b=H[u],h=r*b/R,f=X+h;if(M.fillStyle=w[q++],q===w.length&&(q=0),M.beginPath(),x){var F=k+T(X)*d/2,C=P+c(X)*d/2,n=k+T(f)*d,I=P+c(f)*d;M.moveTo(F,C),M.arc(k,P,d/2,X,f,!1),M.lineTo(n,I),M.arc(k,P,d,f,X,!0)}else M.moveTo(k,P),M.arc(k,P,d,f,X,!0);v&&(h=(X+f)/2,v.add({text:Lj(g)?g(b,u,R,N):b,x:k+.75*T(h)*d,y:P+.75*c(h)*d})),M.closePath(),M.fill(),X=f}v&&v.each(function(Y){qq(M,Y.text,L,O,Y.x,Y.y,0,0,fg)})}},x=function(o,w){var n=V(o,Rk);if(n&&n.length>0){var q=n.length,J=V(o,lb),C=V(o,Zp),W=V(o,ln),_=J?new rp:Y,S=V(o,"minValue")||0,r=V(o,"maxValue");if(r==Y&&(r=0,n.forEach(function(l){V(l,Rh).forEach(function(W){r=B(r,W)})})),S===r)return;for(var A=w.height/(r-S),p=w.y+r*A,Q=V(n[0],Rh).length,O=w.width/(3*Q+1),D=2*O/q,v=0,e=0;q>e;e++)for(var k=n[e],K=V(k,Ym),L=V(k,"colors"),y=V(k,Rh),U=0;Q>U;U++){L?M.fillStyle=L[U]:K?M.fillStyle=K:(M.fillStyle=hl[v++],v===hl.length&&(v=0));var T=y[U],H=T*A,X=w.x+(1+3*U)*O+e*D;if(_e(M,X,p-H,D,H),_){var m=Lj(J)?J(T,U,k,N):T,G=Ie(C,m).height;_.add({x:X,y:p-H-G,width:D,height:G,text:m})}}_&&_.each(function(R){qq(M,R.text,C,W,R.x,R.y,R.width,R.height,fg)})}},_=function(P,c){var K=V(P,Rk);if(K&&K.length>0){var d=K.length,W=V(K[0],Rh).length,o=c.width/(3*W+1),O=0,b=V(P,"maxValue"),f=V(P,lb),g=V(P,Zp),y=V(P,ln),i=f?new rp:Y;if(b==Y){b=0;for(var G=0;W>G;G++){for(var m=0,S=0;d>S;S++)m+=V(K[S],Rh)[G];b=B(b,m)}}if(b>0){for(var G=0;W>G;G++)for(var U=c.y+c.height,S=0;d>S;S++){var k=K[S],v=V(k,Ym),l=V(k,Rh)[G],w=l/b*c.height;v?M.fillStyle=v:(M.fillStyle=hl[O++],O===hl.length&&(O=0)),U-=w;var j={x:c.x+(1+3*G)*o,y:U,width:2*o,height:w};_e(M,j.x,j.y,j.width,j.height),i&&(j.text=Lj(f)?f(l,G,k,N):l,i.add(j))}i&&i.each(function(s){qq(M,s.text,g,y,s.x,s.y,s.width,s.height,fg)})}}},n=function(m,e){var T=V(m,Rk);if(T&&T.length>0){for(var p=T.length,y=V(T[0],Rh).length,v=e.width/(3*y+1),D=0,h=V(m,lb),G=V(m,Zp),j=V(m,ln),U=h?new rp:Y,W=0;y>W;W++){for(var C=0,r=0;p>r;r++)C+=V(T[r],Rh)[W];if(C>0){var O=e.y+e.height;for(r=0;p>r;r++){var I=T[r],z=V(I,Ym),f=V(I,Rh)[W],A=f/C*e.height;z?M.fillStyle=z:(M.fillStyle=hl[D++],D===hl.length&&(D=0)),O-=A;var _={x:e.x+(1+3*W)*v,y:O,width:2*v,height:A};_e(M,_.x,_.y,_.width,_.height),U&&(_.text=Lj(h)?h(f,W,I,N):f,U.add(_))}}}U&&U.each(function(Z){qq(M,Z.text,G,j,Z.x,Z.y,Z.width,Z.height,fg)})}},q=function(I,v){var J=V(I,Rk);if(J&&J.length>0){var K=J.length,Z=V(I,"minValue")||0,b=V(I,"maxValue");if(b==Y&&(b=0,J.forEach(function(i){V(i,Rh).forEach(function(J){b=B(b,J)})})),Z===b)return;for(var g=v.height/(b-Z),i=v.y+b*g,R=V(J[0],Rh).length,L=v.width/(3*R+1),G=0,h=V(I,"lineWidth")||2,A=V(I,"line3d"),O=V(I,"linePoint"),m=V(I,lb),j=V(I,Zp),o=V(I,ln),T=0;K>T;T++){var w=J[T],s=V(w,Ym),c=V(w,Rh);s?M.strokeStyle=s:(s=M.strokeStyle=hl[G++],G===hl.length&&(G=0)),M.beginPath();for(var S=0;R>S;S++){var q=v.x+(2+3*S)*L,e=i-c[S]*g;0===S?M.moveTo(q,e):M.lineTo(q,e)}if(M.lineWidth=h,M.stroke(),A&&wq(M,s,Y,h,p),O||m){var u,X=h/2+2;for(S=0;R>S;S++){var W=c[S];if(q=v.x+(2+3*S)*L,e=i-W*g,Lj(O)?O(M,q,e,s,S,w,N):O&&(M.fillStyle=s,M.beginPath(),M.arc(q,e,X,0,r,!0),M.fill()),Lj(m)?u=m(W,S,w,N):m&&(u=W),u){var D=Ie(j,u).height,t=M.shadowBlur;if(t){var Q=M.shadowOffsetX,C=M.shadowOffsetY,F=M.shadowColor;M.shadowOffsetX=0,M.shadowOffsetY=0,M.shadowBlur=0,M.shadowColor=Y}qq(M,u,j,o,q,e-D-X+2,0,D,fg),t&&(M.shadowOffsetX=Q,M.shadowOffsetY=C,M.shadowBlur=t,M.shadowColor=F)}}}}}},A=function(){M=null,N=null,j=null},v={border:I,image:o,text:l,pieChart:e,columnChart:x,stackedColumnChart:_,percentageColumnChart:n,lineChart:q};return function(D,E,w,x,S,h,r,G,e,Q){if(E&&S&&h){var _=M?!1:!0;M=D,N=r,j=G,p=j?j._zoom?j._zoom:1:1,u=e,W=Q;var i=S,C=h;if(Mp()){var q,L,c;0===M[Bk]?Mp[0]&&(q=!0):q=!0,M.texureImage2D?Mp[1]&&(L=!0):L=!0,M.texureImage3D?Mp[2]&&(c=!0):c=!0,q&&L&&c&&(i=w,C=x)}if(E.tagName)return Xd(a)&&!f[a]||M.drawImage(E,i,C,S,h),_&&A(),void 0;if(V(E,"visible")===!1)return _&&A(),void 0;u||(u=hg(E.color,N,j)),Q||(W=hg(E.blendMode,N,j)),Xd(a)&&!f[a]&&(S=i,h=C);var T=re(E,N,j,S),U=dp(E,N,j,h),B={x:0,y:0,width:T,height:U,fitSize:V(E,"fitSize")},J=V(E,"clip"),I=V(E,"opacity");if(B.fitSize&&(B.widthScale=T/hg(E.width,N,j),B.heightScale=U/hg(E.height,N,j)),M.save(),M.interactiveInfo){var b=M.interactiveInfo.matrix,z=b.clone();b.appendTranslate(i,C).appendScale(S/T,h/U)}Jd(M,i,C),(T!==S||U!==h)&&M.scale(S/T,h/U),J&&(Lj(J)?J(M,T,U,N,j,E):(M.beginPath(),M.rect(0,0,T,U),M.clip())),I!=Y&&(M.globalAlpha*=I),V(E,"comps").forEach(function(x){if(V(x,hq)!==!1){if(Ip.splice(0,0,x),M.interactiveInfo)var U=M.interactiveInfo.matrix.clone();var r=V(x,"opacity"),E=V(x,"shadow"),L=V(x,"type"),J=X(x,B);if(r!=Y){var T=M.globalAlpha;M.globalAlpha*=r}if(E){var z=M.shadowOffsetX,f=M.shadowOffsetY,w=M.shadowBlur,m=M.shadowColor,$=V(x,"shadowOffsetX"),S=V(x,"shadowOffsetY"),D=V(x,"shadowBlur"),h=t(x,"shadowColor");M.shadowOffsetX=($==Y?3:$)*p,M.shadowOffsetY=(S==Y?3:S)*p,M.shadowBlur=(D==Y?6:D)*p,M.shadowColor=h||t(nq)}if("save"===L)M.save();else if("endClip"===L||"restore"===L)M.restore();else if("clip"===L)M.save(),Er(M,V(x,"points",g),V(x,"segments",O),!0),M.clip();else if(Re[L])J=J||{x:0,y:0,width:B.width,height:B.height},H(x,L,J,B);else if(L===ak)H(x,L,J,B);else if("SVGPath"===L)K(x,L,J);else{J=J||{x:0,y:0,width:B.width,height:B.height};var c=V(x,Hd),I=V(x,"scaleX"),R=V(x,"scaleY"),C=y(x),A=F(x,J,J,c,I,R,C);if(Lj(L))d(x,L),k.drawCompType(L,M,J,x,N,j);else if(k.getCompType(L)){var W=k.getCompType(L),b=W.func||W;d(x,W),k.drawCompType(b,M,J,x,N,j)}else v[L]?v[L](x,J):k.getCompType(L)===P&&gd.test(L)&&Df(L);A&&Z()}E&&(M.shadowOffsetX=z,M.shadowOffsetY=f,M.shadowBlur=w,M.shadowColor=m),r!=Y&&(M.globalAlpha=T),M.interactiveInfo&&(M.interactiveInfo.matrix=U),Ip.splice(0,1)}}),M.interactiveInfo&&(M.interactiveInfo.matrix=z),M.restore(),_&&A()}}}();k.getCurrentComp=function(){return Ip[0]},k.getParentComp=function(){return Ip[1]},k.getInternal=function(){return{isEnter:Jf,isEsc:xs,isSpace:Qg,isLeft:Ml,isUp:Kb,isRight:Tb,isDown:Db,addMethod:yl,superCall:wj,toPointsArray:om,translateAndScale:$r,appendArray:ob,createWorldMatrix:Nk,vec3TransformMat4:uh,setCanvas:hn,createDiv:Aj,createView:kk,createCanvas:eq,createImage:Ai,initContext:sf,layout:dk,fillRect:_e,Mat:cq,drawBorder:sb,isString:Xd,setBorder:Nq,getPropertyValue:Ij,setPropertyValue:ah,drawVerticalLine:Sc,draw3DRect:Ae,getPinchDist:No,isSameRect:Sj,getPosition:ai,intersectionLineRect:yo,getNodeRect:vg,getEdgeAgentPosition:tq,getImageWidth:re,getImageHeight:dp,initItemElement:_i,drawPoints:Er,createG2:ro,closePopup:yg,isH:co,createAnim:Zj,createNormalMatrix:Lb,createNormals:Dk,toFloatArray:Lp,glMV:Do,batchShape:ae,createNodeMatrix:Hg,getFaceInfo:zm,transformAppend:nl,drawFaceInfo:Kd,to3dPointsArray:Hc,setGLDebugMode:function(l){cn=l},cube:function(){return{vs:Gh,is:ug,uv:$m}},ui:function(){return{DataUI:hd,NodeUI:Yo,EdgeUI:un,GroupUI:cm,ShapeUI:yd,GridUI:Bj,Data3dUI:Wf,Node3dUI:Dm,Shape3dUI:Ek}},getInternalVersion:function(){return"U2FsdGVkX1/YJqywhVAP0UEUd8JdnVJUBLVMfXv/xVk="},getDragger:function(){return no},addMSMap:function(a){yl(Wk,a)},k:E}},function(J){function X(S,D){S!=Y&&(D==Y&&ss!=typeof S?this._54O(S,256):this._54O(S,D))}function Z(){return new X(Y)}function F(t,J,H,l,T,B){for(;--B>=0;){var g=J*this[t++]+H[l]+T;T=s(g/67108864),H[l++]=67108863&g}return T}function O(o,F,s,A,V,G){for(var u=32767&F,N=F>>15;--G>=0;){var R=32767&this[o],$=this[o++]>>15,q=N*R+$*u;R=u*R+((32767&q)<<15)+s[A]+(1073741823&V),V=(R>>>30)+(q>>>15)+N*$+(V>>>30),s[A++]=1073741823&R}return V}function R(J,L,e,Z,m,U){for(var x=16383&L,B=L>>14;--U>=0;){var n=16383&this[J],R=this[J++]>>14,y=B*n+R*x;n=x*n+((16383&y)<<14)+e[Z]+m,m=(n>>28)+(y>>14)+B*R,e[Z++]=268435455&n}return m}function z(y){return qp.charAt(y)}function H(W,L){var p=Sm[W.charCodeAt(L)];return p==Y?-1:p}function K(f){for(var u=this.t-1;u>=0;--u)f[u]=this[u];f.t=this.t,f.s=this.s}function w($){this.t=1,this.s=0>$?-1:0,$>0?this[0]=$:-1>$?this[0]=$+this.DV:this.t=0}function C(u){var B=Z();return B._58O(u),B}function S(o,T){var c,K=this;if(16==T)c=4;else if(8==T)c=3;else if(256==T)c=8;else if(2==T)c=1;else if(32==T)c=5;else{if(4!=T)return K.fromRadix(o,T),void 0;c=2}K.t=0,K.s=0;for(var F=o.length,C=!1,W=0;--F>=0;){var O=8==c?255&o[F]:H(o,F);0>O?"-"==o.charAt(F)&&(C=!0):(C=!1,0==W?K[K.t++]=O:W+c>K.DB?(K[K.t-1]|=(O&(1<<K.DB-W)-1)<<W,K[K.t++]=O>>K.DB-W):K[K.t-1]|=O<<W,W+=c,W>=K.DB&&(W-=K.DB))}8==c&&0!=(128&o[0])&&(K.s=-1,W>0&&(K[K.t-1]|=(1<<K.DB-W)-1<<W)),K._57O(),C&&X.ZERO._78O(K,K)}function k(){for(var b=this,N=b.s&b.DM;b.t>0&&b[b.t-1]==N;)--b.t}function v(t){var l=this;if(l.s<0)return"-"+l._85O()[fk](t);var E;if(16==t)E=4;else if(8==t)E=3;else if(2==t)E=1;else if(32==t)E=5;else{if(4!=t)return l.toRadix(t);E=2}var G,$=(1<<E)-1,D=!1,r="",H=l.t,J=l.DB-H*l.DB%E;if(H-->0)for(J<l.DB&&(G=l[H]>>J)>0&&(D=!0,r=z(G));H>=0;)E>J?(G=(l[H]&(1<<J)-1)<<E-J,G|=l[--H]>>(J+=l.DB-E)):(G=l[H]>>(J-=E)&$,0>=J&&(J+=l.DB,--H)),G>0&&(D=!0),D&&(r+=z(G));return D?r:"0"}function M(){var d=Z();return X.ZERO._78O(this,d),d}function y(){return this.s<0?this._85O():this}function g(m){var o=this,g=o.s-m.s;if(0!=g)return g;var n=o.t;if(g=n-m.t,0!=g)return o.s<0?-g:g;for(;--n>=0;)if(0!=(g=o[n]-m[n]))return g;return 0}function W(f){var Q,L=1;return 0!=(Q=f>>>16)&&(f=Q,L+=16),0!=(Q=f>>8)&&(f=Q,L+=8),0!=(Q=f>>4)&&(f=Q,L+=4),0!=(Q=f>>2)&&(f=Q,L+=2),0!=(Q=f>>1)&&(f=Q,L+=1),L}function l(){var F=this;return F.t<=0?0:F.DB*(F.t-1)+W(F[F.t-1]^F.s&F.DM)}function f(E,S){var r;for(r=this.t-1;r>=0;--r)S[r+E]=this[r];for(r=E-1;r>=0;--r)S[r]=0;S.t=this.t+E,S.s=this.s}function Q(t,z){for(var G=t;G<this.t;++G)z[G-t]=this[G];z.t=B(this.t-t,0),z.s=this.s}function o(R,q){var E,w=this,o=R%w.DB,r=w.DB-o,A=(1<<r)-1,p=s(R/w.DB),H=w.s<<o&w.DM;for(E=w.t-1;E>=0;--E)q[E+p+1]=w[E]>>r|H,H=(w[E]&A)<<o;for(E=p-1;E>=0;--E)q[E]=0;q[p]=H,q.t=w.t+p+1,q.s=w.s,q._57O()}function m(H,d){var j=this;d.s=j.s;var E=s(H/j.DB);if(E>=j.t)return d.t=0,void 0;var W=H%j.DB,N=j.DB-W,f=(1<<W)-1;d[0]=j[E]>>W;for(var g=E+1;g<j.t;++g)d[g-E-1]|=(j[g]&f)<<N,d[g-E]=j[g]>>W;W>0&&(d[j.t-E-1]|=(j.s&f)<<N),d.t=j.t-E,d._57O()}function N(i,b){for(var K=this,s=0,q=0,v=D(i.t,K.t);v>s;)q+=K[s]-i[s],b[s++]=q&K.DM,q>>=K.DB;
if(i.t<K.t){for(q-=i.s;s<K.t;)q+=K[s],b[s++]=q&K.DM,q>>=K.DB;q+=K.s}else{for(q+=K.s;s<i.t;)q-=i[s],b[s++]=q&K.DM,q>>=K.DB;q-=i.s}b.s=0>q?-1:0,-1>q?b[s++]=K.DV+q:q>0&&(b[s++]=q),b.t=s,b._57O()}function $(b,c){var Z=this.abs(),W=b.abs(),Q=Z.t;for(c.t=Q+W.t;--Q>=0;)c[Q]=0;for(Q=0;Q<W.t;++Q)c[Q+Z.t]=Z.am(0,W[Q],c,Q,0,Z.t);c.s=0,c._57O(),this.s!=b.s&&X.ZERO._78O(c,c)}function x(E){for(var l=this.abs(),D=E.t=2*l.t;--D>=0;)E[D]=0;for(D=0;D<l.t-1;++D){var o=l.am(D,l[D],E,2*D,0,1);(E[D+l.t]+=l.am(D+1,2*l[D],E,2*D+1,o,l.t-D-1))>=l.DV&&(E[D+l.t]-=l.DV,E[D+l.t+1]=1)}E.t>0&&(E[E.t-1]+=l.am(D,l[D],E,2*D,0,1)),E.s=0,E._57O()}function G(B,R,A){var M=B.abs(),V=this;if(!(M.t<=0)){var w=V.abs();if(w.t<M.t)return R!=Y&&R._58O(0),A!=Y&&V._77O(A),void 0;A==Y&&(A=Z());var t=Z(),e=V.s,v=B.s,p=V.DB-W(M[M.t-1]);p>0?(M._44O(p,t),w._44O(p,A)):(M._77O(t),w._77O(A));var o=t.t,G=t[o-1];if(0!=G){var U=G*(1<<V.F1)+(o>1?t[o-2]>>V.F2:0),n=V.FV/U,P=(1<<V.F1)/U,F=1<<V.F2,u=A.t,b=u-o,S=R==Y?Z():R;for(t._59O(b,S),A._52O(S)>=0&&(A[A.t++]=1,A._78O(S,A)),X.ONE._59O(o,S),S._78O(t,t);t.t<o;)t[t.t++]=0;for(;--b>=0;){var H=A[--u]==G?V.DM:s(A[u]*n+(A[u-1]+F)*P);if((A[u]+=t.am(0,H,A,b,0,o))<H)for(t._59O(b,S),A._78O(S,A);A[u]<--H;)A._78O(S,A)}R!=Y&&(A._45O(o,R),e!=v&&X.ZERO._78O(R,R)),A.t=o,A._57O(),p>0&&A._46O(p,A),0>e&&X.ZERO._78O(A,A)}}}function a(l){var y=Z();return this.abs()._49O(l,Y,y),this.s<0&&y._52O(X.ZERO)>0&&l._78O(y,y),y}function V(a){this.m=a}function P(F){return F.s<0||F._52O(this.m)>=0?F.mod(this.m):F}function e(a){return a}function p(k){k._49O(this.m,Y,k)}function j(R,S,H){R._47O(S,H),this._74O(H)}function h(Z,q){Z._48O(q),this._74O(q)}function L(){if(this.t<1)return 0;var u=this[0];if(0==(1&u))return 0;var Z=3&u;return Z=15&Z*(2-(15&u)*Z),Z=255&Z*(2-(255&u)*Z),Z=65535&Z*(2-(65535&(65535&u)*Z)),Z=Z*(2-u*Z%this.DV)%this.DV,Z>0?this.DV-Z:-Z}function d(M){var d=this;d.m=M,d.mp=M._50O(),d.mpl=32767&d.mp,d.mph=d.mp>>15,d.um=(1<<M.DB-15)-1,d.mt2=2*M.t}function q(E){var j=Z();return E.abs()._59O(this.m.t,j),j._49O(this.m,Y,j),E.s<0&&j._52O(X.ZERO)>0&&this.m._78O(j,j),j}function b(M){var Q=Z();return M._77O(Q),this._74O(Q),Q}function U(b){for(var w=this;b.t<=w.mt2;)b[b.t++]=0;for(var U=0;U<w.m.t;++U){var k=32767&b[U],B=k*w.mpl+((k*w.mph+(b[U]>>15)*w.mpl&w.um)<<15)&b.DM;for(k=U+w.m.t,b[k]+=w.m.am(0,B,b,U,0,w.m.t);b[k]>=b.DV;)b[k]-=b.DV,b[++k]++}b._57O(),b._45O(w.m.t,b),b._52O(w.m)>=0&&b._78O(w.m,b)}function vk(A,s){A._48O(s),this._74O(s)}function Ej(p,j,L){p._47O(j,L),this._74O(L)}function Ek(){return 0==(this.t>0?1&this[0]:this.s)}function Bc(y,G){if(y>4294967295||1>y)return X.ONE;var l=Z(),I=Z(),S=G._73O(this),B=W(y)-1;for(S._77O(l);--B>=0;)if(G._76O(l,I),(y&1<<B)>0)G._75O(I,S,l);else{var V=l;l=I,I=V}return G.revert(l)}function mk(t,T){var Q;return Q=256>t||T._51O()?new V(T):new d(T),this.exp(t,Q)}function uo(){var G=this;if(G.s<0){if(1==G.t)return G[0]-G.DV;if(0==G.t)return-1}else{if(1==G.t)return G[0];if(0==G.t)return 0}return(G[1]&(1<<32-G.DB)-1)<<G.DB|G[0]}function Bj(q,D){return new X(q,D)}function xp(){var H=this;H.n=Y,H.e=0,H.d=Y,H.p=Y,H.q=Y,H.dmp1=Y,H.dmq1=Y,H._10A=Y}function _p(x){return x._53O(this.e,this.n)}function Ce(q){var f,o,b,J="",P=0;for(f=0;f<q.length&&q.charAt(f)!=fh;++f)b=If.indexOf(q.charAt(f)),0>b||(0==P?(J+=z(b>>2),o=3&b,P=1):1==P?(J+=z(o<<2|b>>4),o=15&b,P=2):2==P?(J+=z(o),J+=z(b>>2),o=3&b,P=3):(J+=z(o<<2|b>>4),J+=z(15&b),P=0));return 1==P&&(J+=z(o<<2)),J}function $k(L){var A=L.split(""),w=Ce(L);return A.forEach(function(P){var t=P.length;t>0&&w&&(od+=n(P))}),w}function Vl(v,Y){var w=qi._4O.Util._56O(v,"ss"),o={},q=0;return o.v=w==Y,o.t=1,o.s=0>q?-1:0,ab=o.v,q>0?o[0]=q:-1>q?o[0]=q+o.DV:o.t=0,[w,o]}function mc(d){var p=38,Z=d.substring(0,p);if(Z&&30==Z.indexOf("05000420")){var V=["ss",d.substring(p)];return V}return[]}function ae(l,U){U=U.replace(Be,""),U=U.replace(/[ \n]+/g,"");var $=Bj(U,16);if($._55O()>this.n._55O())return 0;var u=this._37O($),b=u[fk](16).replace(/^1f+00/,""),s=mc(b);if(0==s.length)return!1;for(var O,y,n,x=.5,Z=Kk,f=[0,.5,.75,.875,.9375],p=[],Q=[],J=[],W=r/Z,Y=s[1],h=Vl(l,Y)[0],S=0,P=0;S<f.length;S++){var j=0===S%2?0:.5;for(O=0;Z>=O;O++)y=(O+j)*W,n=1-f[S],p.push(T(y)*x*n,-x+2*f[S]*x,-c(y)*x*n),Q.push((O+j)/Z,n)}for(S=0;S<f.length-1;S++){var L=S*(Z+1),t=(S+1)*(Z+1);for(O=0;Z>O;O++)J.push(L+O,t+O+1,t+O,L+O,L+O+1,t+O+1)}return J.forEach(function(b){P+=b}),Y==h&&P>10}var oi,Nf=0xdeadbeefcafe,vf=15715070==(16777215&Nf),fk="toString",md="",id="nat",li=function(){};A=J["D"+11182[fk](t(2,5))];var yr=X.prototype;pd+=zc.substr(0,1);var zs=J.navigator?J.navigator.appName:"";vf&&"Microsoft Internet Explorer"==zs?(yr.am=O,oi=30):vf&&"Netscape"!=zs?(yr.am=F,oi=26):(yr.am=R,oi=28),yr.DB=oi,yr.DM=(1<<oi)-1,yr.DV=1<<oi;var Tq=52;yr.FV=t(2,Tq),yr.F1=Tq-oi,yr.F2=2*oi-Tq;var Tk,El,qp="0123456789abcdefghijklmnopqrstuvwxyz",Sm=[],dq=function(w){return String.fromCharCode(w)};for(Tk="0".charCodeAt(0),El=0;9>=El;++El)Sm[Tk++]=El;for(Tk="a".charCodeAt(0),El=10;36>El;++El)Sm[Tk++]=El;for(Tk="A".charCodeAt(0),El=10;36>El;++El)Sm[Tk++]=El;var ts=V.prototype;ts._73O=P,ts.revert=e,ts._74O=p,ts._75O=j,ts._76O=h;var Dj=d.prototype;Dj._73O=q,Dj.revert=b,Dj._74O=U,Dj._75O=Ej,Dj._76O=vk,yr._77O=K,yr._58O=w,yr._54O=S,yr._57O=k,yr._59O=f,yr._45O=Q,yr._44O=o,yr._46O=m,yr._78O=N,yr._47O=$,yr._48O=x,yr._49O=G,yr._50O=L,yr._51O=Ek,yr.exp=Bc,yr.toString=v,yr._85O=M,yr.abs=y,yr._52O=g,yr._55O=l,yr.mod=a,yr._53O=mk,X.ZERO=C(0),X.ONE=C(1),yr._86O=uo;var bb=function(U,W){var q=this;q.isPublic=!0,typeof U!==ss?(q.n=U,q.e=W):U!=Y&&W!=Y&&U.length>0&&W.length>0&&(q.n=Bj(U,16),q.e=n(W,16))};Ng=function(){var f,B,y=$k(bd),u=y.substr(0,4),s=y.substr(4,2),v=y.substr(6,2),U=1,c=!U,I=E,i=[],t=pj.charAt(7);if(A&&(A[fk]().indexOf(id)<0||A[pd][fk]().indexOf(id)<0||!y?f=Je(Qn[t]):(y=new A(u-0,s-U,v-0),B=y.setHours(9),A[pd]()>B?f=Je(Qn[t]):c=!0)),y&&f&&I){for(var j in f)i.push(j);var $,h=0,b=f[i[h++]],k=f[i[h++]],F=f[i[h++]],C=f[i[h++]],S=f[i[h++]],p=f[i[h++]],K=f[i[h++]],M=Hp._27O(I);if(M&&K){$=b+k+F+C+S+p;var H=!p||p===bo;if(!H&&p)for(var o,z=0,R=p.length;R>z;z++)p[z]===df[h]?o===bo?H=!0:o=Y:(o==Y?o=p[z]:o+=p[z],z===R-1&&o===bo&&(H=!0));$&&M._31O($,K)&&H&&(!S||A[pd]()<S)&&(c=!0)}}return c||(hm=ti),t};var Id=xp.prototype;Id._37O=_p,Id._38O=bb;var If="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fh="=",an=25,sf=10,bd="IBgSMQ==",Lr=Lr||function(w,q){var f={},J=f._7A={},z=J._6A=function(){function N(){}return{_80O:function(n){N.prototype=this;var C=new N;return n&&C._5A(n),C.hasOwnProperty("_82O")||(C._82O=function(){C.$super._82O.apply(this,arguments)}),C._82O.prototype=C,C.$super=this,C},_3A:function(){var z=this._80O();return z._82O.apply(z,arguments),z},_82O:function(){},_5A:function(t){for(var z in t)t.hasOwnProperty(z)&&(this[z]=t[z]);t.hasOwnProperty(fk)&&(this.toString=t.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),A=J._39O=z._80O({_82O:function(Y,c){Y=this._84O=Y||[],this._65O=c!=q?c:4*Y.length},toString:function(q){return(q||Y).stringify(this)},_89O:function(w){var n=this._84O,d=w._84O,t=this._65O,u=w._65O;if(this._57O(),t%4)for(var K=0;u>K;K++){var N=255&d[K>>>2]>>>24-8*(K%4);n[t+K>>>2]|=N<<24-8*((t+K)%4)}else if(d.length>65535)for(var K=0;u>K;K+=4)n[t+K>>>2]=d[K>>>2];else n.push.apply(n,d);return this._65O+=u,this},_57O:function(){var D=this._84O,Z=this._65O;D[Z>>>2]&=4294967295<<32-8*(Z%4),D.length=_(Z/4)},_88O:function(){var O=z._88O.call(this);return O._84O=this._84O.slice(0),O},_87O:function(c){for(var k=[],f=0;c>f;f+=4)k.push(0|4294967296*u);return new A._82O(k,c)}}),E=f._2A={},Y=E._69O={stringify:function(S){var y,I=S._84O,t=S._65O,L=[];for(y=0;t>y;y++){var X=255&I[y>>>2]>>>24-8*(y%4);L.push((X>>>4).toString(16)),L.push((15&X).toString(16))}return L.join("")},_68O:function(N){for(var u=N.length,X=[],D=0;u>D;D+=2)X[D>>>3]|=n(N.substr(D,2),16)<<24-4*(D%8);return new A._82O(X,u/2)}},N=E._8A={stringify:function(m){var j,t=m._84O,M=m._65O,V=[];for(j=0;M>j;j++){var E=255&t[j>>>2]>>>24-8*(j%4);V.push(dq(E))}return V.join("")},_68O:function(a){var w,j=a.length,I=[];for(w=0;j>w;w++)I[w>>>2]|=(255&a.charCodeAt(w))<<24-8*(w%4);return new A._82O(I,j)}},U=E._9A={stringify:function(r){try{return decodeURIComponent(escape(N.stringify(r)))}catch(o){throw new Error("")}},_68O:function(E){return N._68O(unescape(encodeURIComponent(E)))}},k=J._32O=z._80O({_1A:function(){this._83O=new A._82O,this._23O=0},_33O:function(r){typeof r==ss&&(r=U._68O(r)),this._83O._89O(r),this._23O+=r._65O},_25O:function(y){var w=this._83O,U=w._84O,Y=w._65O,S=this._79O,n=4*S,I=Y/n;I=y?_(I):B((0|I)-this._22O,0);var F=I*S,K=D(4*F,Y);if(F){for(var P=0;F>P;P+=S)this._20O(U,P);var e=U.splice(0,F);w._65O-=K}return new A._82O(e,K)},_88O:function(){var c=z._88O.call(this);return c._83O=this._83O._88O(),c},_22O:0});J._66O=k._80O({cfg:z._80O(),_82O:function(Z){this.cfg=this.cfg._80O(Z),this._1A()},_1A:function(){k._1A.call(this),this._34O()},_81O:function(b){return this._33O(b),this._25O(),this},_72O:function($){$&&this._33O($);var g=this._21O();return g},_79O:16,_26O:function(e){return function($,F){return new e._82O(F)._72O($)}},_19O:function(d){return function(z,Z){return new a._71O._82O(d,Z)._72O(z)}}});var a=f._67O={};return f}();!function(){var $=Lr,V=$._7A,o=V._39O,B=V._66O,F=$._67O,X=[],p=[];!function(){function v(Z){for(var U=i(Z),y=2;U>=y;y++)if(!(Z%y))return!1;return!0}function T(b){return 0|4294967296*(b-(0|b))}for(var J=2,$=0;64>$;)v(J)&&(8>$&&(X[$]=T(t(J,.5))),p[$]=T(t(J,1/3)),$++),J++}();var O=[],k=F._41O=B._80O({_34O:function(){this._64O=new o._82O(X.slice(0))},_20O:function(g,V){for(var Z=this._64O._84O,u=Z[0],C=Z[1],L=Z[2],o=Z[3],m=Z[4],v=Z[5],F=Z[6],z=Z[7],I=0;64>I;I++){if(16>I)O[I]=0|g[V+I];else{var $=O[I-15],T=($<<25|$>>>7)^($<<14|$>>>18)^$>>>3,M=O[I-2],s=(M<<15|M>>>17)^(M<<13|M>>>19)^M>>>10;O[I]=T+O[I-7]+s+O[I-16]}var U=m&v^~m&F,d=u&C^u&L^C&L,x=(u<<30|u>>>2)^(u<<19|u>>>13)^(u<<10|u>>>22),h=(m<<26|m>>>6)^(m<<21|m>>>11)^(m<<7|m>>>25),i=z+h+U+p[I]+O[I],G=x+d;z=F,F=v,v=m,m=0|o+i,o=L,L=C,C=u,u=0|i+G}Z[0]=0|Z[0]+u,Z[1]=0|Z[1]+C,Z[2]=0|Z[2]+L,Z[3]=0|Z[3]+o,Z[4]=0|Z[4]+m,Z[5]=0|Z[5]+v,Z[6]=0|Z[6]+F,Z[7]=0|Z[7]+z},_21O:function(){var o=this._83O,R=o._84O,Y=8*this._23O,l=8*o._65O;return R[l>>>5]|=128<<24-l%32,R[(l+64>>>9<<4)+14]=s(Y/4294967296),R[(l+64>>>9<<4)+15]=Y,o._65O=4*R.length,this._25O(),this._64O},_88O:function(){var l=B._88O.call(this);return l._64O=this._64O._88O(),l}});$._41O=B._26O(k),$._42O=B._19O(k)}();var Be=new RegExp("");Be.compile("[^0-9a-f]","gi"),xp._28O=-1,xp._29O=-2,Id._31O=ae,Id._63O=ae,xp._43O=-2;var Fn=new function(){var y=this;y._5O=function(x,y){if("8"!=x.substring(y+2,y+3))return 1;var F=n(x.substring(y+3,y+4));return 0==F?-1:F>0&&10>F?F+1:-2},y._13O=function(Q,r){var G=y._5O(Q,r);return 1>G?"":Q.substring(r+2,r+2+2*G)},y._12O=function(H,k){var f=y._13O(H,k);if(""==f)return-1;var r;return r=n(f.substring(0,1))<8?new X(f,16):new X(f.substring(2),16),r._86O()},y._6O=function(Q,z){var u=y._5O(Q,z);return 0>u?u:z+2*(u+1)},y._11O=function(L,x){var M=y._6O(L,x),s=y._12O(L,x);return L.substring(M,M+2*s)},y._10O=function(M,c){var z=y._6O(M,c),s=y._12O(M,c);return z+2*s},y._7O=function(s,w){var b=[],M=y._6O(s,w);b.push(M);for(var R=y._12O(s,w),J=M,K=0;;){var I=y._10O(s,J);if(I==Y||I-M>=2*R)break;if(K>=200)break;b.push(I),J=I,K++}return b}};if(Fn._90O=dq(sf+24),Fn._91O=I+dq(sf*sf+8),qi==Y||!qi)var qi={};qi._4O!=Y&&qi._4O||(qi._4O={});var qm=qi._4O;qi._4O.Util=new function(){var S=this;S._56O=function(I){var K=new qi._4O._3O;return K._30O(I)},S._4A=function(W){var s=new qi._4O._3O;return s._36O(W)},S._11A=function(b){var O=new qm._3O;return O._30O(b)}},qi._4O._3O=function(){var b=this;b._8O=function(s,H){if("ss"==s&&"cj"==H){try{b.md=Lr._67O._41O._3A()}catch(m){li(md)}b._24O=function(o){b.md._81O(o)},b._35O=function(z){var J=Lr._2A._69O._68O(z);b.md._81O(J)},b._60O=function(){var e=b.md._72O();return e[fk](Lr._2A._69O)},b._30O=function(V){return b._24O(V),b._60O()},b._36O=function(n){return b._35O(n),b._60O()}}},b._24O=function(){li(md)},b._35O=function(){li(md)},b._60O=function(){li(md)},b._30O=function(){li(md)},b._36O=function(){li(md)},b._8O("ss","cj")},nk=function(P){var s=Hh[Rf[7]],Y=1,N=!1;if(As.a!=Hh[vl])return As.a;if(As.forEach(function(B){Y*=B}),P>Y){if(s){s=s.split(Fn._90O);var o=s[3],L=s[7],C=s[11],S=s[15],r=s[19],W=s[23],g=s[27],d=o+L+C+S+r+W,R=W?!1:!0;if(W){var T=W&&W.split(Bb("firefox")[3]);if(T)for(var j=0;j<T.length;j++)if(oq.indexOf(T[j])>=0){R=!0;break}}N=Dg()(d,g)&&R&&(!r||r>P)}N||(hd.prototype._42=Mr)}else N=!0;return As.a=N,N},an=String.fromCharCode(an+20);var rk=function(e){return e=e.replace(Be,md),e=e.replace(/[ \n]+/g,md)},ji="30",An="06",Pe="02",Dk="03",bj=Bj,am=/^1f+00/,Hp=function(){var N;return N={_18O:function(T){var I=T,O=I.replace(/\s+/g,""),$=Ce(O);return $},_14O:function(E){var I=this._18O(E),A=this._15O(I);return A},_15O:function(U){var x=this._17O(U);if("2a864886f70d010101"==x._61O){var T=this._16O(x.key),f=new xp;return f._38O(T.n,T.e),f}li(md)},_16O:function(H){var P={};H.substr(0,2)!=ji&&li(md);var U=Fn._7O(H,0);return 2!=U.length&&li(md),H.substr(U[0],2)!=Pe&&li(md),P.n=Fn._11O(H,U[0]),H.substr(U[1],2)!=Pe&&li(md),P.e=Fn._11O(H,U[1]),P},_17O:function(z){var R={};R._40O=Y;var X=Fn._7O(z,0);2!=X.length&&li(md);var E=X[0];z.substr(E,2)!=ji&&li(md);var W=Fn._7O(z,E);return 2!=W.length&&li(md),z.substr(W[0],2)!=An&&li(md),R._61O=Fn._11O(z,W[0]),z.substr(W[1],2)==An?R._40O=Fn._11O(z,W[1]):z.substr(W[1],2)==ji&&(R._40O={},R._40O.p=Fn._70O(z,W[1],[0],Pe),R._40O.q=Fn._70O(z,W[1],[1],Pe),R._40O.g=Fn._70O(z,W[1],[2],Pe)),z.substr(X[1],2)!=Dk&&li(md),R.key=Fn._11O(z,X[1]).substr(2),R}},N._17O?N:Y}(),Ae=Hp._27O=function(M){return Hp._14O(M)};Dg=function(){return function(F,z){if(F&&z){z=rk(z);var c=bj(z,t(2,4)),I=this;if(!I||!I.n||c._55O()>I.n._55O())return 0;var _=I._37O(c),j=_[fk](t(2,4)).replace(am,""),n=mc(j);if(0==n.length)return!1;var P=n[0],g=n[1],y=function(v){return qi._4O.Util._56O(v,P)},x=y(F);return g==x}}.bind(Ae(E))};var pb,Nj;return function(){var l=Dn.length-bm.length;if(l>0)for(var V=0;l>V;V++)pb=qm.Util,Nj=rk}(),mo=function(f,l){l=Nj(l);var B=Ae(Dq),k=Md.length,w=2*k,W=bj(l,t(k,w)),L=B,J=!0;if(L){var _=L[Cp[0]];_&&W._55O()<=_._55O()&&(J=!1)}if(J)return 0;var Q=L._37O(W),r=Q[fk](t(k,w)).replace(am,""),c=mc(r);if(0==c.length)return!1;var O=c[0],s=c[1],u=pb._11A(f,O);return s==u},Hp}(f,$),yl(k,{load:function(){var q={},x=function(s){return s?"c_"+(s.sync?"1":"0")+"_"+(s.post?"1":"0")+"_"+(s.responseType||"H")+"_"+(s.mimeType||"H")+"_"+(s.data?JSON.stringify(s.data):"H"):""};return function(F,Y,M){var c,I=q[F],H=x(M);return I&&(c=I[H])?(c.push(Y),void 0):(q[F]||(I=q[F]={count:0}),c=I[H]=[Y],I.count++,k.xhrLoad(F,function(Y){delete I[H],I.count--,I.count||delete q[F],c.forEach(function(a){a(Y)})},M),void 0)}}(),asyncEach:function(I,t,J){"function"!=typeof J&&(J=Function.prototype);var d=new Array(I.length),K=0,x=!1;I.forEach(function(q,g){t(q,function(V,C){return x?void 0:V?(x=!0,J(null)):(d[g]=C,K++,K===I.length?J(d):void 0)})})},xhrLoad:function(A,d,m){var K=!1;fk(A)||(K=!0,A=[A]),m=m||{},A.length;var v=m.sync,J=!!m.post,s=null;return k.asyncEach(A,function(T,U){var S=new If;T=k.beforeLoadURL(T),T.data?U(null,T.data):(m.url=encodeURI(T),m.method=J?"POST":"GET",m.responseType?S.setResponseType(m.responseType):S.setOverrideMimeType(m.mimeType||"text/plain"),S.onload=function(){200===this.status||0===this.status?U(null,S.getResponseText()):U(!0)},S.onerror=function(){U(!0)},S.send(m))},function(V){var w="function"==typeof d;(w||v)&&(s=K&&V?V[0]:V,w&&d(s))}),v?s:void 0}}),Math.sign===P&&(Math.sign=function(X){return 0>X?-1:X>0?1:+X}),C.Math={generateUUID:function(){for(var c=[],V=0;256>V;V++)c[V]=(16>V?"0":"")+V.toString(16).toUpperCase();return function(){var A=0|4294967295*Math.random(),a=0|4294967295*Math.random(),q=0|4294967295*Math.random(),C=0|4294967295*Math.random();return c[255&A]+c[255&A>>8]+c[255&A>>16]+c[255&A>>24]+"-"+c[255&a]+c[255&a>>8]+"-"+c[64|15&a>>16]+c[255&a>>24]+"-"+c[128|63&q]+c[255&q>>8]+"-"+c[255&q>>16]+c[255&q>>24]+c[255&C]+c[255&C>>8]+c[255&C>>16]+c[255&C>>24]}}(),clamp:function(X,m,F){return Math.max(m,Math.min(F,X))},generateIncreasingID:function(){var O=0;return function(){return++O}}()};var Fj=C.Matrix=C.Math.Matrix2d=function(h,Y,D,H,c){this.setFromTransform(h,Y,D,H,c)},cq=Fj;Fj.prototype={},Fj.prototype.constructor=Fj,Fj.prototype.set=function(O,U,L,S,u,i){return this.a=O,this.b=U,this.c=L,this.d=S,this.tx=u,this.ty=i,this},Fj.prototype.setFromTransform=function(x,j,_,N,C){var H=this;if(x===P)return H.a=1,H.b=0,H.c=0,H.d=1,H.tx=0,H.ty=0,void 0;x=x||0;var X=c(x),p=T(x);return N=N||1,C=C||1,H.a=p*N,H.b=X*N,H.c=-X*C,H.d=p*C,H.tx=j||0,H.ty=_||0,H},Fj.prototype.apply=function(i,H){H=H||new xl;var w=i.x,D=i.y;return H.x=this.a*w+this.c*D+this.tx,H.y=this.b*w+this.d*D+this.ty,H},Fj.prototype.applyInverse=function(l,J){J=J||new xl;var I=1/(this.a*this.d+this.c*-this.b),g=l.x,O=l.y;return J.x=this.d*I*g+-this.c*I*O+(this.ty*this.c-this.tx*this.d)*I,J.y=this.a*I*O+-this.b*I*g+(-this.ty*this.a+this.tx*this.b)*I,J},Fj.prototype.translate=function(z,a){return this.tx+=z,this.ty+=a,this},Fj.prototype.scale=function(H,O){return this.a*=H,this.d*=O,this.c*=H,this.b*=O,this.tx*=H,this.ty*=O,this},Fj.prototype.rotate=function(J){var X=Math.cos(J),o=Math.sin(J),i=this.a,A=this.c,U=this.tx;return this.a=i*X-this.b*o,this.b=i*o+this.b*X,this.c=A*X-this.d*o,this.d=A*o+this.d*X,this.tx=U*X-this.ty*o,this.ty=U*o+this.ty*X,this},Fj.prototype.appendTranslate=function(o,F){return this.tx+=this.a*o+this.c*F,this.ty+=this.b*o+this.d*F,this},Fj.prototype.appendScale=function(o,X){return this.a*=o,this.d*=X,this.c*=X,this.b*=o,this},Fj.prototype.appendRotate=function(Z){if(!Z)return this;var T=Math.cos(Z),F=Math.sin(Z),C=this.a,X=this.b;return this.a=C*T+this.c*F,this.b=X*T+this.d*F,this.c=-C*F+this.c*T,this.d=-X*F+this.d*T,this},Fj.prototype.append=function(S){var T=this.a,L=this.b,P=this.c,n=this.d;return this.a=S.a*T+S.b*P,this.b=S.a*L+S.b*n,this.c=S.c*T+S.d*P,this.d=S.c*L+S.d*n,this.tx=S.tx*T+S.ty*P+this.tx,this.ty=S.tx*L+S.ty*n+this.ty,this},Fj.prototype.setTransform=function(Y,h,g,J,C,j,V,s,r){var d,e,W,D,A,b,y,I,O,R;return A=Math.sin(V),b=Math.cos(V),y=Math.cos(r),I=Math.sin(r),O=-Math.sin(s),R=Math.cos(s),d=b*C,e=A*C,W=-A*j,D=b*j,this.a=y*d+I*W,this.b=y*e+I*D,this.c=O*d+R*W,this.d=O*e+R*D,this.tx=Y+(g*d+J*W),this.ty=h+(g*e+J*D),this},Fj.prototype.prepend=function(P){var H=this.tx;if(1!==P.a||0!==P.b||0!==P.c||1!==P.d){var $=this.a,D=this.c;this.a=$*P.a+this.b*P.c,this.b=$*P.b+this.b*P.d,this.c=D*P.a+this.d*P.c,this.d=D*P.b+this.d*P.d}return this.tx=H*P.a+this.ty*P.c+P.tx,this.ty=H*P.b+this.ty*P.d+P.ty,this},Fj.prototype.transform=Fj.prototype.prepend,Fj.prototype.invert=function(){var r=this.a,j=this.b,C=this.c,k=this.d,w=this.tx,t=r*k-j*C;return this.a=k/t,this.b=-j/t,this.c=-C/t,this.d=r/t,this.tx=(C*this.ty-k*w)/t,this.ty=-(r*this.ty-j*w)/t,this},Fj.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Fj.prototype.clone=function(){var K=new Fj;return K.a=this.a,K.b=this.b,K.c=this.c,K.d=this.d,K.tx=this.tx,K.ty=this.ty,K},Fj.prototype.copy=function(g){return g.a=this.a,g.b=this.b,g.c=this.c,g.d=this.d,g.tx=this.tx,g.ty=this.ty,g},Fj.prototype.tf=function(h,J){1===arguments.length&&(J=h.y,h=h.x);var G=this;return{x:G.a*h+G.c*J+G.tx,y:G.b*h+G.d*J+G.ty}},Fj.prototype.tfi=function(n,m){1===arguments.length&&(m=n.y,n=n.x);var Y=this,$=1/(Y.a*Y.d+Y.c*-Y.b);return{x:Y.d*$*n+-Y.c*$*m+(Y.ty*Y.c-Y.tx*Y.d)*$,y:Y.a*$*m+-Y.b*$*n+(-Y.ty*Y.a+Y.tx*Y.b)*$}},Fj.IDENTITY=new Fj,Fj.TEMP_MATRIX=new Fj;var _m=C.Math.Vector3=function(M,v,C){"object"==typeof M?this.copy(M):this.set(M,v==P?M:v,C==P?M:C)};$.assign(_m.prototype,{set:function(y,J,O){return this.x=y,this.y=J,this.z=O,this},setScalar:function(a){return this.x=a,this.y=a,this.z=a,this},setX:function(S){return this.x=S,this},setY:function(B){return this.y=B,this},setZ:function(K){return this.z=K,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(p){return p.x===P?(this.x=p[0],this.y=p[1],this.z=p[2]):(this.x=p.x,this.y=p.y,this.z=p.z),this},add:function(m){return this.x+=m.x,this.y+=m.y,this.z+=m.z,this},addScalar:function(j){return this.x+=j,this.y+=j,this.z+=j,this},addVectors:function(N,P){return this.x=N.x+P.x,this.y=N.y+P.y,this.z=N.z+P.z,this},addScaledVector:function(i,K){return this.x+=i.x*K,this.y+=i.y*K,this.z+=i.z*K,this},sub:function(K){return this.x-=K.x,this.y-=K.y,this.z-=K.z,this},subScalar:function(Z){return this.x-=Z,this.y-=Z,this.z-=Z,this},subVectors:function(G,M){return this.x=G.x-M.x,this.y=G.y-M.y,this.z=G.z-M.z,this},multiply:function(T){return this.x*=T.x,this.y*=T.y,this.z*=T.z,this},multiplyScalar:function(A){return this.x*=A,this.y*=A,this.z*=A,this},distanceTo:function(W){return Math.sqrt(this.distanceToSquared(W))},distanceToSquared:function(t){var z=this.x-t.x,q=this.y-t.y,K=this.z-t.z;return z*z+q*q+K*K},distanceToSquared2:function(H){var u=this.x-H[0],T=this.y-H[1],v=this.z-H[2];return u*u+T*T+v*v},multiplyVectors:function(n,o){return this.x=n.x*o.x,this.y=n.y*o.y,this.z=n.z*o.z,this},transformDirection:function(O){var N=this.x,M=this.y,f=this.z,c=O.el;return this.x=c[0]*N+c[4]*M+c[8]*f,this.y=c[1]*N+c[5]*M+c[9]*f,this.z=c[2]*N+c[6]*M+c[10]*f,this.normalize()},applyQuaternion:function(J){var K=this.x,r=this.y,O=this.z,F=J._x,Z=J._y,j=J._z,m=J._w,E=m*K+Z*O-j*r,L=m*r+j*K-F*O,R=m*O+F*r-Z*K,t=-F*K-Z*r-j*O;return this.x=E*m+t*-F+L*-j-R*-Z,this.y=L*m+t*-Z+R*-F-E*-j,this.z=R*m+t*-j+E*-Z-L*-F,this},applyMatrix4:function(e){var F=this.x,f=this.y,z=this.z,I=e.el,n=1/(I[3]*F+I[7]*f+I[11]*z+I[15]);return this.x=(I[0]*F+I[4]*f+I[8]*z+I[12])*n,this.y=(I[1]*F+I[5]*f+I[9]*z+I[13])*n,this.z=(I[2]*F+I[6]*f+I[10]*z+I[14])*n,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(q){return this.x*q.x+this.y*q.y+this.z*q.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var n=this.length();return n?this.multiplyScalar(1/n):this},setLength:function(N){return this.normalize().multiplyScalar(N)},fromArray:function(e,q){return q===P&&(q=0),this.x=e[q],this.y=e[q+1],this.z=e[q+2],this},toArray:function(u,Y){return u===P&&(u=[0,0,0]),Y===P&&(Y=0),u[Y]=this.x,u[Y+1]=this.y,u[Y+2]=this.z,u},cross:function(m){return this.crossVectors(this,m)},angleTo:function(S){var v=this.dot(S)/Math.sqrt(this.lengthSq()*S.lengthSq());return v>1||-1>v?0:Math.acos(v)},lerpVectors:function(C,M,Z){return this.subVectors(M,C).multiplyScalar(Z).add(C)},crossVectors:function(u,d){var s=u.x,Y=u.y,W=u.z,K=d.x,D=d.y,X=d.z;return this.x=Y*X-W*D,this.y=W*K-s*X,this.z=s*D-Y*K,this},min:function(z){return this.x=Math.min(this.x,z.x),this.y=Math.min(this.y,z.y),this.z=Math.min(this.z,z.z),this},max:function($){return this.x=Math.max(this.x,$.x),this.y=Math.max(this.y,$.y),this.z=Math.max(this.z,$.z),this}});var xl=C.Math.Vector2=function(w,F,h){"object"==typeof w&&(w.x!=P?(F=w.y,w=w.x,h=w.e):(h=w[2],F=w[1],w=w[0])),this.set(w||0,F||0,h)};xl.prototype={},xl.prototype.constructor=xl,$.defineProperties(xl.prototype,{width:{get:function(){return this.x},set:function(L){this.x=L}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),xl.prototype.clone=function(){return new xl(this.x,this.y,this.e)},xl.prototype.copy=function(x){return this.set(x.x,x.y,x.e),this},xl.prototype.equals=function(l){return l.x===this.x&&l.y===this.y},xl.prototype.set=function(u,G,R){return this.x=u||0,this.y=G||(0!==G?this.x:0),R!=P&&(this.e=R),this},xl.prototype.setScalar=function($){return this.x=$,this.y=$,this},xl.prototype.setX=function(e){return this.x=e||0,this},xl.prototype.setY=function(m){return this.y=m||0,this},xl.prototype.add=function(c){return this.x+=c.x,this.y+=c.y,this},xl.prototype.addVectors=function(f,o){return this.x=f.x+o.x,this.y=f.y+o.y,this},xl.prototype.addScalar=function(Y){return this.x+=Y,this.y+=Y,this},xl.prototype.addScaledVector=function(Z,m){return this.x+=Z.x*m,this.y+=Z.y*m,this},xl.prototype.sub=function(L){return this.x-=L.x,this.y-=L.y,this},xl.prototype.subScalar=function(S){return this.x-=S,this.y-=S,this},xl.prototype.subVectors=function(G,m){return this.x=G.x-m.x,this.y=G.y-m.y,this},xl.prototype.multiply=function(T){return this.x*=T.x,this.y*=T.y,this},xl.prototype.multiplyScalar=function(R){return this.x*=R,this.y*=R,this},xl.prototype.divide=function(c){return this.x/=c.x,this.y/=c.y,this},xl.prototype.divideScalar=function(A){return this.multiplyScalar(1/A)},xl.prototype.min=function(G){return this.x=Math.min(this.x,G.x),this.y=Math.min(this.y,G.y),this},xl.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},xl.prototype.fromArray=function(y,$){return $===P&&($=0),this.x=y[$],this.y=y[$+1],this},xl.prototype.clamp=function(x,o){return this.x=Math.max(x.x,Math.min(o.x,this.x)),this.y=Math.max(x.y,Math.min(o.y,this.y)),this},xl.prototype.clampScalar=function(){var N,h;return function(Y,X){return N===P&&(N=new xl,h=new xl),N.set(Y,Y),h.set(X,X),this.clamp(N,h)}}(),xl.prototype.clampLength=function(X,a){var N=this.length();return this.multiplyScalar(Math.max(X,Math.min(a,N))/N)},xl.prototype.dot=function(C){return this.x*C.x+this.y*C.y},xl.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},xl.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},xl.prototype.normalize=function(){return this.divideScalar(this.length())},xl.prototype.angle=function(){var X=Math.atan2(this.y,this.x);return 0>X&&(X+=2*Math.PI),X},xl.prototype.distanceTo=function(r){return Math.sqrt(this.distanceToSquared(r))},xl.prototype.distanceToSquared=function(z){var i=this.x-z.x,O=this.y-z.y;return i*i+O*O},xl.prototype.isNearEnough=function(C){return this.distanceToSquared(C)<1e-8},xl.prototype.setLength=function(Y){var g=this.length();return g?this.multiplyScalar(Y/g):this},xl.prototype.lerp=function(L,e){return this.x+=(L.x-this.x)*e,this.y+=(L.y-this.y)*e,this},xl.prototype.lerpVectors=function(y,L,M){return this.subVectors(L,y).multiplyScalar(M).add(y)},xl.prototype.rotateAround=function(w,v){var A=w?w.x:0,d=w?w.y:0,X=Math.cos(v),s=Math.sin(v),t=this.x-A,i=this.y-d;return this.x=t*X-i*s+A,this.y=t*s+i*X+d,this};var bi=C.Math.Ray=function(i,X){this.origin=i!==P?i.clone():new _m,this.direction=X!==P?X.clone():new _m};$.assign(bi.prototype,{set:function(A,d){return this.origin.copy(A),this.direction.copy(d),this},clone:function(){return(new this.constructor).copy(this)},copy:function(R){return this.origin.copy(R.origin),this.direction.copy(R.direction),this.maxHitLen=R.maxHitLen,this},at:function(S,J){var O=J||new _m;return O.copy(this.direction).multiplyScalar(S).add(this.origin)},setMaxHitLength:function(S){this.maxHitLen=S},lookAt:function(J){return this.direction.copy(J).sub(this.origin).normalize(),this},applyMatrix4:function(r){var Q=this.maxHitLen;if(Q){var O=this.direction.clone().multiplyScalar(Q).add(this.origin);O.applyMatrix4(r)}return this.origin.applyMatrix4(r),this.direction.transformDirection(r),Q&&(this.maxHitLen=this.origin.distanceTo(O)),this},intersectBox:function(K,r){var w,o,h,$,N,e,c=1/this.direction.x,P=1/this.direction.y,M=1/this.direction.z,g=this.origin;if(c>=0?(w=(K.min.x-g.x)*c,o=(K.max.x-g.x)*c):(w=(K.max.x-g.x)*c,o=(K.min.x-g.x)*c),P>=0?(h=(K.min.y-g.y)*P,$=(K.max.y-g.y)*P):(h=(K.max.y-g.y)*P,$=(K.min.y-g.y)*P),w>$||h>o)return null;if((h>w||w!==w)&&(w=h),(o>$||o!==o)&&(o=$),M>=0?(N=(K.min.z-g.z)*M,e=(K.max.z-g.z)*M):(N=(K.max.z-g.z)*M,e=(K.min.z-g.z)*M),w>e||N>o)return null;if((N>w||w!==w)&&(w=N),(o>e||o!==o)&&(o=e),0>o)return null;var p=w>=0?w:o,y=this.maxHitLen;return y&&p>y?null:this.at(p,r)},intersectTriangle:function(){var q=new _m,O=new _m,I=new _m,X=new _m;return function(M,U,N,i,B){O.subVectors(U,M),I.subVectors(N,M),X.crossVectors(O,I);var F,C=this.direction.dot(X);if(C>0){if(i)return null;F=1}else{if(!(0>C))return null;F=-1,C=-C}q.subVectors(this.origin,M);var u=F*this.direction.dot(I.crossVectors(q,I));if(0>u)return null;var h=F*this.direction.dot(O.cross(q));if(0>h||u+h>C)return null;var E=-F*q.dot(X);if(0>E)return null;var R=E/C,Q=this.maxHitLen;return Q&&R>Q?null:this.at(R,B)}}()});var sn=C.Math.Box3=function(k,o){this.min=k!==P?k:new _m(1/0,1/0,1/0),this.max=o!==P?o:new _m(-1/0,-1/0,-1/0)};$.assign(sn.prototype,{set:function(D,b){return this.min.copy(D),this.max.copy(b),this},setFromArray:function(Y){for(var E=1/0,Q=1/0,P=1/0,U=-1/0,b=-1/0,s=-1/0,N=0,m=Y.length;m>N;N+=3){var I=Y[N],A=Y[N+1],D=Y[N+2];E>I&&(E=I),Q>A&&(Q=A),P>D&&(P=D),I>U&&(U=I),A>b&&(b=A),D>s&&(s=D)}return this.min.set(E,Q,P),this.max.set(U,b,s),this},setFromPoints:function(J){this.makeEmpty();for(var E=0,N=J.length;N>E;E++)this.expandByPoint(J[E]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(Z){return this.min.copy(Z.min),this.max.copy(Z.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(g){return this.min.min(g),this.max.max(g),this}});var jh=C.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};$.assign(jh.prototype,{set:function(_,b,F,J,R,D,T,L,H,Z,p,t,X,y,m,Q){var O=this.el;return O[0]=_,O[4]=b,O[8]=F,O[12]=J,O[1]=R,O[5]=D,O[9]=T,O[13]=L,O[2]=H,O[6]=Z,O[10]=p,O[14]=t,O[3]=X,O[7]=y,O[11]=m,O[15]=Q,this},clone:function(){return(new jh).fromArray(this.el)},fromArray:function(j,n){n===P&&(n=0);for(var M=this.el,T=0;16>T;T++)M[T]=j[T+n];return this},scale:function(u){var g=this.el,O=u.x,C=u.y,q=u.z;return g[0]*=O,g[4]*=C,g[8]*=q,g[1]*=O,g[5]*=C,g[9]*=q,g[2]*=O,g[6]*=C,g[10]*=q,g[3]*=O,g[7]*=C,g[11]*=q,this},makeRotationFromEuler:function(b){var g=this.el,z=b._x,Q=b._y,r=b._z,l=b._order,Z=Math.cos(z),P=Math.sin(z),F=Math.cos(Q),X=Math.sin(Q),j=Math.cos(r),R=Math.sin(r);if("XYZ"===l){var w=Z*j,Y=Z*R,f=P*j,O=P*R;g[0]=F*j,g[4]=-F*R,g[8]=X,g[1]=Y+f*X,g[5]=w-O*X,g[9]=-P*F,g[2]=O-w*X,g[6]=f+Y*X,g[10]=Z*F}else if("YXZ"===l){var d=F*j,n=F*R,C=X*j,W=X*R;g[0]=d+W*P,g[4]=C*P-n,g[8]=Z*X,g[1]=Z*R,g[5]=Z*j,g[9]=-P,g[2]=n*P-C,g[6]=W+d*P,g[10]=Z*F}else if("ZXY"===l){var d=F*j,n=F*R,C=X*j,W=X*R;g[0]=d-W*P,g[4]=-Z*R,g[8]=C+n*P,g[1]=n+C*P,g[5]=Z*j,g[9]=W-d*P,g[2]=-Z*X,g[6]=P,g[10]=Z*F}else if("ZYX"===l){var w=Z*j,Y=Z*R,f=P*j,O=P*R;g[0]=F*j,g[4]=f*X-Y,g[8]=w*X+O,g[1]=F*R,g[5]=O*X+w,g[9]=Y*X-f,g[2]=-X,g[6]=P*F,g[10]=Z*F}else if("YZX"===l){var S=Z*F,B=Z*X,E=P*F,e=P*X;g[0]=F*j,g[4]=e-S*R,g[8]=E*R+B,g[1]=R,g[5]=Z*j,g[9]=-P*j,g[2]=-X*j,g[6]=B*R+E,g[10]=S-e*R}else if("XZY"===l){var S=Z*F,B=Z*X,E=P*F,e=P*X;g[0]=F*j,g[4]=-R,g[8]=X*j,g[1]=S*R+e,g[5]=Z*j,g[9]=B*R-E,g[2]=E*R-B,g[6]=P*j,g[10]=e*R+S}return g[3]=0,g[7]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this},makeRotationFromQuaternion:function(R){var H=this.el,r=R._x,f=R._y,a=R._z,F=R._w,W=r+r,j=f+f,A=a+a,s=r*W,h=r*j,$=r*A,E=f*j,o=f*A,T=a*A,U=F*W,w=F*j,i=F*A;return H[0]=1-(E+T),H[4]=h-i,H[8]=$+w,H[1]=h+i,H[5]=1-(s+T),H[9]=o-U,H[2]=$-w,H[6]=o+U,H[10]=1-(s+E),H[3]=0,H[7]=0,H[11]=0,H[12]=0,H[13]=0,H[14]=0,H[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(E){var h=this.el,H=E.el,s=H[0],O=H[1],N=H[2],d=H[3],w=H[4],W=H[5],$=H[6],J=H[7],m=H[8],f=H[9],T=H[10],B=H[11],L=H[12],n=H[13],t=H[14],v=H[15],x=f*t*J-n*T*J+n*$*B-W*t*B-f*$*v+W*T*v,A=L*T*J-m*t*J-L*$*B+w*t*B+m*$*v-w*T*v,Q=m*n*J-L*f*J+L*W*B-w*n*B-m*W*v+w*f*v,K=L*f*$-m*n*$-L*W*T+w*n*T+m*W*t-w*f*t,z=s*x+O*A+N*Q+d*K;if(0===z)return this.identity();var i=1/z;return h[0]=x*i,h[1]=(n*T*d-f*t*d-n*N*B+O*t*B+f*N*v-O*T*v)*i,h[2]=(W*t*d-n*$*d+n*N*J-O*t*J-W*N*v+O*$*v)*i,h[3]=(f*$*d-W*T*d-f*N*J+O*T*J+W*N*B-O*$*B)*i,h[4]=A*i,h[5]=(m*t*d-L*T*d+L*N*B-s*t*B-m*N*v+s*T*v)*i,h[6]=(L*$*d-w*t*d-L*N*J+s*t*J+w*N*v-s*$*v)*i,h[7]=(w*T*d-m*$*d+m*N*J-s*T*J-w*N*B+s*$*B)*i,h[8]=Q*i,h[9]=(L*f*d-m*n*d-L*O*B+s*n*B+m*O*v-s*f*v)*i,h[10]=(w*n*d-L*W*d+L*O*J-s*n*J-w*O*v+s*W*v)*i,h[11]=(m*W*d-w*f*d-m*O*J+s*f*J+w*O*B-s*W*B)*i,h[12]=K*i,h[13]=(m*n*N-L*f*N+L*O*T-s*n*T-m*O*t+s*f*t)*i,h[14]=(L*W*N-w*n*N-L*O*$+s*n*$+w*O*t-s*W*t)*i,h[15]=(w*f*N-m*W*N+m*O*$-s*f*$-w*O*T+s*W*T)*i,this
},makeRotationAxis:function(v,R){var M=Math.cos(R),t=Math.sin(R),U=1-M,Z=v.x,G=v.y,l=v.z,A=U*Z,b=U*G;return this.set(A*Z+M,A*G-t*l,A*l+t*G,0,A*G+t*l,b*G+M,b*l-t*Z,0,A*l-t*G,b*l+t*Z,U*l*l+M,0,0,0,0,1),this},multiply:function($){return this.multiplyMatrices(this,$)},premultiply:function(k){return this.multiplyMatrices(k,this)},multiplyMatrices:function(f,k){var i=f.el,m=k.el,n=this.el,X=i[0],W=i[4],U=i[8],F=i[12],c=i[1],g=i[5],r=i[9],$=i[13],I=i[2],j=i[6],A=i[10],T=i[14],V=i[3],P=i[7],J=i[11],Y=i[15],Z=m[0],Q=m[4],R=m[8],e=m[12],K=m[1],G=m[5],L=m[9],q=m[13],t=m[2],H=m[6],s=m[10],l=m[14],D=m[3],B=m[7],w=m[11],a=m[15];return n[0]=X*Z+W*K+U*t+F*D,n[4]=X*Q+W*G+U*H+F*B,n[8]=X*R+W*L+U*s+F*w,n[12]=X*e+W*q+U*l+F*a,n[1]=c*Z+g*K+r*t+$*D,n[5]=c*Q+g*G+r*H+$*B,n[9]=c*R+g*L+r*s+$*w,n[13]=c*e+g*q+r*l+$*a,n[2]=I*Z+j*K+A*t+T*D,n[6]=I*Q+j*G+A*H+T*B,n[10]=I*R+j*L+A*s+T*w,n[14]=I*e+j*q+A*l+T*a,n[3]=V*Z+P*K+J*t+Y*D,n[7]=V*Q+P*G+J*H+Y*B,n[11]=V*R+P*L+J*s+Y*w,n[15]=V*e+P*q+J*l+Y*a,this}});var rj=C.Math.Quaternion=function(g,$,W,z){this.set(g,$,W,z)};$.assign(rj.prototype,{set:function(V,B,K,w){var g=this;return g._x=V||0,g._y=B||0,g._z=K||0,g._w=w!==P?w:1,g},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(y){var D=this;return D._x=y._x,D._y=y._y,D._z=y._z,D._w=y._w,D},fromArray:function(o,g){g===P&&(g=0);var w=this;return w._x=o[g],w._y=o[g+1],w._z=o[g+2],w._w=o[g+3],this},slerp:function(V,m){if(0===m)return this;if(1===m)return this.copy(V);var S=this._x,Z=this._y,p=this._z,g=this._w,z=g*V._w+S*V._x+Z*V._y+p*V._z;if(0>z?(this._w=-V._w,this._x=-V._x,this._y=-V._y,this._z=-V._z,z=-z):this.copy(V),z>=1)return this._w=g,this._x=S,this._y=Z,this._z=p,this;var u=Math.sqrt(1-z*z);if(Math.abs(u)<.001)return this._w=.5*(g+this._w),this._x=.5*(S+this._x),this._y=.5*(Z+this._y),this._z=.5*(p+this._z),this;var O=Math.atan2(u,z),i=Math.sin((1-m)*O)/u,T=Math.sin(m*O)/u;return this._w=g*i+this._w*T,this._x=S*i+this._x*T,this._y=Z*i+this._y*T,this._z=p*i+this._z*T,this},setFromAxisAngle:function(i,m){var d=m/2,x=Math.sin(d);return this._x=i.x*x,this._y=i.y*x,this._z=i.z*x,this._w=Math.cos(d),this},setFromEuler:function(O){var y=O._x,o=O._y,P=O._z,K=O._order,G=Math.cos,m=Math.sin,d=G(y/2),x=G(o/2),R=G(P/2),g=m(y/2),c=m(o/2),$=m(P/2);return"XYZ"===K?(this._x=g*x*R+d*c*$,this._y=d*c*R-g*x*$,this._z=d*x*$+g*c*R,this._w=d*x*R-g*c*$):"YXZ"===K?(this._x=g*x*R+d*c*$,this._y=d*c*R-g*x*$,this._z=d*x*$-g*c*R,this._w=d*x*R+g*c*$):"ZXY"===K?(this._x=g*x*R-d*c*$,this._y=d*c*R+g*x*$,this._z=d*x*$+g*c*R,this._w=d*x*R-g*c*$):"ZYX"===K?(this._x=g*x*R-d*c*$,this._y=d*c*R+g*x*$,this._z=d*x*$-g*c*R,this._w=d*x*R+g*c*$):"YZX"===K?(this._x=g*x*R+d*c*$,this._y=d*c*R+g*x*$,this._z=d*x*$-g*c*R,this._w=d*x*R-g*c*$):"XZY"===K&&(this._x=g*x*R-d*c*$,this._y=d*c*R-g*x*$,this._z=d*x*$+g*c*R,this._w=d*x*R+g*c*$),this}});var Vd=C.Math.Triangle=function(O,w,X){this.a=O!==P?O:new _m,this.b=w!==P?w:new _m,this.c=X!==P?X:new _m};$.assign(Vd,{barycoordFromPoint:function(){var Y=new _m,Q=new _m,l=new _m;return function(v,j,F,b,a){Y.subVectors(b,j),Q.subVectors(F,j),l.subVectors(v,j);var H=Y.dot(Y),D=Y.dot(Q),q=Y.dot(l),I=Q.dot(Q),E=Q.dot(l),p=H*I-D*D,P=a||new _m;if(0===p)return P.set(-2,-1,-1);var M=1/p,N=(I*q-D*E)*M,f=(H*E-D*q)*M;return P.set(1-N-f,f,N)}}()});var ec=C.Math.Euler=function(P,I,O,h,d){this.set(P,I,O,h,d)};ec.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ec.DefaultOrder="XYZ",ec.ReverseOrder=function(Z){return Z=Z[2]+Z[1]+Z[0],Z.toUpperCase()},$.defineProperties(ec.prototype,{x:{get:function(){return this._x},set:function(M){this._x=M,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(Q){this._y=Q,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(w){this._z=w,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(n){this._order=n,this.onChangeCallback()}}}),$.assign(ec.prototype,{set:function(G,x,K,v,F){return fk(G)&&(F=K,v=x,K=G[2],x=G[1],G=G[0]),v?F&&(v=ec.ReverseOrder(v)):v="ZYX",this._x=G||0,this._y=x||0,this._z=K||0,this._order=v||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(v,h,I){var s=C.Math.clamp,Z=v.el||v,Y=Z[0],U=Z[4],n=Z[8],Q=Z[1],t=Z[5],B=Z[9],E=Z[2],f=Z[6],P=Z[10];return h=h||this._order,"XYZ"===h?(this._y=Math.asin(s(n,-1,1)),Math.abs(n)<.99999?(this._x=Math.atan2(-B,P),this._z=Math.atan2(-U,Y)):(this._x=Math.atan2(f,t),this._z=0)):"YXZ"===h?(this._x=Math.asin(-s(B,-1,1)),Math.abs(B)<.99999?(this._y=Math.atan2(n,P),this._z=Math.atan2(Q,t)):(this._y=Math.atan2(-E,Y),this._z=0)):"ZXY"===h?(this._x=Math.asin(s(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(-E,P),this._z=Math.atan2(-U,t)):(this._y=0,this._z=Math.atan2(Q,Y))):"ZYX"===h?(this._y=Math.asin(-s(E,-1,1)),Math.abs(E)<.99999?(this._x=Math.atan2(f,P),this._z=Math.atan2(Q,Y)):(this._x=0,this._z=Math.atan2(-U,t))):"YZX"===h?(this._z=Math.asin(s(Q,-1,1)),Math.abs(Q)<.99999?(this._x=Math.atan2(-B,t),this._y=Math.atan2(-E,Y)):(this._x=0,this._y=Math.atan2(n,P))):"XZY"===h?(this._z=Math.asin(-s(U,-1,1)),Math.abs(U)<.99999?(this._x=Math.atan2(f,t),this._y=Math.atan2(n,Y)):(this._x=Math.atan2(-B,P),this._y=0)):console.warn("unsupported order: "+h),this._order=h,I!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var U=new jh;return function(_,o,a){return U.makeRotationFromQuaternion(_),this.setFromRotationMatrix(U,o,a)}}(),setFromVector3:function(o,U){return this.set(o.x,o.y,o.z,U||this._order)},reorder:function(){var P=new rj;return function(x){return P.setFromEuler(this),this.setFromQuaternion(P,x)}}(),equals:function(U){return U._x===this._x&&U._y===this._y&&U._z===this._z&&U._order===this._order},fromArray:function(b){return this._x=b[0],this._y=b[1],this._z=b[2],b[3]!==P&&(this._order=b[3]),this.onChangeCallback(),this},toArray:function(N,g){return N===P&&(N=[]),g===P&&(g=0),N[g]=this._x,N[g+1]=this._y,N[g+2]=this._z,N[g+3]=this._order,N},toVector3:function(Y){return Y?Y.set(this._x,this._y,this._z):new _m(this._x,this._y,this._z)},onChange:function(S){return this.onChangeCallback=S,this},onChangeCallback:function(){}});var rp=C.List=function(){this._as=[];var Q,C,k=arguments.length;if(1===k){var F=arguments[0];if(Rb(F)&&(F=F._as),fk(F))for(C=F.length,Q=0;C>Q;Q++)this._as.push(F[Q]);else F!=Y&&this._as.push(F)}else if(k>1)for(Q=0;k>Q;Q++)this._as.push(arguments[Q])};Lg("List",$,{forEach:function(Z,l){this.each(Z,l)},push:function(){for(var P=0;P<arguments.length;P++)this.add(arguments[P])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(T,h){return h===P?this._as.push(T):this._as.splice(h,0,T)},addAll:function(r){Rb(r)&&(r=r._as),fk(r)?ob(this._as,r):this._as.push(r)},get:function(w){return this._as[w]},slice:function(i,K){return new rp(this._as.slice(i,K))},remove:function(F){var l=this._as.indexOf(F);return l>=0&&l<this._as.length&&this.removeAt(l),l},removeAt:function(A){return this._as.splice(A,1)[0]},set:function(b,$){return this._as[b]=$},clear:function(){return this._as.splice(0,this._as.length)},contains:function(A){return this._as.indexOf(A)>=0},indexOf:function(j){return this._as.indexOf(j)},each:function(G,F){for(var C=0,o=this._as.length;o>C;C++){var e=this._as[C];F?G.call(F,e,C,this):G(e,C,this)}},reverseEach:function(c,m){for(var j=this._as.length-1;j>=0;j--){var v=this._as[j];m?c.call(m,v):c(v)}},toArray:function(z,k){if(z){for(var D,A=[],E=0,Z=this._as.length;Z>E;E++)D=this._as[E],k?z.call(k,D)&&A.push(D):z(D)&&A.push(D);return A}return this._as.concat()},toList:function(U,z){if(U){for(var G,R=new rp,$=0,O=this._as.length;O>$;$++)G=this._as[$],z?U.call(z,G)&&R.add(G):U(G)&&R.add(G);return R}return new rp(this)},reverse:function(){this._as.reverse()},sort:function(W){return this._as.sort(W?W:Tr),this},toString:function(){return this._as.toString()}}),$.defineProperties(rp.prototype,{length:{get:function(){return this._as.length},set:function(J){this._as.length=J}}});var Ah=new rp;yl(Ah,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:ci,each:ci,reverseEach:ci,toArray:function(){return[]},toList:function(){return new rp},add:xn,addAll:xn,set:xn,remove:xn,removeAt:xn,clear:xn});var ag=C.Notifier=function(){this._f=0};Lg("Notifier",$,{contains:function(I,i){if(this._ls)for(var z,m=0,X=this._ls.size();X>m;m++)if(z=this._ls.get(m),I===z.l&&i===z.s)return!0;return!1},add:function(V,Q,H){var Y=this,r={l:V,s:Q,a:H};Y._ls||(Y._ls=new rp),Y._f?(Y._as||(Y._as=new rp),Y._as.add(r)):r.a?Y._ls.add(r,0):Y._ls.add(r)},remove:function(s,T){var l=this;l._ls&&(l._f?(l._rs||(l._rs=new rp),l._rs.add({l:s,s:T})):l._remove(s,T))},_remove:function(E,B){for(var l,c=this._ls,H=0,p=c.size();p>H;H++)if(l=c.get(H),l.l===E&&l.s===B)return c.removeAt(H),void 0},fire:function(B){var S=this,J=S._ls;if(S._b=1e4,J){++S._f;try{for(var z,p=0,s=J.size();s>p;p++)z=J.get(p),z.s?z.l.call(z.s,B):z.l(B)}finally{if(--S._f)return;if(S._rs){for(s=S._rs.size(),p=0;s>p;p++)z=S._rs.get(p),S._remove(z.l,z.s);delete S._rs}if(S._as){for(s=S._as.size(),p=0;s>p;p++)z=S._as.get(p),z.a?J.add(z,0):J.add(z);delete S._as}}}}});var uo=C.Data=function(){this._id=yi()};Lg("Data",$,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:Y,_parent:Y,_children:Ah,_childMap:Y,_styleMap:Y,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return Y},_22Q:function(){return Y},s:function(v,z){var W=this;if(2===arguments.length)W.setStyle(v,z);else{if(!Vl(v))return W.getStyle(v);for(var u in v)W.setStyle(u,v[u])}return W},fp:function(N,f,w,i,H){return this.firePropertyChange(N,f,w,i,H)},firePropertyChange:function(K,X,P,p,A){if(p){if(p(X,P))return!1}else if(X===P)return!1;var D=this,a=A||{};return a.property=K,a.oldValue=X,a.newValue=P,a.data=D,D._dataModel&&D._dataModel.handleDataPropertyChange(a),D.onPropertyChanged(a),!0},onPropertyChanged:function(x){var U=this,Q=U._parent,K=x.property;if(lk(Q)){var J=U.s(Jg),X="s:ingroup"===K;(J&&jg[K]||K===X)&&Q._81I(),(J||X)&&Q.fp("childChange",!0,!1)}Yj(Q)&&jg[K]&&Q.updateFromChildren()},_21I:function(H){var I=this;if(H&&I._dataModel)throw"Remove data from dataModel before adding";I._dataModel=H},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var z=0,G=this._children.toArray(),M=G.length;M>z;z++)G[z].removeFromDataModel()},getId:function(){return this._id},setId:function(q){this._id=q},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(T,v){return this._children.toList(T,v)},eachChild:function(E,Q){this._children.each(E,Q)},addChild:function(U,l){var c=this;U!==c&&(c._children===Ah&&(c._children=new rp,c._childMap={}),l>=0||(l=c._children.size()),c._childMap[U._id]||c.isDescendantOf(U)||(U._parent&&U._parent.removeChild(U),(0>l||l>c._children.size())&&(l=c._children.size()),c._children.add(U,l),c._childMap[U._id]=U,U.setParent(c),c.onChildAdded(U,l),c.fp(Fo,Y,U)))},onChildAdded:function(){},removeChild:function(H){var w=this;if(w._childMap&&w._childMap[H._id]){var O=w._children.remove(H);delete w._childMap[H._id],w.fp(Fo,H,Y),H.setParent(Y,O),w.onChildRemoved(H,O)}},onChildRemoved:function(){},getChildAt:function(X){return this._children.get(X)},clearChildren:function(){var L=this;if(!L._children.isEmpty())for(var w=0,_=L._children.toArray(),z=_.length;z>w;w++)L.removeChild(_[w])},getParent:function(){return this._parent},setParent:function(h,S){var e=this;if(!(e._73I||e._parent===h||e===h||h&&h.isDescendantOf(e))){var m,W=e._parent;e._parent=h,e._73I=1,W?(S==Y&&(S=W.getChildren().indexOf(e)),W.removeChild(e)):e._dataModel&&S==Y&&(S=e._dataModel.getRoots().indexOf(e)),h&&(h.addChild(e),m=h.getChildren().indexOf(e)),delete e._73I,e.fp("parent",W,h,P,{oldIndex:S,newIndex:m}),e.onParentChanged(W,h)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(F){return F?this.isDescendantOf(F)||F.isDescendantOf(this):!1},isParentOf:function(l){return l&&this._childMap?!!this._childMap[l._id]:!1},isDescendantOf:function(y){if(!y||y.isEmpty())return!1;for(var t=this._parent;t;){if(y===t)return!0;t=t._parent}return!1},getStyle:function(e,I){I===P&&(I=1);var q=this._styleMap?this._styleMap[e]:P;return q===P&&I?j[e]:q},setStyle:function(J,F){var e=this;e._styleMap||(e._styleMap={});var L=e._styleMap[J];F===P?delete e._styleMap[J]:e._styleMap[J]=F,e.fp("s:"+J,L,F)&&e.onStyleChanged(J,L,F)},onStyleChanged:function(){},iv:function(M){this.invalidate(M)},invalidate:function(T){this.fp(T||"*",!1,!0)},toString:function(){var u=this;return u._displayName||u._name||u._tag||u._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(I,G){var r=this,P=r.s(jn);P||r.s(jn,P={}),G?P[I]=G:delete P[I],r.fp(jn,Y,P)},removeStyleIcon:function(E){var n=this.s(jn);if(n){var I=n[E];delete n[E],this.fp(jn,Y,n)}return I},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var l,D={};for(l in this._styleMap)D[l]=1;return D}});var fs=C.DataModel=function(){var B=this;B._datas=new rp,B._dataMap={},B._roots=new rp,B._rootMap={},B._fsDataMap={},B._78O={},B._36I=new ag,B._35I=new ag,B._serializeNotifier=new ag,B._selectionModel=new Ji(B);var X=B._29Q=[],S=B._scheduleCallback=function(){for(var r=Date.now(),Z=0;Z<X.length;Z++){var u=X[Z];u.enabled&&r-u.lastTime>u.interval&&(u.beforeAction&&u.beforeAction(),B.each(function(i){u.action(i)}),u.afterAction&&u.afterAction(),u.lastTime=r)}X.length&&(B._30Q=f.requestAnimationFrame(S))}};Lg("DataModel",$,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:P,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:P,_init:P,_envmap:P,_postProcessingData:P,sm:function(){return this.getSelectionModel()},mm:function(T,m,q){this.addDataModelChangeListener(T,m,q)},umm:function(k,r){this.removeDataModelChangeListener(k,r)},md:function(G,A,T){this.addDataPropertyChangeListener(G,A,T)},umd:function(s,G){this.removeDataPropertyChangeListener(s,G)},mh:function(i,o,A){this.addHierarchyChangeListener(i,o,A)},umh:function(Q,Y){this.removeHierarchyChangeListener(Q,Y)},getAttrObject:function(){return this._attrObject},setAttrObject:function(J){return this._attrObject=J},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getDataById:function($){return this._dataMap[$]},removeDataById:function(m){this.remove(this.getDataById(m))},toDatas:function(h,Y){return this._datas.toList(h,Y)},each:function(b,h){this._datas.each(b,h)},getDataByTag:function(K){return this._78O[K]},getTagMap:function(){return this._78O},removeDataByTag:function(T){this.remove(this.getDataByTag(T))},add:function(w,T,i){var z=this,u=w._id,B=w._tag,a=z._roots;if(z._dataMap[u])throw"'"+u+"' already exists";B!=Y&&(z._78O[B]=w),z._dataMap[u]=w,i>=0?z._datas.add(w,i):z._datas.add(w),w._parent||(z._rootMap[u]=w,T>=0?a.add(w,T):a.add(w)),w.s("fullscreen")!==P&&(z._fsDataMap[u]=w),w._21I(z),z.onAdded(w),z._36I.fire({kind:"add",data:w,rootsIndex:T,datasIndex:i})},onAdded:function(){},remove:function(z,d){if(z){var $=this,i=z._id,A=d&&d.keepStructure,h=d&&d.keepChildren,V=z.getTag();if(z._dataModel===$){this.beginTransaction(),A?$._removingData||($._removingData=z):$.prepareRemove(z),h||z.toChildren().each(function(O){$.remove(O,d)},$),A?$._removingData===z&&(z._parent&&z._parent.removeChild(z),delete $._removingData):z._parent&&z._parent.removeChild(z);var C=$._datas.remove(z);delete $._dataMap[i],V!=Y&&delete $._78O[V];var g;$._rootMap[i]&&(delete $._rootMap[i],g=$._roots.remove(z)),$._fsDataMap[i]&&delete $._fsDataMap[i],z._21I(Y),$.onRemoved(z),$._36I.fire({kind:Kn,data:z,rootsIndex:g,datasIndex:C}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var Z=this;if(Z._datas.size()){var Q=Z._historyManager?this.toJSON():P;Z._datas.toArray().forEach(function(p){p._21I(Y)}),Z._datas.clear(),Z._dataMap={},Z._roots.clear(),Z._rootMap={},Z._fsDataMap={},Z._78O={},Z._36I.fire({kind:Qb,json:Q})}},contains:function(F){return F&&F._dataModel===this},handleDataPropertyChange:function($){var O=this,K=$.data,y=$.property;if("parent"===y){var m=K._id,L=O._rootMap,R=O._roots;K._parent?L[m]&&(delete L[m],R.remove(K)):L[m]||(L[m]=K,R.add(K))}else if("tag"===y){var G=$.oldValue,r=$.newValue,f=O._78O;G!=Y&&delete f[G],r!=Y&&(f[r]=K)}else if("s:fullscreen"===y){var m=K._id,q=O._fsDataMap;$.oldValue!=Y&&delete q[m],$.newValue!=Y&&(q[m]=K)}this.onDataPropertyChanged(K,$),this._35I.fire($)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(r,H,$){this._36I.add(r,H,$)},removeDataModelChangeListener:function(v,n){this._36I.remove(v,n)},addSerializeListener:function(T,Z,P){this._serializeNotifier.add(T,Z,P)},removeSerializeListener:function(p,H){this._serializeNotifier.remove(p,H)},fireSerializeEvent:function(F){this._serializeNotifier.fire(F)},addDataPropertyChangeListener:function(k,Z,N){this._35I.add(k,Z,N)},removeDataPropertyChangeListener:function(G,b){this._35I.remove(G,b)},_38I:function(b,E,Q){this._37I&&this._37I.fire({data:b,oldIndex:E,newIndex:Q})},addHierarchyChangeListener:function(O,R,k){this._37I||(this._37I=new ag),this._37I.add(O,R,k)},removeHierarchyChangeListener:function(J,f){this._37I.remove(J,f)},getSiblings:function(F){var M=F._parent;return M?M._children:this._roots},eachByHierarchical:function(o,b,z){if(b)return this._eachByHierarchical(o,b,z);for(var v=0,h=this._roots,c=h.size();c>v;v++)if(this._eachByHierarchical(o,h.get(v),z)===!1)return!1;return!0},_eachByHierarchical:function(s,Q,x){if(x){if(s.call(x,Q)===!1)return!1}else if(s(Q)===!1)return!1;for(var J=Q.size(),D=0;J>D;D++)if(this._eachByHierarchical(s,Q.getChildAt(D),x)===!1)return!1;return!0},reverseEachByHierarchical:function(U,H,k){if(H)return this._reverseEachByHierarchical(U,H,k);for(var C=this._roots,a=C.size(),l=a-1;l>=0;l--)if(this._reverseEachByHierarchical(U,C.get(l),k)===!1)return!1;return!0},_reverseEachByHierarchical:function(m,d,O){for(var $=d.size(),I=$-1;I>=0;I--)if(this._reverseEachByHierarchical(m,d.getChildAt(I),O)===!1)return!1;if(O){if(m.call(O,d)===!1)return!1}else if(m(d)===!1)return!1;return!0},eachByDepthFirst:function(V,L,p){if(L)return this._11I(V,L,p);for(var u=0,d=this._roots,E=d.size();E>u;u++)if(this._11I(V,d.get(u),p)===!1)return!1;return!0},_11I:function(D,g,x){for(var V=g.size(),J=0;V>J;J++)if(this._11I(D,g.getChildAt(J),x)===!1)return!1;if(x){if(D.call(x,g)===!1)return!1}else if(D(g)===!1)return!1;return!0},eachByBreadthFirst:function(r,Z,k){var $=new rp;for(Z?$.add(Z):this._roots.each($.add,$);$.size()>0;)if(Z=$.removeAt(0),Z.eachChild($.add,$),k){if(r.call(k,Z)===!1)return!1}else if(r(Z)===!1)return!1;return!0},moveTo:function(t,Q){var a=this.getSiblings(t),k=a.indexOf(t);k===Q||0>k||Q>=0&&Q<=a.size()&&(a.remove(t),Q>a.size()&&Q--,a.add(t,Q),this._38I(t,k,Q))},moveUp:function(P){this.moveTo(P,this.getSiblings(P).indexOf(P)-1)},moveDown:function(p){this.moveTo(p,this.getSiblings(p).indexOf(p)+1)},moveToTop:function(H){this.moveTo(H,0)},moveToBottom:function(q){this.moveTo(q,this.getSiblings(q).size())},moveSelectionUp:function(A){this.beginTransaction(),A||(A=this.sm());var l=new rp;vc(A,l,this._roots),l.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(H){this.beginTransaction(),H||(H=this.sm());var Q=new rp;lq(H,Q,this._roots),Q.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(r){this.beginTransaction(),r||(r=this.sm());var J=new rp;Mh(r,J,this._roots),J.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(V){this.beginTransaction(),V||(V=this.sm());var h=new rp;zl(V,h,this._roots),h.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(e,n,y){var g=this.getDatas();null==y&&(y=g.indexOf(e)),y===n||0>y||n>=0&&n<=g.size()&&(g.remove(e),n>g.size()&&n--,g.add(e,n),this._76I(e,y,n))},bringForward:function(G){this.moveToIndex(G,this.getDatas().indexOf(G)+1)},bringToFront:function(c){this.moveToIndex(c,this.size())},sendBackward:function(y){this.moveToIndex(y,this.getDatas().indexOf(y)-1)},sendToBack:function(i){this.moveToIndex(i,0)},bringSelectionForward:function(y){this.beginTransaction(),y||(y=this.sm());for(var Z=new rp,e=this.getDatas(),t=!1,O=0;O<e.size();O++){var u=e.get(e.size()-1-O);y.contains(u)?t&&Z.add(u):t=!0}Z.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(d){this.beginTransaction(),d||(d=this.sm());for(var f=new rp,T=this.getDatas(),Z=0;Z<T.size();Z++){var S=T.get(Z);d.contains(S)&&f.add(S)}f.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(e){this.beginTransaction(),e||(e=this.sm());for(var r=new rp,V=this.getDatas(),H=!1,n=0;n<V.size();n++){var F=V.get(n);e.contains(F)?H&&r.add(F):H=!0}r.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(a){this.beginTransaction(),a||(a=this.sm());for(var U=new rp,L=this.getDatas(),J=0;J<L.size();J++){var m=L.get(L.size()-1-J);a.contains(m)&&U.add(m)}U.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(e){var c=this;c.removeScheduleTask(e),e.enabled==Y&&(e.enabled=!0),e.interval==Y&&(e.interval=10),e.action==Y&&(e.action=ci),e.lastTime=Date.now(),c._29Q.push(e),c._30Q==Y&&(c._30Q=f.requestAnimationFrame(c._scheduleCallback))},removeScheduleTask:function(Q){var k=this,n=k._29Q,y=n.indexOf(Q);y>=0&&n.splice(y,1),n.length||k._30Q==Y||(f.cancelAnimationFrame(k._30Q),delete k._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(e){this._historyManager||new C.HistoryManager(this),null!=e&&this._historyManager.setMaxHistoryCount(e),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(g){this._historyManager&&this._historyManager.undo(g)},redo:function(T){this._historyManager&&this._historyManager.redo(T)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(o){this._historyManager&&this._historyManager.addHistory(o)},onHistoryManagerChanged:function(){}});var Ji=C.SelectionModel=function(Q){var K=this;K._68O=Rp,K._map={},K._73O=new rp,K._74I=new ag,K._21I(Q)};Lg("SelectionModel",$,{ms_fire:1,ms_dm:1,ms:function(A,B,k){this.addSelectionChangeListener(A,B,k)},ums:function(q,m){this.removeSelectionChangeListener(q,m)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===pn},co:function(c){return this._map[c._id]!=Y},ss:function(O){this.setSelection(O)},as:function(W){this.appendSelection(W)},rs:function(G){this.removeSelection(G)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(S){var f=this;if(f._68O!==S&&(S===Cp||S===pn||S===Rp)){f.cs();var X=f._68O;f._68O=S,f.fp("selectionMode",X,S)}},_21I:function(m){var T=this,b=T._dataModel;b!==m&&(b&&(T.cs(),b.umm(T.handleDataModelChange,T)),T._dataModel=m,m.mm(T.handleDataModelChange,T,!0),T.fp(br,b,m))},dispose:function(){var T=this;T.cs(),T._dataModel.umm(T.handleDataModelChange,T)},handleDataModelChange:function(Z){var F=this;if(Z.kind===Kn){var J=Z.data;F.co(J)&&(F._73O.remove(J),delete F._map[J._id],F._75I(Kn,new rp(J)))}else Z.kind===Qb&&F.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(i){var f=this;if(f._filterFunc!==i){f.cs();var o=f._filterFunc;f._filterFunc=i,f.fp("filterFunc",o,f._filterFunc)}},_75I:function(j,A,u,e){u&&(this._73O.each(function(x){e[x._id]?u.remove(x):u.add(x)}),A=u.toList()),this._74I.fire({kind:j,datas:new rp(A)})},addSelectionChangeListener:function(o,p,d){this._74I.add(o,p,d)},removeSelectionChangeListener:function(p,x){this._74I.remove(p,x)},_97O:function(w,B){for(var e,G=this,q=0,c=new rp(w);q<c.size();q++)e=c.get(q),(G._filterFunc&&!G._filterFunc(e)||B&&G.co(e)||!B&&!G.co(e)||!G._dataModel.contains(e))&&(c.removeAt(q),q--);return c},appendSelection:function(U){var Q=this;if(Q._68O!==Cp){var r,T,z=Q._73O,e=Q._97O(U,!0);e.isEmpty()||(Q.sg()&&(r=new rp(z),T=Q._map,z.clear(),Q._map={},e=new rp(e.get(e.size()-1))),e.each(function(q){z.add(q),Q._map[q._id]=q}),Q._75I("append",e,r,T))}},removeSelection:function(n){var W=this,I=W._97O(n),g=0,E=I.size();if(0!==E){for(;E>g;g++){var j=I.get(g);W._73O.remove(j),delete W._map[j._id]}W._75I(Kn,I)}},toSelection:function(L,x){return this._73O.toList(L,x)},getSelection:function(){return this._73O},each:function(B,b){this._73O.each(B,b)},setSelection:function(p){var q=this,y=q._73O;if(q._68O!==Cp&&!(y.isEmpty()&&!p||1===y.size()&&q.ld()===p)){var I=new rp(y),w=q._map;y.clear(),q._map={};var m=q._97O(p,!0);q.sg()&&m.size()>1&&(m=new rp(m.get(m.size()-1))),m.each(function(B){y.add(B),q._map[B._id]=B}),q._75I("set",Y,I,w)}},clearSelection:function(){var l=this,I=l._73O;if(I.size()>0){var b=I.toList();I.clear(),l._map={},l._75I(Qb,b)}},selectAll:function(){var C=this;if(C._68O!==Cp){var n,Z,P=C._dataModel.toDatas();if(C._filterFunc)for(n=0;n<P.size();n++)Z=P.get(n),C._filterFunc(Z)||(P.removeAt(n),n--);var t=C._73O,O=new rp(t),k=C._map;t.clear(),C._map={},C.sg()&&P.size()>1&&(P=new rp(P.get(P.size()-1)));var m=P.size();for(n=0;m>n;n++)Z=P.get(n),t.add(Z),C._map[Z._id]=Z;C._75I("all",Y,O,k)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(Q){return this._map[Q._id]!=Y},getLastData:function(){var F=this._73O;return F.size()>0?F.get(F.size()-1):Y},getFirstData:function(){var S=this._73O;return S.size()>0?S.get(0):Y},isSelectable:function(s){var u=this;return s&&u._68O!==Cp?u._filterFunc?u._filterFunc(s):!0:!1},getTopSelection:function(){var h=this,o=new rp;return h._73O.each(function(I){for(var W=I.getParent();W;){if(h.contains(W)){I=Y;break}W=W.parent}I&&o.add(I)}),o}});var vg=function(){return _q(0),function(f,H){var z;if(ao(H)){var a=f.getDataUI(H);a&&a._88I&&(z=a._88I.rect)}return z?z:H.getRect()}}();yl(k,{edgeGroupAgentFunc:Y,graphViewAutoScrollZone:16,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:y.rectSelectBorder,graphViewRectSelectBackground:jj,graphViewEditPointSize:hc?17:7,graphViewEditPointBorderColor:y.editPointBorder,graphViewEditPointBackground:y.editPointBackground,setEdgeType:function(T,F,k){Wq[T]=F,Lf[T]=k},getEdgeType:function(f){return Wq[f]},getEdgeTypeMap:function(){return Wq},getNodeRect:vg},!0),yl(j,{layout:!1,"layout.h":P,"layout.h.value":P,"layout.v":P,"layout.v.value":P,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":P,interactive:!1,"image.stretch":"fill",icons:P,ingroup:!0,"body.color":P,"2d.gray":!1,fullscreen:P,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:P,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"clip.direction":"top","clip.percentage":1,"select.color":nq,"select.width":1,"select.padding":2,"select.type":xo,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,"border.color":P,"border.width":2,"border.padding":2,"border.type":xo,label:P,"label.font":P,"label.color":bl,"label.background":P,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":P,"label.max":P,"label.opacity":P,"label.scale":1,"label.align":P,"label.selectable":!0,label2:P,"label2.font":P,"label2.color":bl,"label2.background":P,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":P,"label2.max":P,"label2.opacity":P,"label2.scale":1,"label2.align":P,"label2.selectable":!0,note:P,"note.expanded":!0,"note.font":P,"note.color":Eo,"note.background":nq,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":P,"note.toggleable":!0,"note.border.width":1,"note.border.color":P,"note.opacity":P,"note.scale":1,"note.align":P,note2:P,"note2.expanded":!0,"note2.font":P,"note2.color":Eo,"note2.background":nq,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":P,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":P,"note2.opacity":P,"note2.scale":1,"note2.align":P,"group.type":P,"group.image":P,"group.image.stretch":"fill","group.repeat.image":P,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":P,"group.title.color":Eo,"group.title.background":y.groupTitleBackground,"group.title.align":wp,"group.title.orientation":Gc,"group.background":y.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":P,"group.border.color":zh,"group.border.radius":0,"group.border.cap":Ue,"group.border.join":Ok,"group.splitLine":!1,"group.gradient":Y,"group.gradient.color":"#FFF",shape:P,"shape.background":zh,"shape.repeat.image":P,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":zh,"shape.border.3d":!1,"shape.border.3d.color":P,"shape.border.3d.accuracy":P,"shape.border.cap":Ue,"shape.border.join":Ok,"shape.border.pattern":P,"shape.gradient":Y,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":Ld,"shape.dash.offset":0,"shape.dash.color":ho,"shape.dash.width":P,"shape.dash.3d":!1,"shape.dash.3d.color":P,"shape.dash.3d.accuracy":P,"shape.polygon.side":6,"shape.arc.from":O,"shape.arc.to":r,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":P,"shape.gradient.pack":P,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":P,"shape.foreground.gradient":Y,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":P,"autolayout.hgap":P,"autolayout.vgap":P,"edge.type":P,"edge.points":P,"edge.segments":P,"edge.color":zh,"edge.width":2,"edge.width.absolute":!1,"edge.offset":20,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":P,"edge.3d.accuracy":P,"edge.cap":Ue,"edge.join":Ok,"edge.source.position":17,"edge.source.anchor.x":P,"edge.source.anchor.y":P,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.target.position":17,"edge.target.anchor.x":P,"edge.target.anchor.y":P,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.pattern":P,"edge.dash":!1,"edge.dash.pattern":Ld,"edge.dash.offset":0,"edge.dash.color":ho,"edge.dash.width":P,"edge.dash.3d":!1,"edge.dash.3d.color":P,"edge.dash.3d.accuracy":P,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":P,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":P,"grid.column.percents":P,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":y.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":y.gridCellBorderColor,"grid.block":P,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":y.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":bl,"text.font":fi,"text.shadow":!1,"text.shadow.color":nq,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1},!0),yl(fs,{_76I:function(v,V,B){this._39I&&this._39I.fire({data:v,oldIndex:V,newIndex:B})
},addIndexChangeListener:function(c,X,R){var v=this;v._39I||(v._39I=new ag),v._39I.add(c,X,R)},removeIndexChangeListener:function(R,B){this._39I.remove(R,B)},prepareRemove:function(w){ad(w)&&(w.setSource(Y),w.setTarget(Y)),w._70O&&w._70O.toList().each(this.remove,this),w._69O&&w._69O.toList().each(function(Q){Q.setHost(Y)}),w._host&&w.setHost(Y)},onAdded:function(Y){this.isAutoAdjustIndex()&&this.adjustIndex(Y)},onDataPropertyChanged:function(d,t){Zl[t.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(d)},isAdjustable:function(q){return fr(q)||ad(q)},isAdjustedToBottom:function(q){return lk(q)?q.isExpanded()&&Ab(q):!1},adjustIndex:function(Z){var L=this;this.isHierarchicalRendering()||(L.isAdjustedToBottom(Z)?(L.sendToBottom(Z),Z.eachChild(L.adjustIndex,L)):L.sendToTop(Z))},sendToTop:function(U){var c=this;if(c.contains(U)&&c.isAdjustable(U)){var C=c._datas;if(U!==C.get(c.size()-1)){var x=C.indexOf(U);C.removeAt(x),C.add(U),c._76I(U,x,c.size()-1)}if(ad(U)){var H=U._40I;H&&!c.isAdjustedToBottom(H)&&c.sendToTop(H),H=U._41I,H&&!c.isAdjustedToBottom(H)&&c.sendToTop(H)}U._69O&&U._69O.each(function(s){s.isRelatedTo(U)||fr(U)&&s.isLoopedHostOn(U)||c.sendToTop(s)}),U.ISubGraph||(!lk(U)||U.isExpanded())&&U._adjustChildrenToTop&&U.eachChild(function(L){ad(L)||c.sendToTop(L)})}},sendToBottom:function(J,D){var u=this;if(J!==D&&u.contains(J)&&u.isAdjustable(J)&&(!D||u.contains(D))){var p=u._datas,T=p.remove(J),P=D?u._datas.indexOf(D):0;if(p.add(J,P),T!==P){u._76I(J,T,P);var o=J._parent;!o||o.ISubGraph||ad(o)||u.sendToBottom(J._parent,J)}}}}),yl(Wk,{ms_edit:function(x){x._46O=function(_){var W=this,E=W.gv.dm(),f=W._index,V=W._89I,O=W._node,U=W._shape,t=W._edge,N=W._77I;O&&V?(this.fi({kind:"endEditRect",event:_,data:O,direction:V}),E.endTransaction()):U&&f>=0?(W.fi({kind:"endEditPoint",event:_,data:U,index:f}),E.endTransaction()):t&&f>=0?(W.fi({kind:"endEditPoint",event:_,data:t,index:f}),E.endTransaction()):N&&(W.fi({kind:"endEditRotation",event:_,data:N}),E.endTransaction())},x._78I=function(T){var B=this;B.autoScroll(T);var t=B.gv.lp(T),M=B._index,h=B._89I,Q=B._node,z=B._shape,o=B._edge,X=B._77I;if(Q&&h)B._80O(t),B.fi({kind:"betweenEditRect",event:T,data:Q,direction:h});else if(z&&M>=0)t.e=z.getPoints().get(M).e,z.setPoint(M,t),B.fi({kind:"betweenEditPoint",event:T,data:z,index:M});else if(o&&M>=0){var A=o.s(Hj);t.e=A.get(M).e,A.set(M,t),o.fp(Hj,Y,A),B.fi({kind:"betweenEditPoint",event:T,data:o,index:M})}else if(X){var I=X.p(),x=X.getScale(),e=F+d(t.y-I.y,t.x-I.x);x.y<0&&(e+=O),L(e)<.04&&(e=0),X.setRotation(e),B.fi({kind:"betweenEditRotation",event:T,data:X})}},x._80O=function(o){var O=this,C=O._node,L=O._rect,u=L.x,z=L.y,g=L.width,y=L.height,T=O._89I,D=O._anchor,j=O._matrix,o=j.tfi(o);"northwest"===T?L=ig(o,{x:u+g,y:z+y}):T===Ch?L=ig({x:u,y:o.y},{x:u+g,y:z+y}):"northeast"===T?L=ig({x:u,y:o.y},{x:o.x,y:z+y}):T===zc?L=ig({x:o.x,y:z},{x:u+g,y:z+y}):T===Xc?L=ig({x:u,y:z},{x:o.x,y:z+y}):"southwest"===T?L=ig({x:o.x,y:z},{x:u+g,y:o.y}):"south"===T?L=ig({x:u,y:z},{x:u+g,y:o.y}):"southeast"===T&&(L=ig({x:u,y:z},o)),C.setPosition(j.tf(L.x+L.width*D.x,L.y+L.height*D.y)),C.setWidth(L.width),C.setHeight(L.height)},x._80I=function(S,B,T,p){var M=this,f=M.gv._zoom,U=(M.gv.getEditPointSize()+2)/f;return Gr({x:B-U/2,y:T-U/2,width:U,height:U},S)?(M._89I!==p&&(M._89I=p),!0):!1},x._79I=function(h,P,q){var g=this,V=g.gv,b=P?V.getDataUI(P):Y,x=b?b._55O:Y;if(x){var K,B,l,o,A=V._zoom,U=(V.getEditPointSize()+2)/A,u=V.lp(h);if(fr(P)){if(x._56O&&fr(P)&&(B=x._98o,Gr({x:B.x-U/2,y:B.y-U/2,width:U,height:U},u)))return g._77I=P,q&&g.fi({kind:"beginEditRotation",event:h,data:P}),g.setCursor("crosshair"),!0;if(x._43O&&P instanceof en)for(l=P.getPoints(),K=l.size()-1;K>=0;K--)if(B=l.get(K),Gr({x:B.x-U/2,y:B.y-U/2,width:U,height:U},u))return g._index=K,g._shape=P,q&&g.fi({kind:"beginEditPoint",event:h,data:P,index:K}),g.setCursor("crosshair"),!0;if(x._42O)for(var X=P.getEditControlPoints(),a=["northwest",-1,-1,zc,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Xc,1,0,"northeast",1,-1,Ch,0,-1],K=0,o=X.length;o>K;K++){var O=a[3*K],s=X[K];if(g._80I(u,s.x,s.y,O)){g._node=P;var S=P.getWidth(),L=P.getHeight(),C=P.getAnchor();g._rect={x:-S*C.x,y:-L*C.y,width:S,height:L},g._anchor=C,g._matrix=P.getMatrix();var y=P.getRotation(),v=T(y),I=c(y),Z=a[3*K+1]*Pb(P.getScale().x),G=a[3*K+2]*Pb(P.getScale().y),d=Math.atan2(-I*Z-v*G,v*Z-I*G),f=(Math.round(d/(Math.PI/4))+8)%8,p=[Jn,"nesw-resize",pj,"nwse-resize",Jn,"nesw-resize",pj,"nwse-resize"][f];return g.setCursor(p),q&&g.fi({kind:"beginEditRect",event:h,data:P,direction:g._89I}),!0}}}if(x._43O&&ad(P)&&P.s(_r)===Ap&&(l=P.s(Hj)))for(K=l.size()-1;K>=0;K--)if(B=l.get(K),Gr({x:B.x-U/2,y:B.y-U/2,width:U,height:U},u))return g._index=K,g._edge=P,q&&g.fi({kind:"beginEditPoint",event:h,data:P,index:K}),g.setCursor("crosshair"),!0}return!1}},ms_gv:function(j){j._currentSubGraph=Y,j.upSubGraph=function(){this.setCurrentSubGraph(jr(this._currentSubGraph))},j.isVisible=function(j){var r=this;if(jr(j)!==r._currentSubGraph)return!1;if(ad(j)){var f=j._40I,C=j._41I;if(!f||!C)return!1;if(!(j.s("edge.independent")||r.isVisible(f)&&r.isVisible(C)))return!1;if(j.isEdgeGroupHidden())return!1}else for(var F=j._parent;F&&!F.ISubGraph;){if(lk(F)&&(!F.isExpanded()||!r.isVisible(F)))return!1;F=F._parent}if(j._parent instanceof Ff&&!r.isVisible(j._parent))return!1;if(j._refGraph instanceof Vg&&!r.isVisible(j._refGraph))return!1;if(r instanceof fq){if(!j.s("3d.visible"))return!1}else{var u=r.getLayersInfo();if(u){var U=u[j._layer];if(U&&U.visible===!1)return!1}if(!j.s("2d.visible"))return!1}return r._visibleFunc?r._visibleFunc(j):!0},j.handleSelectionChange=function(p){var J=this;p.datas.each(function(d){J.invalidateData(d);var K=d._parent;lk(K)&&fr(d)&&d.s(Jg)&&(J.invalidateData(K),K._49I&&K._49I.each(function(y){J.invalidateData(y)}))}),J.onSelectionChanged(p)},j.onSelectionChanged=function(x){var R=this,l=R.sm();if(1===l.size()&&("set"===x.kind||"append"===x.kind)){var u=l.ld();R.isAutoMakeVisible()&&R.makeVisible(u),R.adjustIndex&&R._dataModel.isAutoAdjustIndex()&&R.adjustIndex(u)}},j.makeVisible=function(n){if(n){var p=this,a=p.getDataUI?p.getDataUI(n):p.getData3dUI(n);if(a){var g=n,O=jr(n);for(O!==p._currentSubGraph&&p.setCurrentSubGraph(O);(g=g._parent)&&g!==O;)lk(g)&&g.setExpanded(!0);p._23I=n,p.iv()}}},j.getLabel=function(M){var Y=M.getStyle(lb);return Y===P?M.getName():Y},j.getLabelBackground=function(I){return I.getStyle("label.background")},j.getLabelColor=function(P){return P.getStyle("label.color")},j.getLabel2=function(m){return m.getStyle("label2")},j.getLabel2Background=function(W){return W.getStyle("label2.background")},j.getLabel2Color=function(o){return o.getStyle("label2.color")},j.getNote=function(y){return y.getStyle(Di)},j.getNoteBackground=function(I){return I.getStyle("note.background")},j.getNote2=function(O){return O.getStyle(pi)},j.getNote2Background=function(L){return L.getStyle("note2.background")},j.handleClick=function(P,t,K){var T=this;t?(T.fi({kind:"clickData",event:P,data:t,part:K}),T.onDataClicked(t,P)):(T.fi({kind:"clickBackground",event:P}),T.onBackgroundClicked(P))},j.handleDoubleClick=function(x,W,G){var U=this;Qe(x)&&(W?(U.fi({kind:"doubleClickData",event:x,data:W,part:G}),U.onDataDoubleClicked(W,x,G),U.checkDoubleClickOnNote(x,W,G)||U.checkDoubleClickOnRotation&&U.checkDoubleClickOnRotation(x,W,G)||(ad(W)?U.onEdgeDoubleClicked(W,x,G):W.ISubGraph?U.onSubGraphDoubleClicked(W,x,G):lk(W)?U.onGroupDoubleClicked(W,x,G):W.IDoorWindow?U.onDoorWindowDoubleClicked(W,x,G):W.ICSGBox&&U.onCSGBoxDoubleClicked(W,x,G))):(U.fi({kind:"doubleClickBackground",event:x}),U.onBackgroundDoubleClicked(x)))},j.onSubGraphDoubleClicked=function(B){this.setCurrentSubGraph(B)},j.onEdgeDoubleClicked=function(g,M){g.ISubGraph&&!En(M)?this.setCurrentSubGraph(g):g.s("edge.toggleable")&&g.toggle()},j.onGroupDoubleClicked=function(y){y.s("group.toggleable")&&y.toggle()},j.onDoorWindowDoubleClicked=function(r){r.s("dw.toggleable")&&r.toggle(!0)},j.onCSGBoxDoubleClicked=function(w,b){var d=this;if(d instanceof fq){var Q=d.getHitFaceInfo(b);Q&&Q.face&&w.s(Q.face+".toggleable")&&w.toggleFace(Q.face,!0)}},j.onBackgroundClicked=function(){},j.onBackgroundDoubleClicked=function(){this.upSubGraph()},j.onDataClicked=function(){},j.onDataDoubleClicked=function(){},j.onAutoLayoutEnded=function(){},j.onMoveEnded=function(){},j.onPanEnded=function(){},j.onPinchEnded=function(){},j.onRectSelectEnded=function(){},j.onZoomEnded=function(){},j.serialize=function(N){return this.dm().serialize(N)},j.toJSON=function(){return this.dm().toJSON()},j.deserialize=function(X,W){return W=W instanceof uo?{rootParent:W}:sr(W)?{setId:W}:Lj(W)?{finishFunc:W}:W||{},W.view=this,this.dm().deserialize(X,W.rootParent,W)}},ms_icons:function(j){j.getRotation=function(X){return X==Y?0:X},j._15O=function(){var P=this,Q=P.s(jn);if(Q){var N=P,x=P.data||P._data,f=P._38o={icons:Q,rects:{}};for(var T in Q){var b=Q[T],o=hg(b.shape3d,x,N);if(!(hg(b.visible,x,N)===!1||hg(b.for3d,x,N)&&!P.I3d||o&&!P.I3d)){var B=o?[o]:hg(b.names,x,N),J=B?B.length:0,t=hg(b.position,x,N)||3,X=hg(b.offsetX,x,N)||0,E=hg(b.offsetY,x,N)||0,r=hg(b.direction,x,N)||Xc,C=hg(b.gap,x,N),h=C!=Y?C:1,u=hg(b.rotation,x,N),i=hg(b.keepOrien,x,N),d=hg(b.rotationFixed,x,N)?u:P.getRotation(u,i,t),L=Y,z=f.rects[T]=new Array(J);z.rotation=d;for(var g=0;J>g;g++){var c,m,G,j,F=B[g];if(o)G=0,j=0;else{var l=km(F);G=hg(b.width,x,N),j=hg(b.height,x,N),G==Y&&(G=re(l,x)),j==Y&&(j=dp(l,x))}if(L?r===Xc?X+=G/2:r===zc?X-=G/2:r===Ch?E-=j/2:E+=j/2:L={width:G,height:j},P.I3d){var K=-G/2,v=-j/2;m={width:G,height:j,mat:P._16O(hg(b.autorotate,x,N),t,L,hg(b.face,x,N)||Wh,hg(b.t3,x,N),hg(b.r3,x,N),hg(b.rotationMode,x,N),X,E),vs:new Ve([K,-v,0,K,-v-j,0,K+G,-v-j,0,K+G,-v,0])}}else c=P.getPosition(t,X,E,L,hg(b.positionFixed,x,N)),m={x:c.x-G/2,y:c.y-j/2,width:G,height:j},P._68o(m,d);z[g]=m,r===Xc?X+=G/2+h:r===zc?X-=G/2+h:r===Ch?E-=j/2+h:E+=j/2+h}}}}}}});var Qj={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},Vj={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},uf={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},Zl={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},jg={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},Aq={"edge.type":1,"edge.group":1},il={rotation:1,rotationX:1,rotationZ:1},Qp={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},Kr={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},Sg={shape:1,thickness:1,position:1,anchor:1,scale:1},Po=function(B,E){if(!B||!lk(E)||E.isEmpty())return!1;for(B=B._parent;lk(B);){if(B===E)return!0;B=B._parent}return!1},mj=function(t,U){if(!t||!Yj(U)||U.isEmpty())return!1;for(t=t._parent;Yj(t);){if(t===U)return!0;t=t._parent}return!1},jr=function(D){if(!D)return Y;if(ad(D)){var Z=D._40I,S=D._41I;if(!Z||!S)return Y;var m=jr(Z),x=jr(S);return m===x?m:Y}for(var C=D._parent;ad(C)&&!C.ISubGraph;)C=C._parent;return C?C.ISubGraph?C:jr(C):Y},fm=function(M,U,e,i){var Q=U.getStyle(e)*i;Q&&El(M,Q),Q=U.getStyle(e+".left")*i,Q&&(M.x-=Q,M.width+=Q),Q=U.getStyle(e+".right")*i,Q&&(M.width+=Q),Q=U.getStyle(e+".top")*i,Q&&(M.y-=Q,M.height+=Q),Q=U.getStyle(e+".bottom")*i,Q&&(M.height+=Q),M.width<0&&(M.width=-M.width,M.x-=M.width),M.height<0&&(M.height=-M.height,M.y-=M.height)},Ab=function(G){for(var O,U=0,m=G.size();m>U;U++)if(O=G.getChildAt(U),fr(O)&&Ab(O))return!0;return G.hasAgentEdges()},jf=function(B){if(!B)return Y;for(var O=B._parent;lk(O);){if(!lk(O._parent))return O.isExpanded()?B:O;O.isExpanded()||(B=O),O=O._parent}return B},Cm=function(i,U){if(!i||!U)return Y;var J,p,f,s=jr(i),V=jr(U);if(s!==V){for(;V&&s!==V;)V=jr(V);if(s===V)return i;J=new rp,J.add(i,0);for(var r=i._parent;fr(r)&&!U.isDescendantOf(r);)J.add(r,0),r=r._parent;for(f=J.size(),p=0;f>p;p++){var Q=J.get(p);if(lk(Q)&&!Q.isExpanded())return Q;if(Q.ISubGraph)return Q}return i}return i},Uh=function(I){if(I.isLooped())return I._source;var p=jf(I._source),X=jf(I._target);return p===X?I._source:Cm(p,X)},jl=function(X){if(X.isLooped())return X._target;var t=jf(X._source),_=jf(X._target);return t===_?X._target:Cm(_,t)},tq=function(k,G,X,U,o,e,C){if(!G)return Y;var B,A=G.getRotation?G.getRotation():0;if(e!==P||C!==P)if(e=e===P?.5:e,C=C===P?.5:C,A&&!ao(G,k)){var H=G.getPosition(),z=G.getWidth(),t=G.getHeight(),V=G.getAnchor(),q=G.getScale(),p=new cq(A,H.x,H.y,q.x,q.y);X=p.tf((e-V.x)*z,(C-V.y)*t)}else B=vg(k,G),X={x:B.x+e*B.width,y:B.y+C*B.height};else X=ai(X,vg(k,G));if(A){var u=T(A),m=c(A),r=U*u-o*m;o=U*m+o*u,U=r}return X.x+=U,X.y+=o,X},bg=function(p,n){if(!p||!n)return Y;var s,O,f,u,P,l;if(p===n){if(u=p.getLoopedEdges(),!u)return Y;u=new rp(u)}else{if(P=p.getAgentEdges(),l=n.getAgentEdges(),!P||!l)return Y;for(O=P.size(),s=0;O>s;s++)f=P.get(s),l.contains(f)&&(u||(u=new rp),u.add(f))}if(u)for(s=0;s<u.size();s++)f=u.get(s),f.getStyle(_r)===Ap&&(f._22I(Y),u.removeAt(s),s--);return u},Kl=function(K,M){var s=bg(K,M);if(s&&!s.isEmpty()){if(1===s.size())return s.get(0)._22I(Y),void 0;var R=new rp,E=new rp;s.each(function(g){var x=g.s("edge.group");R.contains(x)||R.add(x)}),R.sort(),R.each(function(M){E.add(new C.EdgeGroup(s.toList(function(C){return M===C.s("edge.group")}),E))}),E.each(function(f){f.each(function(R){R._22I(f)})})}},qd=function(t,L){if(L){var b=L.rect,p=L.color,T=L.rotation,Q=L.labelWidth,S=L.background,R=L.opacity,m=L.scale,o=m!=Y&&1!==m;if(R!=Y){var e=t.globalAlpha;t.globalAlpha*=R}if(T||o){t.save();var z=b.x+b.width/2,X=b.y+b.height/2;Jd(t,z,X),T&&hh(t,T),o&&t.scale(m,m),Jd(t,-z,-X)}if(S&&_e(t,b.x,b.y,b.width,b.height,S),Q){var M=b.width,q=t.createLinearGradient(b.x,b.y,b.x+M,b.y);q.addColorStop(0,p),q.addColorStop(.9,p),q.addColorStop(1,oi),p=q,b.width=Q}Rc(t,L.ss,b,L.font,p,L.align),Q&&(b.width=M),(T||o)&&t.restore(),R!=Y&&(t.globalAlpha=e)}},pk=function(v,X){if(X){var I=X.rect,A=I.x,L=I.y,g=I.width,t=I.height,e=X.background,a=X.backgroundImage,V=X.borderWidth,k=X.borderColor,W=X.labelWidth,w=X.opacity,o=X.scale,h=o!=Y&&1!==o;if(w!=Y){var R=v.globalAlpha;v.globalAlpha*=w}if(h){v.save();var s=I.x+I.width/2,T=I.y+I.height/2;Jd(v,s,T),v.scale(o,o),Jd(v,-s,-T)}if(X.expanded){var f=D(8,g/4),z=L+t-8;if(v.fillStyle=e,v.beginPath(),v.moveTo(A,L),v.lineTo(A,z),v.lineTo(A+g/2,z),v.lineTo(A+g/2,L+t),v.lineTo(A+g/2+f,z),v.lineTo(A+g,z),v.lineTo(A+g,L),v.closePath(),v.fill(),V&&(v.lineWidth=V,v.lineJoin="round",v.lineCap="round",k?(v.strokeStyle=k,v.stroke()):(v.strokeStyle=ac(e),v.beginPath(),v.moveTo(A+g,L),v.lineTo(A+g,z),v.lineTo(A+g/2+f,z),v.lineTo(A+g/2,L+t),v.stroke(),v.strokeStyle=kp(e),v.beginPath(),v.moveTo(A+g,L),v.lineTo(A,L),v.lineTo(A,z),v.lineTo(A+g/2,z),v.lineTo(A+g/2,L+t),v.stroke())),a)Cq(v,km(a),Ih,I.x,I.y,I.width,I.height-8,X.data,X.view);else{if(I.height-=8,e=X.color,W){var K=g,m=v.createLinearGradient(A,L,A+K,L);m.addColorStop(0,e),m.addColorStop(.9,e),m.addColorStop(1,oi),e=m,I.width=W}Rc(v,X.ss,I,X.font,e,X.align),W&&(I.width=K),I.height+=8}}else if(X.icon)mf(v,km(X.icon),A,L,g,t,X.data,X.view);else{var p=g/2;V&&(v.lineWidth=V,v.lineJoin="round",v.lineCap="round",v.strokeStyle=k?k:ac(e),v.beginPath(),v.arc(A+p,L+p,p,F,1.6*O,!0),v.moveTo(A+p,L+t),v.lineTo(A+g-p/5,L+p),v.stroke(),v.strokeStyle=k?k:kp(e),v.beginPath(),v.arc(A+p,L+p,p,1.6*O,F,!0),v.moveTo(A+p,L+t),v.lineTo(A+p/5,L+p),v.stroke()),v.fillStyle=e,v.beginPath(),v.arc(A+p,L+p,p,0,r,!0),v.moveTo(A+p,L+t),v.lineTo(A+g-p/5,L+p),v.lineTo(A+p/5,L+p),v.closePath(),v.fill(),v.fillStyle=X.color,v.beginPath(),v.arc(A+p,L+p,p/3,0,r,!0),v.fill()}h&&v.restore(),w!=Y&&(v.globalAlpha=R)}},os=function(C,$){return $>2*C?C:$/2},Xr=function(o,b,e,s){if(!o||!b)return 0;var m=d(b.y-o.y,b.x-o.x);return e||(m=b.x<o.x?m+O:m),m+s},Pg=function(v,$,N,D,p,I,c){c&&(v.x>$.x||v.x===$.x&&v.y>$.y)&&(N=Ed[N],p=-p);var F=ai(N,{x:0,y:0,width:Qf(v,$),height:0},I);return F.x+=D,F.y+=p,F=new cq(d($.y-v.y,$.x-v.x)).tf(F),F.x+=v.x,F.y+=v.y,F},hj=function(n,o,P,w,e){if(n._19Q=!0,!P.getEdgeGroup())return w?P.s("edge.gap"):0;var N,F=0,M=0,Y=0;if(P.getEdgeGroup().getSiblings().each(function(I){I.each(function(n){if(o.isVisible(n)&&n.s(_r)==e){var t=n.s("edge.gap");N?(M+=Y/2+t/2,Y=t):(N=n,Y=t),n===P&&(F=M)}})}),w)return M-F+Y;var i=F-M/2;return N&&P._40I!==N._40I&&(n._19Q=!1),i},xj=function(){var n=function(f){var F=[];return f.forEach(function(f){F.push({x:f.x,y:f.y}),F.push({x:f.x+f.width,y:f.y+f.height}),F.push({x:f.x+f.width,y:f.y}),F.push({x:f.x,y:f.y+f.height})}),F};return function(j,X,V){if("oval"===j){var P=0,U=V.height/V.width,Y=U*U,J=V.x+V.width/2,Z=V.y+V.height/2,F=n(X);F.forEach(function(y){var r=y.x-J,c=y.y-Z,E=r*r+c*c/Y;E>P&&(P=E)}),P=i(P);var q=U*P;return{x:J-P,y:Z-q,width:2*P,height:2*q}}if("circle"===j){var f=0,J=V.x+V.width/2,Z=V.y+V.height/2,F=n(X);return F.forEach(function(X){var T=X.x-J,N=X.y-Z,I=T*T+N*N;I>f&&(f=I)}),f=i(f),{x:J-f,y:Z-f,width:2*f,height:2*f}}return"roundRect"===j?(El(V,D(V.width,V.height)/16),V):V}}(),Mk=C.graph={},Gd=function(T,v,k){jq(I+".graph."+T,v,k)};C.layout={};var rf={comps:[{type:ak,points:[85,50,70,115,100,71,86,107,88,49,47,80,112,114,43,65,74,75,101,117,82,71,72,113,56,120,78,75,65,121,85,76,101,82,71,102,55,101,120,79,121,79,73,61],borderWidth:1,borderColor:Y}]};if(rf[wl]=rf[Gb]=160,f.Image){var qh=new f.Image;qh.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",Hq("default_blank",qh)}Hq("node_image",Ai(30,30,[{type:xo,rect:[4,5,22,16],gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[2,3,26,20],borderWidth:1,borderColor:zh},{type:xo,rect:[11,23,8,4],background:zh},{type:xo,rect:[6,27,18,2],background:zh}])),Hq("node_icon",Ai(16,16,[{type:xo,rect:[2,2,12,10],gradient:xm,gradientColor:pg,background:zh},{type:Ag,rect:[2,2,12,10],width:1,color:zh},{type:xo,rect:[6,12,4,2],background:zh},{type:xo,rect:[4,14,8,1],background:zh}])),Hq("block_icon",Ai(16,16,[{type:Ag,rect:[1,1,14,14],width:1,color:zh}])),Hq("group_image",Ai(66,39,[{type:xo,rect:[44.3,18,18.1,12.8],gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[3.3,17.8,18.1,12.8],gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:zh,gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[26.2,29.4,12.8,4.2],background:zh},{type:xo,rect:[21.3,33.5,22.5,2.3],background:zh},{type:xo,rect:[5.3,32.7,14.1,2.1],background:zh},{type:xo,rect:[9,30.4,6.7,2.4],background:zh},{type:xo,rect:[50,30.7,6.7,2.4],background:zh},{type:xo,rect:[46.3,33,14.1,2.1],background:zh}])),Hq("group_icon",Ai(16,16,[{type:xo,rect:[4,12,4,2],background:zh},{type:xo,rect:[2,13,8,1],background:zh},{type:xo,rect:[12,12,2,1],background:zh},{type:xo,rect:[11,13,4,1],background:zh},{type:xo,rect:[10,7,6,5],gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[1,2,10,10],gradient:xm,gradientColor:pg,background:zh},{type:Ag,rect:[1,2,10,10],width:1,color:zh}])),Hq("refGraph_icon",Ai(16,16,[{type:"shape",borderWidth:1,borderColor:zh,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:zh,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),Hq("edge_icon",Ai(16,16,[{type:xo,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[10.8,1,4,4],background:zh},{type:xo,rect:[1,11,4,4],background:zh}])),Hq("subGraph_image",Ai(72,45,[{type:ak,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[29.6,30.7,3.6,1.8],background:zh},{type:xo,rect:[28.4,32.3,6,1.2],background:zh},{type:xo,rect:[37.3,32,10.8,1.8],background:zh},{type:xo,rect:[39.1,29.9,7.2,2.3],background:zh},{type:xo,rect:[26.6,23.7,9.6,7.2],gradient:xm,gradientColor:pg,background:zh},{type:xo,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:zh,gradient:xm,gradientColor:pg,background:zh}])),Hq("subGraph_icon",Ai(17,17,[{type:ak,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:xm,gradientColor:pg,background:zh}])),Hq("shape_icon",Ai(16,16,[{type:ak,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:zh}])),Hq("polyline_icon",Ai(16,16,[{type:ak,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:zh},Np(7.5,.4),Np(7.5,6.3),Np(13.6,6.3),Np(13.6,14),Np(.7,13.9),Np(.7,.3)])),Hq("grid_icon",Ai(16,16,[{type:xo,rect:[1,1,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[6,1,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[11,1,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[11,6,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[6,6,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[1,6,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[11,11,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[6,11,4,4],background:zh,gradient:xm,gradientColor:pg},{type:xo,rect:[1,11,4,4],background:zh,gradient:xm,gradientColor:pg}])),Hq("light_icon",Ai(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:zh},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:zh,gradient:xm,gradientColor:pg,background:{func:function(_){var t=_?_.s(Al):Y;return fk(t)?"rgb("+n(255*t[0])+","+n(255*t[1])+","+n(255*t[2])+")":t||zh}}}])),Hq("text_icon",Ai(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:zh}])),Hq("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),Hq("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),Hq("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),Hq("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var Ug=function(M,f){for(var x=M.vertices,T=0;T<x.length;T++){var K=x[T],X=K.y;K.y=K.z,K.z=-X,f&&(K.y+=f)}},ye=function(y){for(var E,p,A,I,Z,x,C=[],b=[],z=[],h=y.faces,m=0,t=0,$=0,D=h.length;D>m;m++,t+=6,$+=9){var S=h[m];1===S.i?(E||(E=[],p=[],A=[]),Yi(S,m,t,$,y,E,A,p)):2===S.i?(I||(I=[],Z=[],x=[]),Yi(S,m,t,$,y,I,x,Z)):Yi(S,m,t,$,y,C,z,b)}return{vs:C,uv:b,ns:z,top_vs:E,top_uv:p,top_ns:A,bottom_vs:I,bottom_uv:Z,bottom_ns:x}},Yi=function(u,b,g,w,r,t,f,Y){var B=r.vertices,Q=r.faceVertexUvs,R=B[u.a],C=B[u.b],I=B[u.c];t[w]=R.x,t[w+1]=R.y,t[w+2]=R.z,t[w+3]=C.x,t[w+4]=C.y,t[w+5]=C.z,t[w+6]=I.x,t[w+7]=I.y,t[w+8]=I.z;var p=u.vertexNormals;if(3===p.length){var J=p[0],S=p[1],G=p[2];f[w]=J.x,f[w+1]=J.y,f[w+2]=J.z,f[w+3]=S.x,f[w+4]=S.y,f[w+5]=S.z,f[w+6]=G.x,f[w+7]=G.y,f[w+8]=G.z}else{var E=u.normal;f[w]=E.x,f[w+1]=E.y,f[w+2]=E.z,f[w+3]=E.x,f[w+4]=E.y,f[w+5]=E.z,f[w+6]=E.x,f[w+7]=E.y,f[w+8]=E.z}var M=Q[0][b][0],s=Q[0][b][1],Z=Q[0][b][2];Y[g]=M.x,Y[g+1]=M.y,Y[g+2]=s.x,Y[g+3]=s.y,Y[g+4]=Z.x,Y[g+5]=Z.y},us=function(x){var O=x._lineModel;if(O)return O;var Y;Y=fk(x)?x:[x];var E,c,b,y,i,k,q,J,G,I,r,X,V=["","top","bottom"];for(O=[],E=0,c=Y.length;c>E;E++)for(G=Y[E],b=0,y=V.length;y>b;b++)if(q=G[V[b]+"vs"]){J=G[V[b]+"is"],k=J?J.length:q.length/3;for(var i=0;k>i;i+=3)J?(I=J[i],r=J[i+1],X=J[i+2]):(I=i,r=i+1,X=i+2),I*=3,r*=3,X*=3,O.push(q[I],q[I+1],q[I+2],q[r],q[r+1],q[r+2],q[r],q[r+1],q[r+2],q[X],q[X+1],q[X+2],q[X],q[X+1],q[X+2],q[I],q[I+1],q[I+2])}return x._lineModel=O,O},fh=function(K,P,$,i,B,X,I,a,W){$==Y&&($=!0),i==Y&&(i=!0),I==Y&&(I=1),a==Y&&(a=0);var s=new Jm;return Er(s,K,P,W),s=s.toShapes(),ye(new Iq(s,{top:$,bottom:i,curveSegments:B,amount:I,repeatUVLength:X},-I/2+a))},cg=function(e,a){this.x=e||0,this.y=a||0};cg.prototype={constructor:cg,add:function(U){return this.x+=U.x,this.y+=U.y,this},sub:function(k){return this.x-=k.x,this.y-=k.y,this},equals:function(E){return E.x===this.x&&E.y===this.y},multiplyScalar:function(V){return this.x*=V,this.y*=V,this},distanceTo:function(L){return i(this.distanceToSquared(L))},distanceToSquared:function(Z){var W=this.x-Z.x,G=this.y-Z.y;return W*W+G*G},clone:function(){return new cg(this.x,this.y)}};var xh=function(Y,j,t){this.x=Y||0,this.y=j||0,this.z=t||0};xh.prototype={constructor:xh,set:function(s,p,b){return this.x=s,this.y=p,this.z=b,this},setY:function(v){return this.y=v,this},copy:function(W){return this.x=W.x,this.y=W.y,this.z=W.z,this},add:function(J){return this.x+=J.x,this.y+=J.y,this.z+=J.z,this},addVectors:function(d,U){return this.x=d.x+U.x,this.y=d.y+U.y,this.z=d.z+U.z,this},sub:function(L){return this.x-=L.x,this.y-=L.y,this.z-=L.z,this},subVectors:function(P,$){return this.x=P.x-$.x,this.y=P.y-$.y,this.z=P.z-$.z,this},multiplyScalar:function(z){return this.x*=z,this.y*=z,this.z*=z,this},applyMatrix4:function(n){var f=this.x,b=this.y,O=this.z,R=n.elements;return this.x=R[0]*f+R[4]*b+R[8]*O+R[12],this.y=R[1]*f+R[5]*b+R[9]*O+R[13],this.z=R[2]*f+R[6]*b+R[10]*O+R[14],this},divideScalar:function(F){if(0!==F){var X=1/F;this.x*=X,this.y*=X,this.z*=X}else this.x=0,this.y=0,this.z=0;return this},dot:function(X){return this.x*X.x+this.y*X.y+this.z*X.z},length:function(){return i(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(I){var C=this.x,y=this.y,l=this.z;return this.x=y*I.z-l*I.y,this.y=l*I.x-C*I.z,this.z=C*I.y-y*I.x,this},crossVectors:function(R,Y){var K=R.x,a=R.y,d=R.z,Q=Y.x,B=Y.y,A=Y.z;return this.x=a*A-d*B,this.y=d*Q-K*A,this.z=K*B-a*Q,this},distanceTo:function(Z){return i(this.distanceToSquared(Z))},distanceToSquared:function(x){var f=this.x-x.x,L=this.y-x.y,d=this.z-x.z;return f*f+L*L+d*d},clone:function(){return new xh(this.x,this.y,this.z)}};var Ob=function(){this.elements=new Float32Array(16)};Ob.prototype={constructor:Ob,set:function(P,e,f,U,_,o,k,z,x,u,O,l,$,G,i,R){var X=this.elements;return X[0]=P,X[4]=e,X[8]=f,X[12]=U,X[1]=_,X[5]=o,X[9]=k,X[13]=z,X[2]=x,X[6]=u,X[10]=O,X[14]=l,X[3]=$,X[7]=G,X[11]=i,X[15]=R,this},makeRotationAxis:function(p,G){var R=T(G),f=c(G),F=1-R,O=p.x,w=p.y,d=p.z,A=F*O,U=F*w;return this.set(A*O+R,A*w-f*d,A*d+f*w,0,A*w+f*d,U*w+R,U*d-f*O,0,A*d-f*w,U*d+f*O,F*d*d+R,0,0,0,0,1),this}};var xg=function(c){this.repeatUVLength=c};xg.prototype={generateTopUV:function(X,q,s,c,T,Y,z){var n,$,x,B,i=X.vertices,N=i[c].x,u=i[c].y,W=i[T].x,y=i[T].y,Q=i[Y].x,I=i[Y].y,H=this.repeatUVLength;if(H)n=0,$=0,x=H,B=H;else{this._bb||(this._bb=q.getBoundingBox());var P=this._bb;n=P.minX,$=P.minY,x=P.maxX-n,B=P.maxY-$}return z?[new cg((N-n)/x,(u-$)/B),new cg((W-n)/x,(y-$)/B),new cg((Q-n)/x,(I-$)/B)]:[new cg((N-n)/x,1-(u-$)/B),new cg((W-n)/x,1-(y-$)/B),new cg((Q-n)/x,1-(I-$)/B)]},generateBottomUV:function(m,q,k,j,S,C){return this.generateTopUV(m,q,k,j,S,C,!0)},generateSideWallUV:function(x,d,H,b,V,l,m,y,T,E,v,A){if(!this._cl){for(var c,$,Z=[],e=0,z=H.length,M=0;z>M;M++){c=H[M],$=H[(M+1)%z];var t=c.x-$.x,p=c.y-$.y,L=i(t*t+p*p);Z.push(e),e+=L}for(var M=0;z>M;M++)Z[M]/=e;this._cl=Z}var Z=this._cl,U=1-T/E,K=1-(T+1)/E,O=Z[v],I=Z[A];return I>O&&(O+=1),[new cg(O,U),new cg(I,U),new cg(I,K),new cg(O,K)]}};var ph=function(T,E,Z,B,A,d){this.a=T,this.b=E,this.c=Z,this.i=d,this.normal=B instanceof xh?B:new xh,this.vertexNormals=B instanceof Array?B:[]};ph.prototype={constructor:ph};var Bq=[-8,13,-3,12,-3,5,1,6,-1],Mp=function(){if(Mp[Cj]!=Y)return Mp[Cj];for(var n=ne[Cj],d=Bq,B=uo.prototype.getClassName(),c='"',X=0,y="",q=!1,G=+new(f[B.substr(3,3)+Jn[X]]),l=X;l<d.length;l++){var t=d.length-l;y+=l%2===X?d[l]+t+"":d[l]-t+""}for(var l=X;4>l;l++)y+=X;if(y=y*y.length/y.length,G>y){if(n){for(var N,Z,S,A,w,o,R,H,C="",u=0,l=0;l<n.length;l++)n[l]===c?H?(H=!1,0!==u%2&&(N==Y?N=C:Z==Y?Z=C:S==Y?S=C:A==Y?A=C:w==Y?w=C:o==Y?o=C:R==Y&&(R=C)),u++,C=""):H=!0:H&&(C+=n[l]);var m=N+Z+S+A+w+o;(q=mo(m,R)&&(!o||o.indexOf(bo)>=0)&&(!w||w>G))&&S.indexOf(Me[0])>=0&&(Mp[Me[0]]=1),q&&S.indexOf(1)>=0&&(Mp[1]=1),q&&S.indexOf(2)>=0&&(Mp[2]=1)}}else q=!0,Mp[Me[0]]=Mp[1]=Mp[2]=1;return Mp[Cj]=q,q},Ar=function(){},zf=Ar.prototype;zf.getPointAt=function(x){var J=this.getUtoTmapping(x);return this.getPoint(J)},zf.getPoints=function(V){V||(V=5);var i,M=[];for(i=0;V>=i;i++)M.push(this.getPoint(i/V));return M},zf.getSpacedPoints=function(V){V||(V=5);var A,b=[];for(A=0;V>=A;A++)b.push(this.getPointAt(A/V));return b},zf.getLength=function(){var t=this.getLengths();return t[t.length-1]},zf.getLengths=function(j){if(j||(j=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==j+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var W,m,z=[],O=this.getPoint(0),B=0;for(z.push(0),m=1;j>=m;m++)W=this.getPoint(m/j),B+=W.distanceTo(O),z.push(B),O=W;return this.cacheArcLengths=z,z},zf.getUtoTmapping=function(o,T){var j,m=this.getLengths(),g=0,M=m.length;j=T?T:o*m[M-1];for(var h,r=0,Z=M-1;Z>=r;)if(g=s(r+(Z-r)/2),h=m[g]-j,0>h)r=g+1;else{if(!(h>0)){Z=g;break}Z=g-1}if(g=Z,m[g]==j){var d=g/(M-1);return d}var S=m[g],V=m[g+1],G=V-S,U=(j-S)/G,d=(g+U)/(M-1);return d},zf.getTangent=function(v){var x=1e-4,S=v-x,j=v+x;0>S&&(S=0),j>1&&(j=1);var k=this.getPoint(S),$=this.getPoint(j),M=$.clone().sub(k);return M.normalize()},zf.getTangentAt=function(d){var W=this.getUtoTmapping(d);return this.getTangent(W)},Ar.create=function(e,l){return e.prototype=xp(Ar.prototype),e.prototype.getPoint=l,e};var Ko=function(){this.curves=[],this.autoClose=!1},_d=Ko.prototype=xp(zf);_d.add=function(D){this.curves.push(D)},_d.closePath=function(){var j=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);j.equals(t)||this.curves.push(new Gk(t,j))},_d.getPoint=function(F){for(var c,v,Q=F*this.getLength(),f=this.getCurveLengths(),H=0;H<f.length;){if(f[H]>=Q){c=f[H]-Q,v=this.curves[H];var M=1-c/v.getLength();return v.getPointAt(M)}H++}return null},_d.getLength=function(){var m=this.getCurveLengths();return m[m.length-1]},_d.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var h,S=[],I=0,c=this.curves.length;for(h=0;c>h;h++)I+=this.curves[h].getLength(),S.push(I);return this.cacheLengths=S,S
},_d.getTransformedPoints=function(H){return this.getPoints(H)},_d.getBoundingBox=function(){var z,m,Z,K,G,v,r=this.getPoints();z=m=Number.NEGATIVE_INFINITY,K=G=Number.POSITIVE_INFINITY;var N,b,n,Y,k=r[0]instanceof xh;for(Y=k?new xh:new cg,b=0,n=r.length;n>b;b++)N=r[b],N.x>z&&(z=N.x),N.x<K&&(K=N.x),N.y>m&&(m=N.y),N.y<G&&(G=N.y),k&&(N.z>Z&&(Z=N.z),N.z<v&&(v=N.z)),Y.add(N);var h={minX:K,minY:G,maxX:z,maxY:m};return k&&(h.maxZ=Z,h.minZ=v),h};var pl=function(H){Ko.call(this),this.actions=[],H&&this.fromPoints(H)},qc=pl.prototype=xp(Ko.prototype),Gp="moveTo",bj="lineTo",nn="quadraticCurveTo",qo="bezierCurveTo",ql="arc",Op="ellipse";qc.fromPoints=function(D){this.moveTo(D[0].x,D[0].y);for(var E=1,O=D.length;O>E;E++)this.lineTo(D[E].x,D[E].y)},qc.moveTo=function(){var D=Array.prototype.slice.call(arguments);this.actions.push({action:Gp,args:D})},qc.lineTo=function(f,v){var t=Array.prototype.slice.call(arguments),m=this.actions[this.actions.length-1].args,a=m[m.length-2],i=m[m.length-1],d=new Gk(new cg(a,i),new cg(f,v));this.curves.push(d),this.actions.push({action:bj,args:t})},qc.quadraticCurveTo=function(h,L,e,r){var D=Array.prototype.slice.call(arguments),B=this.actions[this.actions.length-1].args,E=B[B.length-2],Q=B[B.length-1],g=new ok(new cg(E,Q),new cg(h,L),new cg(e,r));this.curves.push(g),this.actions.push({action:nn,args:D})},qc.bezierCurveTo=function(q,N,u,C,_,o){var z=Array.prototype.slice.call(arguments),M=this.actions[this.actions.length-1].args,e=M[M.length-2],b=M[M.length-1],p=new Gj(new cg(e,b),new cg(q,N),new cg(u,C),new cg(_,o));this.curves.push(p),this.actions.push({action:qo,args:z})},qc.arc=function(x,e,N,c,U,O){var V=this.actions[this.actions.length-1].args,k=V[V.length-2],s=V[V.length-1];this.absarc(x+k,e+s,N,c,U,O)},qc.absarc=function(K,f,p,H,P,x){this.absellipse(K,f,p,p,H,P,x)},qc.ellipse=function(k,H,j,B,l,J,X){var w=this.actions[this.actions.length-1].args,R=w[w.length-2],y=w[w.length-1];this.absellipse(k+R,H+y,j,B,l,J,X)},qc.absellipse=function(A,c,s,h,w,W,x){var a=Array.prototype.slice.call(arguments),P=new Ye(A,c,s,h,w,W,x);this.curves.push(P);var J=P.getPoint(1);a.push(J.x),a.push(J.y),this.actions.push({action:Op,args:a})},qc.getSpacedPoints=function(C){C||(C=40);for(var O=[],d=0;C>d;d++)O.push(this.getPoint(d/C));return O},qc.getPoints=function(o,H){o=o||12;var h,C,I,V,r,Y,O,R,f,y,j,X,t,A,K,k,Q,b,J=[];for(h=0,C=this.actions.length;C>h;h++)switch(I=this.actions[h],V=I.action,r=I.args,V){case Gp:J.push(new cg(r[0],r[1]));break;case bj:J.push(new cg(r[0],r[1]));break;case nn:for(Y=r[2],O=r[3],y=r[0],j=r[1],J.length>0?(A=J[J.length-1],X=A.x,t=A.y):(A=this.actions[h-1].args,X=A[A.length-2],t=A[A.length-1]),K=1;o>=K;K++)k=K/o,Q=Yf.b2(k,X,y,Y),b=Yf.b2(k,t,j,O),J.push(new cg(Q,b));break;case qo:for(Y=r[4],O=r[5],y=r[0],j=r[1],R=r[2],f=r[3],J.length>0?(A=J[J.length-1],X=A.x,t=A.y):(A=this.actions[h-1].args,X=A[A.length-2],t=A[A.length-1]),K=1;o>=K;K++)k=K/o,Q=Yf.b3(k,X,y,R,Y),b=Yf.b3(k,t,j,f,O),J.push(new cg(Q,b));break;case ql:var w,l=r[0],u=r[1],n=r[2],G=r[3],x=r[4],s=!!r[5],e=x-G,W=2*o;for(K=1;W>=K;K++)k=K/W,s||(k=1-k),w=G+k*e,Q=l+n*T(w),b=u+n*c(w),J.push(new cg(Q,b));break;case Op:var w,l=r[0],u=r[1],v=r[2],d=r[3],G=r[4],x=r[5],s=!!r[6],e=x-G,W=2*o;for(K=1;W>=K;K++)k=K/W,s||(k=1-k),w=G+k*e,Q=l+v*T(w),b=u+d*c(w),J.push(new cg(Q,b))}var $=J[J.length-1],N=1e-10;return L($.x-J[0].x)<N&&L($.y-J[0].y)<N&&J.splice(J.length-1,1),H&&J.push(J[0]),J},qc.toShapes=function(A,U){function G(M){var Q,s,a,L,F,r=[],i=new pl;for(Q=0,s=M.length;s>Q;Q++)a=M[Q],F=a.args,L=a.action,L==Gp&&0!=i.actions.length&&(r.push(i),i=new pl),i[L].apply(i,F);return 0!=i.actions.length&&r.push(i),r}function $(m){for(var Z=[],M=0,v=m.length;v>M;M++){var w=m[M],A=new Jm;A.actions=w.actions,A.curves=w.curves,Z.push(A)}return Z}function z(z,b){for(var k=1e-10,t=b.length,h=!1,a=t-1,C=0;t>C;a=C++){var g=b[a],f=b[C],m=f.x-g.x,u=f.y-g.y;if(L(u)>k){if(0>u&&(g=b[C],m=-m,f=b[a],u=-u),z.y<g.y||z.y>f.y)continue;if(z.y==g.y){if(z.x==g.x)return!0}else{var S=u*(z.x-g.x)-m*(z.y-g.y);if(0==S)return!0;if(0>S)continue;h=!h}}else{if(z.y!=g.y)continue;if(f.x<=z.x&&z.x<=g.x||g.x<=z.x&&z.x<=f.x)return!0}}return h}var p=G(this.actions);if(0==p.length)return[];if(U===!0)return $(p);var Z,e,N,w=[];if(1==p.length)return e=p[0],N=new Jm,N.actions=e.actions,N.curves=e.curves,w.push(N),w;var o=!Yf.isClockWise(p[0].getPoints());o=A?!o:o;var y,M=[],t=[],k=[],W=0;t[W]=P,k[W]=[];var F,r;for(F=0,r=p.length;r>F;F++)e=p[F],y=e.getPoints(),Z=Yf.isClockWise(y),Z=A?!Z:Z,Z?(!o&&t[W]&&W++,t[W]={s:new Jm,p:y},t[W].s.actions=e.actions,t[W].s.curves=e.curves,o&&W++,k[W]=[]):k[W].push({h:e,p:y[0]});if(!t[0])return $(p);if(t.length>1){for(var u=!1,b=[],R=0,x=t.length;x>R;R++)M[R]=[];for(var R=0,x=t.length;x>R;R++){t[R];for(var O=k[R],X=0;X<O.length;X++){for(var I=O[X],Y=!0,j=0;j<t.length;j++)z(I.p,t[j].p)&&(R!=j&&b.push({froms:R,tos:j,hole:X}),Y?(Y=!1,M[j].push(I)):u=!0);Y&&M[R].push(I)}}b.length>0&&(u||(k=M))}var E,l,i;for(F=0,r=t.length;r>F;F++)for(N=t[F].s,w.push(N),E=k[F],l=0,i=E.length;i>l;l++)N.holes.push(E[l].h);return w};var Jm=function(){pl.apply(this,arguments),this.holes=[]},dq=Jm.prototype=xp(qc);dq.getPointsHoles=function(h){var m,y=this.holes.length,l=[];for(m=0;y>m;m++)l[m]=this.holes[m].getTransformedPoints(h);return l},dq.extractAllPoints=function(K){return{shape:this.getTransformedPoints(K),holes:this.getPointsHoles(K)}},dq.extractPoints=function($){return this.extractAllPoints($)};var Yf={triangulateShape:function(T,t){function B(p,S,y){return p.x!=S.x?p.x<S.x?p.x<=y.x&&y.x<=S.x:S.x<=y.x&&y.x<=p.x:p.y<S.y?p.y<=y.y&&y.y<=S.y:S.y<=y.y&&y.y<=p.y}function i(p,C,n,q,t){var $=1e-10,N=C.x-p.x,e=C.y-p.y,Y=q.x-n.x,G=q.y-n.y,W=p.x-n.x,U=p.y-n.y,V=e*Y-N*G,s=e*W-N*U;if(L(V)>$){var E;if(V>0){if(0>s||s>V)return[];if(E=G*W-Y*U,0>E||E>V)return[]}else{if(s>0||V>s)return[];if(E=G*W-Y*U,E>0||V>E)return[]}if(0==E)return!t||0!=s&&s!=V?[p]:[];if(E==V)return!t||0!=s&&s!=V?[C]:[];if(0==s)return[n];if(s==V)return[q];var i=E/V;return[{x:p.x+i*N,y:p.y+i*e}]}if(0!=s||G*W!=Y*U)return[];var R=0==N&&0==e,Z=0==Y&&0==G;if(R&&Z)return p.x!=n.x||p.y!=n.y?[]:[p];if(R)return B(n,q,p)?[p]:[];if(Z)return B(p,C,n)?[n]:[];var H,Q,m,K,c,A,a,h;return 0!=N?(p.x<C.x?(H=p,m=p.x,Q=C,K=C.x):(H=C,m=C.x,Q=p,K=p.x),n.x<q.x?(c=n,a=n.x,A=q,h=q.x):(c=q,a=q.x,A=n,h=n.x)):(p.y<C.y?(H=p,m=p.y,Q=C,K=C.y):(H=C,m=C.y,Q=p,K=p.y),n.y<q.y?(c=n,a=n.y,A=q,h=q.y):(c=q,a=q.y,A=n,h=n.y)),a>=m?a>K?[]:K==a?t?[]:[c]:h>=K?[c,Q]:[c,A]:m>h?[]:m==h?t?[]:[H]:h>=K?[H,Q]:[H,A]}function I(n,W,i,Q){var q=1e-10,k=W.x-n.x,$=W.y-n.y,g=i.x-n.x,h=i.y-n.y,X=Q.x-n.x,s=Q.y-n.y,G=k*h-$*g,P=k*s-$*X;if(L(G)>q){var m=X*h-s*g;return G>0?P>=0&&m>=0:P>=0||m>=0}return P>0}function A(C,H){function V(Q,z){var c=E.length-1,q=Q-1;0>q&&(q=c);var X=Q+1;X>c&&(X=0);var N=I(E[Q],E[q],E[X],_[z]);if(!N)return!1;var f=_.length-1,O=z-1;0>O&&(O=f);var g=z+1;return g>f&&(g=0),N=I(_[z],_[O],_[g],E[Q]),N?!0:!1}function m(K,d){var N,o,k;for(N=0;N<E.length;N++)if(o=N+1,o%=E.length,k=i(K,d,E[N],E[o],!0),k.length>0)return!0;return!1}function u(Y,C){var K,d,J,F,t;for(K=0;K<R.length;K++)for(d=H[R[K]],J=0;J<d.length;J++)if(F=J+1,F%=d.length,t=i(Y,C,d[J],d[F],!0),t.length>0)return!0;return!1}for(var _,o,D,g,t,B,S,y,j,f,p,E=C.concat(),R=[],s=[],e=0,$=H.length;$>e;e++)R.push(e);for(var W=0,d=2*R.length;R.length>0&&(d--,!(0>d));)for(D=W;D<E.length;D++){g=E[D],o=-1;for(var e=0;e<R.length;e++)if(B=R[e],S=g.x+":"+g.y+":"+B,s[S]===P){_=H[B];for(var O=0;O<_.length;O++)if(t=_[O],V(D,O)&&!m(g,t)&&!u(g,t)){o=O,R.splice(e,1),y=E.slice(0,D+1),j=E.slice(D),f=_.slice(o),p=_.slice(0,o+1),E=y.concat(f).concat(p).concat(j),W=D;break}if(o>=0)break;s[S]=!0}if(o>=0)break}return E}for(var r,W,J,w,S,U,$={},j=T.concat(),z=0,E=t.length;E>z;z++)Array.prototype.push.apply(j,t[z]);for(r=0,W=j.length;W>r;r++)S=j[r].x+":"+j[r].y,$[S]!==P,$[S]=r;var q=A(T,t),K=Vo.Triangulate(q,!1);for(r=0,W=K.length;W>r;r++)for(w=K[r],J=0;3>J;J++)S=w[J].x+":"+w[J].y,U=$[S],U!==P&&(w[J]=U);return K.concat()},isClockWise:function(N){return Vo.Triangulate.area(N)<0},b2p0:function(S,x){var P=1-S;return P*P*x},b2p1:function(Y,J){return 2*(1-Y)*Y*J},b2p2:function(J,D){return J*J*D},b2:function(J,N,o,g){return this.b2p0(J,N)+this.b2p1(J,o)+this.b2p2(J,g)},b3p0:function(p,Y){var K=1-p;return K*K*K*Y},b3p1:function($,W){var e=1-$;return 3*e*e*$*W},b3p2:function(i,t){var d=1-i;return 3*d*i*i*t},b3p3:function(l,y){return l*l*l*y},b3:function(h,Z,U,a,e){return this.b3p0(h,Z)+this.b3p1(h,U)+this.b3p2(h,a)+this.b3p3(h,e)}},Vo={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var x=$.keys(this.faces);return x.length?x[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(u){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(Y){var P=Y.familyName.toLowerCase(),y=this;return y.faces[P]=y.faces[P]||{},y.faces[P][Y.cssFontWeight]=y.faces[P][Y.cssFontWeight]||{},y.faces[P][Y.cssFontWeight][Y.cssFontStyle]=Y,Y},drawText:function(S){var e,o=this.getFace(),W=this.size/o.resolution,g=0,p=String(S).split(""),t=p.length,$=[];for(e=0;t>e;e++){var N=new pl,k=this.extractGlyphPoints(p[e],o,W,g,N);k&&(g+=k.offset*this.spacing,$.push(k.path))}var U=g/2;return{paths:$,offset:U}},extractGlyphPoints:function(b,X,S,u,Y){var h,z,Q,r,F,p,Z,$,v,R,j,E,o,d,c,N,P,W,w,G=[],q=X.glyphs[b]||X.glyphs["?"];if(q){if(q.o)for(r=q._cachedOutline||(q._cachedOutline=q.o.split(" ")),p=r.length,Z=S,$=S,h=0;p>h;)switch(F=r[h++]){case"m":v=r[h++]*Z+u,R=r[h++]*$,Y.moveTo(v,R);break;case"l":v=r[h++]*Z+u,R=r[h++]*$,Y.lineTo(v,R);break;case"q":if(j=r[h++]*Z+u,E=r[h++]*$,c=r[h++]*Z+u,N=r[h++]*$,Y.quadraticCurveTo(c,N,j,E),w=G[G.length-1])for(o=w.x,d=w.y,z=1,Q=this.divisions;Q>=z;z++){var l=z/Q;Yf.b2(l,o,c,j),Yf.b2(l,d,N,E)}break;case"b":if(j=r[h++]*Z+u,E=r[h++]*$,c=r[h++]*Z+u,N=r[h++]*$,P=r[h++]*Z+u,W=r[h++]*$,Y.bezierCurveTo(c,N,P,W,j,E),w=G[G.length-1])for(o=w.x,d=w.y,z=1,Q=this.divisions;Q>=z;z++){var l=z/Q;Yf.b3(l,o,c,P,j),Yf.b3(l,d,N,W,E)}}return{offset:q.ha*S,path:Y}}}};Vo.generateShapes=function(V,$){$=$||{};var j=$.font;if(j===P&&(j=Vo.getDefaultFont(),!j))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var R=$.size!==P?$.size:1,f=$.curveSegments!==P?$.curveSegments:4,x=$.spacing!==P?$.spacing:1,E=$.weight!==P?$.weight:"normal",p=$.style!==P?$.style:"normal";Vo.size=R,Vo.divisions=f,Vo.face=j,Vo.weight=E,Vo.style=p,Vo.spacing=x;for(var W=Vo.drawText(V),D=W.paths,b=[],C=0,L=D.length;L>C;C++)Array.prototype.push.apply(b,D[C].toShapes());return b},function(C){var l=1e-10,p=function(R,n){var N=R.length;if(3>N)return null;var m,T,s,t=[],D=[],e=[];if(u(R)>0)for(T=0;N>T;T++)D[T]=T;else for(T=0;N>T;T++)D[T]=N-1-T;var A=N,$=2*A;for(T=A-1;A>2;){if($--<=0)return n?e:t;if(m=T,m>=A&&(m=0),T=m+1,T>=A&&(T=0),s=T+1,s>=A&&(s=0),W(R,m,T,s,A,D)){var O,P,X,g,o;for(O=D[m],P=D[T],X=D[s],t.push([R[O],R[P],R[X]]),e.push([D[m],D[T],D[s]]),g=T,o=T+1;A>o;g++,o++)D[g]=D[o];A--,$=2*A}}return n?e:t},u=function(c){for(var T=c.length,m=0,S=T-1,R=0;T>R;S=R++)m+=c[S].x*c[R].y-c[R].x*c[S].y;return.5*m},W=function(w,Z,q,s,$,k){var K,W,i,h,j,L,c,g,O;if(W=w[k[Z]].x,i=w[k[Z]].y,h=w[k[q]].x,j=w[k[q]].y,L=w[k[s]].x,c=w[k[s]].y,l>(h-W)*(c-i)-(j-i)*(L-W))return!1;var T,X,a,e,n,P,M,R,H,C,m,z,B,Q,F;for(T=L-h,X=c-j,a=W-L,e=i-c,n=h-W,P=j-i,K=0;$>K;K++)if(g=w[k[K]].x,O=w[k[K]].y,!(g===W&&O===i||g===h&&O===j||g===L&&O===c)&&(M=g-W,R=O-i,H=g-h,C=O-j,m=g-L,z=O-c,F=T*C-X*H,B=n*R-P*M,Q=a*z-e*m,F>=-l&&Q>=-l&&B>=-l))return!1;return!0};return C.Triangulate=p,C.Triangulate.area=u,C}(Vo),f._typeface_js={faces:Vo.faces,loadFace:Vo.loadFace};var ng=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Sl=ng.prototype={constructor:ng,computeFaceNormals:function(){for(var j=new xh,h=new xh,t=0,p=this.faces.length;p>t;t++){var I=this.faces[t],c=this.vertices[I.a],g=this.vertices[I.b],V=this.vertices[I.c];j.subVectors(V,g),h.subVectors(c,g),j.cross(h),j.normalize(),I.normal.copy(j)}},computeVertexNormals:function(G){var u,f,F,Q,S,E;for(E=new Array(this.vertices.length),u=0,f=this.vertices.length;f>u;u++)E[u]=new xh;if(G){var B,Z,j,v=new xh,e=new xh;for(F=0,Q=this.faces.length;Q>F;F++)S=this.faces[F],B=this.vertices[S.a],Z=this.vertices[S.b],j=this.vertices[S.c],v.subVectors(j,Z),e.subVectors(B,Z),v.cross(e),E[S.a].add(v),E[S.b].add(v),E[S.c].add(v)}else for(F=0,Q=this.faces.length;Q>F;F++)S=this.faces[F],E[S.a].add(S.normal),E[S.b].add(S.normal),E[S.c].add(S.normal);for(u=0,f=this.vertices.length;f>u;u++)E[u].normalize();for(F=0,Q=this.faces.length;Q>F;F++)S=this.faces[F],S.vertexNormals[0]=E[S.a].clone(),S.vertexNormals[1]=E[S.b].clone(),S.vertexNormals[2]=E[S.c].clone()},mergeVertices:function(){var Z,U,e,s,H,A,$,B,g={},p=[],F=[],c=4,D=t(10,c);for(e=0,s=this.vertices.length;s>e;e++)Z=this.vertices[e],U=R(Z.x*D)+"_"+R(Z.y*D)+"_"+R(Z.z*D),g[U]===P?(g[U]=e,p.push(this.vertices[e]),F[e]=p.length-1):F[e]=F[g[U]];var G=[];for(e=0,s=this.faces.length;s>e;e++){H=this.faces[e],H.a=F[H.a],H.b=F[H.b],H.c=F[H.c],A=[H.a,H.b,H.c];for(var w=0;3>w;w++)if(A[w]==A[(w+1)%3]){G.push(e);break}}for(e=G.length-1;e>=0;e--){var k=G[e];for(this.faces.splice(k,1),$=0,B=this.faceVertexUvs.length;B>$;$++)this.faceVertexUvs[$].splice(k,1)}var J=this.vertices.length-p.length;return this.vertices=p,J}},Ye=function($,O,u,o,p,f,c){this.aX=$,this.aY=O,this.xRadius=u,this.yRadius=o,this.aStartAngle=p,this.aEndAngle=f,this.aClockwise=c};Ye.prototype=xp(zf),Ye.prototype.getPoint=function(u){var D,P=this.aEndAngle-this.aStartAngle;0>P&&(P+=r),P>r&&(P-=r),D=this.aClockwise===!0?this.aEndAngle+(1-u)*(r-P):this.aStartAngle+u*P;var k=this.aX+this.xRadius*T(D),S=this.aY+this.yRadius*c(D);return new cg(k,S)};var Gk=function(e,f){this.v1=e,this.v2=f},Dj=Gk.prototype=xp(zf);Dj.getPoint=function(p){var I=this.v2.clone().sub(this.v1);return I.multiplyScalar(p).add(this.v1),I},Dj.getPointAt=function(N){return this.getPoint(N)},Dj.getTangent=function(){var M=this.v2.clone().sub(this.v1);return M.normalize()};var ok=function(W,m,y){this.v0=W,this.v1=m,this.v2=y};ok.prototype=xp(zf),ok.prototype.getPoint=function(v){var M,z;return M=Yf.b2(v,this.v0.x,this.v1.x,this.v2.x),z=Yf.b2(v,this.v0.y,this.v1.y,this.v2.y),new cg(M,z)};var Gj=function(b,x,v,K){this.v0=b,this.v1=x,this.v2=v,this.v3=K};Gj.prototype=xp(zf),Gj.prototype.getPoint=function(H){var O,K;return O=Yf.b3(H,this.v0.x,this.v1.x,this.v2.x,this.v3.x),K=Yf.b3(H,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new cg(O,K)},Ar.create(function(O,L){this.v1=O,this.v2=L},function(S){var g=new xh;return g.subVectors(this.v2,this.v1),g.multiplyScalar(S),g.add(this.v1),g});var Jp=Ar.create(function(Q,m,D){this.v0=Q,this.v1=m,this.v2=D},function(o){var Y,B,y;return Y=Yf.b2(o,this.v0.x,this.v1.x,this.v2.x),B=Yf.b2(o,this.v0.y,this.v1.y,this.v2.y),y=Yf.b2(o,this.v0.z,this.v1.z,this.v2.z),new xh(Y,B,y)}),Hn=Ar.create(function(p,A,x,f){this.v0=p,this.v1=A,this.v2=x,this.v3=f},function(k){var Z,S,m;return Z=Yf.b3(k,this.v0.x,this.v1.x,this.v2.x,this.v3.x),S=Yf.b3(k,this.v0.y,this.v1.y,this.v2.y,this.v3.y),m=Yf.b3(k,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new xh(Z,S,m)}),Ol=function(X,Q,V,I,o,S,y,A){ng.call(this),I=I!==P?I:.5,o=o!==P?o:.5,A=A!==P?A:1,X=X||8,S=S||0,y=y||r;var $,W,f=1,m=A/2,e=[],M=[],z=this.vertices,O=this.faces,t=this.faceVertexUvs;for(W=0;f>=W;W++){var Z=[],s=[],h=W/f,n=h*(o-I)+I;for($=0;X>=$;$++){var j=$/X,N=new xh,g=-(j*y+S);N.z=n*c(g),N.y=-h*A+m,N.x=n*T(g),z.push(N),Z.push(z.length-1),s.push(new cg(j,h))}e.push(Z),M.push(s)}var p,b,u=(o-I)/A;for($=0;X>$;$++)for(0!==I?(p=z[e[0][$]].clone(),b=z[e[0][$+1]].clone()):(p=z[e[1][$]].clone(),b=z[e[1][$+1]].clone()),p.setY(i(p.x*p.x+p.z*p.z)*u).normalize(),b.setY(i(b.x*b.x+b.z*b.z)*u).normalize(),W=0;f>W;W++){var K=e[W][$],l=e[W+1][$],E=e[W+1][$+1],v=e[W][$+1],k=p.clone(),_=p.clone(),B=b.clone(),G=b.clone(),d=M[W][$].clone(),w=M[W+1][$].clone(),U=M[W+1][$+1].clone(),H=M[W][$+1].clone();O.push(new ph(K,l,v,[k,_,G])),t[0].push([d,w,H]),O.push(new ph(l,E,v,[_.clone(),B,G.clone()])),t[0].push([w.clone(),U,H.clone()])}if(Q&&I>0)for(this.vertices.push(new xh(0,m,0)),$=0;X>$;$++){var K=e[0][$],l=e[0][$+1],E=this.vertices.length-1,k=new xh(0,1,0),_=new xh(0,1,0),B=new xh(0,1,0),d=M[0][$].clone(),w=M[0][$+1].clone(),U=new cg(w.x,0);O.push(new ph(K,l,E,[k,_,B],null,1));var F=$/X*r,R=T(F),a=c(F),q=($+1)/X*r,J=T(q),L=c(q);t[0].push([new cg(.5+.5*R,.5+.5*a),new cg(.5+.5*J,.5+.5*L),new cg(.5,.5)])}if(V&&o>0)for(this.vertices.push(new xh(0,-m,0)),$=0;X>$;$++){var K=e[W][$+1],l=e[W][$],E=z.length-1,k=new xh(0,-1,0),_=new xh(0,-1,0),B=new xh(0,-1,0),d=M[W][$+1].clone(),w=M[W][$].clone();O.push(new ph(K,l,E,[k,_,B],null,2));var F=$/X*r,R=T(F),a=c(F),q=($+1)/X*r,J=T(q),L=c(q);t[0].push([new cg(.5+.5*J,.5-.5*L),new cg(.5+.5*R,.5-.5*a),new cg(.5,.5)])}};Ol.prototype=xp(Sl);var ml=function(S,M,I,n,K,b,W){ng.call(this),W=W||.5,S=S||16,M=M||16,I=(I!==P?I:0)-O,n=n!==P?n:r,K=K!==P?K:0,b=b!==P?b:O;var B,k,A=[],d=[],F=this.vertices,i=this.faces,U=this.faceVertexUvs;for(k=0;M>=k;k++){var g=[],J=[];for(B=0;S>=B;B++){var H=B/S,a=k/M,D=new xh;D.x=-W*T(I+H*n)*c(K+a*b),D.y=W*T(K+a*b),D.z=W*c(I+H*n)*c(K+a*b),F.push(D),g.push(F.length-1),J.push(new cg(H,a))}A.push(g),d.push(J)}for(k=0;M>k;k++)for(B=0;S>B;B++){var l=A[k][B+1],C=A[k][B],p=A[k+1][B],N=A[k+1][B+1],Z=F[l].clone().normalize(),s=F[C].clone().normalize(),X=F[p].clone().normalize(),Y=F[N].clone().normalize(),t=d[k][B+1].clone(),G=d[k][B].clone(),u=d[k+1][B].clone(),j=d[k+1][B+1].clone();L(F[l].y)===W?(t.x=(t.x+G.x)/2,i.push(new ph(l,p,N,[Z,X,Y])),U[0].push([t,u,j])):L(F[p].y)===W?(u.x=(u.x+j.x)/2,i.push(new ph(l,C,p,[Z,s,X])),U[0].push([t,G,u])):(i.push(new ph(l,C,N,[Z,s,Y])),U[0].push([t,G,j]),i.push(new ph(C,p,N,[s.clone(),X,Y.clone()])),U[0].push([G.clone(),u,j.clone()]))}};ml.prototype=xp(Sl);var hb=function(k,K,P,$,n,u){ng.call(this),k=k||.33,K=K||.17,$=$||8,P=P||6,n=n||0,u=u||r;for(var V=new xh,Z=[],t=[],J=0;$>=J;J++)for(var N=J/$*r+O,W=0;P>=W;W++){var I=W/P*u+n;V.x=k*T(I),V.z=-k*c(I);var x=new xh,U=k+K*T(N);x.x=U*T(I),x.z=-U*c(I),x.y=K*c(N),this.vertices.push(x),Z.push(new cg(W/P,1-J/$)),t.push(x.clone().sub(V).normalize())}for(var J=1;$>=J;J++)for(var W=1;P>=W;W++){var M=(P+1)*J+W-1,A=(P+1)*(J-1)+W-1,l=(P+1)*(J-1)+W,i=(P+1)*J+W,R=new ph(M,A,i,[t[M].clone(),t[A].clone(),t[i].clone()]);this.faces.push(R),this.faceVertexUvs[0].push([Z[M].clone(),Z[A].clone(),Z[i].clone()]),R=new ph(A,l,i,[t[A].clone(),t[l].clone(),t[i].clone()]),this.faces.push(R),this.faceVertexUvs[0].push([Z[A].clone(),Z[l].clone(),Z[i].clone()])}this.computeFaceNormals()};hb.prototype=xp(Sl);var Iq=function(z,b,e){return z?(ng.call(this),z=z instanceof Array?z:[z],this.addShapeList(z,b),b.convertYZ!==!1&&Ug(this,e),this.computeFaceNormals(),void 0):(z=[],void 0)},zk=Iq.prototype=xp(ng.prototype);zk.addShapeList=function(E,c){for(var $=E.length,b=0;$>b;b++){var M=E[b];this.addShape(M,c)}},zk.addShape=function(m,B){function f(){if(B.bottom)for(var _=0;n>_;_++)e=y[_],W(e[2],e[1],e[0],!0);if(B.top)for(_=0;n>_;_++)e=y[_],W(e[0]+K*V,e[1]+K*V,e[2]+K*V,!1)}function A(){var D=0;for(C(H,D),D+=H.length,c=0,w=b.length;w>c;c++)X=b[c],C(X,D),D+=X.length}function C(J,P){for(var f,v,m=J.length;--m>=0;){f=m,v=m-1,0>v&&(v=J.length-1);var X=0,t=V;for(X=0;t>X;X++){var l=K*X,x=K*(X+1),b=P+f+l,W=P+v+l,R=P+v+x,e=P+f+x;F(b,W,R,e,J,X,t,f,v)}}}function L(O,k,m){d.vertices.push(new xh(O,k,m))}function W(F,i,K,X){F+=Q,i+=Q,K+=Q,d.faces.push(new ph(F,i,K,null,null,X?2:1));var $=X?M.generateBottomUV(d,m,B,F,i,K):M.generateTopUV(d,m,B,F,i,K);d.faceVertexUvs[0].push($)}function F(E,Z,h,v,s,X,G,f,r){E+=Q,Z+=Q,h+=Q,v+=Q,d.faces.push(new ph(E,Z,v)),d.faces.push(new ph(Z,h,v));var l=M.generateSideWallUV(d,m,s,B,E,Z,h,v,X,G,f,r);d.faceVertexUvs[0].push([l[0],l[1],l[3]]),d.faceVertexUvs[0].push([l[1],l[2],l[3]])}var u,N,p,s,G,r=B.amount,k=B.curveSegments||Em,V=B.steps||1,$=B.extrudePath,O=!1,M=new xg(B.repeatUVLength);$&&(u=$.getSpacedPoints(V),O=!0,N=B.frames!==P?B.frames:new Dd.FrenetFrames($,V,!1),p=new xh,s=new xh,G=new xh);var X,c,w,d=this,Q=this.vertices.length,Y=m.extractPoints(k),j=Y.shape,b=Y.holes,z=!Yf.isClockWise(j);if(z){for(j=j.reverse(),c=0,w=b.length;w>c;c++)X=b[c],Yf.isClockWise(X)&&(b[c]=X.reverse());z=!1}var y=Yf.triangulateShape(j,b),H=j;for(c=0,w=b.length;w>c;c++)X=b[c],j=j.concat(X);for(var I,e,K=j.length,n=y.length,R=0;K>R;R++)I=j[R],O?(s.copy(N.normals[0]).multiplyScalar(I.x),p.copy(N.binormals[0]).multiplyScalar(I.y),G.copy(u[0]).add(s).add(p),L(G.x,G.y,G.z)):L(I.x,I.y,0);var g;for(g=1;V>=g;g++)for(R=0;K>R;R++)I=j[R],O?(s.copy(N.normals[g]).multiplyScalar(I.x),p.copy(N.binormals[g]).multiplyScalar(I.y),G.copy(u[g]).add(s).add(p),L(G.x,G.y,G.z)):L(I.x,I.y,r/V*g);f(),A()};var Dd=function(s,X,O,n,F){function V(L,O,i){return H.vertices.push(new xh(L,O,i))-1}ng.call(this),X=X||64,O=O||1,n=n||8,F=F||!1;var q,J,b,v,e,M,d,l,g,o,k,W,B,a,f,x,m,u,D,t,S=[],H=this,Q=X+1,I=new xh,K=new Dd.FrenetFrames(s,X,F),h=K.tangents,Y=K.normals,G=K.binormals;for(this.tangents=h,this.normals=Y,this.binormals=G,g=0;Q>g;g++)for(S[g]=[],v=g/(Q-1),l=s.getPointAt(v),q=h[g],J=Y[g],b=G[g],o=0;n>o;o++)e=o/n*r,M=-O*T(e),d=O*c(e),I.copy(l),I.x+=M*J.x+d*b.x,I.y+=M*J.y+d*b.y,I.z+=M*J.z+d*b.z,S[g][o]=V(I.x,I.y,I.z);for(g=0;X>g;g++)for(o=0;n>o;o++)k=F?(g+1)%X:g+1,W=(o+1)%n,B=S[g][o],a=S[k][o],f=S[k][W],x=S[g][W],m=new cg(g/X,o/n),u=new cg((g+1)/X,o/n),D=new cg((g+1)/X,(o+1)/n),t=new cg(g/X,(o+1)/n),this.faces.push(new ph(B,a,x)),this.faceVertexUvs[0].push([m,u,t]),this.faces.push(new ph(a,f,x)),this.faceVertexUvs[0].push([u.clone(),D,t.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Dd.prototype=xp(Sl),Dd.FrenetFrames=function(y,X,x){function N(){E[0]=new xh,i[0]=new xh,n=Number.MAX_VALUE,V=L(d[0].x),t=L(d[0].y),g=L(d[0].z),n>=V&&(n=V,S.set(1,0,0)),n>=t&&(n=t,S.set(0,1,0)),n>=g&&S.set(0,0,1),H.crossVectors(d[0],S).normalize(),E[0].crossVectors(d[0],H),i[0].crossVectors(d[0],E[0])}var F,n,V,t,g,P,O,S=new xh,d=[],E=[],i=[],H=new xh,h=new Ob,C=X+1,B=1e-4;for(this.tangents=d,this.normals=E,this.binormals=i,P=0;C>P;P++)O=P/(C-1),d[P]=y.getTangentAt(O),d[P].normalize();for(N(),P=1;C>P;P++)E[P]=E[P-1].clone(),i[P]=i[P-1].clone(),H.crossVectors(d[P-1],d[P]),H.length()>B&&(H.normalize(),F=q(lm(d[P-1].dot(d[P]),-1,1)),E[P].applyMatrix4(h.makeRotationAxis(H,F))),i[P].crossVectors(d[P],E[P]);if(x)for(F=q(lm(E[0].dot(E[C-1]),-1,1)),F/=C-1,d[0].dot(H.crossVectors(E[0],E[C-1]))>0&&(F=-F),P=1;C>P;P++)E[P].applyMatrix4(h.makeRotationAxis(d[P],F*P)),i[P].crossVectors(d[P],E[P])};var Il=function(d,H,x,F){ng.call(this),H=H||18,x=x||0,F=F==Y?r:F;for(var A=1/(d.length-1),C=1/H,D=0,Z=H;Z>=D;D++)for(var f=x+D*C*F,l=T(f),k=c(f),U=0,L=d.length;L>U;U++){var w=d[U],M=new xh;M.x=l*w.x-k*w.y,M.y=k*w.x+l*w.y,M.z=w.z,this.vertices.push(M)}for(var m=d.length,D=0,Z=H;Z>D;D++)for(var U=0,L=d.length-1;L>U;U++){var g=U+m*D,b=g,o=g+m,l=g+1+m,N=g+1,t=D*C,B=U*A,a=t+C,j=B+A;this.faces.push(new ph(b,N,o)),this.faceVertexUvs[0].push([new cg(t,B),new cg(t,j),new cg(a,B)]),this.faces.push(new ph(o,N,l)),this.faceVertexUvs[0].push([new cg(a,B),new cg(t,j),new cg(a,j)])}this.mergeVertices(),Ug(this),this.computeFaceNormals(),this.computeVertexNormals()};Il.prototype=xp(Sl);var Gg=function(L,q){q=q||{};var b=Vo.generateShapes(L,q);q.amount=q.amount!==P?q.amount:.5,q.convertYZ=!1,q.fill!==!1&&(q.bottom=!0,q.top=!0),Iq.call(this,b,q)};Gg.prototype=xp(zk);var Dh=C.Node=function(){wj(Dh,this)},bd={X:Ir,Y:Sq,Z:ur},Up={X:0,Y:1,Z:2},Th={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},eg="xzy",ud=function(o,v,B){if(v){var w=v[0],l=v[1],x=v[2];"xzy"===B?(Sq(o,l),ur(o,x),Ir(o,w)):"xyz"===B?(ur(o,x),Sq(o,l),Ir(o,w)):"yxz"===B?(ur(o,x),Ir(o,w),Sq(o,l)):"yzx"===B?(Ir(o,w),ur(o,x),Sq(o,l)):"zxy"===B?(Sq(o,l),Ir(o,w),ur(o,x)):"zyx"===B?(Ir(o,w),Sq(o,l),ur(o,x)):(Sq(o,l),ur(o,x),Ir(o,w))}};Lg("Node",uo,{ms_ac:["rotationMode","anchorElevation"],_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:eg,_64O:0,_rotationX:0,_53O:0,_host:Y,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Yo},_22Q:function(){return Dm},getX:function(){return this.p().x},setX:function(Y){this.p(Y,this.p().y)},getY:function(){return this.p().y},setY:function(v){this.p(this.p().x,v)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(g){this.setAnchor(g,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(w){this.setAnchor(this.getAnchor().x,w)},getScaleX:function(){return this.getScale().x},setScaleX:function(d){this.setScale(d,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(o){this.setScale(this.getScale().x,o)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(W,J){uh(W,Nk(Y,Y,this.r3(),this.getRotationMode())),this.translate3d(W[0]*J,W[1]*J,W[2]*J)},translateFront:function(M){this.translate3dBy([0,0,1],M)},translateBack:function(O){this.translate3dBy([0,0,-1],O)},translateLeft:function(r){this.translate3dBy([-1,0,0],r)},translateRight:function(b){this.translate3dBy([1,0,0],b)},translateTop:function(K){this.translate3dBy([0,1,0],K)},translateBottom:function(Q){this.translate3dBy([0,-1,0],Q)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(E,y,f){1===arguments.length&&(y=E[1],f=E[2],E=E[0]),this.p(E,f),this.setElevation(y)},translate3d:function(l,I,n){1===arguments.length&&(I=l[1],n=l[2],l=l[0]),this.translate(l,n),this.setElevation(this._54O+I)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(t,h,j){1===arguments.length&&(h=t[1],j=t[2],t=t[0]),this.setSize(t,j),this.setTall(h)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(h,K,r){1===arguments.length&&(K=h[1],r=h[2],h=h[0]),this.setRotationX(h),this.setRotation(-K),this.setRotationZ(r)},setRotationY:function(C){this.setRotation(-C)},getRotationY:function(){return-this._64O},lookAtDirection:function(y,U){U=U||Wh;var I=this,t=Qf(y);U===Wh?(I.r3([-x(y[1]/t),-d(y[2],y[0])+F,0]),I.setRotationMode("xzy")):U===lh?(I.r3(0,-d(y[2],y[0]),x(y[1]/t)),I.setRotationMode("zyx")):U===wp?(I.r3(0,-d(y[2],y[0])+O,-x(y[1]/t)),I.setRotationMode("zyx")):U===Gc?(I.r3([-x(y[1]/t)+F,-d(y[2],y[0])+F,0]),I.setRotationMode("xzy")):U===Xh&&(I.r3([-x(y[1]/t)-F,-d(y[2],y[0])+F,0]),I.setRotationMode("xzy")),U===Bc&&(I.r3([-x(y[1]/t)+O,-d(y[2],y[0])+F,O]),I.setRotationMode("zxy"))},lookAt:function(Q,k){return this.lookAtDirection(Lh(Q,this.p3()),k)},getLoopedEdges:function(){return this._45I},getEdges:function(){return this._70O},getAgentEdges:function(){return this._49I},getHost:function(){return this._host},setHost:function(I){var m=this;if(m!==I&&m._host!==I){var d=m._host;d&&d._removeAttach(m),m._host=I,m._host&&m._host._addAttach(m),m.fp("host",d,I),m.onHostChanged(d,I)}},getAttaches:function(){return this._69O},_addAttach:function(X){var h=this;h._69O||(h._69O=new rp),h._69O.add(X),h.fp("attaches",Y,X)},_removeAttach:function(z){var s=this;s._69O.remove(z),s._69O.isEmpty()&&delete s._69O,s.fp("attaches",z,Y)},getSourceEdges:function(){return this._42I},getTargetEdges:function(){return this._43I},_2I:function(f){var r=this;r._44I||(r._44I=new rp),r._42I||(r._42I=new rp),r._44I.add(f),r._42I.add(f),r._20I()},_4I:function(e){var o=this;o._44I||(o._44I=new rp),o._43I||(o._43I=new rp),o._44I.add(e),o._43I.add(e),o._20I()},_16I:function(M){var b=this;b._44I.remove(M),b._42I.remove(M),b._44I.isEmpty()&&delete b._44I,b._42I.isEmpty()&&delete b._42I,b._20I()},_18I:function(c){var i=this;i._44I.remove(c),i._43I.remove(c),i._44I.isEmpty()&&delete i._44I,i._43I.isEmpty()&&delete i._43I,i._20I()},_20I:function(){var M=this;if(delete M._45I,!M._44I||M._44I.isEmpty())return delete M._70O,void 0;var Y;M._44I.each(function(K){K.isLooped()&&(Y||(Y={}),Y[K._id]||(M._45I||(M._45I=new rp),M._45I.add(K),Y[K._id]=K))}),Y?(M._70O=new rp,M._44I.each(function(E){Y[E._id]?"A"===Y[E._id]||(Y[E._id]="A",M._70O.add(E)):M._70O.add(E)})):M._70O=M._44I},hasAgentEdges:function(){return!!this._49I&&!this._49I.isEmpty()},getSourceAgentEdges:function(){return this._46I},getTargetAgentEdges:function(){return this._47I},_1I:function(Z){var z=this;z._46I||(z._46I=new rp),z._48I||(z._48I=new rp),z._46I.add(Z),z._48I.add(Z),z._19I()},_3I:function(h){var W=this;W._47I||(W._47I=new rp),W._48I||(W._48I=new rp),W._47I.add(h),W._48I.add(h),W._19I()},_15I:function(n){var s=this;s._46I.remove(n),s._48I.remove(n),s._46I.isEmpty()&&delete s._46I,s._48I.isEmpty()&&delete s._48I,s._19I()},_17I:function(o){var r=this;r._47I.remove(o),r._48I.remove(o),r._47I.isEmpty()&&delete r._47I,r._48I.isEmpty()&&delete r._48I,r._19I()},_19I:function(){var p=this;delete p._49I;var A=p._48I;if(A&&!A.isEmpty()){var M={};A.each(function(E){M[E._id]?p._49I||(p._49I=new rp):M[E._id]=E}),p._49I?A.each(function(n){M[n._id]&&(p._49I.add(n),delete M[n._id])}):p._49I=A}},getImage:function(){if(this._pendingCheckImageJSON){var e=k.getImage(this._image);e&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof Vg&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(h){var V=this,A=V._image,l=V.getWidth(),g=V.getHeight();V._image=h,V.fp("image",A,h)&&(null!=h&&(Vl(h)||Xd(h)&&/\.json$/i.test(h))&&(this._pendingCheckImageJSON=!0),V.fp(wl,l,V.getWidth()),V.fp(Gb,g,V.getHeight()))},getElevation:function(){return this._54O},setElevation:function(W){var R=this;if(!R._50O){R._50O=1;var H=R._54O;R._54O=W,R.fp(Xg,H,W),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(q){var A=this;if(!A._49O){A._49O=1;var g=A._64O;A._64O=q,A.fp(Hd,g,q),delete A._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(U){var i=this;if(!i._51O){i._51O=1;var d=i._rotationX;i._rotationX=U,i.fp("rotationX",d,U),delete i._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(z){var G=this;if(!G._52O){G._52O=1;var U=G._53O;G._53O=z,G.fp("rotationZ",U,z),delete G._52O}},getPosition:function(){return this._position},setPosition:function(U,f){var R=this;if(!R._50I){R._50I=1;var Y;if(Y=2===arguments.length?{x:U,y:f}:U,Y.x!==R._position.x||Y.y!==R._position.y){var H=R._position;R._position=Y,R.fp(kr,H,Y)}delete R._50I}},translate:function(z,m){var K=this._position;this.p(K.x+z,K.y+m)},getWidth:function(){var W=this;if(W._width>=0)return W._width;var G=W.getStyle("shape3d");if(G){var d=$e(G);if(d&&d.rawS3)return d.rawS3[0];if("billboard"===G||"plane"===G){var X=km(W.getStyle("shape3d.image"));return X?re(X,W):20}}var X=km(W._image);return X?re(X,W):20},setWidth:function(P){var $=this,b=$._width;$._width=P,$.fp(wl,b,P)},getHeight:function(){var F=this;if(F._height>=0)return F._height;var I=F.getStyle("shape3d");if(I){var V=$e(I);if(V&&V.rawS3)return V.rawS3[2];if("plane"===I){var K=km(F.getStyle("shape3d.image"));return K?dp(K,F):20}if("billboard"===I)return 2}var K=km(F._image);return K?dp(K,F):20},setHeight:function(I){var u=this,U=u._height;u._height=I,u.fp(Gb,U,I)},getTall:function(){var _=this;if(_._tall>=0)return _._tall;var u=_.getStyle("shape3d");if(u){var W=$e(u);if(W&&W.rawS3)return W.rawS3[1];if("billboard"===u){var P=km(_.getStyle("shape3d.image"));return P?dp(P,_):20}if("plane"===u)return 2}return 20},setTall:function(S){var J=this,s=J._tall;J._tall=S,J.fp("tall",s,S)},setSize:function(T,L){var E=this;2===arguments.length?(E.setWidth(T),E.setHeight(L)):(E.setWidth(T.width),E.setHeight(T.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}
},setRect:function(U,G,p,L,v){var P=this,o=P.getAnchor(),k=P.getScale();arguments.length<=2&&(v=G,G=U.y,p=U.width,L=U.height,U=U.x);var i=v&&k.x<0?1-o.x:o.x,X=v&&k.y<0?1-o.y:o.y;P.p(U+p*i,G+L*X),v&&(p/=Math.abs(k.x),L/=Math.abs(k.y)),P.setWidth(p),P.setHeight(L)},getMatrix:function(){var Q=this,y=Q._64O,T=Q._position,f=Q.getScale();return new cq(y,T.x,T.y,f.x,f.y)},getAnchorRect:function(){var d=this,e=d.getWidth(),y=d.getHeight(),c=d.getAnchor();return{x:-e*c.x,y:-y*c.y,width:e,height:y}},toLocal:function(C){return this.getMatrix().tfi(C)},toGlobal:function(M){return this.getMatrix().tf(M)},getAttachPosition:function(){var L=new cq;return function(d,D,Z,y){Z=Z||0,y=y||0;var e=this,u=e.getAnchor(),U=e._64O,I=e._position,k=e.getScale();return L.setFromTransform(U,I.x,I.y).tf({x:Z+k.x*e.getWidth()*(d-u.x),y:y+k.y*e.getHeight()*(D-u.y)})}}(),isInRect:function(k){k=this.toLocal(k);var q=this.getWidth(),c=this.getHeight();return k.x+=q*this.getAnchorX(),k.y+=c*this.getAnchorY(),!(k.x<0||k.y<0||k.x>q||k.y>c)},getRect:function(){var N=this,Q=N.getWidth(),r=N.getHeight(),z=N.getAnchor(),k={x:-Q*z.x,y:-r*z.y,width:Q,height:r},R=N.getMatrix();return k=ig([R.tf(k.x,k.y),R.tf(k.x+k.width,k.y),R.tf(k.x+k.width,k.y+k.height),R.tf(k.x,k.y+k.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var T=this,A=T.getAnchor(),d=T._anchorElevation;return{x:A.x,y:d,z:A.y}},setAnchorElevation:function(U){var i=this,V=i._anchorElevation;return V!==U?(i._anchorElevation=U,i.fp("anchorElevation",V,U),!0):!1},setAnchor3d:function(o,M,u,U){var d,S=this;"number"==typeof o?d={x:o,y:M,z:u}:(d=o.length?{x:o[0],y:o[1],z:o[2]}:o,U=M);var g=S.getDataModel();g&&g.beginTransaction();var B=S.getAnchor3d(),v=S.setAnchor(d.x,d.z);if(S.setAnchorElevation(d.y)&&(v=!0),v&&U&&!Zn){S.getAnchor3d();var e=Hg(S),z=uh([d.x-B.x,d.y-B.y,d.z-B.z],e);S.p3(z)}return g&&g.endTransaction(),v},getAnchor:function(){var f=this;if(f.hasOwnProperty("_anchor"))return f._anchor;var U=km(f._image);return U&&U.anchorX!==P?{x:U.anchorX,y:U.anchorY}:f._anchor},setAnchor:function(e,s,$){var B,j=this;"number"==typeof e?B={x:e,y:s}:(B=e.length?{x:e[0],y:e[1]}:e,$=s);var g=j.getAnchor();if(g.x!==B.x||g.y!==B.y){var m=j.getDataModel();if(m&&m.beginTransaction(),j._anchor=B,j.fp("anchor",g,B),$&&!Zn){var M=j.getPosition(),C=j.getSize(),f=j.getRotation(),S=j.getScale(),K=-C.width*(g.x-B.x)*S.x,x=-C.height*(g.y-B.y)*S.y,I=c(f),l=T(f);j.setPosition(M.x+l*K-I*x,M.y+I*K+l*x)}return m&&m.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(G,F){var J,f=this;J=2===arguments.length?{x:G,y:F}:G;var X=f.getScale();(X.x!==J.x||X.y!==J.y)&&(f._scale=J,f.fp("scale",X,J))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var Y=this,v=Y._scaleTall,I=Y.getScale();return[I.x,v,I.y]},getFinalScale3d:function(){var f=this,F=f.s3(),W=f._dynamicScale3d,x=f.getScale3d();return F&&(x[0]*=F[0],x[1]*=F[1],x[2]*=F[2]),W&&(x[0]*=W[0],x[1]*=W[1],x[2]*=W[2]),x},getFinalRotation3d:function(){var W=this;return W._dynamicRotation||W.r3()},setScaleTall:function(G){var W=this,b=W._scaleTall;b!==G&&(W._scaleTall=G,W.fp("scaleTall",b,G))},setScale3d:function(z,i,m){var q,n=this;q="number"==typeof z?{x:z,y:i,z:m}:z.length?{x:z[0],y:z[1],z:z[2]}:z,n.setScaleTall(q.y),n.setScale(q.x,q.z)},getCorners:function(g,T){g==Y&&(g=0),T==Y&&(T=g);var H=this,a=H.getAnchor(),y=H.getWidth(),D=H.getHeight(),x=-y*a.x-g,j=-D*a.y-T,Z=y+2*g,m=D+2*T,K=H.getMatrix();return[K.tf(x,j),K.tf(x,j+m),K.tf(x+Z,j+m),K.tf(x+Z,j)]},getEditControlPoints:function(N,l,s){l==Y&&(l=0),s==Y&&(s=l);var S=this,W=S.getAnchor(),Z=S.getWidth(),U=S.getHeight(),u=-Z*W.x-l,r=-U*W.y-s,i=Z+2*l,m=U+2*s;if(N)return[{x:u,y:r},{x:u,y:0},{x:u,y:r+m},{x:0,y:r+m},{x:u+i,y:r+m},{x:u+i,y:0},{x:u+i,y:r},{x:0,y:r}];var M=S.getMatrix();return[M.tf(u,r),M.tf(u,0),M.tf(u,r+m),M.tf(0,r+m),M.tf(u+i,r+m),M.tf(u+i,0),M.tf(u+i,r),M.tf(0,r)]},rotateAt:function(n,v,m){var P=this,K=P._position,h=P._64O,z=new cq(h,K.x,K.y).tf(n,v),t=i(n*n+v*v),U=d(K.y-z.y,K.x-z.x)+m;P.setRotation(h+m),P.p(z.x+t*T(U),z.y+t*c(U))},onParentChanged:function(){Dh.superClass.onParentChanged.apply(this,arguments),this._8I()},_8I:function(){this._70O&&this._70O.each(function(g){g._7I()})},onPropertyChanged:function(){var Q={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(V){Q[V]=!0}),function(q){var Y=this;Dh.superClass.onPropertyChanged.call(Y,q),Q[q.property]&&!Y._layoutUpdating&&Y.updateLayoutParameters(null,q.property),Y._69O&&Y._69O.each(function(P){P.handleHostPropertyChange(q)}),Y._49I&&Y._49I.each(function(P){P.fp("agentChange",!0,!1)})}}(),onHostChanged:function(){this.updateAttach()},handleHostPropertyChange:function(h){this.updateAttach(h)},onStyleChanged:function(u){Dh.superClass.onStyleChanged.apply(this,arguments),Kr[u]&&this.updateAttach()},updateAttach:function(E){var J=this;J._51I||Zn||(J._51I=1,J._71O(E),delete J._51I)},_71O:function(k){var $,S,X,M,N,s,n=this,r=n._host,D=k?k.property:Y,j=k?k.oldValue:Y,a=k?k.newValue:Y;if(r instanceof C.Grid){if(D===Xg)n.setElevation(n._54O+a-j);else if(!k||Qp[D]){if($=n.s("attach.row.index"),S=n.s("attach.column.index"),X=r.getCellRect($,S),!X)return;M=n.s("attach.row.span"),N=n.s("attach.column.span"),(1!==M||1!==N)&&(X=Si(X,r.getCellRect($+M-1,S+N-1))),fm(X,n,"attach.padding",1),n.setRect(X)}}else if(r instanceof en&&(s=n.s("attach.index"))>=0&&(!k||Sg[D])){var o=n.s("attach.thickness");o!=Y&&n.setHeight(r.getThickness()*o);var W=n.s("attach.offset"),J=r.getPoints(),P=J.size();if(P>s){var H=J.get(s),G=P===s+1?J.get(0):J.get(s+1),h=[G.x-H.x,G.y-H.y],B=Qf(h);if(B){n.s("attach.offset.relative")&&(W*=B),n.s("attach.offset.opposite")&&(W=B-W);var I={x:H.x+h[0]/B*W,y:H.y+h[1]/B*W},q=n.s("attach.gap");q&&(n.s("attach.gap.relative")&&(q*=r.getThickness()),I=ps(Y,I,G,q)),n.p(I),n.setRotation(d(h[1],h[0]))}}}else k&&(D===kr?n.translate(a.x-j.x,a.y-j.y):D===Xg?n.setElevation(n._54O+a-j):il[D]?n._11Q(r,D,a-j):("anchor"===D||"width"===D||"height"===D||"scale"===D)&&n.layout(r))},_11Q:function(){var Y=new C.Math.Euler,S=C.Math.Euler.ReverseOrder,H=new C.Math.Vector2,l=new C.Math.Vector2;return function(P,f,J){var v=this,d=P.p3(),c=P.r3(),V=v.p3(),Q=v.r3();if(f===Hd&&(f="rotationY",J=-J),(f===Hd||"rotationY"===f)&&0===Q[0]&&0===Q[2]&&0===c[0]&&0===c[2]&&0===V[1]&&0===d[1])return v.setRotation(-Q[1]-J),H.set(V[0],V[2]).rotateAround(l.set(d[0],d[2]),-J),v.p(H.x,H.y),void 0;var C=Th[P.getRotationMode()],p=C[0],u=C[1],w=C[2],W=bd[p],D=bd[u],I=bd[w],O=ck();f===Hd+p?(I(O,c[Up[w]]),D(O,c[Up[u]]),W(O,J),D(O,-c[Up[u]]),I(O,-c[Up[w]])):f===Hd+u?(I(O,c[Up[w]]),D(O,J),I(O,-c[Up[w]])):f===Hd+w&&I(O,J);var $=Lh(V,d);uh($,O),v.p3(d[0]+$[0],d[1]+$[1],d[2]+$[2]);var e=v.getRotationMode();ud(O,v.r3(),e),Y.setFromRotationMatrix(O,S(e)),v.r3([Y.x,Y.y,Y.z])}}(),isHostOn:function(F){var W=this;if(W._host&&F&&F._69O)for(var r={},M=W._host;M&&M!==W&&!r[M._id];){if(M===F)return!0;r[M._id]=M,M=M._host}return!1},isLoopedHostOn:function(X){return this.isHostOn(X)&&X.isHostOn(this)},getScaledSize:function(){var $=this.getSize(),H=this.getScale();return $.width*=Math.abs(H.x),$.height*=Math.abs(H.y),$},layout:function(u){if(u=u||this.getHost()){var Y=this,m=Y.s("layout.h")||"center",Q=Y.s("layout.v")||"center";if("center"!==m||"center"!==Q){var n=new C.Math.Vector2,U=u.getPosition(),Z=u.getAnchor(),G=u.getScaledSize();Y.getPosition();var _,V,r,S,o,j=1,R=1;switch(Y._layoutUpdating=!0,m){case"left":n.setX(Y._layoutHValue-Z.x*G.width);break;case"right":n.setX((1-Z.x)*G.width-Y._layoutHValue);break;case"leftright":_=G.width-Y._layoutHValue[2],r=Y.getRotation()-u.getRotation(),S=Math.abs(Math.sin(r)),o=Math.abs(Math.cos(r)),j+=o*_/Y._layoutHValue[3],R+=S*_/Y._layoutHValue[4],n.setX(Y._layoutHValue[1]+(Y._layoutHValue[5]-Z.x)*G.width);break;case"center":n.setX((.5-Z.x)*G.width-Y._layoutHValue);break;case"scale":r=Y.getRotation()-u.getRotation(),S=Math.abs(Math.sin(r)),o=Math.abs(Math.cos(r)),n.setX((.5-Z.x)*G.width-Y._layoutHValue[1]*G.width/Y._layoutHValue[0]),V=G.width/Y._layoutHValue[2]-1,j+=o*V,R+=S*V}switch(Q){case"top":n.setY(Y._layoutVValue-Z.y*G.height);break;case"bottom":n.setY((1-Z.y)*G.height-Y._layoutVValue);break;case"topbottom":r||(r=Y.getRotation()-u.getRotation(),S=Math.abs(Math.sin(r)),o=Math.abs(Math.cos(r))),_=G.height-Y._layoutVValue[2],j+=S*_/Y._layoutVValue[3],R+=o*_/Y._layoutVValue[4],n.setY(Y._layoutVValue[1]+(Y._layoutVValue[5]-Z.y)*G.height);break;case"center":n.setY((.5-Z.y)*G.height-Y._layoutVValue);break;case"scale":r||(r=Y.getRotation()-u.getRotation(),S=Math.abs(Math.sin(r)),o=Math.abs(Math.cos(r))),n.setY((.5-Z.y)*G.height-Y._layoutVValue[1]*G.height/Y._layoutVValue[0]),V=G.height/Y._layoutVValue[2]-1,j+=S*V,R+=o*V}(1!==j||1!==R)&&("leftright"===m||"scale"===m?Y.setSize(Y._layoutHValue[3]*j,Y._layoutHValue[4]*R):Y.setSize(Y._layoutVValue[3]*j,Y._layoutVValue[4]*R)),n.rotateAround(null,u.getRotation()),this.setPosition(n.x+U.x,n.y+U.y),Y._layoutUpdating=P}}},updateLayoutParameters:function(F,l){if(F=F||this.getHost()){var b=this,W=b.s("layout.h"),O=b.s("layout.v");if(W||O){var P,o,q,n,u,I,V=new C.Math.Vector2,z=F.getPosition(),J=F.getAnchor(),f=F.getScaledSize(),d=b.getPosition(),S=b.getSize();switch(V.set(d.x-z.x,d.y-z.y),V.rotateAround(null,-F.getRotation()),W){case"left":b._layoutHValue=V.x+J.x*f.width;break;case"right":b._layoutHValue=-V.x+(1-J.x)*f.width;break;case"center":b._layoutHValue=-V.x+(.5-J.x)*f.width;break;case"leftright":case"scale":"scale"===W?P=-V.x+(.5-J.x)*f.width:(o=b.getAnchor(),q=b.getRotation()-F.getRotation(),n=Math.cos(q),u=Math.sin(q),I=-Math.min(-o.x*n+o.y*u,-o.x*n-(1-o.y)*u,(1-o.x)*n+o.y*u,(1-o.x)*n-(1-o.y)*u),P=V.x-(I-J.x)*f.width),"position"===l&&"object"==typeof b._layoutHValue?(b._layoutHValue[0]=f.width,b._layoutHValue[1]=P):b._layoutHValue=[f.width,P,f.width,S.width,S.height,I]}switch(O){case"top":b._layoutVValue=V.y+J.y*f.height;break;case"bottom":b._layoutVValue=-V.y+(1-J.y)*f.height;break;case"center":b._layoutVValue=-V.y+(.5-J.y)*f.height;break;case"topbottom":case"scale":"scale"===O?P=-V.y+(.5-J.y)*f.height:(q||(o=b.getAnchor(),q=b.getRotation()-F.getRotation(),n=Math.cos(q),u=Math.sin(q)),I=-Math.min(-o.x*u-o.y*n,-o.x*u+(1-o.y)*n,(1-o.x)*u-o.y*n,(1-o.x)*u+(1-o.y)*n),P=V.y-(I-J.y)*f.height),"position"===l&&"object"==typeof b._layoutVValue?(b._layoutVValue[0]=f.height,b._layoutVValue[1]=P):b._layoutVValue=[f.height,P,f.height,S.width,S.height,I]}}}},getSerializableProperties:function(){var a=Dh.superClass.getSerializableProperties.call(this);return yl(a,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),a}});var vn=C.Edge=function(a,x){var J=this;wj(vn,J),J.setSource(a),J.setTarget(x)};Lg("Edge",uo,{_icon:"edge_icon",getUIClass:function(){return un},_22Q:function(){return gp},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},setSource:function(d){var P=this;if(P._source!==d){var n=P._source;P._source=d,n&&n._16I(P),d&&d._2I(P),P._7I(),P.fp("source",n,d)}},setTarget:function(e){var A=this;if(A._target!==e){var U=A._target;A._target=e,U&&U._18I(A),e&&e._4I(A),A._7I(),A.fp("target",U,e)}},isLooped:function(){var E=this;return E._source===E._target&&!!E._source&&!!E._target},_7I:function(){var e,B=this,j=Uh(B);B._40I!==j&&(e=this._40I,e&&e._15I(B),B._40I=j,j&&j._1I(B),B.fp("sourceAgent",e,j),Kl(e,B._41I),Kl(j,B._41I));var T=jl(B);B._41I!==T&&(e=B._41I,e&&e._17I(B),B._41I=T,T&&T._3I(B),B.fp("targetAgent",e,T),Kl(e,B._40I),Kl(T,B._40I))},_22I:function(y){this._52I=y,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var a=this;return a._52I&&a._52I.get(0)!==a&&!a.getStyle(Xb)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var X=this,v=X._52I;return v&&!X.getStyle(Xb)&&v.size()>1&&X===v.get(0)},toggle:function(){var e=this._52I,V=!this.s(Xb);e&&e.size()>1&&(e.each(function(n){n.s(Xb,V)}),e.getSiblings().each(function(R){R!==e&&R.each(function(f){f.fp("edgeGroup",Y,R)})}))},setStyle:function(v,P){(v===Hj||"edge.segments"===v)&&(P=vb(P)),vn.superClass.setStyle.call(this,v,P)},onStyleChanged:function(v){vn.superClass.onStyleChanged.apply(this,arguments),Aq[v]&&Kl(this._41I,this._40I)},getSerializableProperties:function(){var m=vn.superClass.getSerializableProperties.call(this);return yl(m,{source:1,target:1}),m}});var wi=C.Group=function(){wj(wi,this)};Lg("Group",Dh,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return cm},onChildAdded:function(){wi.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){wi.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var t=this;if(!t._54I&&!Zn){var i=t.getChildrenRect();i&&(t._53I=1,t.p(ai(t.s("group.position"),i,t.getSize())),delete t._53I)}},getChildrenRect:function(){var A,Z=this;return Z.eachChild(function(G){A=Si(A,Z.getChildRect(G))}),A},getChildRect:function(N){var k;return fr(N)&&N.s(Jg)&&(lk(N)&&N.isExpanded()&&N.eachChild(function(g){k=Si(k,N.getChildRect(g))}),!k&&N.getRect&&(k=N.getRect())),k},setPosition:function(g,o){var K=this;if(!K._54I){var Z;Z=2===arguments.length?{x:g,y:o}:g,Zn||K._53I||(K._54I=1,Dr(K._children,Z.x-K._position.x,Z.y-K._position.y),delete K._54I),wi.superClass.setPosition.call(this,Z)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(l){var m=this;if(m._57O!==l){var d=m._57O;m._57O=l,m.fp("expanded",d,m._57O),m._fireInvalidateDeep(),m._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(L){lk(L)?L._fireInvalidateDeep():L.iv()})},_8I:function(){wi.superClass._8I.call(this),this.eachChild(function(z){fr(z)&&z._8I()})},onStyleChanged:function(K){wi.superClass.onStyleChanged.apply(this,arguments),"group.position"===K&&this._81I()},getSerializableProperties:function(){var R=wi.superClass.getSerializableProperties.call(this);return R.expanded=1,R}});var Ff=C.Block=function(){wj(Ff,this)};Lg("Block",Dh,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return Te},onChildAdded:function(){Ff.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){Ff.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},updateFromChildren:function(){var d=this;if(!Zn&&!d._updatingToChildren&&d._syncSize&&!d._freezeSyncFromChildren){var y,J,H,t,w,r=[],Q=d.getRotation();if(d.eachChild(function(A){fr(A)&&r.push.apply(r,A.getCorners())}),r.length){d._updatingFromChildren=1;var l=T(-Q),x=c(-Q),j=1/0,u=-1/0,$=1/0,U=-1/0;for(t=0,w=r.length;w>t;t++)H=r[t],y=H.x,J=H.y,H.x=l*y-x*J,H.y=x*y+l*J,j=D(j,H.x),u=B(u,H.x),$=D($,H.y),U=B(U,H.y);var V=d.getScale();d.setSize(L((u-j)/V.x),L((U-$)/V.y));var h;V.x<0&&(h=j,j=u,u=h),V.y<0&&(h=$,$=U,U=h),l=T(Q),x=c(Q);var g=d.getAnchor();y=j+(u-j)*g.x,J=$+(U-$)*g.y,d.setPosition(l*y-x*J,x*y+l*J),delete d._updatingFromChildren}}},setPosition:function(J,y){var A=this;if(!A._updatingToChildren){var s;s=2===arguments.length?{x:J,y:y}:J,Zn||A._updatingFromChildren||(A._updatingToChildren=1,Dr(A._children,s.x-A._position.x,s.y-A._position.y),delete A._updatingToChildren),Ff.superClass.setPosition.call(this,s)}},setWidth:function(s){return this.setSize(s,this.getHeight())},setHeight:function(S){return this.setSize(this.getWidth(),S)},setSize:function(U,N){1>U&&(U=1),1>N&&(N=1);var z=this;if(!z._updatingToChildren){2!==arguments.length&&(N=U.height,U=U.width);var w=z.getWidth(),Z=z.getHeight();if(U!==w&&Ff.superClass.setWidth.call(z,U),N!==Z&&Ff.superClass.setHeight.call(z,N),!Zn&&!z._updatingFromChildren){z._updatingToChildren=1;var X=U/w,j=N/Z;z._adjustChildScaleOrSize(X,j,"size"),delete z._updatingToChildren,z.updateFromChildren()}}},_adjustChildScaleOrSize:function(C,V,v){var Q=this;if(Q._syncSize){var D=Q.getPosition(),I=Q.getRotation();Q.getScale(),Q.eachChild(function(R){if(fr(R)){var M=R.getPosition(),Q=R.getRotation(),S=R.getWidth(),h=R.getHeight(),x=R.getScale(),F=x.x*S,i=x.y*h,z=new cq(Q,M.x,M.y,F,i);z.translate(-D.x,-D.y),z.rotate(-I),Q=d(z.b*Math.sign(F),z.a*Math.sign(F)),z.scale(C,V);var H,O,u,Z=T(Q);if(Math.abs(Z)<.001?(H=c(Q),O=z.b/H,u=-z.c/H):(O=z.a/Z,u=z.d/Z),"scale"===v)R.setScale(O/S,u/h);else if("size"===v){var n=O/x.x,l=u/x.y;R.setScale(Pb(O)*Math.abs(x.x),Pb(u)*Math.abs(x.y)),R.setSize(Math.max(.1,Math.abs(n)),Math.max(.1,Math.abs(l)))}z.rotate(I),z.translate(D.x,D.y),R.setPosition(z.tx,z.ty)}})}},_calcChangeFactor:function(d,p,E,$){var i,U,O,S;return i=L(d),U=L(E),O=i>U?i/U:U/i,i=L(p),U=L($),S=i>U?i/U:U/i,B(O,S)},setAnchor:function(){var I=this;if(!I._updatingToChildren){var f=I.getAnchor();if(Ff.superClass.setAnchor.apply(I,arguments),!Zn&&!I._updatingFromChildren&&I._syncSize){I._updatingToChildren=1;var z=I.getAnchor();I.getPosition();var u=I.getSize(),p=I.getScale(),N=I.getRotation(),m=-u.width*p.x*(f.x-z.x),q=-u.height*p.y*(f.y-z.y),J=c(N),F=T(N),Q=F*m-J*q,v=J*m+F*q;I.eachChild(function(L){if(fr(L)){var G=L.getPosition();L.setPosition(G.x-Q,G.y-v)}}),delete I._updatingToChildren}}},setRotation:function(i){var v=this;if(!v._updatingToChildren){var S=v.getRotation();if(Ff.superClass.setRotation.apply(v,arguments),!Zn&&!v._updatingFromChildren){v._updatingToChildren=1;var e=v.getPosition(),X=i-S;v.eachChild(function(j){if(fr(j)){var l=j.getMatrix();l.translate(-e.x,-e.y),l.rotate(X),l.translate(e.x,e.y);var z=Math.sign(j.getScale().x);j.setRotation(d(l.b*z,l.a*z)),j.setPosition(l.tx,l.ty)}}),delete v._updatingToChildren}}},setScale:function($,G){var h=this;if(!h._updatingToChildren){null==G&&(G=$.y,$=$.x);var d=h.getScale();if(L($)<.01&&($=.01*(Pb($)||Pb(d.x))),L(G)<.01&&(G=.01*(Pb(G)||Pb(d.y))),Ff.superClass.setScale.call(h,$,G),!Zn&&!h._updatingFromChildren){h._updatingToChildren=1;var H=$/d.x,t=G/d.y;h._adjustChildScaleOrSize(H,t,"size"),delete h._updatingToChildren,h.updateFromChildren()}}},getSerializableProperties:function(){var U=Ff.superClass.getSerializableProperties.call(this);return U.clickThroughEnabled=1,U.syncSize=1,U}});var Mq=C.Grid=function(){wj(C.Grid,this)};Lg("Grid",Dh,{IRotatable:!1,_icon:"grid_icon",_image:Y,getUIClass:function(){return Bj},setRotation:function(){},getCellRect:function(O,s){var U=this,B=U.s("grid.row.count"),V=U.s("grid.column.count");if(0>=B||0>=V||0>O||O>=B||0>s||s>=V)return Y;var z,G,M,E=U.getRect(),P=U.s("grid.row.percents"),J=U.s("grid.column.percents");if(fm(E,U,"grid.border",-1),P&&P._as&&(P=P._as),J&&J._as&&(J=J._as),P&&P.length===B){for(M=0,z=0;O>z;z++)M+=E.height*P[z];E.y+=M,E.height=E.height*P[O]}else E.height=E.height/B,E.y+=E.height*O;if(J&&J.length===V){for(G=0,z=0;s>z;z++)G+=E.width*J[z];E.x+=G,E.width=E.width*J[s]}else E.width=E.width/V,E.x+=E.width*s;return El(E,-U.s("grid.gap")),E}});var Pj=C.Text=function(){wj(Pj,this),this.setSize(100,50),this.s("text","TEXT")};Lg("Text",Dh,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return He},setWidth:function(I){I||(I=.001),Pj.superClass.setWidth.call(this,I)},setHeight:function($){$||($=.001),Pj.superClass.setHeight.call(this,$)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),Hq("__text__",{width:{value:100,isSafeFunc:!0,func:function(m){return m._width}},height:{value:50,isSafeFunc:!0,func:function(s){return s._height}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var en=C.Shape=function(){wj(en,this),this._59O=new rp};en.__de__=rf,Lg("Shape",Dh,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return yd},_22Q:function(){return Ek},getLength:function(A){return Um(om(this._59O,this._58O,A,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var k=this._58O;return k?new rp(k._as.slice(0)):k},setSegments:function(V){var x=this._58O;V=V?fk(V)?new rp(V.slice(0)):new rp(V._as.slice(0)):null,(x&&V&&x._as.join(",")!==V._as.join(",")||x!==V)&&(this._58O=V,this.fp("segments",x,V))},getPoints:function(){return this._59O},toPoints:function(){var k=this._59O;return new rp(k._as.slice(0))},setPoints:function($,t){var m=this,l=m._59O;$=$?fk($)?new rp($.slice(0)):new rp($._as.slice(0)):new rp;var a,e,Q,v,j,F;t&&(a=m.getPosition(),F=new cq(m.getRotation(),0,0,m.getScale().x,m.getScale().y)),(l&&$&&l._as.join(",")!==$._as.join(",")||l!==$)&&(m._59O=$,m.fs(),m.fp("points",l,$)),t&&(e=m.getPosition(),Q=e.x-a.x,v=e.y-a.y,j=F.tf(Q,v),m.setPosition(e.x-Q+j.x,e.y-v+j.y))},addPoint:function(t,s,i){var P=this.toPoints();P.add(t,s),this.setPoints(P,i)},setPoint:function(W,s,A){var n=this.toPoints();n.set(W,s),this.setPoints(n,A)},removePointAt:function(i){var _=this.toPoints();_.removeAt(i),this.setPoints(_)},setWidth:function(L){var C=this;if(1>L&&(L=1),!C._55I&&!Zn&&C.getWidth()){C._55I=1;var Y=C._position.x,V=L/C.getWidth(),X=C.toPoints(),j=new rp;X.each(function(A){j.add({x:(A.x-Y)*V+Y,y:A.y,e:A.e})}),C.setPoints(j),Qn(C,[V,0,0,1,Y*(1-V),0]),C.fs(),delete C._55I}en.superClass.setWidth.call(C,L)},setHeight:function(e){var J=this;if(1>e&&(e=1),!J._55I&&!Zn&&J.getHeight()){J._55I=1;var F=J._position.y,O=e/J.getHeight(),c=J.toPoints(),I=new rp;c.each(function(x){I.add({x:x.x,y:(x.y-F)*O+F,e:x.e})}),J.setPoints(I),Qn(J,[1,0,0,O,0,F*(1-O)]),J.fs(),delete J._55I}en.superClass.setHeight.call(J,e)},setAnchorElevation:function(H){var P=this;P._55I=!0;var F=P._updatingAnchor3d,C=!Zn&&!F;if(C){var s,K=H,D=P.getAnchorElevation(),p=P.getTall();s=p*(D-K),P.shiftPointsElevation(s)}var e=en.superClass.setAnchorElevation.apply(P,arguments);return F||delete P._55I,e},getShapeElevation:function(){var O=this,W=O._54O;return W-(O.getTall()||0)*(O._anchorElevation-.5)},setAnchor3d:function(A,P,j,s){var g,F=this;"number"==typeof A?g={x:A,y:P,z:j}:(g=A.length?{x:A[0],y:A[1],z:A[2]}:A,s=P),F._55I=!0,F._updatingAnchor3d=!0;var N=F.getDataModel();if(N&&N.beginTransaction(),!Zn){var f=F.getAnchor3d(),u=F.getSize(),Y=F.getTall(),e=u.width*(f.x-g.x),z=u.height*(f.z-g.z),_=Y*(f.y-g.y);s||F.shiftPoints(e,z,_);var p=F.p3()}var d=en.superClass.setAnchor3d.apply(F,arguments);if(!Zn&&s){var K=F.p3();F.shiftPoints(K[0]-p[0]+e,K[2]-p[2]+z,K[1]-p[1]+_)}return N&&N.endTransaction(),delete F._updatingAnchor3d,delete F._55I,d},setAnchor:function(T,t,G){var w=this;w._55I=!0;var q=w._updatingAnchor3d,j=!Zn&&!q;if(j){var Y,R,k;"number"==typeof T?k={x:T,y:t}:(k=T.length?{x:T[0],y:T[1]}:T,G=t);var M=w.getAnchor(),n=w.getSize();Y=n.width*(M.x-k.x),R=n.height*(M.y-k.y),G||w.shiftPoints(Y,R);var r=w.getPosition()}var u=en.superClass.setAnchor.apply(w,arguments);if(j){var I=w.getPosition();G&&w.shiftPoints(I.x-r.x+Y,I.y-r.y+R)}return q||delete w._55I,u},shiftPoints:function(p,A,s){var R=this,E=R.getElevation()||0,Q=R.toPoints(),D=new rp;Q.each(function(w){var G=w.e;s&&(G=(G==Y?E:G)+s),D.add({x:w.x+p,y:w.y+A,e:G})}),R.setPoints(D),R.fs()},shiftPointsElevation:function(m){return this.shiftPoints(0,0,m)},setPosition:function(S,u){var n,Y=this;if(!Y._28Q){if(Y._28Q=1,!Y._55I&&!Zn){n=2===arguments.length?{x:S,y:u}:S;var x=n.x-Y._position.x,K=n.y-Y._position.y;if(0===x&&0===K)return delete Y._28Q,void 0;Y._55I=1,Y.shiftPoints(x,K),Qn(Y,[1,0,0,1,x,K]),delete Y._55I}en.superClass.setPosition.apply(Y,arguments),delete Y._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var V=this;if(2!==V._59O.size())return!1;var t=V._58O;return t?2===t.size()&&1===t.get(0)&&2===t.get(1)?!0:!1:!0},fireShapeChange:function(){var S=this;if(!S._55I&&!Zn){var g=ig(S._59O);g&&(S._55I=1,S.setRect(g),delete S._55I)}S.fp(ak,!1,!0)},getSerializableProperties:function(){var $=en.superClass.getSerializableProperties.call(this);return $.segments=1,$.points=1,$.thickness=1,$.closePath=1,$}});var yr=C.Polyline=function(){wj(yr,this),this.s({"shape.background":null,"shape.border.width":2})};Lg("Polyline",en,{_icon:"polyline_icon",_22Q:function(){return Pr},getUIClass:function(){return uk},setClosePath:function(){},setTall:function(w){var Z=this;if(!Z._55I&&!Z._24Q&&!Zn&&Z.getTall()){Z._24Q=1;var N=Z._54O,I=w/Z.getTall();Z._59O.each(function(v){v.e=v.e==Y?N:(v.e-N)*I+N}),Z.fs(),delete Z._24Q}yr.superClass.setTall.call(Z,w)},setElevation:function(R){var A=this;if(!A._55I&&!A._24Q&&!Zn){A._24Q=1;var h=R-A._54O;A._59O.each(function(N){N.e==Y?N.e=R:N.e+=h}),A.fs(),delete A._24Q}yr.superClass.setElevation.apply(A,arguments)},fireShapeChange:function(){var g=this,a=g._59O;if(!g._55I&&!g._24Q&&!Zn){var _=a.size();if(_){var K=1,H=a.get(0),V=g._54O;H.e==Y&&(H.e=V);for(var s=H.e,F=0;_>K;K++){H=a.get(K),H.e==Y&&(H.e=V);var u=D(s,H.e),t=B(s+F,H.e);s=u,F=t-u}g._24Q=1,g.setTall(F),g.setElevation(s+F*g._anchorElevation),delete g._24Q}}yr.superClass.fireShapeChange.apply(g,arguments)}});var lo=C.SubGraph=function(){wj(lo,this)};Lg("SubGraph",Dh,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){lo.superClass._8I.call(this),this.eachChild(function(f){fr(f)&&f._8I()})}}),k.loadingRefGraph=0;var Vg=C.RefGraph=function(){wj(Vg,this)};Lg("RefGraph",Ff,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(r){var u=this._ref;this._ref=r,this.fp("ref",u,r),this.updateRef()},_21I:function(){Vg.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var t=this;if(k.loadingRefGraph++,t.clearChildrenFromDataModel(),k.loadingRefGraph--,t._ref&&t._dataModel){t._xhrLoadHandler&&(t._xhrLoadHandler.cancel=!0);var y=Zn,j=t._xhrLoadHandler=function(Z){if(Z&&t._dataModel){k.loadingRefGraph++;var $=t._pendingUpdateInfo={needToRestore:y};y&&($.position=t.p(),$.width=t.getWidth(),$.height=t.getHeight(),$.rotation=t.getRotation(),$.anchor=t.getAnchor(),$.scale=t.getScale()),t.p(0,0),t.setAnchor(.5,.5),t.setRotation(0),t.setScale(1,1);var D=k.parse(Z),C=t._dataModel.deserialize(D,t,{justDatas:!0});C.each(function(_){_._refGraph=t}),t.checkPendingUpdateInfo(),k.loadingRefGraph--,k.handleRefGraphLoaded(t,C,D)}};j.xhrLoadCalled=!1,k.load(t._ref,function(G){j.cancel||(j.xhrLoadCalled?j(G):an(function(){j(G)}))}),j.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var B=this,K=B._pendingUpdateInfo;if(!K)return B.onPendingUpdated&&(k.loadingRefGraph++,B.onPendingUpdated(),k.loadingRefGraph--),void 0;var i=!0;this.eachChild(function(g){(g._pendingCheckImageJSON||g._pendingUpdateInfo)&&(i=!1)}),i&&(k.loadingRefGraph++,B._pendingUpdateInfo=null,B.updateFromChildren(),K.needToRestore&&(B.setSize(K.width,K.height),B.setAnchor(K.anchor),B.setRotation(K.rotation),B.setScale(K.scale),B.p(K.position)),this.getParent()instanceof Vg&&this.getParent().checkPendingUpdateInfo(),B.onPendingUpdated&&B.onPendingUpdated(),k.loadingRefGraph--)},getSerializableProperties:function(){var g=Vg.superClass.getSerializableProperties.call(this);return g.ref=1,g}}),C.EdgeGroup=function(d,F){this._70O=d,this._siblings=F;for(var O,e,x=0,_=d.size(),u=j[Xb];_>x;x++)if(O=d.get(x).getStyle(Xb,!1),O!=Y){u=O;break}u==Y&&(u=!0);var n=k.edgeGroupAgentFunc;for(n&&(e=n(d),e&&e!==d.get(0)&&(d.remove(e),d.add(e,0))),x=0;_>x;x++)d.get(x).s(Xb,u)},Lg("EdgeGroup",$,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(Z){return this._70O.get(Z)},indexOf:function(w){return this._70O.indexOf(w)},each:function(R,N){this._70O.each(R,N)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(L,M){this._siblings.each(function(p){p._70O.each(L,M)})}});var ki=function(s,$,h){var M=wh[s]={type:s,action:$};if(h)for(var v in h)M[v]=h[v]};yl(k,{setConnectAction:ki,getConnectAction:function(A,G){if(!G){if(!A)return null;G=A.getCurrentConnectActionType()}return wh[G]},doConnectAction:function(o,z,E,n){n=n||o.getCurrentConnectActionType();var T=wh[n];if(!T)return!1;var p=T.action;return p?(z instanceof zr.Group?o.sm().getSelection().each(function(Z){p.call(null,o,Z,E)}):p.call(null,o,z,E),!0):!1},doDeleteConnectionAction:function(l,J,A){A=A||l.getCurrentConnectActionType();var H=wh[A];if(!H||!H.delete)return!1;var d=H.delete.action;return d?(J instanceof zr.Group?l.sm().getSelection().each(function(W){d.call(null,l,W)}):d.call(null,l,J),!0):!1}});var Kc=C.JSONSerializer=function(G,o){this.dm=this._dataModel=G,this._hierarchical=k.forceHierarchicalSerialization?!0:o==Y?G.isHierarchicalRendering():o};Lg("JSONSerializer",$,{ms_ac:["hierarchical"],serialize:function(p){return k.stringify(this.toJSON(),p)},toJSON:function(){var p=this,b=p.dm,I=b.getRoots(),S=p.json={v:k.getVersion(),p:{},a:{},d:[]},C=b.getSerializableAttrs();b.getInit()&&(S.init=b.getInit()),b.getName()&&(S.p.name=b.getName()),b.getBackground()&&(S.p.background=b.getBackground()),b.getLayers()&&(S.p.layers=b.getLayers()),b.getEnvmap()&&(S.p.envmap=b.getEnvmap()),S.p.autoAdjustIndex=b.isAutoAdjustIndex(),S.p.hierarchicalRendering=b.isHierarchicalRendering();for(var V in C){var O=b.a(V);O!==P&&p[Rf](V,O,S.a)}return Cr(S.a)&&delete S.a,p._hierarchical?I.each(p.serializeData,this):b.each(function(c){p.serializeData(c)}),b.fireSerializeEvent({type:"serialize",json:S}),b.getPostProcessingData()&&(S.p.postProcessingData=b.getPostProcessingData()),S},isSerializable:function(){return!0},getProperties:function(o){return o.getSerializableProperties()},getStyles:function(T){return T.getSerializableStyles()},getAttrs:function(h){return h.getSerializableAttrs()},serializeData:function(K){var z=this;if(z.isSerializable(K)&&!K._refGraph){var N,m,n,J,i=ns(K.getClassName())||K.getClass(),Q=new i,e={c:K.getClassName(),i:K.getId(),p:{},s:{},a:{}};z.json.d.push(e),N=z.getProperties(K);for(m in N)/^_/.test(m)?(n=K[m],"_width"!==m&&"_height"!==m||n!==P||((K.s("layout.h")||K.s("layout.v"))&&K.getHost()||K.s("fullscreen"))&&(n=K[m]="_width"===m?K.getWidth():K.getHeight()),n!==Q[m]&&z[Rf](m.substr(1),n,e.p)):(J=Gq(m),K[J]&&(n=K[J](),n!==Q[J]()&&z[Rf](m,n,e.p)));N=z.getStyles(K);for(m in N)n=K.s(m),n!==Q.s(m)&&z[Rf](m,n,e.s);N=z.getAttrs(K);for(m in N)n=K.a(m),n!==Q.a(m)&&z[Rf](m,n,e.a);Cr(e.p)&&delete e.p,Cr(e.s)&&delete e.s,Cr(e.a)&&delete e.a}z._hierarchical&&K.getChildren().each(z.serializeData,z)},serializeValue:function(J,G,i){Rb(G)?G={__a:G._as}:G instanceof uo&&(G={__i:G.getId()}),i[J]=G},deserialize:function(P,w,B){var z=this;return Xd(P)&&/.json$/.test(P)?(k.xhrLoad(P,function(_){z.deserializeImpl(_,w,B)}),void 0):z.deserializeImpl(P,w,B)},deserializeImpl:function(v,p,l){var B=this,j=B.dm;l=sr(l)?{setId:l}:Lj(l)?{finishFunc:l}:l||{},v=B.json=Xd(v)?k.parse(v):v,v.a&&v.a.onPreDeserialize&&!l.disableOnPreDeserialize&&v.a.onPreDeserialize(v,j,l.view),j.beginTransaction(),Zn++,B._82I={};var a=new rp,n=new rp,V=0,I=v.d.length;if(l.justDatas||(Lj(v.init)&&v.init(j),j.setInit(v.init)),!l.justDatas){for(var o in v.a)j.a(o,B[al](v.a[o]));for(var f in v.p)j[Bb(f)](v.p[f])}for(;I>V;V++){var t=v.d[V],R=ns(t.c),D=new R,H=t.i;l.setId&&H!=Y&&(D._id=H),B._82I[H]=D,a.add(D),n.add(t)}for(V=0;I>V;V++)B.deserializeData(a.get(V),n.get(V));return a.each(function(q){p&&!q.getParent()&&q.setParent(p),j.add(q)}),j.fireSerializeEvent({type:"deserialize",json:v}),Zn--,j.endTransaction(),v.a&&v.a.onPostDeserialize&&!l.disableOnPostDeserialize&&v.a.onPostDeserialize(v,j,l.view,a),l.finishFunc&&l.finishFunc(v,j,l.view,a),a},deserializeData:function(z,h){for(var P in h.p)z[Bb(P)](this[al](h.p[P]));for(P in h.s)z.s(P,this[al](h.s[P]));for(P in h.a)z.a(P,this[al](h.a[P]))},deserializeValue:function(a){if(Vl(a)){var _=a.__i;
if(_!=Y)return this._82I[_];if(_=a.__a,fk(_))return new rp(_)}return a}}),yl(fs,{serialize:function(D,c){return new Kc(this,c).serialize(D)},toJSON:function(R){return new Kc(this,R).toJSON()},deserialize:function(w,F,y){return new Kc(this).deserialize(w,F,y)}});var ir=C.OverlappingBox=function(c){this.gv=c,this.boxes={}};Lg("OverlappingBox",$,{clear:function(){var N,g,n=this.boxes;for(N in n)g=n[N],g.length=0},isOverlapping:function(X,M){var E,p,A=this,s=A.boxes,f=s[X];f?(E=f.rects,p=f.length):f=s[X]={rects:E=[],length:p=0};var N,e,M;for(N=0;p>N;N++)if(e=E[N],e.x<M.x+M.w&&e.x+e.w>M.x&&e.y<M.y+M.h&&e.h+e.y>M.y)return!0;return E.length<=p?(E.push(M),f.length++):E[f.length++]=M,!1}}),yl(k,{fetch:function(h,J){var s="GET",E=!1,P=null,r="";J&&(s=J.method||"GET",E=J.sync,r=J.url,P=J.data||null),h.open(s,r,!E),J.responseType?h.responseType=J.responseType:J.overrideMimeType&&h.overrideMimeType(J.overrideMimeType),h.send(P)},convertImageSrc:function(n,z){z&&"function"==typeof z||(z=function(){}),z(n)}});var If=C.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};Lg("Request",$,{_responseType:null,_overrideMimeType:"text/plain",send:function(J){var Z=this._xhr,L=this.onload,V=this.onerror;this.getResponseType()?J.responseType=this.getResponseType():this.getOverrideMimeType()&&(J.overrideMimeType=this.getOverrideMimeType()),Z.onload=L,Z.onerror=V,k.fetch(Z,J)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(C){this._responseType=C},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(I){this._overrideMimeType=I},getResponseText:function(){var R=this._xhr;return R.response||R.responseText}}),Mk.GraphView=function(E){var p=this;p._24I={},p._34I=new rp,p._25I={},p._56I={},p._view=kk(1,p),p._canvas=eq(p._view),p.dm(E?E:new fs),this._coreInteractor=new zd(this),p.setEditable(!1),p.setScrollBarVisible(k.graphViewScrollBarVisible)},Gd("GraphView",$,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Yq,bb,bk,ks,"resettable","editInteractor",qn,"pannable","rectSelectable","autoScrollZone",df,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_resettable:k.graphViewResettable,_pannable:k.graphViewPannable,_rectSelectable:k.graphViewRectSelectable,_autoScrollZone:k.graphViewAutoScrollZone,_rectSelectBackground:k.graphViewRectSelectBackground,_rectSelectBorderColor:k.graphViewRectSelectBorderColor,_editPointSize:k.graphViewEditPointSize,_editPointBorderColor:k.graphViewEditPointBorderColor,_editPointBackground:k.graphViewEditPointBackground,_scrollBarColor:Ge,_scrollBarSize:Yd,_autoHideScrollBar:Vn,_autoMakeVisible:nj,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(t){this._dataModel.setLayers(t)},setEditable:function(G){var U=this,O=U.__interactorMap__;if(!O){var V=Mk.XEditInteractor;O=U.__interactorMap__={scrollBar:new Zm(U),select:new Yl(U),edit:V?new V(U):new Qr(U),move:new Zq(U),"default":new Gi(U),touch:new pe(U,{editable:!1})}}G?(U._uieditable=!0,U.setInteractors([O.scrollBar,O.select,O.edit,O.move,O.default,O.touch])):(U._uieditable=!1,U.setInteractors([O.scrollBar,O.select,O.move,O.default,O.touch]))},getCanvas:function(){return this._canvas},_33I:function(f){var G=f.getUIClass();return G?new G(this,f):Y},getDataUI:function(F){var G=this,p=G._25I[F._id];return p===P&&(p=G._33I(F),G._25I[F._id]=p),p},getNodeRect:function($){return k.getNodeRect(this,$)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(P){var k=this.getDataUI(P);return k?(k._79o(),k._78o):null},getEdgeSourcePosition:function(B){var N=this,R=N.getDataUI(B),I=R.s,f=R._data._40I;return tq(N,f,I("edge.source.position"),I("edge.source.offset.x"),I("edge.source.offset.y"),I("edge.source.anchor.x"),I("edge.source.anchor.y"))},getEdgeTargetPosition:function(m){var u=this,F=u.getDataUI(m),L=F.s,i=F._data._41I;return tq(u,i,L("edge.target.position"),L("edge.target.offset.x"),L("edge.target.offset.y"),L("edge.target.anchor.x"),L("edge.target.anchor.y"))},invalidateAll:function(s){var V=this;if(s){for(var p in V._25I){var v=V._25I[p];v&&v.dispose()}V._25I={},V._56I={},V._24I={},V._34I.clear(),V.redraw()}else V.dm().each(function(t){V.invalidateData(t)})},invalidateSelection:function(){var o=this;o.sm().each(function(C){o.invalidateData(C)})},invalidateData:function(a){var t=this;t._24I[a._id]=a,t._21Q(a),t.iv()},_21Q:function(L){var S=this,w=S._24I;if(ad(L)&&Lf[L.s(_r)]){var K=L.getSourceAgent();K&&K.getAgentEdges().each(function(m){w[m._id]=m}),K=L.getTargetAgent(),K&&K.getAgentEdges().each(function(g){w[g._id]=g}),S.iv()}},redraw:function(o){var h=this;h._32I||(o?h._34I.add(o):(h._32I=1,h._34I.clear()),h.iv())},each:function(j,y){var e,Z,g,l=0,b=this.getLayers(),H=this._dataModel,s=H._datas._as,I=s.length;if(b){for(var h=b.length;h>l;l++)if(g=b[l],Vl(g)&&(g=g.name),H.isHierarchicalRendering()){var D=function(a){return a._layer===g?y?j.call(y,a):j(a):void 0};if(this._dataModel.eachByHierarchical(D)===!1)return}else for(var n=0;I>n;n++)if(e=s[n],e._layer===g&&(Z=y?j.call(y,e):j(e),Z===!1))return}else if(H.isHierarchicalRendering())this._dataModel.eachByHierarchical(j,null,y);else for(;I>l;l++)if(e=s[l],Z=y?j.call(y,e):j(e),Z===!1)return},reverseEach:function(S,M){var v,F,x,h,f=this._dataModel,p=f._layers,I=f._datas._as,E=I.length;if(p){for(v=p.length-1;v>=0;v--)if(h=p[v],Vl(h)&&(h=h.name),f.isHierarchicalRendering()){var t=function(v){return v._layer===h?M?S.call(M,v):S(v):void 0};if(f.reverseEachByHierarchical(t)===!1)return}else for(var Q=E-1;Q>=0;Q--)if(F=I[Q],F._layer===h&&(x=M?S.call(M,F):S(F),x===!1))return}else if(f.isHierarchicalRendering())f.reverseEachByHierarchical(S,null,M);else for(v=E-1;v>=0;v--)if(F=I[v],x=M?S.call(M,F):S(F),x===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var E=this,d=E._84I;if(!d){var p=this.dm().a("width"),y=this.dm().a("height");p>0&&y>0?E._84I={x:0,y:0,width:p,height:y}:(E.each(function(Z){E.isVisible(Z)&&(d=Si(d,E.getDataUIBounds(Z)))}),E._84I=d?d:Zc)}return E._84I},getScrollRect:function(){return Si(this.getContentRect(),this._29I)},makeCenter:function(B,z,_){var I=this;if(!I.getWidth()||!I.getHeight())return _||an(I.centerData,I,[B,z,!0],500),void 0;I.makeVisible(B),I.validate();var D=I.getDataUIBounds(B);if(D){var S=I.getWidth(),W=I.getHeight(),f=D.x+D.width/2,v=D.y+D.height/2,p=-f*I._zoom+S/2,l=-v*I._zoom+W/2;I.setTranslate(p,l,z)}},fitData:function(l,z,F,x,Z){var v=this;if(!v.getWidth()||!v.getHeight())return Z||an(v.fitData,v,[l,z,F,x,!0],500),void 0;var W=function(){v.makeVisible(l),v.validate();var c=v.getDataUIBounds(l);c&&(c=aq(c),El(c,F==Y?20:F),v.fitRect(c,z,x))};z?k.callWhenLoaded(W):W()},fitContent:function(T,L,z,g){var u=this;if(!u.getWidth()||!u.getHeight())return g||an(u.fitContent,u,[T,L,z,!0],500),void 0;var f=function(){u.validate();var w=aq(u.getContentRect());El(w,L==Y?20:L),u.fitRect(w,T,z)};T?k.callWhenLoaded(f):f()},fitRect:function(V,q,e){var n=this,H=n.getWidth(),w=n.getHeight(),d=V.x+V.width/2,Y=V.y+V.height/2,Z=D(H/V.width,w/V.height),K=n._zoom,A=-d*K+H/2,C=-Y*K+w/2;0===Z||isNaN(Z)||(e&&(Z=D(1,Z)),q?(n._65I&&(delete n._65I.finishFunc,n._65I.stop(!0)),n._14o&&n._14o.stop(!0),n.setTranslate(A,C,{finishFunc:function(){n.setZoom(Z,q)}})):(n.setTranslate(A,C),n.setZoom(Z)))},toCanvas:function(E,G){G=G||this._zoom,this.validateImpl();var Z=this,U=Z.getContentRect();U.width||(U.width=10),U.height||(U.height=10);var w=eq(),u=U.x*G,i=U.y*G,N=U.width*G,H=U.height*G;hn(w,N,H,1);var P=sf(w);return E=E||this._dataModel.getBackground(),E&&_e(P,0,0,N,H,E),Jd(P,-u,-i),P.scale(G,G),Z._42(P),P.restore(),w},toDataURL:function(x,y,E){return this.toCanvas(x,E).toDataURL(y||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(q,Q){var E=this,l=this.__htmlOrderList,B=[];if(E._93db(q,Q),E.each(function(J){var e=E.getDataUI(J);if(e){var x=E._56I[J._id],n=e._htmlView;if(x){var r=e._79o();if(n=e._htmlView,C.HtmlNode&&J instanceof C.HtmlNode)e._42(q);else{var $=E.getViewRect(),d=n&&n.layoutHTML;!Q||po(Q,r)?(d&&(n.layoutHTML(),e.__outerLayout&&delete e.__outerLayout),e._42(q)):po($,r)||!d||e.__outerLayout||(n.layoutHTML(),e.__outerLayout=!0)}}n&&(B.push(n),n.getView&&(n=n.getView()),n.style.display=x?"block":Cp)}}),l&&B.length>0){var H=!1;if(l.length!==B.length)H=!0;else for(var t=0;t<B.length;t++)if(B[t]!==l[t]){H=!0;break}H&&(B.forEach(function(i){E.appendHTML(i,!0)}),this.__htmlOrderList=B)}else this.__htmlOrderList=B;E._92db(q,Q)},validateImpl:function(){this.tryUpdateRootData();var S,D,R,U,h,x=this,X=x.tx(),N=x.ty(),T=x._zoom,l=x._canvas,W=this.getWidth(),u=this.getHeight(),c=x._29I,m={x:-X/T,y:-N/T,width:W/T,height:u/T},p={},k=x._34I,F=x._24I,e=x._32I,n=x._23I;x._24I={},(W!==l.clientWidth||u!==l.clientHeight)&&(hn(l,W,u),e=1),e||Sj(m,c)||(e=1),x._29I=m,x.each(function(P){D=P._id;var i=p[D]=x.isVisible(P);i!==x._56I[D]&&(F[D]=P,R=x.getDataUI(F[D]),R&&R._84o(i),x._84o(P,i))},x);for(D in F)R=x.getDataUI(F[D]),R&&(!e&&x._56I[D]&&(h=R._79o(),h&&k.add(h)),R.invalidate()),x._83I=1;if(x._56I=p,!e)for(D in F)p[D]&&(R=x.getDataUI(F[D]),R&&(h=R._79o(),h&&k.add(h)));if(e?U=m:(k.each(function(T){po(m,T)&&(U=Si(U,T))}),U&&(El(U,B(1,1/T)),U.x=s(U.x*T)/T,U.y=s(U.y*T)/T,U.width=_(U.width*T)/T,U.height=_(U.height*T)/T,U=as(m,U))),x._74O=U,U){S=sf(l);var t=U.x,d=U.y,J=U.width,w=U.height;t=Math.floor((t*T+X)*es),d=Math.floor((d*T+N)*es),J=Math.ceil(J*T*es)+1,w=Math.ceil(w*T*es)+1,S.beginPath(),S.rect(t,d,J,w),S.clip(),S.clearRect(t,d,J,w),$r(S,X,N,T),x._42(S,U),S.restore(),delete x._74O}if(k.clear(),delete x._32I,n&&W>0&&u>0){var R=x.getDataUI(n);if(R){var h=R._79o(),H=x._29I,G=H.x,Q=H.y,r=H.width,O=H.height,T=x._zoom;h&&!po(h,H)&&(h.x+h.width<G&&x.tx(-h.x*T),h.x>G+r&&x.tx(-(h.x+h.width-r)*T),h.y+h.height<Q&&x.ty(-h.y*T),h.y>Q+O&&x.ty(-(h.y+h.height-O)*T))}delete x._23I}x._83I&&(delete x._83I,delete x._84I),x._98O(),Cr(x._24I)||an(x.iv,x)},tryUpdateRootData:function(){var J,L=this.getFullscreenDatas();for(var y in L)J=L[y],this.scaleRootData(J)},scaleRootData:function($){var y=$.s("fullscreen");if("uniform"===y||"fill"===y){$.setRotation(0);var r,o=$.s("fullscreen.gap")||0,l=this.getWidth()-2*o,Z=this.getHeight()-2*o,t=$.getAnchor(),d=$.getScaledSize(),e=d.width,P=d.height,w=$.s("fullscreen.lock");if(w)return"uniform"===y?l/Z>e/P?(r=Z/P,e=P*l/Z):(r=l/e,P=e*Z/l):"v"===w?(r=Z/P,e=l/r,$.setWidth(e)):(r=l/e,P=Z/r,$.setHeight(P)),this.setZoom(r),this.tx(o-($.getX()-t.x*e)*r),this.ty(o-($.getY()-t.y*P)*r),void 0;var x=this.tx(),b=this.ty();r=this._zoom;var O={x:(-x+o)/r,y:(-b+o)/r,width:l/r,height:Z/r};if("uniform"===y){var i=e/P,C=Math.min(O.width,O.height*i),V=C/i;O.x+=.5*(O.width-C),O.y+=.5*(O.height-V),O.width=C,O.height=V}$.setSize(O.width/$.getScaleX(),O.height/$.getScaleY()),$.setPosition(O.x+t.x*O.width,O.y+t.y*O.height)}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function($){var j=this;$!==j.isScrollBarVisible()&&($?(Hb(j._view,j._79O=Aj()),Hb(j._79O,j._27I=Aj()),Hb(j._79O,j._28I=Aj())):(rn(j._79O),delete j._79O,delete j._27I,delete j._28I),j.fp("scrollBarVisible",!$,$))},showScrollBar:function(){var P=this;P._79O&&(P._85I||(N(function(){P._86I()},dl),P.iv()),P._85I=new Date)},_86I:function(){var F=this;if(F._85I){var w=new Date,U=w.getTime();U-F._85I.getTime()>=dl?(delete F._85I,F.iv()):N(function(){F._86I()},dl)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var R=this,n=this._27I,M=this._28I;if(R._79O){if(R._autoHideScrollBar&&!R._85I)return n.style.visibility=Wb,M.style.visibility=Wb,void 0;var x=R.getScrollBarColor(),B=R._zoom,Z=R.getScrollBarSize(),v=R.getViewRect(),Q=R.getScrollRect(),d=v.height*B,H=Q.height*B,K=v.width*B-Z-2,T=d*((v.y-Q.y)*B/H),G=d*(d/H),k=n.style;H-.5>d?(Qd>G&&(T=T+G/2-Qd/2,0>T&&(T=0),T+Qd>d&&(T=d-Qd),G=Qd),dk(n,K,T,Z,G),k.visibility=hq,k.background=x,k.borderRadius=Z/2+Md):k.visibility=Wb;var F=v.width*B,D=Q.width*B,T=v.height*B-Z-2,K=F*((v.x-Q.x)*B/D),o=F*(F/D),k=M.style;D-.5>F?(Qd>o&&(K=K+o/2-Qd/2,0>K&&(K=0),K+Qd>F&&(K=F-Qd),o=Qd),dk(M,K,T,o,Z),k.visibility=hq,k.background=x,k.borderRadius=Z/2+Md):k.visibility=Wb}},setDataModel:function(Y){var w=this,b=w._dataModel,M=w._selectionModel;b!==Y&&(b&&(b.ump(w.handleDataModelPropertyChange,w),b.umm(w.handleDataModelChange,w),b.umd(w.handleDataPropertyChange,w),b.removeIndexChangeListener(w._75O,w),b.removeHierarchyChangeListener(w.handleHierarchyChange,w),M||b.sm().ums(w.handleSelectionChange,w)),w._dataModel=Y,Y.mp(w.handleDataModelPropertyChange,w),Y.mm(w.handleDataModelChange,w),Y.md(w.handleDataPropertyChange,w),Y.addIndexChangeListener(w._75O,w),Y.addHierarchyChangeListener(w.handleHierarchyChange,w),M?M._21I(Y):Y.sm().ms(w.handleSelectionChange,w),w.invalidateAll(!0),w.fp(br,b,Y),w._canvas.style.background=Y.getBackground()||"")},getLayersInfo:function(){if(this._layersInfo===P){var S=this.getLayers();S?(this._layersInfo={},S.forEach(function(H){var J=Vl(H)?H.name:H;this._layersInfo[J]=H},this)):this._layersInfo=null}return this._layersInfo},calculateAttachPoint:function(){var p=new xl,V=new xl,h=new xl;return function(Q,t){var N=this.getAttachPoints(Q);if(!N||!N.length)return null;h.set(t.x,t.y);for(var L,a,l,K,Z=1/0,o=0,x=N.length;x>o;o++)l=N[o],V.x=l.x,V.y=l.y,p.x=l.offsetX||0,p.y=l.offsetY||0,K=tq(this,Q,0,p.x,p.y,V.x,V.y),a=h.distanceToSquared(K),Z>a&&(L=o,Z=a);Z=Math.sqrt(Z);var H=this.getAttachStyle(Q);if("close"===H){var S=Q.s("attach.close.threshold")/this._zoom;if(Z>S)return null}return{index:L,distance:Z,info:N[L]}}}(),getAttachPoints:function(Q){var N=Q.s("attach.points");if(N)return N;var d=km(Q._image);return d?hg(d.attachPoints,Q,this)||null:void 0},getAttachStyle:function(H){var a=H.s("attach.style");if(a)return a;var i=km(H._image);return i?hg(i.attachStyle,H,this)||"close":void 0},updateLayers:function(){this._layersInfo=P,this.invalidateSelection(),this.redraw()},handleDataModelPropertyChange:function(Z){if("background"===Z.property){var o=this._canvas.style.background,M=Z.newValue||"";this._canvas.style.background=M,this.fp("canvasBackground",o,M)}else"a:width"===Z.property||"a:height"===Z.property?(this._83I=1,this.redraw()):"layers"===Z.property?this.updateLayers():"hierarchicalRendering"===Z.property&&this.redraw()},handleDataPropertyChange:function(Q){this.dm().isHierarchicalRendering()&&"parent"===Q.property&&Q.data.hasChildren()&&this.redraw(),this.invalidateData(Q.data)},onPropertyChanged:function(Q){var _=this,O=Q.property;if(_.redraw(),"zoom"===O){var R=_.sm().getSelection();R.size()&&R.each(function(b){b.invalidate()})}uf[O]?_.showScrollBar():O===qn&&_.onCurrentSubGraphChanged(Q)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(X){var I=this,r=X.kind,Z=X.data;if(I._83I=1,"add"===r)I.invalidateData(Z),ad(Z)&&Z.getEdgeGroup()&&Z.getEdgeGroup().eachSiblingEdge(I.invalidateData,I);else if(r===Kn){I._21Q(Z);var k=Z._id,p=I._25I[k];if(p){if(I._56I[k]){var e=p._79o();e&&I.redraw(e)}p.dispose(),delete I._25I[k],delete I._24I[k],delete I._56I[k]}Z===I._currentSubGraph&&I.setCurrentSubGraph(Y)}else r===Qb&&(I.invalidateAll(!0),I.setCurrentSubGraph(Y))},_75O:function(C){this.invalidateData(C.data)},handleHierarchyChange:function(M){this.dm().isHierarchicalRendering()&&M.data.hasChildren()&&this.redraw(),this.invalidateData(M.data)},adjustIndex:function(I){var Y=this;if(Y.isVisible(I)){Y.dm().beginTransaction();for(var G=I;G._parent&&Y.isVisible(G._parent);)G=G._parent;G&&G!==I&&Y._dataModel.adjustIndex(G),Y._dataModel.adjustIndex(I),Y.dm().endTransaction()}},getImage:function(v){return v.getImage?v.getImage():P},getSelectWidth:function(C){var M=km(this.getImage(C));return M&&hg(M.disableSelectedBorder,C,this)?0:C.s("select.width")},getSelectColor:function(V){return V.s("select.color")},isSelectable:function(U,w){if(this.isSelected(U))return!0;if(!w&&U.getParent()instanceof Ff&&this.isSelectable(U.getParent(),!0)&&U.getParent().isSyncSize())return!1;var e=this.getLayersInfo();if(e){var h=e[U._layer];if(h&&h.selectable===!1)return!1}return U.s("2d.selectable")&&this.sm().isSelectable(U)},isMovable:function(H){var m=this;if(ad(H)&&H.getStyle(_r)!==Ap)return!1;var e=this.getLayersInfo();if(e){var S=e[H._layer];if(S&&S.movable===!1)return!1}return H.s("2d.movable")?m._movableFunc?m._movableFunc(H):!0:!1},isEditable:function(i){var t=this;if(C._uiSerializing)return t._uieditable;if(!t._editInteractor||!t.isSelected(i))return!1;if(lk(i)){var L=t.getDataUI(i);if(!L||L._88I)return!1}if(ad(i)&&i.getStyle(_r)!==Ap)return!1;var l=this.getLayersInfo();if(l){var V=l[i._layer];if(V&&V.editable===!1)return!1}return i.s("2d.editable")?t._editableFunc?t._editableFunc(i):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(D){return fr(D)&&0!==D.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(D):!0},isRectEditable:function(D){return this._rectEditableFunc?this._rectEditableFunc(D):!0},isAnchorEditable:function(R){return this._anchorEditableFunc?this._anchorEditableFunc(R):!0},isRotationEditable:function(w){return w.setRotation&&w.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(w):!0:!1},getRotationPoint:function(B){var y=B.getAnchor(),D=B.getScale(),X=this._zoom,v=le(B.getRotation(),0,-B.getHeight()*D.y*y.y-(D.y<0?-1:1)*(hc?32:16)/X),m=B.p();return v.x+=m.x,v.y+=m.y,v},getLogicalPoint:function(K){var W=this;return Zr(K,W._canvas,W.tx(),W.ty(),W._zoom,W._zoom)},getScreenPoint:function(S,m){var x,e=this;return"object"==typeof S?S.x!==P?(x=S.x,m=S.y):(x=S[0],m=S[1]):x=S,wf(x,m,e._canvas,e.tx(),e.ty(),e._zoom,e._zoom)},getSelectedDataAt:function(y){var e=this;return this.getDataAt(y,function(t){return e.isSelected(t)})},getDataInfoAt:function(i,N,G){var z,d=this.lp(i),f=this.getDataAt(d,N,G);if(f){var s=this.getDataUI(f);z={data:f,ui:s,point:d};var W=s._38o;if(W){var t=W.icons;for(var K in t){var m=t[K],M=W.rects[K];if(M)for(var D=hg(m.names,f,this),$=D?D.length:0,U=M.rotation,x=$-1;x>=0;x--){var B=D[x],w=M[x];if(Gr(w,d,U))return z.part="icons",z.name=K,z.icon=B,z.rect=w,z.index=x,z.rotation=U,z}}}if(this.isNoteVisible(f)){if(s.note2Info&&Gr(s.note2Info.clickRect,d,Y,s.note2Info.scale))return z.part="note2",z;if(s.noteInfo&&Gr(s.noteInfo.clickRect,d,Y,s.noteInfo.scale))return z.part="note",z}if(this.isLabelVisible(f)){if(s.label2Info&&Gr(s.label2Info.rect,d,s.label2Info.rotation,s.label2Info.scale))return z.part="label2",z;if(s.labelInfo&&Gr(s.labelInfo.rect,d,s.labelInfo.rotation,s.labelInfo.scale))return z.part="label",z}if(f.isInRect&&f.isInRect(d))return z.part="body",z}return z},getDataAt:function(h,E,K){h.target&&(h=this.lp(h));var y,s=this._zoom;return this.reverseEach(function(R){return(E?E(R):this.isSelectable(R))&&this.rectIntersects(R,bn(h.x,h.y,K,s))?(y=R,!1):void 0},this),y},getIconInfoAt:function(B,I){var H=this;if(B.target&&(B=H.lp(B)),I||(I=H.getDataAt(B)),I){var d=H.getDataUI(I);if(d&&d._38o){var x,M=d._38o,U=new rp;for(x in M.icons)U.add(x);for(var O=U.size()-1;O>=0;O--){x=U.get(O);for(var b=M.rects[x],s=b.rotation,P=b.length-1;P>=0;P--){var z=b[P],C=z.width,S=z.height,n={x:B.x-z.x-C/2,y:B.y-z.y-S/2};s!=Y&&(n=le(-s,n.x,n.y));var z={x:-C/2,y:-S/2,width:C,height:S};if(Gr(z,n))return{key:x,index:P,name:M.icons[x].names[P],rect:b[P],point:B,rotation:s,relativeRect:z,relativePoint:n,data:I}}}}}return Y},getDatasInRect:function(q,c,h){h===P&&(h=1);var i=this,s=new rp;return i.reverseEach(function(u){h&&!i.isSelectable(u)||(c?i.rectIntersects(u,q):i.rectContains(u,q))&&s.add(u)}),s},moveSelection:function(K,D){var X=this;X.dm().beginTransaction(),Dr(X.sm().toSelection(X.isMovable,X),K,D),X.dm().endTransaction()},moveDatas:function(R,L,o){var w=this;w.dm().beginTransaction(),R instanceof rp||(R=new rp(R)),Dr(R,L,o),w.dm().endTransaction()},getDataUIBounds:function(L){var G=this.getDataUI(L);return G?G._79o():Y},drawData:function(n,f,m){var j=this.getDataUI(f);if(j){var b=j._79o();(!m||po(m,b))&&(j._42(n),f instanceof C.Block&&f.eachChild(function(B){this.drawData(n,B,m)},this))}},getBoundsForGroup:function(P){return P.s(Jg)?this.getDataUIBounds(P):Y},isPixelPerfect:function(v){return v.s("pixelPerfect")},rectIntersects:function(P,R){this.validate();var e=Y;if(this._56I[P._id]){var V=this._25I[P._id];if(V){var t=V._79o();if(pq(R,t))e=!0;else if((R=as(R,t))&&(V.rectIntersects&&(e=V.rectIntersects(R)),e==Y)){if(!this.isPixelPerfect(P))return!0;var M=R.x,H=R.y,Q=R.width,A=R.height,s=this._zoom,b=k.hitMaxArea,w=Q*A*s*s;if(w>b){var u=Math.sqrt(b/w);s*=u}Q*=s,A*=s,2>Q&&(Q=2),2>A&&(A=2),M*=s,H*=s;var n=Ph(Q,A);Jd(n,-M,-H),n.scale(s,s),this._drawForChecking=!0,this.drawData(n,P,R),this._drawForChecking=!1;try{for(var i=0,W=n.getImageData(0,0,Q,A).data;i<W.length;i+=4)if(0!==W[i+3]){e=!0;break}n.restore()}catch(U){kc=Y,e=!1}}}}return e?!0:!1},rectContains:function(H,s){if(this._56I[H._id]){var l=this._25I[H._id];if(l)return pq(s,l._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(s){if(!k.isInput(s.target)){var T=this,c=T._focusData,D=c&&T._25I[c._id],e=0,y=T._dataModel._datas;if(!(c&&c._enabled&&c._editable&&D&&D.onKeyDown&&D.onKeyDown(s)===!0))if(9===s.keyCode&&(c&&(e=y.indexOf(c),Bm(s)?-1===--e&&(e=0):++e===y.size()&&(e=0)),T._focusData=c=y.get(e),T.sm().setSelection(c)),Lq(s)?T.selectAll():Qg(s)&&T.isResettable()&&T.reset(),T.sm().isEmpty()){if(T._editing)return;var C=T.tx(),t=T.ty(),z=!1,M=Bm()?100:10;Ml(s)&&(C-=M,z=!0),Kb(s)&&(t-=M,z=!0),Tb(s)&&(C+=M,z=!0),Db(s)&&(t+=M,z=!0),z&&T.setTranslate(C,t)}else{gq(s)&&T.handleDelete(s);var Y=Bm()?10:1;Ml(s)&&(T.moveSelection(-Y,0),T.fi({kind:"moveLeft"})),Kb(s)&&(T.moveSelection(0,-Y),T.fi({kind:"moveUp"})),Tb(s)&&(T.moveSelection(Y,0),T.fi({kind:"moveRight"})),Db(s)&&(T.moveSelection(0,Y),T.fi({kind:"moveDown"}))}}},handleScroll:function(G,H){if(vj(G),!this.getEditInteractor()){var h=this.getDataAt(G);if(h){var z=km(this.getImage(h));if(z&&hg(z.scrollable,h,this))return}}var l=this.lp(G);H>0?this.scrollZoomIn(l):0>H&&this.scrollZoomOut(l)},handlePinch:function(U,S,Q){this._68I||(S>Q?this.pinchZoomIn(U):this.pinchZoomOut(U))},checkDoubleClickOnNote:function(C,D){var G=this,A=G.lp(C),j=G.getDataUI(D),k=j.note2Info;return k&&D.s("note2.toggleable")&&Gr(k.clickRect,A)?(D.s(kf,!D.s(kf)),G.fi({kind:"toggleNote2",event:C,data:D}),!0):(k=j.noteInfo,k&&D.s("note.toggleable")&&Gr(k.clickRect,A)?(D.s(Pi,!D.s(Pi)),G.fi({kind:"toggleNote",event:C,data:D}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(r,Y){var P=this,_=P.getAutoScrollZone(),B=_/P.getZoom(),z=_/4,V=P._29I,w=P.lp(r),R={x:P.tx(),y:P.ty()};return w&&_>0&&V&&(w.x-V.x<B?P.translate(z,0):V.x+V.width-w.x<B&&P.translate(-z,0),w.y-V.y<B?P.translate(0,z):V.y+V.height-w.y<B&&P.translate(0,-z)),R.x=P.tx()-R.x,R.y=P.ty()-R.y,Y&&(Y.x+=R.x,Y.y+=R.y),R},getMoveMode:function(r,J){var o=J.s("2d.move.mode");return o?o:ii["88"]?"x":ii["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(N,f,J){var l=this;return"currentSubGraph"===f?{__i:N.getId()}:J.serializeProperty(N,f,l)},deserializeProperty:function(t,d,A){var P=this;if("currentSubGraph"===d){var U=P.dm(),b=U.__idMap;return b[t.__i]}return A.deserializeProperty(t,d,P)},setDefaultCursor:function(B,S){this._defaultCursor=B,S!==!1&&this.setCursor(B)},setCursor:function(U){"default"===U&&(U=this._defaultCursor||U);var L=this.getView().style;L.cursor=U,L.cursor="-webkit-"+U,L.cursor="-moz-"+U},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(H){return H===Y||k.getConnectAction(null,H)?(this._currentActionType=H,this.redraw(),!0):!1},isConnectActionVisible:function(j){var o=k.getConnectAction(this);if(!o)return!1;var t=o.visible;return Lj(t)&&(t=t(this,j)),t},isInteractive:function(C){var G=km(this.getImage(C));return G&&hg(G.interactive,C,this)?!0:C.s("interactive")},appendHTML:function(U,K){var h=this.getView();if(!(K||U&&U.parentNode!==h))return!1;var o=U.getView&&U.getView();return!K&&o&&o.parentNode===h?!1:U.isSelfViewEvent?(U.addToDOM(h),!0):(U.getView&&(U=U.getView()),this.isScrollBarVisible()?h.insertBefore(U,this.getView().lastChild):Hb(h,U),!0)},layoutHTML:function(y,N,l){var c,A=this,D=A._zoom;if(N.getView&&(c=N,N=N.getView()),N.style.position="absolute",l){var _=y.getRect();dk(c||N,A.tx()+_.x*D,A.ty()+_.y*D,_.width*D,_.height*D)}else{var Y=new Fj,_=y.getAnchorRect(),Q=y.getPosition(),X=y.getScale(),g=N.style;dk(c||N,_),Y.appendTranslate(A.tx(),A.ty()),Y.appendScale(D,D),Y.append(new Fj(y.getRotation(),Q.x,Q.y,X.x,X.y)),Fq(g,"transform","matrix("+Y.a.toFixed(5)+", "+Y.b.toFixed(5)+", "+Y.c.toFixed(5)+",\n    "+Y.d.toFixed(5)+", "+Y.tx.toFixed(5)+", "+Y.ty.toFixed(5)+")"),Fq(g,"transformOrigin",(-_.x).toFixed(5)+"px "+(-_.y).toFixed(5)+"px"),N.maxtrixAppend=Y.invert().translate(-_.x,-_.y)}}});var hd=function(V,N){var o=this;o.gv=V,o.s=function(y){return N.getStyle(y)},o._data=N,o._87I=new rp};jq(hd,$,{_6I:Y,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var v=this,n=v.gv.isSelected(v._data);return!n||v.isShadowed()?0:v.gv.getSelectWidth(v._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(x){var v=this._data,c=this.gv.getBodyColor(v);return c?c:x?v.getStyle(x):Y},_2Q:function(K){return this.s(K)},_1Q:function(f,v,h,F){var r=this.s,N=r("2d.gray"),$=r(v+".dash.color");if(N&&($=k.toGrayColor($)),f.strokeStyle=$,f.lineWidth=h,f.stroke(),r(v+".dash.3d")){var T=r(v+".dash.3d.color");wq(f,$,N?k.toGrayColor(T):T,h,this.gv._zoom,r(v+".dash.3d.accuracy"))}zi(f,F)},invalidate:function(){this._6I=Y},_79o:function(){var d=this;if(!d._6I){var J=d._data,N=d.gv;d.labelInfo=d.label2Info=d.noteInfo=d.note2Info=d._38o=Y,d._87I.clear(),d.interactiveInfo=N.isInteractive(J)?{}:Y,d._3O(),d._55O=N.isEditable(J)?{_42O:N.isRectEditable(J),_43O:N.isPointEditable(J),_56O:N.isRotationEditable(J)}:Y,d._6I=d._81o()}return d._6I},_3O:function(){},getPosition:function(){return Zc},_68o:function(y,E){y&&this._87I.add(wc(y,E))},_81o:function(){var F=this,y=F.s;F._24O(lb,"getLabel"),F._24O(Jl,"getLabel2"),F._26O(Di,"getNote"),F._26O(pi,"getNote2"),F._15O(),F._55O&&F._48O();var d;if(F._87I.each(function(S){d=Si(d,S)}),d&&F.isShadowed()){var U=aq(d);U.x+=y("shadow.offset.x"),U.y+=y("shadow.offset.y"),El(U,y("shadow.blur")),d=Si(d,U)}return F._87I.clear(),d},_42:function(C){var y=this,f=y._data,o=y.gv,_=y.s,P=_("opacity"),z=this.isShadowed();if(z){var J=C.shadowOffsetX,n=C.shadowOffsetY,T=C.shadowBlur,X=C.shadowColor,s=o.getZoom();C.shadowOffsetX=_("shadow.offset.x")*s,C.shadowOffsetY=_("shadow.offset.y")*s,C.shadowBlur=_("shadow.blur")*s,C.shadowColor=y.getSelectColor()}if(P!=Y){var r=C.globalAlpha;C.globalAlpha=P}y._80o(C),o.isLabelVisible(f)&&((!o._drawForChecking||_("label.selectable"))&&qd(C,y.labelInfo),(!o._drawForChecking||_("label2.selectable"))&&qd(C,y.label2Info)),o.isNoteVisible(f)&&(pk(C,y.noteInfo),pk(C,y.note2Info)),y._99O(C),P!=Y&&(C.globalAlpha=r),z&&(C.shadowOffsetX=J,C.shadowOffsetY=n,C.shadowBlur=T,C.shadowColor=X)},_80o:function(){},_47O:function(){},_24O:function(t,F){var A=this,X=A._data,j=A.gv,p=A.s,T=j[F](X);if(T!=Y){var o=p(t+".scale"),_=p(t+".max"),l=p(t+".position"),f=A[t+"Info"]={label:T,scale:o,color:j[F+"Color"](X),font:p(t+".font"),opacity:p(t+".opacity"),align:p(t+".align"),rotation:A.getRotation(p(t+".rotation"),!1,l),background:j[F+"Background"](X)},U=Dc(f,T);_>0&&_<U.width&&(f.labelWidth=U.width,U.width=_),1!==o&&(U.width*=o,U.height*=o);var y=A.getPosition(l,p(t+".offset.x"),p(t+".offset.y"),U,p(t+".position.fixed"));if(U.x=y.x-U.width/2,U.y=y.y-U.height/2,A._68o(f.rect=U,f.rotation),1!==o){var Q=U.width/o,R=U.height/o;f.rect={x:y.x-Q/2,y:y.y-R/2,width:Q,height:R}}}},_26O:function(r,Q){var $=this,l=$.gv,P=$._data,z=$.s,p=l[Q](P);if(p!=Y){var X,G,Z=z(r+".scale"),J=$[r+"Info"]={note:p,scale:Z,data:P,view:l,expanded:z(r+".expanded"),font:z(r+".font"),color:z(r+".color"),opacity:z(r+".opacity"),align:z(r+".align"),icon:z(r+".icon"),backgroundImage:z(r+".backgroundImage"),borderWidth:z(r+".border.width"),borderColor:z(r+".border.color"),background:l[Q+"Background"](P)},S=$.getPosition(z(r+".position"),z(r+".offset.x"),z(r+".offset.y")),h=S.x,E=S.y;if(J.expanded){var c,k=z(r+".max"),m=z(r+".backgroundImage");m?(m=km(m),c={width:re(m,P),height:dp(m,P)}):c=Dc(J,p),c.width+=6,c.height+=2,k>0&&k<c.width&&(J.labelWidth=c.width,c.width=k),X=c.width,G=c.height+8,J.clickRect={x:h-X*Z/2,y:E-G*Z,width:X*Z,height:G*Z*c.height/G}}else{var H=z(r+".icon");H?(H=km(H),X=re(H,P),G=dp(H,P)):(X=12,G=18),J.clickRect={x:h-X*Z/2,y:E-G*Z,width:X*Z,height:G*Z}}J.rect={x:h-X/2,y:E-G*Z/2-G/2,width:X,height:G};var a=_(J.borderWidth/2)*Z;$._68o({x:h-X*Z/2-a,y:E-G*Z-a,width:X*Z+2*a,height:G*Z+2*a})}},_48O:function(){},_99O:function(I){var T=this,r=T._38o;if(r){var M=T.gv,V=T._data,J=r.icons,o=T.interactiveInfo;o&&(o._38o={});for(var O in J){var f=J[O],L=r.rects[O];if(L){o&&(o._38o[O]=[]);var G=hg(f.opacity,V,M),w=hg(f.names,V,M),K=w?w.length:0,Q=L.rotation;if(G!=Y){var E=I.globalAlpha;I.globalAlpha*=G}for(var c=0;K>c;c++){var y=w[c],x=km(y),j=L[c];if(Q){var d=j.x+j.width/2,q=j.y+j.height/2;I.save(),Jd(I,d,q),hh(I,Q),Jd(I,-d,-q)}o&&o._38o[O].push(I.interactiveInfo={compInfos:[],matrix:Q?new Fj(Q,d,q).appendTranslate(-d,-q):new Fj}),Cq(I,x,hg(f.stretch,V,M),j.x,j.y,j.width,j.height,T._data,T.gv),I.interactiveInfo=Y,Q&&I.restore()}G!=Y&&(I.globalAlpha=E)}}}}});var Yo=function(E,k){wj(Yo,this,[E,k])};jq(Yo,hd,{_checkEmptyRect:!0,_40O:function(j,_){var o=this,Q=o.s,m=j.rect;(j.borderColor=o.gv.getBorderColor(o._data))&&(j.borderType=Q("border.type"),j.borderWidth=Q("border.width"),j.borderPadding=Q("border.padding"),_=B(_,j.borderPadding+j.borderWidth/2));var M=o._data.getScale(),w=B(1,B(L(M.x),L(M.y)));if(j.selectWidth=o.getSelectWidth()){var T=o.gv._zoom;j.selectType=Q("select.type"),j._97o=o.getSelectColor(),j.selectPadding=Q("select.padding"),_=B(_,(j.selectPadding+j.selectWidth/2/T)/w)}_>0&&(_*=w,m=aq(m),El(m,_)),o._68o(m)},_39O:function(A,Z){var f,R=this,X=Z.rect;if(Z.borderWidth>0&&(f=Z.borderPadding,A.strokeStyle=Z.borderColor,A.lineWidth=Z.borderWidth,hm(A,Z.borderType,{x:X.x-f,y:X.y-f,width:X.width+2*f,height:X.height+2*f}),A.stroke()),Z.selectWidth>0){var o=R.gv._zoom;if(f=Z.selectPadding,A.strokeStyle=Z._97o,A.lineWidth=Z.selectWidth/o,Z.rotation!=Y){A.save(),A.translate(Z.position.x,Z.position.y),A.rotate(Z.rotation);var O=R._data,Q=O.getWidth(),N=O.getHeight(),y=Z.scale,e=Z.anchor;X={x:y.x*-Q*e.x,y:y.y*-N*e.y,width:y.x*Q,height:y.y*N}}hm(A,Z.selectType,{x:X.x-f,y:X.y-f,width:X.width+2*f,height:X.height+2*f}),Z.rotation!=Y&&A.restore(),A.stroke()}},dispose:function(){var d=this,J=d._htmlView;Yo.superClass._3O.call(d),J&&(J.onHTMLRemoved&&J.onHTMLRemoved(),rn(J))},_3O:function(){var Q=this,G=Q.s,r=Q._data,U=Q.gv,X=r.getStyle(ak),H=Q.getBodyColor(),p=Q._83o=X?{shape:X,_53o:Q.getBodyColor("shape.background"),_27Q:km(G("shape.repeat.image"),H),shapeGradientPack:G("shape.gradient.pack"),_54o:G("shape.border.width"),_55o:G("shape.border.color"),_56o:G("shape.border.3d"),_57o:G("shape.border.3d.color"),_58o:G("shape.border.3d.accuracy"),shapeGradient:G("shape.gradient"),_59o:G("shape.gradient.color"),_60o:G("shape.border.pattern"),_61o:G("shape.border.cap"),_62o:G("shape.border.join"),shapeForeground:G("shape.foreground"),bodyColor:H,gray:G("2d.gray")}:{img:km(U.getImage(r),H),bodyColor:H,gray:G("2d.gray"),stretch:G("image.stretch")};
if(K&&!v);else{var o,F=p.img;F&&F.renderHTML?(Q._htmlInfo&&Q._htmlInfo.img!==F&&(Q._htmlInfo=Y),Q._htmlInfo||(Q._htmlInfo={img:F,cache:{}}),o=F.renderHTML(r,U,Q._htmlInfo.cache)):Q._htmlInfo=Y,Q._htmlView&&Q._htmlView!==o&&(Q._htmlView.onHTMLRemoved&&Q._htmlView.onHTMLRemoved(),rn(Q._htmlView.getView?Q._htmlView.getView():Q._htmlView)),(Q._htmlView=o)&&U.appendHTML(o)&&o.onHTMLAdded&&o.onHTMLAdded(),p.rect=r.getRect(),p.position=r.p(),p.scale=r.getScale(),p.anchor=r.getAnchor(),p.rotation=r.getRotation(),X===xo&&(p._63o=G("shape.depth"));var C=0;if(X)C=ne(Y,p._54o/2,p._62o),Q.s("shape.dash")&&(C=B(C,(Q.s("shape.dash.width")||p._54o)/2));else if(F&&F.boundExtend)if(C=hg(F.boundExtend,r,U),F.boundExtendAbsolute){var x=r.getScale();C/=U._zoom*B(1,B(L(x.x),L(x.y)))}else if(!hg(F.fitSize,r,U)){var g=hg(F.width,r,U),V=hg(F.height,r,U);C*=B(r.getWidth()/g,r.getHeight()/V)}Q._40O(p,C);var b=G("clip.percentage");if(1>b&&(0>b&&(b=0),p.clipRect=Ig(r.getAnchorRect(),G("clip.direction"),b)),X){var N=G("shape.fill.clip.percentage");1>N&&(0>N&&(N=0),p.shapeClipRect=Ig(r.getAnchorRect(),G("shape.fill.clip.direction"),N));var i=G("shape.foreground.clip.percentage");1>i&&(0>i&&(i=0),p.shapeForegroundClipRect=Ig(r.getAnchorRect(),G("shape.foreground.clip.direction"),i))}}},getPosition:function(C,u,D,r){var E=ai(C,this._83o.rect,r);return E.x+=u,E.y+=D,E},_80o:function(B){var K=this,y=K.s,Q=K.gv,i=K._data,C=K._83o,b=C.rect,g=C.position,c=C.rotation,$=C.anchor,z=C.scale,h=C.shape,I=C.clipRect;if(!K._checkEmptyRect||b.width>0&&b.height>0){var R=i.getSize();if(R.x=-R.width*$.x,R.y=-R.height*$.y,B.save(),Jd(B,g.x,g.y),hh(B,c),Ro(B,z.x,z.y),I&&(B.beginPath(),B.rect(I.x,I.y,I.width,I.height),B.clip()),Q._drawForChecking&&C.img&&hg(C.img.pixelPerfect,i,Q)===!1)_e(B,R.x,R.y,R.width,R.height,"#888888");else if(K.freeDraw)K.freeDraw(B,R,C);else if(h){var H,n,D,X,e=C._60o,N=ro(B,e),a=C._27Q,q=C._54o,S=C.shapeGradientPack,A=C.gray,L=B.lineJoin,v=B.lineCap,W=function(l){return A?k.toGrayColor(l):l};"roundRect"===h?H=y("shape.corner.radius"):"polygon"===h?H=y("shape.polygon.side"):"arc"===h&&(H=y("shape.arc.from"),n=y("shape.arc.to"),D=y("shape.arc.close"),X=y("shape.arc.oval")),B.lineJoin=C._62o,B.lineCap=C._61o;var l=W(C._53o);if(l||a||S){var p=C.shapeClipRect;p&&(B.save(),B.beginPath(),B.rect(p.x,p.y,p.width,p.height),B.clip()),hm(B,h,R,H,n,D,X),S?gn(B,S):a?ol(B,a,W(C.bodyColor),null,i,Q):wo(B,l,C.shapeGradient,W(C._59o),R),B.fill(),p&&B.restore(),S&&B.restore(),B!==N&&hm(N,h,R,H,n,D,X)}else hm(N,h,R,H,n,D,X);var s=C.shapeForeground;if(s){B.save();var f=C.shapeForegroundClipRect;f&&(B.beginPath(),B.rect(f.x,f.y,f.width,f.height),B.clip()),hm(B,h,R,H,n,D,X),wo(B,s,y("shape.foreground.gradient"),W(y("shape.foreground.gradient.color")),R),B.fill(),B.restore()}if(q>0){var t=y("shape.border.width.absolute");t&&(B.save(),B.setTransform(1,0,0,1,0,0)),B.lineWidth=q;var U=W(C._55o);B.strokeStyle=U,B.stroke(),t&&B.restore(),C._56o&&wq(B,U,W(C._57o),q,Q._zoom,C._58o)}if(zi(B,e),y("shape.dash")){var u=y("shape.dash.width")||q;if(u>0){e=y("shape.dash.pattern");var N=ro(B,e,K._2Q("shape.dash.offset"));N!==B&&hm(N,h,R,H,n,D,X),K._1Q(B,"shape",u,e)}}Ae(B,l,C._63o,R),B.lineJoin=L,B.lineCap=v}else{var r=K.interactiveInfo;r&&(B.interactiveInfo=r.bodyInfo={compInfos:[],matrix:new Fj(c,g.x,g.y,z.x,z.y)}),C.gray&&(B.compGray=!0),Cq(B,C.img,C.stretch,R.x,R.y,R.width,R.height,i,Q,C.bodyColor),B.compGray=!1,B.interactiveInfo=Y}B.restore()}K._39O(B,C)},_48O:function(){},_47O:function(){}});var un=function(g,C){wj(un,this,[g,C])},pr=function(H,h,P,v){var G=Qf(H,h);return P=v?D(P,G):os(P,G),G?P/=G:P=0,{x:H.x+(h.x-H.x)*P,y:H.y+(h.y-H.y)*P}};jq(un,hd,{_3O:function(){var A,e=this,g=e._data,r=e.gv,x=e.s,V=x(_r),o=g.isLooped(),m=x("edge.width"),T=x("edge.center"),z=x("edge.offset"),q=r.getBorderColor(g),Q=q?x("border.width"):0,G=e.getSelectWidth(),v=g._40I,l=g._41I,p=e._78o=v&&l?{looped:o,type:V,width:m,center:T,color:e.getBodyColor("edge.color"),borderColor:q,borderWidth:Q,_97o:G?e.getSelectColor():Y,selectWidth:G,pattern:x("edge.pattern"),cap:x("edge.cap"),join:x("edge.join"),is3d:x("edge.3d"),_67o:x("edge.3d.color"),_66o:x("edge.3d.accuracy"),gray:x("2d.gray")}:Y;if(p){var i=k.getEdgeType(V);if(i){var U=i(g,hj(e,r,g,o,V),r,e._19Q);U.points&&U.points.size()>1?(p.edgeTypeInfo=U,A=ig(p.edgeTypeInfo.points)):U[Co]&&U.rect&&(p.edgeTypeInfo=U,A=U.rect)}else{var R=x("edge.source.anchor.x"),w=x("edge.source.anchor.y"),M=x("edge.target.anchor.x"),L=x("edge.target.anchor.y"),I=tq(r,v,x("edge.source.position"),x("edge.source.offset.x"),x("edge.source.offset.y"),R,w),S=tq(r,l,x("edge.target.position"),x("edge.target.offset.x"),x("edge.target.offset.y"),M,L);if(V===Ap){var y=p.points=x(Hj)||Ah,$=y.size();p.segments=x("edge.segments");var F=R!==P||w!==P,K=M!==P||L!==P;if(!T)if(z)F||(I=pr(I,$?y.get(0):S,z,$)),K||(S=pr(S,$?y.get($-1):I,z,$));else{var h;F||(h=yo(I,$?y.get(0):S,vg(r,v)),h&&(I={x:h[0],y:h[1]})),K||(h=yo($?y.get($-1):I,S,vg(r,l)),h&&(S={x:h[0],y:h[1]}))}A=Si(ig(p.points),ig(I,S))}else{var c=hj(e,r,g,o,V);if(e._19Q||(c=-c),o)I=aq(I),I.x=r.getNodeRect(v).x,p.radius=c,A={x:I.x-c,y:I.y-c,width:2*c,height:2*c};else{var H=Qf(I,S),n=os(z,H),f={x:n,y:c},_={x:H-n,y:c},b=d(S.y-I.y,S.x-I.x),u=p.mat=new cq(b);if(p.orienAngle=b,p.angle=S.x<I.x?b+O:b,p.rect={x:f.x,y:f.y,width:_.x-f.x,height:0},p.origin=I,f=u.tf(f),f.x+=I.x,f.y+=I.y,_=u.tf(_),_.x+=I.x,_.y+=I.y,T){var j={x:H,y:0};j=u.tf(j),j.x+=I.x,j.y+=I.y,A=ig([I,f,_,j]),p.c1=I,p.c2=j}else A=ig(f,_);I=f,S=_}}p.sourcePoint=I,p.targetPoint=S,g._lastSourcePoint=I,g._lastTargetPoint=S}var C=0;x("edge.dash")&&(C=x("edge.dash.width")||m);var N="square"===p.cap?.71:.5;ne(A,B(C*N,m*N+Q+G),p.join),e._68o(A)}},getRotation:function(A,t,V){A=A||0;var M=this._78o;if(M){var F,S=M.angle,d=M.points,k=M.edgeTypeInfo;if(S!=Y)return t?M.orienAngle+A:S+A;if(k&&k[Co])return k.getRotation?k.getRotation(this,A,t,V):0;if(k&&k.points){var g=k.points;return F=g.size(),Vj[V]?F&&0===F%2?Xr(g.get(F/2-1),g.get(F/2),t,A):A:Qj[V]?Xr(g.get(0),g.get(1),t,A):Xr(g.get(F-2),g.get(F-1),t,A)}if(d)return F=d.size(),Vj[V]?F&&0===F%2?Xr(d.get(F/2-1),d.get(F/2),t,A):A:Qj[V]?Xr(M.sourcePoint,F?d.get(0):M.targetPoint,t,A):Xr(F?d.get(F-1):M.sourcePoint,M.targetPoint,t,A)}return A},getPosition:function(k,o,M,v,W){var S=this._78o;if(S){var Z,T=S.type,w=S.points,B=S.edgeTypeInfo,P=S.sourcePoint,$=S.targetPoint;if(!T)return S.looped?{x:P.x-S.radius+o,y:P.y+M}:(W&&P&&$&&(P.x>$.x||P.x===$.x&&P.y>$.y)&&(k=Ed[k],M=-M),Z=ai(k,S.rect,v),Z.x+=o,Z.y+=M,Z=S.mat.tf(Z),Z.x+=S.origin.x,Z.y+=S.origin.y,Z);if(B&&B[Co])return B.getPosition?B.getPosition(this,k,o,M,v,W):{x:(P.x+$.x)/2,y:(P.y+$.y)/2};if(w){var Z,F=w.size();if(Vj[k]){if(F){var Y=F%2;if(0===Y)return Pg(w.get(F/2-1),w.get(F/2),k,o,M,v,W);Z=w.get((F-Y)/2)}else Z={x:(P.x+$.x)/2,y:(P.y+$.y)/2};return Z=ai(k,{x:Z.x,y:Z.y,width:0,height:0},v),Z.x+=o,Z.y+=M,Z}return Qj[k]?Pg(P,F?w.get(0):$,k,o,M,v,W):Pg(F?w.get(F-1):P,$,k,o,M,v,W)}if(B){var n=B.points,F=n.size();if(Vj[k]){var Y=F%2;return 0===Y?Pg(n.get(F/2-1),n.get(F/2),k,o,M,v,W):(Z=n.get((F-Y)/2),Z=ai(k,{x:Z.x,y:Z.y,width:0,height:0},v),Z.x+=o,Z.y+=M,Z)}return Qj[k]?Pg(n.get(0),n.get(1),k,o,M,v,W):Pg(n.get(F-2),n.get(F-1),k,o,M,v,W)}}return Zc},_42:function(g){this._78o&&un.superClass._42.call(this,g)},drawPath:function(b,i){b.beginPath();var C=i.type,B=i.points,X=i.segments,v=i.edgeTypeInfo;if(!C||B){var O=i.sourcePoint,T=O.x,I=O.y,H=i.targetPoint,f=H.x,Z=H.y;if(C)if(X){var G=new rp({x:T,y:I});G.addAll(B),G.add({x:f,y:Z}),Er(b,G,X)}else b.moveTo(T,I),B.each(function(f){b.lineTo(f.x,f.y)}),b.lineTo(f,Z);else i.looped?b.arc(T,I,i.radius,0,r,!0):i.center?(b.moveTo(i.c1.x,i.c1.y),b.lineTo(T,I),b.lineTo(f,Z),b.lineTo(i.c2.x,i.c2.y)):(b.moveTo(T,I),b.lineTo(f,Z))}else v&&(v.points?Er(b,v.points,v.segments):v[Co]&&v[Co](b,v))},_80o:function(I){var j=this,R=j.s,E=j._78o,L=E.width,B=E.selectWidth,o=E.borderWidth,N=I.lineJoin,$=I.lineCap,V=E.gray,a=E.pattern;I.lineJoin=E.join,I.lineCap=E.cap,j.drawPath(ro(I,a),E);var x=R("edge.width.absolute");x&&(I.save(),I.setTransform(1,0,0,1,0,0)),B&&(I.strokeStyle=E._97o,I.lineWidth=L+2*(o+B),I.stroke()),o&&(I.strokeStyle=V?k.toGrayColor(E.borderColor):E.borderColor,I.lineWidth=L+2*o,I.stroke());var f=V?k.toGrayColor(E.color):E.color,Y=V?k.toGrayColor(E._67o):E._67o;if(I.strokeStyle=f,I.lineWidth=L,I.stroke(),E.is3d&&wq(I,f,Y,L,j.gv._zoom,E._66o),x&&I.restore(),zi(I,a),R("edge.dash")){a=R("edge.dash.pattern");var s=ro(I,a,j._2Q("edge.dash.offset"));s!==I&&j.drawPath(s,E),j._1Q(I,"edge",R("edge.dash.width")||L,a)}I.lineJoin=N,I.lineCap=$},_48O:function(){},_47O:function(){},_71o:function(h,q){var i=this,y=i._data;if(i._19Q=!0,!y.getEdgeGroup())return h?y.s("edge.gap"):0;var b,O=0,t=0,L=0;if(y.getEdgeGroup().getSiblings().each(function(V){V.each(function(K){if(i.gv.isVisible(K)&&K.s(_r)==q){var c=K.s("edge.gap");b?(t+=L/2+c/2,L=c):(b=K,L=c),K===y&&(O=t)}})}),h)return t-O+L;var Y=O-t/2;return b&&y._40I!==b._40I&&(i._19Q=!1),Y}});var cm=function(L,Y){wj(cm,this,[L,Y])};jq(cm,Yo,{_3O:function(){var V,c,y=this,b=y.s,w=y._data,H=y.gv;if(y._88I=Y,w.isExpanded()&&w.eachChild(function(C){var Q=H.getBoundsForGroup(C);Q&&(c||(c=[]),c.push(Q),V=Si(V,Q))}),V){var h=H.getLabel(w),d=b("group.type");V=xj(d,c,V),fm(V,w,"group.padding",1);var E=y._88I={type:d,rect:V,_64o:V};if(!d&&h!=Y){var u,z=y.labelInfo={label:h,color:b("group.title.color"),font:b("group.title.font"),align:b("group.title.align")},R=Dc(z,h),F=R.width,r=R.height,Z=b("group.title.align"),n=b("group.title.orientation");if((n===Gc||n===Xh)&&F>V.width?V.width=F:(n===wp||n===lh)&&F>V.height&&(V.height=F),z.rect={y:V.y-r,width:R.width,height:r},u=Z===wp?V.x:Z===lh?V.x+V.width-F:V.x+V.width/2-F/2,z.rect.x=u,n===Xh)E.titleRect={x:V.x,y:V.y+V.height,width:V.width,height:r},E.rect={x:V.x,y:V.y,width:V.width,height:V.height+r},z.rect={x:u,y:V.y+V.height,width:F,height:r};else if(n===wp){var i=E.titleRect={x:V.x-r,y:V.y,width:r,height:V.height};E.rect={x:V.x-r,y:V.y,width:V.width+r,height:V.height},z.rect={x:i.x+r/2-V.height/2,y:i.y+V.height/2-r/2,width:V.height,height:r},z.rotation=-Math.PI/2}else if(n===lh){var i=E.titleRect={x:V.x+V.width,y:V.y,width:r,height:V.height};E.rect={x:V.x,y:V.y,width:V.width+r,height:V.height},z.rect={x:i.x+r/2-V.height/2,y:i.y+V.height/2-r/2,width:V.height,height:r},z.rotation=Math.PI/2}else E.titleRect={x:V.x,y:V.y-r,width:V.width,height:r+1},E.rect={x:V.x,y:V.y-r,width:V.width,height:V.height+r}}y._40O(E,b("group.border.width")/2)}else cm.superClass._3O.call(y)},getPosition:function(D,j,o,Z){var n=this._88I;if(n){var k=ai(D,n.rect,Z);return k.x+=j,k.y+=o,k}return cm.superClass.getPosition.apply(this,arguments)},_24O:function(J,j){var p=this._88I;(!p||p.type||"label2"===J)&&cm.superClass._24O.call(this,J,j)},_80o:function(c){var J=this,H=J._88I;if(H){var $=J._data,K=J.s,s=J.gv,P=H.type,l=H.rect,x=H._64o,n=H.titleRect,W=J.getBodyColor(),q=km(K("group.image"),W),G=K("group.image.stretch"),A=J.getBodyColor("group.background"),S=km(K("group.repeat.image"),W),C=K("group.gradient.pack"),T=K("group.gradient"),F=K("group.gradient.color"),L=K("group.border.width"),X=K("group.border.color"),m=K("group.border.pattern"),r=K("group.title.orientation"),b=K("group.depth");if(P){var M=c.lineJoin,i=c.lineCap;if(c.lineJoin=K("group.border.join"),c.lineCap=K("group.border.cap"),q){if(c.save(),hm(c,P,l),c.clip(),Cq(c,q,G,l.x,l.y,l.width,l.height,$,s,W),c.restore(),L>0){var w=ro(c,m);hm(w,P,l),c.lineWidth=L,c.strokeStyle=X,c.stroke(),zi(c,m)}}else{var w=ro(c,m);A||S||C?(hm(c,P,l),C?gn(c,C):S?ol(c,S,W,null,$,s):wo(c,A,T,F,l),c.fill(),C&&c.restore(),c!==w&&hm(w,P,l)):hm(w,P,l),L>0&&(c.lineWidth=L,c.strokeStyle=K("group.border.color"),c.stroke()),zi(c,m),P===xo&&Ae(c,A,b,l)}c.lineJoin=M,c.lineCap=i}else{var Q=K("group.title.background"),Z=K("group.border.radius");if(q)Cq(c,q,G,x.x,x.y,x.width,x.height,$,s,J.getBodyColor());else if(A||S)if(S?ol(c,S,W,null,$,s):wo(c,A,T,F,x),0===L)hm(c,xo,x),c.fill(),Ae(c,A,b,x);else{switch(c.beginPath(),r){case Xh:Rj(c,x.x,x.y,x.width,x.height,Z,Z,0,0);break;case wp:Rj(c,x.x,x.y,x.width,x.height,0,Z,0,Z);break;case lh:Rj(c,x.x,x.y,x.width,x.height,Z,0,Z,0);break;case Gc:Rj(c,x.x,x.y,x.width,x.height,0,0,Z,Z)}c.fill()}if(n&&Q)if(0===L)_e(c,n.x,n.y,n.width,n.height,Q),Ae(c,Q,b,n);else{switch(c.beginPath(),c.fillStyle=Q,r){case Xh:Rj(c,n.x,n.y,n.width,n.height,0,0,Z,Z);break;case wp:Rj(c,n.x,n.y,n.width,n.height,Z,0,Z,0);break;case lh:Rj(c,n.x,n.y,n.width,n.height,0,Z,0,Z);break;case Gc:Rj(c,n.x,n.y,n.width,n.height,Z,Z,0,0)}c.fill()}if(L>0){var w=ro(c,m);if(hm(w,"roundRect",l,Z),c.lineWidth=L,c.strokeStyle=X,n&&K("group.splitLine")){var t=n.x,N=n.y,Y=n.width,R=n.height;r===Xh?(c.moveTo(t,N),c.lineTo(t+Y,N)):r===wp?(c.moveTo(t+Y,N),c.lineTo(t+Y,N+R)):r===lh?(c.moveTo(t,N),c.lineTo(t,N+R)):(c.moveTo(t,N+R),c.lineTo(t+Y,N+R))}c.stroke(),zi(c,m)}}J._39O(c,H)}else cm.superClass._80o.call(J,c)}});var Te=function(g,f){wj(Te,this,[g,f])};jq(Te,Yo,{_80o:function(s){this._39O(s,this._83o)}});var yd=function(a,T){wj(yd,this,[a,T])};jq(yd,Yo,{_3O:function(){var P=this,E=P._data,q=P.s,f=P.gv,I=E.getPoints(),b=f.getBorderColor(E),$=b?q("border.width"):0,S=P.getSelectWidth(),m=q("shape.border.width"),K=E.getRect(),F=f.getBodyColor(E),D=P._99o=I.isEmpty()?Y:{rect:K,rotation:E.getRotation(),fillRule:q("shape.fill.rule"),scale:E.getScale(),position:E.p(),points:I,segments:E.getSegments(),bodyColor:F,borderColor:b,borderWidth:$,_94o:q("shape.border.3d"),_95o:q("shape.border.3d.color"),_96o:q("shape.border.3d.accuracy"),_97o:S?P.getSelectColor():Y,selectWidth:S,_53o:q("shape.background"),_27Q:km(q("shape.repeat.image"),F),shapeGradientPack:q("shape.gradient.pack"),_54o:m,_55o:q("shape.border.color"),shapeGradient:q("shape.gradient"),_59o:q("shape.gradient.color"),_60o:q("shape.border.pattern"),_61o:q("shape.border.cap"),_62o:q("shape.border.join"),shapeForeground:q("shape.foreground"),gray:q("2d.gray")};if(D){var w=E.getScale(),U=B(1,B(L(w.x),L(w.y)));q("shape.dash")&&q("shape.dash.width")>m&&(m=q("shape.dash.width"));var p=m*("square"===D._61o?.71:.5)+$+S/P.gv._zoom/U;p&&(p*=U,K=aq(K),ne(K,p,D._62o)),P._68o(K);var o=q("clip.percentage");1>o&&(0>o&&(o=0),D.clipRect=Ig(E.getAnchorRect(),q("clip.direction"),o));var A=q("shape.fill.clip.percentage");1>A&&(0>A&&(A=0),D.shapeClipRect=Ig(E.getAnchorRect(),q("shape.fill.clip.direction"),A));var n=q("shape.foreground.clip.percentage");1>n&&(0>n&&(n=0),D.shapeForegroundClipRect=Ig(E.getAnchorRect(),q("shape.foreground.clip.direction"),n))}},getPosition:function(j,t,e,n){var O=this._99o;if(O){var d=ai(j,O.rect,n);return d.x+=t,d.y+=e,d}return Zc},_42:function(i){this._99o&&yd.superClass._42.call(this,i)},_80o:function(w){var N,V=this,c=V.s,X=V._99o,G=X.position,T=X.scale,K=X.rotation,h=X.borderWidth,S=X.selectWidth/V.gv._zoom,C=X._27Q,R=X.shapeGradientPack,d=X._54o,O=X.clipRect,z=X.shapeClipRect,e=X.points,Z=X.segments,o=V._data.isClosePath(),y=X.fillRule,_=X.gray,M=function(s){return _?k.toGrayColor(s):s},L=M(X._53o),U=L||C||R;w.save(),Jd(w,G.x,G.y),hh(w,K),Ro(w,T.x,T.y),O&&(w.beginPath(),w.rect(O.x,O.y,O.width,O.height),w.clip()),U&&z&&(w.save(),w.beginPath(),w.rect(z.x,z.y,z.width,z.height),w.clip()),Jd(w,-G.x,-G.y);var b=X._60o,D=ro(w,b),n=w.lineJoin,i=w.lineCap;w.lineJoin=X._62o,w.lineCap=X._61o;var Y=M(X.bodyColor);U?(Er(w,e,Z,o),R?gn(w,R):C?ol(w,C,Y,null,V._data,V.gv):(N=Y?Y:L,wo(w,N,X.shapeGradient,M(X._59o),X.rect)),w.fill(y),z&&(w.restore(),Jd(w,-G.x,-G.y)),R&&w.restore(),D!==w&&Er(D,e,Z,o)):Er(D,e,Z,o);var p=X.shapeForeground;if(p){w.save();var v=X.shapeForegroundClipRect;v&&(Jd(w,G.x,G.y),w.beginPath(),w.rect(v.x,v.y,v.width,v.height),w.clip(),Jd(w,-G.x,-G.y)),Er(w,e,Z,o),wo(w,p,c("shape.foreground.gradient"),M(c("shape.foreground.gradient.color")),X.rect),w.fill(y),w.restore()}var t=c("shape.border.width.absolute");if(t&&(w.save(),w.setTransform(1,0,0,1,0,0)),S&&(w.strokeStyle=X._97o,w.lineWidth=d+2*(h+S),w.stroke()),h&&(w.strokeStyle=M(X.borderColor),w.lineWidth=d+2*h,w.stroke()),d&&(N=M(X._55o),!L&&Y&&(N=Y),w.strokeStyle=N,w.lineWidth=d,w.stroke(),X._94o&&wq(w,N,M(X._95o),d,V.gv._zoom,X._96o)),t&&w.restore(),zi(w,b),c("shape.dash")){var a=c("shape.dash.width")||d;if(a>0){b=c("shape.dash.pattern");var D=ro(w,b,V._2Q("shape.dash.offset"));D!==w&&Er(D,e,Z,o),V._1Q(w,"shape",a,b)}}w.lineJoin=n,w.lineCap=i,w.restore()},_48O:function(){},_47O:function(){}});var uk=function(K,p){wj(uk,this,[K,p])};jq(uk,yd,{getRotation:function(l,h,K){l=l||0;var L=this._data.getPoints(),d=L.size();return d>1?Vj[K]?d&&0===d%2?Xr(L.get(d/2-1),L.get(d/2),h,l):l:Qj[K]?Xr(L.get(0),L.get(1),h,l):Xr(L.get(d-2),L.get(d-1),h,l):l},getPosition:function(P,v,y,t,Z){var G=this._data.getPoints(),S=G.size();if(S>1){if(Vj[P]){var T=S%2;if(0===T)return Pg(G.get(S/2-1),G.get(S/2),P,v,y,t,Z);var D=G.get((S-T)/2),g={x:D.x,y:D.y,width:0,height:0};return D=ai(P,g,t),D.x+=v,D.y+=y,D}return Qj[P]?Pg(G.get(0),G.get(1),P,v,y,t,Z):Pg(G.get(S-2),G.get(S-1),P,v,y,t,Z)}return Zc}});var Bj=function(P,K){wj(Bj,this,[P,K])};jq(Bj,Yo,{_3O:function(){var w=this;Bj.superClass._3O.call(w);var q=w.s,j=w._83o;w._82o=j.img||j.shape?Y:{background:w.getBodyColor("grid.background"),depth:q("grid.depth"),rect:j.rect,_88o:q("grid.cell.depth"),cellBorderColor:q("grid.cell.border.color"),_89o:q("grid.row.count"),_90o:q("grid.column.count"),block:q("grid.block"),_91o:q("grid.block.color"),_92o:q("grid.block.padding"),_93o:q("grid.block.width")}},_80o:function(t){var z=this,$=z._82o;if(!$)return Bj.superClass._80o.call(z,t),void 0;var v,G,J=z._data,N=$.background,d=$.rect,j=$.block,X=$._91o,k=$._92o,M=$._93o,U=$._88o,D=$.cellBorderColor,l=$._89o,V=$._90o;if(N)if(_e(t,d.x,d.y,d.width,d.height,N),Ae(t,N,$.depth,d),U)for(v=0;l>v;v++)for(G=0;V>G;G++)d=J.getCellRect(v,G),d&&Ae(t,N,U,d);else if(D){for(t.beginPath(),v=0;l>v;v++)for(G=0;V>G;G++)d=J.getCellRect(v,G),d&&t.rect(d.x,d.y,d.width,d.height);t.strokeStyle=D,t.lineWidth=1,t.stroke()}if("h"===j)for(v=0;l>v;v++)d=Si(J.getCellRect(v,0),J.getCellRect(v,V-1)),El(d,k),sb(t,X,d.x,d.y,d.width,d.height,M);else if("v"===j)for(G=0;V>G;G++)d=Si(J.getCellRect(0,G),J.getCellRect(l-1,G)),El(d,k),sb(t,X,d.x,d.y,d.width,d.height,M);z._39O(t,z._83o)}});var He=function(f,R){wj(He,this,[f,R])};jq(He,Yo,{_checkEmptyRect:!1,_81o:function(){var v=this._data,G=He.superClass._81o.call(this),X=v.s("text");if(X!=Y){var Q,j,o=v.s("text.font"),D=v.s("text.align"),i=v.s("text.vAlign"),l=Ie(o,X),A=l.width,g=l.height,y=v.getAnchor(),H=v.getWidth(),c=v.getHeight();"left"===D?Q=-H*y.x:"center"===D?Q=-H*y.x+(H-A)/2:"right"===D&&(Q=H*(1-y.x)-l.width),"top"===i?j=-c*y.y:"middle"===i?j=-c*y.y+(c-g)/2:"bottom"===i&&(j=c*(1-y.y)-l.height);var e,O=v.getMatrix();if(e=ig([O.tf(Q,j),O.tf(Q+A,j),O.tf(Q+A,j+g),O.tf(Q,j+g)]),G=Si(G,e),G&&v.s("text.shadow")){var b=aq(G);b.x+=v.s("text.shadow.offset.x"),b.y+=v.s("text.shadow.offset.y"),El(b,v.s("text.shadow.blur")),G=Si(G,b)}}return G}});var Ic=Mk.Interactor=function(Z){this.gv=this._graphView=Z};Gd("Interactor",$,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(l){this.gv.fi(l)},setCursor:function(y){hc||this.gv.setCursor(y)},startDragging:function(n){var T=this;T._lastClientPoint=ih(n),T._lastLogicalPoint=T.gv.lp(n),rc(T,n)},clearDragging:function(){var v=this;v._lastClientPoint=v._lastLogicalPoint=v._logicalPoint=Y},autoScroll:function(b){return this.gv.autoScroll(b,this._lastClientPoint)}});var Kq=Y,zo=function(d){Kq.handleWindowTouchMove(d)},Xj=function(z){Kq.handleWindowTouchEnd(z),f.removeEventListener(sc,zo,p),f.removeEventListener(qm,Xj,p),Kq=Y},An=function(V){Kq.handleWindowMouseMove(V)},rh=function(O){Kq.handleWindowMouseUp(O),f.removeEventListener(Vb,An,p),f.removeEventListener(cd,rh,p),Kq=Y},Ei=function(z,N){z!==Kq&&(Kq?hc?Kq.handleWindowTouchEnd(N):Kq.handleWindowMouseUp(N):hc?(f.addEventListener(sc,zo,p),f.addEventListener(qm,Xj,p)):(f.addEventListener(Vb,An,p),f.addEventListener(cd,rh,p)),Kq=z)},zd=function(z){var y=this;y.gv=z,y._is2d=z instanceof Mk.GraphView,y._is2d&&(y.filter=function(q){return z.isSelectable(q)&&z.isInteractive(q)}),z.getView(),["mousedown","mousemove","mouseleave","touchstart","touchmove",$p].forEach(function(p){y.addListener(p)}),y.initImageResource()};jq(zd,Ic,{enableVR:function(L){var y=this;if(!!y._vrEnable!==L)if(y._vrEnable=L,L)y.gv.vr.mp(y.onVRControllerChange,y);else if(y.gv.vr.ump(y.onVRControllerChange,y),y._vrRayPolyline){var v=y.gv.dm();v.remove(y._vrRayPolyline),v.remove(y._vrRayHitPoint),y._vrRayPolyline=P,y._vrRayHitPoint=P}},onVRControllerChange:function(e){var Q=this,o=e.property,d=e.newValue,J=Q.gv.vr.getController(d.id),_=J.getRay();_&&("gamepad.button.trigger"===o?"down"===d._62O?Q.handle_mousedown(_):Q.handleWindowMouseUp(_):"gamepad.pose"===o&&(Q.handle_mousemove(_),Q.handleWindowMouseMove(_)))},drawVRRay:function(G,M,A){var a,N=this,k=N.gv,u=N._vrRayPolyline,D=!1;if(u)a=N._vrRayHitPoint;else{var d=k.dm();N._vrRayPolyline=u=new C.Polyline,N._vrRayHitPoint=a=new C.Node,a.s({shape3d:"billboard","shape3d.transparent":!0,"shape3d.texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),a.setAnchor3d(.5,.5,.499);var l=.2/k.vr.measureOflength;a.s3(l,l,l),u.s("intersect",!1),a.s("intersect",!1),d.add(u),d.add(a),D=!0}if(M){var H=A.world,Y=A.worldNormal,g=H.x,U=H.y,s=H.z;u.s("shape.border.color","red"),u.setPoints([{x:G.origin.x,y:G.origin.z,e:G.origin.y},{x:g,y:s,e:U}]),a.s("3d.visible",!0),a.p3(g,U,s),a.lookAtDirection([Y.x,Y.y,Y.z],"front")}else{u.s("shape.border.color","blue");var t=new C.Math.Vector3;t.copy(G.direction).setLength(1e3/N.gv.vr.measureOflength).add(G.origin),u.setPoints([{x:G.origin.x,y:G.origin.z,e:G.origin.y},{x:t.x,y:t.z,e:t.y}]),a.s("3d.visible",!1)}k.fi({kind:"vrRayIntersect",ray:G,data:M,intersect:A,polyline:u,hitNode:a,begin:D})},addListener:function(t){var H=this;H.gv.getView().addEventListener(t,function(d){k.preventDefault(d),H.disabled||H["handle_"+t](d)},p)},handleWindowTouchMove:function(A){this.handleWindowMouseMove(A)},handleWindowMouseMove:function(z){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",z):(this.handleDownInfo("onBeginDrag",z),this.isDragging=!0))},handleWindowTouchEnd:function(i){this.handleWindowMouseUp(i)},handleWindowMouseUp:function(v){if(this.isDragging&&(this.handleDownInfo("onEndDrag",v),this.isDragging=!1),this.downInfo){var D=this.handle("onUp",v);D&&D.data===this.downInfo.data?this.handleMissingUp(v):this.handleDownInfo("onUp",v),this.downInfo=Y}},handle_mouseleave:function(u){var k=this,M=k.gv,o=k.currentInfo?k.currentInfo.data:Y;if(o){o.s("onLeave")&&o.s("onLeave")(u,o,M),k.fire("data","onLeave",u,o);var F=k.currentInfo?k.currentInfo.hits:Y;if(F)for(var O in F)k.handleLeave(u,O);k.currentInfo=Y}},handle_mousewheel:function(Z){Z.scrollDelta=Z.wheelDelta/40,this.handle("onScroll",Z)},handle_DOMMouseScroll:function(Q){Q.scrollDelta=2===Q.axis?-Q.detail:0,this.handle("onScroll",Q)},handle_touchstart:function(O){this.handle_mousedown(O)},handle_touchmove:function(E){this.handle("onMove",E)},handle_mousedown:function(K){this.isDragging&&(this.handleDownInfo("onEndDrag",K),this.isDragging=!1),this.downInfo=this.handle("onDown",K),this.downInfo&&Ei(this,K)},handle_mousemove:function(x){var r=this,s=r.gv;r._hoverTimer&&(z(r._hoverTimer),delete r._hoverTimer);var M,h,$,u=r.handle("onMove",x),F=this.currentInfo?this.currentInfo.data:Y,b=this.currentInfo?this.currentInfo.hits:Y;if(u&&(h=u.data,$=u.hits,r._hoverTimer=N(function(){z(r._hoverTimer),delete r._hoverTimer,r.handle("onHover",x,u)},s.getHoverDelay()||k.hoverDelay)),h!==F){if(F&&(F.s("onLeave")&&F.s("onLeave")(x,F,s),this.fire("data","onLeave",x,F)),h&&(h.s("onEnter")&&h.s("onEnter")(x,h,s),this.fire("data","onEnter",x,h)),b)for(M in b)this.handleLeave(x,M);if($)for(M in $){var y=$[M];y.target.onEnter&&y.target.onEnter(x,h,s,y.point,y.width,y.height),this.fire(y.type,"onEnter",y.event,y.data,y.image,y.comp,y.point,y)}}else{if(b)for(M in b)$&&$[M]||this.handleLeave(x,M);if($)for(M in $)if(!b||!b[M]){var y=$[M];y.target.onEnter&&y.target.onEnter(x,h,s,y.point,y.width,y.height),this.fire(y.type,"onEnter",y.event,y.data,y.image,y.comp,y.point,y)}}this.currentInfo=u},handle:function(p,q,_){var r,W=this,P=W.gv;if(W._is2d){if(_=_||P.getDataInfoAt(q,this.filter),!_)return;if(r=_.ui.interactiveInfo){var z,u=_.data;if(u.s(p)&&u.s(p)(q,u,P),this.fire("data",p,q,u),"body"===_.part&&r.bodyInfo)z="body",_.hits=this.handleImage(z,P.getImage(u),p,q,u,_.point,r.bodyInfo);else if("icons"===_.part&&r._38o){var w=r._38o[_.name];w&&w[_.index]&&(z="icons|"+_.name+"|"+_.index,_.hits=this.handleImage(z,_.icon,p,q,u,_.point,w[_.index]))}}return _}var u,y;if(!_)if(q&&q instanceof C.Math.Ray){var Q=P.vr.intersectWorld(q);if(u=Q.data,y=Q.intersect,W.drawVRRay(q,u,y),!u)return;var v=P.getData3dUI(u);if(r=v.interactiveInfo,!r)return;_={data:u,part:y.part,ui:v}}else{if(_=P.getDataInfoAt(q),!_)return;_&&(_={data:_.data,part:_.part})}if(!y){u=_.data;var v=P.getData3dUI(u);if(_.ui=v,r=v.interactiveInfo,!r)return _;if(y=P.intersectObject(q,u),!y)return}u.s(p)&&u.s(p)(q,u,P),this.fire("data",p,q,u);var Y,i=y.part;return"body"!==i&&(Y=u.s(i+".image")||u.s("shape3d."+i+".image")),Y||(Y=u.s("all.image")||u.s("shape3d.image")),(r="object"==typeof Y?r[Y.uuid]:r[Y])?(_.part="body",_.interactiveInfo=r,_.point=y.uv.multiply({x:r.bodyInfo.rect.width,y:r.bodyInfo.rect.height}),_.image=Y,_.hits=this.handleImage("body",Y,p,q,u,_.point,r.bodyInfo),_):void 0},_handleLeaveOrMissing:function(b,n,D){var a="leave"===b?this.currentInfo:this.downInfo;if(a){var X=a.interactiveInfo||a.ui.interactiveInfo;if(X){var k,R,h=a.data;if(this._is2d){if(R=this.gv.lp(n),"body"===a.part&&X.bodyInfo)k="body","leave"===b?this.handleLeaveImage(D,k,this.gv.getImage(h),n,h,R,X.bodyInfo):this.handleMissingUpImage(k,this.gv.getImage(h),n,h,R,X.bodyInfo);else if("icons"===a.part&&X._38o){var H=X._38o[a.name];H&&H[a.index]&&(k="icons|"+a.name+"|"+a.index,"leave"===b?this.handleLeaveImage(D,k,a.icon,n,h,R,H[a.index]):this.handleMissingUpImage(k,a.icon,n,h,R,H[a.index]))}}else{var j=this.gv.intersectObject(n,h);R=j?j.uv.multiply({x:X.bodyInfo.rect.width,y:X.bodyInfo.rect.height}):{x:1/0,y:1/0},"leave"===b?this.handleLeaveImage(D,"body",a.image,n,h,R,X.bodyInfo):this.handleMissingUpImage("body",a.image,n,h,R,X.bodyInfo)}}}},handleDownInfo:function(s,P){if(this.downInfo){var Q=this.downInfo,L=this.gv,G=Q.interactiveInfo||Q.ui.interactiveInfo;if(G){var q,l=Q.data;if(l.s(s)&&l.s(s)(P,l,L),this.fire("data",s,P,l),this._is2d){var Y=L.lp(P);if("body"===Q.part&&G.bodyInfo)q="body",this.handleDownInfoImage(q,L.getImage(l),s,P,l,Y,G.bodyInfo);else if("icons"===Q.part&&G._38o){var U=G._38o[Q.name];U&&U[Q.index]&&(q="icons|"+Q.name+"|"+Q.index,this.handleDownInfoImage(q,Q.icon,s,P,l,Y,U[Q.index]))}}else{var i=L.intersectObject(P,l);if(!i)return;Y=i.uv.multiply({x:G.bodyInfo.rect.width,y:G.bodyInfo.rect.height}),this.handleDownInfoImage("body",Q.image,s,P,l,Y,G.bodyInfo)}}}},fire:function(U,$,s,b,l,Q,N,p){this.gv.fi({kind:$,type:U,event:s,data:b,image:l,comp:Q,view:this.gv,point:N,width:p?p.width:P,height:p?p.height:P})},handleImage:function(U,T,p,V,w,h,q){var L={};if(T&&(T=km(T))){var G=this.gv,x=q.rect,e=this.convertPoint(h,q);e.inRect&&(T[p]&&T[p](V,w,G,e,x.width,x.height),this.fire("image",p,V,w,T,P,e,x),L[U+"|image"]={target:T,type:"image",image:T,data:w,event:V,point:e,width:x.width,height:x.height});for(var Z=q.compInfos,t=T,F=Z.length-1;F>=0;F--){var m=Z[F],J=m.comp;e=this.convertPoint(h,m,t,J,G,w),e.inRect&&(x=m.rect,J[p]&&J[p](V,w,G,e,x.width,x.height),this.fire("comp",p,V,w,T,J,e,x),(T=x.image)&&(T[p]&&T[p](V,w,G,e,x.width,x.height),this.fire("image",p,V,w,T,P,e,x)),L[U+"|"+F]={target:J,type:"comp",comp:J,image:T,data:w,event:V,point:e,width:x.width,height:x.height},T&&(L[U+"|"+F+"|image"]={target:T,type:"image",image:T,data:w,event:V,point:e,width:x.width,height:x.height}))}}return L},handleLeave:function(b,w){return this._handleLeaveOrMissing("leave",b,w)},handleMissingUp:function(X){return this._handleLeaveOrMissing("missing",X)},handleLeaveImage:function(N,F,m,n,g,w,W){if(m&&(m=km(m))){var A=this.gv,R=W.rect,K=this.convertPoint(w,W);N===F+"|image"&&(m.onLeave&&m.onLeave(n,g,A,K,R.width,R.height),this.fire("image","onLeave",n,g,m,P,K,R));for(var r=W.compInfos,v=m,J=r.length-1;J>=0;J--){var S=r[J],M=S.comp;K=this.convertPoint(w,S,v,M,A,g),R=S.rect,N===F+"|"+J&&(M.onLeave&&M.onLeave(n,g,A,K,R.width,R.height),this.fire("comp","onLeave",n,g,m,M,K,R)),(m=R.image)&&N===F+"|"+J+"|image"&&(m.onLeave&&m.onLeave(n,g,A,K,R.width,R.height),this.fire("image","onLeave",n,g,m,P,K,R))}}},handleMissingUpImage:function(V,s,$,I,J,U){var j="onUp",B=this.downInfo.hits;if(B&&s&&(s=km(s))){var Y=this.gv,b=U.rect,h=this.convertPoint(J,U);!h.inRect&&B[V+"|image"]&&(s[j]&&s[j]($,I,Y,h,b.width,b.height),this.fire("image",j,$,I,s,P,h,b));for(var o=U.compInfos,r=s,R=o.length-1;R>=0;R--){var v=o[R],F=v.comp;h=this.convertPoint(J,v,r,F,Y,I),h.inRect||(b=v.rect,B[V+"|"+R]&&(F[j]&&F[j]($,I,Y,h,b.width,b.height),this.fire("comp",j,$,I,s,F,h,b)),(s=b.image)&&B[V+"|"+R+"|image"]&&(s[j]&&s[j]($,I,Y,h,b.width,b.height),this.fire("image",j,$,I,s,P,h,b)))}}},handleDownInfoImage:function(d,Q,Y,Z,K,e,U){var r=this.downInfo.hits;if(r&&Q&&(Q=km(Q))){var $=this.gv,n=U.rect,b=this.convertPoint(e,U);r[d+"|image"]&&(Q[Y]&&Q[Y](Z,K,$,b,n.width,n.height),this.fire("image",Y,Z,K,Q,P,b,n));for(var k=U.compInfos,o=Q,G=k.length-1;G>=0;G--){var g=k[G],i=g.comp;b=this.convertPoint(e,g,o,i,$,K),n=g.rect,r[d+"|"+G]&&(i[Y]&&i[Y](Z,K,$,b,n.width,n.height),this.fire("comp",Y,Z,K,Q,i,b,n)),(Q=n.image)&&r[d+"|"+G+"|image"]&&(Q[Y]&&Q[Y](Z,K,$,b,n.width,n.height),this.fire("image",Y,Z,K,Q,P,b,n))}}},initImageResource:function(){k.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},convertPoint:function(H,X,o,M,m,J){var v=X.rect,x=X.matrix.applyInverse(H).sub(v),y=x.x>=0&&x.y>=0&&x.x<=v.width&&x.y<=v.height;if(!y)return x;if(M&&hg(M.pixelPerfect,J,m)){var v,b=1;this._is2d?(b=m.getZoom(),v=bn(H.x,H.y,P,b)):v=bn(H.x,H.y);var z=!1,U=v.x,l=v.y,i=v.width,B=v.height,h=k.hitMaxArea,R=i*B*b*b;if(R>h){var a=Math.sqrt(h/R);b*=a}i*=b,B*=b,2>i&&(i=2),2>B&&(B=2),U*=b,l*=b;var d=Ph(i,B),K=new Fj(0,-U,-l,b,b);K.append(X.matrix),m._drawForChecking=!0,M.transform=K;var u=o.comps;o.comps=[M],mf(d,o,0,0,i,B,J,self),o.comps=u,delete M.transform,m._drawForChecking=!1;try{for(var C=0,Q=d.getImageData(0,0,i,B).data;C<Q.length;C+=4)if(0!==Q[C+3]){z=!0;break}d.restore()}catch(G){kc=Y,z=!1}x.inRect=z}else x.inRect=!0;return x}});var Gi=Mk.DefaultInteractor=function(N){wj(Gi,this,[N])};Gd("DefaultInteractor",Ic,{handle_mousedown:function(Z){vj(Z);var y=this,r=y.gv,O=r.getDataAt(Z);!r.setFocus(Z)||r._editing||r._scrolling||(Bs(Z)?r.handleDoubleClick(Z,O):r.handleClick(Z,O),!Qg()&&O&&(r.isMovable(O)||r.isInteractive(O))||!r.isPannable()||!Qe(Z)||En(Z)||(y._tx=r.tx(),y._ty=r.ty(),y.startDragging(Z)))},handleWindowMouseUp:function(a){var j=this,C=j.gv;C._panning&&(delete C._panning,C.onPanEnded(),j.fi({kind:"endPan",event:a})),delete j._tx,delete j._ty,j.clearDragging()},handle_mousemove:function(T){var Z=this,U=Z.gv;Z._hoverTimer&&(z(Z._hoverTimer),delete Z._hoverTimer),Z._hoverTimer=N(function(){Z.fi({kind:"hover",event:T}),z(Z._hoverTimer),delete Z._hoverTimer},U.getHoverDelay()||k.hoverDelay)},handle_touchmove:function(m){this.handle_mousemove(m)},handleWindowMouseMove:function(c){var i=this,G=i.gv,a=i._lastClientPoint;i.fi({kind:G._panning?"betweenPan":"beginPan",event:c}),G._panning=1,G.setTranslate(i._tx+c.clientX-a.x,i._ty+c.clientY-a.y)},handle_mousewheel:function(j){this.gv.handleScroll(j,j.wheelDelta)},handle_DOMMouseScroll:function(t){2===t.axis&&this.gv.handleScroll(t,-t.detail)},handle_keydown:function(m){this.gv.handleKeyDown(m)
}});var Yl=Mk.SelectInteractor=function(G){wj(Yl,this,[G])};Gd("SelectInteractor",Ic,{_42:function(){var m=this,Q=m.gv,g=Q.getZoom(),D=m.mark,P=m.div;P||(P=m.div=Aj(),Hb(m.getView(),P));var l={};l.x=D.x*g+Q.tx(),l.y=D.y*g+Q.ty(),l.width=D.width*g,l.height=D.height*g,dk(P,l),this.intersects()?(P.style.border="",P.style.background=Q.getRectSelectBackground()):(P.style.background="",P.style.border="1px solid "+Q.getRectSelectBorderColor())},handle_mousedown:function(I){var b=this,W=b.gv;if(b._57I=Y,b.pendingClickThrough=Y,!(W._editing||W._scrolling||Qg())){var B=W.getDataAt(I),m=W.sm();B?En(I)?m.co(B)?m.rs(B):m.as(B):m.co(B)?B instanceof Ff&&B.isClickThroughEnabled()&&(b.pendingClickThrough=ih(I)):m.ss(B):En(I)||!W.isPannable()?Qe(I)&&(En(I)||m.cs(),W.isRectSelectable()&&(b.startDragging(I),W._77O=1)):Qe(I)&&(b._57I=ih(I))}},handle_mouseup:function(y){var A=this,i=A.gv,h=A._57I;if(h&&(Qf(h,ih(y))<=1&&i.sm().cs(),A._57I=Y),A.pendingClickThrough){if(Qf(A.pendingClickThrough,ih(y))<=1){var p=i.getDataAt(y);if(p instanceof Ff&&p.isClickThroughEnabled()){var P=i.getDataAt(y,function(f){var c=f.getParent()===p&&i.isSelectable(f,!0);return c});P&&(y.clickThrough=!0,i.sm().ss(P))}}A.pendingClickThrough=Y}},handleWindowMouseUp:function(J){this.clear(J)},handleWindowMouseMove:function(S){var C=this,x=C.gv;C._logicalPoint=x.lp(S),C.mark?(C.fi({kind:"betweenRectSelect",event:S}),x.isPannable()&&C.autoScroll(S),C.redraw()):C.fi({kind:"beginRectSelect",event:S}),C.mark=ig(C._lastLogicalPoint,C._logicalPoint),C.redraw()},intersects:function(){var F=this,N=F._lastLogicalPoint,c=F._logicalPoint;return N.x>c.x||N.y>c.y},clear:function(s){var I=this,a=I.gv,q=I.mark;if(I._57I=Y,I.pendingClickThrough=Y,I._lastLogicalPoint){if(q){if(0!==q.width&&0!==q.height){var F=a.getDatasInRect(q,I.intersects());if(!F.isEmpty()){var J=a.sm(),c=J.toSelection();F.each(function(Z){J.co(Z)?c.remove(Z):c.add(Z)}),J.ss(c)}}rn(I.div),delete I.div,delete I.mark,I.redraw(),I.fi({kind:"endRectSelect",event:s}),a.onRectSelectEnded()}I.clearDragging(),delete a._77O}},redraw:function(){var c=this;c._draw||(c._draw=1,N(function(){c.mark&&c._42(),delete c._draw},16))}});var Zq=Mk.MoveInteractor=function(u){wj(Zq,this,[u])};Gd("MoveInteractor",Ic,{handle_mousedown:function(b){var A=this,R=A.gv;if(Qe(b)&&!R._editing&&!R._scrolling&&!Qg()){var O=R.getSelectedDataAt(b);!O||R.isInteractive(O)&&!R.isMovable(O)?R._focusData=Y:(A._data=O,R.handleMouseDown&&R.handleMouseDown(b,O),A.startDragging(b),R.isMovable(O)&&(R._moving=1))}},handleWindowMouseUp:function(U){var K=this,T=K.gv;T.handleMouseUp&&T.handleMouseUp(U,K._data),K.clear(U)},handleWindowMouseMove:function(U){var w=this,_=w._data,A=w.gv;if((!A._93O||!A._93O(U,_))&&A._moving){w._logicalPoint||w.fi({kind:"prepareMove",event:U});var j=w._logicalPoint?"betweenMove":"beginMove",V={kind:j,event:U},K=w._logicalPoint=A.lp(U);"beginMove"!==j||w._alreadyBeginTransaction||(w._alreadyBeginTransaction=!0,A.getDataModel().beginTransaction());var p=w._calcShift(j,U),v=p.x,a=p.y,y=w.gv.getMoveMode(U,_);y&&("x"===y?a=0:"y"===y?v=0:"xy"!==y&&(v=a=0)),A.moveSelection(v,a),w._lastLogicalPoint=K,w.autoScroll(U),w.fi(V)}},_calcShift:function(){var V=this,m=V._logicalPoint,L=V._lastLogicalPoint,q=m.x-L.x,$=m.y-L.y;return{x:q,y:$}},clear:function(p){var $=this,G=$.gv;$._lastLogicalPoint&&($._lastLogicalPoint=$._data=G._moving=Y,$._logicalPoint&&($.fi({kind:"endMove",event:p}),G.onMoveEnded()),$.clearDragging()),$._alreadyBeginTransaction&&($._alreadyBeginTransaction=!1,G.getDataModel().endTransaction())}});var Zm=Mk.ScrollBarInteractor=function(C){wj(Zm,this,[C])};Gd("ScrollBarInteractor",Ic,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(E){var U=this.gv.getViewRect();return this._41o()&&(U.x+U.width-this.gv.lp(E).x)*this.gv.getZoom()<_b},isH:function(c){var x=this.gv.getViewRect();return this._40o()&&(x.y+x.height-this.gv.lp(c).y)*this.gv.getZoom()<_b},handle_mousemove:function(D){this.handle_touchmove(D)},handle_touchmove:function(L){if(!no&&Qe(L)&&this.gv.isScrollBarVisible()){var u=this,b=u.isV(L),w=u.isH(L);(b||w)&&u.gv.showScrollBar(),u.gv._scrolling=b||w}},handleWindowMouseUp:function(i){this.handleWindowTouchEnd(i)},handleWindowTouchEnd:function(h){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=Y,this.fi({kind:"endScroll",event:h})},handle_mousedown:function(g){this.handle_touchstart(g)},handle_touchstart:function(o){var J=this;if(J.gv.setFocus(o),vj(o),J.handle_touchmove(o),!(Lc(o)>1)&&J.gv._scrolling&&J.gv.isScrollBarVisible()){J._cp=ih(o),J._tx=J.gv.tx(),J._ty=J.gv.ty();var x=J.isV(o);J._state=x?"vScroll":"hScroll",rc(J,o),J.fi({kind:"beginScroll",event:o})}},handleWindowMouseMove:function(r){this.handleWindowTouchMove(r)},handleWindowTouchMove:function(K){var n=ih(K),x=this.gv.getViewRect(),N=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-n.y)*N.height/x.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-n.x)*N.width/x.width),this.fi({kind:"betweenScroll",event:K})}});var pe=Mk.TouchInteractor=function(T,L){L=L||{},L.selectable===P&&(L.selectable=!0),L.movable===P&&(L.movable=!0),L.pannable===P&&(L.pannable=!0),L.pinchable===P&&(L.pinchable=!0),L.editable===P&&(L.editable=!0),this.params=L,wj(pe,this,[T])};Gd("TouchInteractor",Ic,{ms_edit:1,setUp:function(){var Y=this;pe.superClass.setUp.call(Y),hc&&Y.params.editable&&Y.gv.setEditInteractor(Y)},tearDown:function(){var u=this;pe.superClass.tearDown.call(u),hc&&u.params.editable&&u.gv.setEditInteractor(Y)},clear:function(d){var S=this,W=S.gv;W._moving&&(S.fi({kind:"endMove",event:d}),delete W._moving,W.onMoveEnded(),W.dm().endTransaction()),W._panning&&(S.fi({kind:"endPan",event:d}),delete W._panning,W.onPanEnded()),W._pinching&&(S.fi({kind:"endPinch",event:d}),delete W._pinching,W.onPinchEnded()),W._editing&&(S._46O(d),S._77I=S._node=S._edge=S._shape=S._rect=S._89I=S._index=W._editing=Y),S._moving=S._panning=S._pinching=S._editing=S._57I=S._data=S._beginHistory=Y,S.clearDragging()},handle_touchstart:function(n){var f=this;if(!f.gv._editing){vj(n),f._57I=Y;var g=f.params,T=f.gv,P=T.sm(),k=T.getDataAt(n),s=Lc(n);if(1===s){if(Bs(n))return T.handleDoubleClick(n,k),void 0;T.handleClick(n,k),k&&(T.handleMouseDown&&T.handleMouseDown(n,k),f._data=k),g.selectable||(k=Y),k?(P.co(k)||P.ss(k),g.editable&&T.isEditable(k)&&f._79I(n,k,!0)?(f._editing=1,f.startDragging(n)):g.movable&&T.isMovable(k)&&(f._moving=1,f.startDragging(n))):(f._57I=ih(n),g.pannable&&T.isPannable()&&(f._panning=1,f.startDragging(n),f._translate={x:T.tx(),y:T.ty()}))}else if(g.pinchable&&2===s){f._pinching=1,f.startDragging(n);var m=T.getView(),v=T.getZoom(),O=m.getBoundingClientRect(),N=n.touches[0],U=n.touches[1],t={x:(N.clientX+U.clientX)/2-O.left,y:(N.clientY+U.clientY)/2-O.top};t.x-=T.tx(),t.y-=T.ty(),t.x/=v,t.y/=v,f._p=t,f._d=No(n)}}},handle_touchend:function(J){var Q=this,C=Q.gv,o=Q._57I,$=Q._data;o&&(Qf(o,ih(J))<=1&&C.sm().cs(),Q._57I=Y),$&&C.handleMouseUp&&C.handleMouseUp(J,$)},handleWindowTouchEnd:function(K){this.clear(K)},handleWindowTouchMove:function(d){var G=this,O=G.gv,t=Lc(d);if(1===t){if(G._editing&&(G._beginHistory||(G._beginHistory=1,O.dm().beginTransaction()),O._editing=1,G._78I(d)),G._moving)G._beginHistory||(G._beginHistory=1,O.dm().beginTransaction()),G.handleMove(d);else if(G._panning){var I=ih(d);O.setTranslate(G._translate.x+I.x-G._lastClientPoint.x,G._translate.y+I.y-G._lastClientPoint.y),G.fi({kind:O._panning?"betweenPan":"beginPan",event:d}),O._panning=1}}else if(2===t&&G._pinching){var m=No(d);O.handlePinch(G._p,m,G._d),G._d=m,G.fi({kind:O._pinching?"betweenPinch":"beginPinch",event:d}),O._pinching=1}},handleMove:function(Q){var T=this,B=T.gv,H=B.lp(Q);B._93O&&B._93O(Q,T._data)||(B.moveSelection(H.x-T._lastLogicalPoint.x,H.y-T._lastLogicalPoint.y),T._lastLogicalPoint=H,T.autoScroll(Q),T.fi({kind:B._moving?"betweenMove":"beginMove",event:Q}),B._moving=1)}});var C=f.ht,zr=C.graph._editor={Math:C.Math,Guide:{}};zr.getStyle=function(E){var N,s=zr.StyleMap;return s&&(N=s[E],N!==P)?N:zr.DefaultStyleMap[E]},zr.setStyle=function(V,y){var B=zr.StyleMap;B||(B=zr.StyleMap={}),B[V]=y},zr.inEdit=function(e){return e._inXEdit===!0},zr.startEdit=function(f){f._inXEdit=!0,zr.Inject.doInject(f)},zr._46O=function(S){S._inXEdit=!1,zr.Inject.undoInject(S)},zr.toScreenPosition=function(P,A){var $=P.tx(),r=P.ty(),z=P._zoom;return new zr.Math.Vector2(A.x*z+$,A.y*z+r)},zr.checkHit=function(e,L,B){return e.distanceTo(L)<B?!0:!1},zr.toWorldPosition=function(n,T){var h=n.tx(),q=n.ty(),k=n._zoom;return{x:(T.x-h)/k,y:(T.y-q)/k}},zr.setAntialias=function(R,W){for(var t,c=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],Z=0,H=c.length;H>Z&&(t=c[Z],!(t in R));Z++);R[t],R[t]=W},zr.getTargetCornersOnScreen=function(t,O){if(!O)return null;var $,v=[];if(ao(O,t)){var Y=vg(t,O);$=[{x:Y.x,y:Y.y},{x:Y.x+Y.width,y:Y.y},{x:Y.x+Y.width,y:Y.y+Y.height},{x:Y.x,y:Y.y+Y.height}]}else{if(!O.getCorners)return null;$=O.getCorners()}return $.forEach(function(L){var I=zr.toScreenPosition(t,L);v.push(I.x,I.y)}),v},zr.log=function(){};var Sh=zr.Inject={_modules:[]};Sh.registAsModule=function(p,E){var A={},T={};for(var S in p){var m=E.prototype[S];A[S]=m}p.getBackup=function(g){return A[g]},p.getBackups=function(){return A},T.doInject=function(){for(var H in p)"getBackup"!==H&&(E.prototype[H]=p[H])},T.undoInject=function(){for(var S in p)"getBackup"!==S&&(E.prototype[S]=A[S])},Sh._modules.push(T)},Sh.doInject=function(P){for(var Z,A=Sh._modules,_=0,r=A.length;r>_;_++)Z=A[_],Z.doInject(P)},Sh.undoInject=function(p){for(var h,o=Sh._modules,q=0,$=o.length;$>q;q++)h=o[q],h.undoInject(p)};var Ic=C.graph.EditInteractor=function(t){var o=this,O=H.createElement("canvas");O.className="editCanvas",O.style.position="absolute",o._styleMap={},o._canvas=O,o._context=O.getContext("2d"),Ic.superClass.constructor.call(o,t),zr.setAntialias(o._context,!1),o._subModules=[new zr.Anchor(o),new zr.RotateX(o),new zr.Rect(o),new zr.Curve(o),new zr.MoveHelper(o)],o._gridGuide=new zr.Guide.Grid(o),o._rectGuide=new zr.Guide.Rect(o)},Qr=Ic;C.Default.def(Ic,C.graph.Interactor,{ms_edit:1,ms_fire:1}),$.defineProperties(Ic.prototype,{editDetail:{get:function(){var i=!!this._editDetail;return i},set:function(Q){var K=this,X=K._editDetail;X!==Q&&(K._editDetail=Q,K.gv._editing=Q,K.fp("editDetail",X,Q),K.fp("pointsEditingMode",X,Q),K.fi({kind:Q?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(l){(!this._editDetail||l)&&(this.gv._editing=l,l||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(P){this._editing=P,this.gvEditing=P}},pointsEditingMode:{get:function(){return this.editDetail},set:function(V){var K=this;K.editDetail!==V&&(V?K._tryEnterEditDetailMode():K._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var y=this._gridEnabled;if(!y)return!1;var Z=this.gv;return Z?!0:!0},set:function(Z){Z!==this._gridEnabled&&(this._gridEnabled=Z,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(S){S!==this._agEnabled&&(this._agEnabled=S,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}}}),Ic.prototype.getSubModule=function(U){var m,T,a,g=this._subModules;for(T=0,a=g.length;a>T;T++)if(m=g[T],m.catalog===U)return m},Ic.prototype.invokeSubModule=function(G,Q){var b=this,$=b._subModules;if($)for(var h,r,e,M=Array.prototype.slice.call(arguments,2),F=0,K=$.length;K>F;F++)if(h=$[F],r=h[G],r&&(e=r.apply(h,M),e!=P&&Q))return h},Ic.prototype.invokeSubModuleInverse=function(r,W){var h=this,J=h._subModules;if(J)for(var u,t,c,C=Array.prototype.slice.call(arguments,2),H=J.length-1;H>=0;H--)if(u=J[H],t=u[r],t&&(c=t.apply(u,C),c!=P&&W))return u},Ic.prototype.setUp=function(){zr.log("setUp");var g=this,t=g.gv,q=t.getView(),V=g._canvas;Ic.superClass.setUp.call(g),t.setEditInteractor(g),t._79O?q.insertBefore(V,t._79O):q.appendChild(V),zr.startEdit(t),g.invokeSubModule("setUp"),t.dm().mm(g._onDataModelChanged,g),t.dm().md(g._onDataPropertyChanged,g)},Ic.prototype.tearDown=function(){zr.log("tearDown");var Q=this,b=Q.gv,S=b.getView();Q._resetCustomCursorStyle(),Ic.superClass.tearDown.call(Q),b.dm().umm(Q._onDataModelChanged,Q),b.dm().umd(Q._onDataPropertyChanged,Q),b.setEditInteractor(null),S.removeChild(Q._canvas),Q._drawTimer&&(z(Q._drawTimer),Q._drawTimer=null),zr._46O(b),Q.invokeSubModule("tearDown")},Ic.prototype._onDataModelChanged=function(e){var F=this;("clear"===e.kind||"remove"===e.kind&&F.editDetail&&e.data===F.getSubModule("Curve").target)&&(F.editDetail=!1,F._42())},Ic.prototype._onDataPropertyChanged=function(j){var t=this;if(t.editDetail){var F=t.getSubModule("Curve"),$=j.data;$===F.target&&($._writing||F._handleDataChanged())}},Ic.prototype.clear=function(){zr.log("clear")},Ic.prototype.redraw=function(){this._42()},Ic.prototype._42=function(){var b=this;b._drawTimer||(b._drawTimer=N(function(){b._drawTimer=null,b.drawImpl()},0))},Ic.prototype.drawImpl=function(){var f;for(f in{_42:!0})break;return function(){var S=this,D=S._canvas,e=S.gv,B=e.getWidth(),s=e.getHeight(),A=S._context,k=C.Default.getInternal();(D.width!==B||D.height!==s)&&k.setCanvas(D,B,s),A.clearRect(0,0,D.width,D.height);var I=S._getValidSelection();A.save();var G=C.Default.devicePixelRatio;A.scale(G,G),S._gridGuide._42(),S.invokeSubModuleInverse(f,!1,A,e,I),S._rectGuide._42(),A.restore()}}(),Ic.prototype._getValidSelection=function(){var G=this,e=G.gv,g=e.sm().getSelection(),a=[];return g.each(function(W){e.isVisible(W)&&e.isEditable(W)&&a.push(W)}),a},Ic.prototype.handle_touchmove=function(c){return this.handle_mousemove(c)},Ic.prototype.handle_mousemove=function(g){if(!C.Default.isDragging()){var $=this;($.editDetail||!Qg())&&($.gvEditing=!1,$._checkEdit(g)&&($.gvEditing=!0))}},Ic.prototype.handle_touchstart=function(O){return this.handle_mousedown(O)},Ic.prototype.handle_mousedown=function(B){vj(B);var i=this;if(i.editDetail||!Qg()){if(Bs(B)&&!B.clickThrough){if(i.editDetail){if(i._tryQuitEditDetailMode(B))return}else if(i._tryEnterEditDetailMode())return;i.gv.dm().beginTransaction();var Q=i.invokeSubModule("handleDoubleClick",!0,B);if(i.gv.dm().endTransaction(),Q)return}var b=i._checkEdit(B);b&&(i._downPosition=i._getLogicalPoint(B),i.gv.dm().beginTransaction(),b.startEdit(i,B),i.editing=!0)}},Ic.prototype._checkEdit=function(z){var q=this,m=q.gv,e=q._getLogicalPoint(z),C=q.invokeSubModule("check",!0,m,z,e)||null;return q._editMod=C,C},Ic.prototype.handleWindowTouchMove=function(R){return this.handleWindowMouseMove(R)},Ic.prototype.handleWindowMouseMove=function(n){var B=this,w=B._downPosition;if(w){var z=B._getLogicalPoint(n);if(z.distanceTo(w)<B.getStyle("moveSensitivity"))return;delete B._downPosition}var K=B._editMod;K&&K.handleEdit(B.gv,n)},Ic.prototype._getLogicalPoint=function(m){var Q=this,q=C.Default.getLogicalPoint(m,Q._canvas);return new zr.Math.Vector2(q)},Ic.prototype.handleWindowTouchEnd=function(Q){return this.handleWindowMouseUp(Q)},Ic.prototype.handleWindowMouseUp=function(){var D;for(D in{_46O:!0})break;return function(W){var q=this;q.editing=!1,q.setCursor("default"),q.invokeSubModule(D,!1,W),q._42(),q.gv.dm().endTransaction()}}(),Ic.prototype.handle_mousewheel=function(o){var c=this;vj(o),c.invokeSubModule("preHandleScroll",!0)||c.gv.handleScroll(o,o.wheelDelta)},Ic.prototype.handleDelete=function(){var G=this;if(!G.editDetail){G.gv.dm().beginTransaction();var L=G.invokeSubModule("handleNormalStateDelete",!0);return G.gv.dm().endTransaction(),L||G.gv.removeSelection(),void 0}G.gv.dm().beginTransaction(),G.invokeSubModule("handleDelete",!0),G.gv.dm().endTransaction(),G._42()},Ic.prototype.handle_keydown=function(g){var t=this;if((g.metaKey||g.ctrlKey)&&t._42(),Qg(g)&&!t.editing)return t.gvEditing=!1,t.setCursor("default"),t._42(),void 0;var I=Jf(g);return t.editDetail?((I||xs(g))&&(t.editDetail=!1,t._42()),t.gv.dm().beginTransaction(),t.invokeSubModule("handle_keydown",!0,g),t.gv.dm().endTransaction(),void 0):(t.gv.dm().beginTransaction(),t.invokeSubModule("handleNormalStateKeyDown",!0,g),t.gv.dm().endTransaction(),I&&t._tryEnterEditDetailMode(),void 0)},Ic.prototype.handle_keyup=function(u){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,u),this.gv.dm().endTransaction()},Ic.prototype._tryEnterEditDetailMode=function(){var X=this;return!X.editDetail&&X.invokeSubModule("canEnterEditDetailMode",!0)&&1===X._getValidSelection().length?(X.editDetail=!0,X._42(),!0):void 0},Ic.prototype._tryQuitEditDetailMode=function(q){var J=this;if(J.editDetail){var d=J.gv,s=J.getSubModule("Curve").target;return q&&d.getDataAt(q)===s?void 0:(J.editDetail=!1,J._42(),!0)}},Ic.prototype.setStyle=function(K,Q,I){var x=this;I?zr.setStyle(K,Q):x._styleMap[K]=Q,x.fp("styleChanged",null,{key:K,value:Q,base:I}),x._42()},Ic.prototype.getStyle=function(V){var t=this,H=t._styleMap[V];return H!==P?H:zr.getStyle(V)},Ic.prototype.setCursor=function(D){this._resetCustomCursorStyle(),C.graph.EditInteractor.superClass.setCursor.call(this,D)},Ic.prototype._resetCustomCursorStyle=function(){var j=this;if(j._customStyle){var f=this.gv.getView();f.classList&&f.classList.remove&&f.classList.remove(j._customStyle),j._customStyle=null}},Ic.prototype._setRotateCursor=function(r){var S=this,l=S._cursorFactory;l||(l=S._cursorFactory=new zr.CursorFactory(S));var O=l.getRotateCursor(r),s=S.gv.getView();S._resetCustomCursorStyle(),S._customStyle=O,s.classList&&s.classList.add&&s.classList.add(O)};var Bn=zr.Group=function(W){var O=this;O._entities=W,O._64O=0,O._position={x:0,y:0},O._scale={x:1,y:1},O._anchor={x:.5,y:.5},O._anchor2={x:.5,y:.5}};Bn.prototype={},Bn.prototype.constructor=Bn;var Ki=null;Bn.findOrCreateGroup=function(X){if(Ki&&Ki.checkIsMe(X))return Ki;var z=new zr.Group(X);return z.getKeyOb()?(Ki=z,z):void 0},Bn.prototype.checkIsMe=function(P){var Z=this._entities;if(Z.length!==P.length)return!1;var S,o={},K=P.length;for(S=0;K>S;S++)o[P[S]._id]=!0;for(S=0;K>S;S++)if(!o[Z[S]._id])return!1;return!0},Bn.prototype.getRotation=function(){return this._64O},Bn.prototype.getPosition=function(){return this._position},Bn.prototype.getAnchor=function(){return this._anchor},Bn.prototype.getWidth=function(){return this._width},Bn.prototype.getScale=function(){return this._scale},Bn.prototype.getSize=function(){return{width:this._width,height:this._height}},Bn.prototype.getHeight=function(){return this._height},Bn.prototype.getKeyOb=function(){for(var w=this._entities,I=w.length-1;I>=0;I--){var m=w[I];if(this.isNode(m))return m}},Bn.prototype.getAnchor2=function(){var p=this,m=p.rotateCenter;if(m)return m;var N=p.getKeyOb();if(!N)return p._anchor;var W=p._anchor2,S=N.getMatrix();return S.tf({x:N.getWidth()*(W.x-N.getAnchor().x),y:N.getHeight()*(W.y-N.getAnchor().y)})},Bn.prototype.setAnchor2=function(M,l){var g=this,B=g.getKeyOb();if(B){var Q,x=B.getMatrix();Q="number"==typeof M?{x:M,y:l}:M;var e=x.tfi(Q);g._anchor2={x:B.getAnchor().x+e.x/B.getWidth(),y:B.getAnchor().y+e.y/B.getHeight()}}},Bn.prototype.setRotation=function(){},Bn.prototype.beginRotate=function(c){this.rotateCenter=c.pos,this.rotateMode=c.groupRotateMode},Bn.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},Bn.prototype.addRotation=function(e,c){return"batch"===c?this._addRotationInBatchMode(e):"block"===c?this._addRotationInBlockMode(e):void 0},Bn.prototype._addRotationInBlockMode=function(o){var g=this,a=g.rotateCenter||g.getPosition();g._entities.forEach(function(r){if(g.isNode(r)){var D=r.getMatrix();D.translate(-a.x,-a.y),D.rotate(o),D.translate(a.x,a.y);var F=Math.sign(r.getScale().x);r.setRotation(d(D.b*F,D.a*F)),r.setPosition(D.tx,D.ty)}})},Bn.prototype._addRotationInBatchMode=function(k){var V=this,c=V._anchor2;V._entities.forEach(function($){if(V.isNode($)){var Q=$.getAnchor(),a=$.getMatrix(),n=a.tf({x:$.getWidth()*(c.x-Q.x),y:$.getHeight()*(c.y-Q.y)}),s=new zr.Math.Matrix2d;s.set(a.a,a.b,a.c,a.d,a.tx,a.ty),s.translate(-n.x,-n.y),s.rotate(k),s.translate(n.x,n.y);var O=Math.sign($.getScale().x);$.setRotation(d(s.b*O,s.a*O)),$.setPosition(s.tx,s.ty)}})},Bn.prototype.setPosition=function(O){var a,J,G,R,k=this,u=k._position,T=O.x-u.x,K=O.y-u.y,W=k._entities;for(J=0,G=W.length;G>J;J++)a=W[J],fr(a)&&(R=a.getPosition(),a.setPosition(R.x+T,R.y+K));k._position=O},Bn.prototype.setScale=function($,k){var d=this,f=$/d._scale.x,m=k/d._scale.y;d._adjustChildScaleOrSize(f,m,"size"),d._scale={x:$,y:k}},Bn.prototype.getRect=function(){var M=this,I=M._position,D=M._width,L=M._height;return{x:I.x-D/2,y:I.y-L/2,width:D,height:L}},Bn.prototype.setSize=function(U,T){var E=this,U=Math.max(1,U),T=Math.max(1,T),f=U/E._width,B=T/E._height;E._adjustChildScaleOrSize(f,B,"size"),E._width=U,E._height=T},Bn.prototype._adjustChildScaleOrSize=function(n,p,r){var b,y,w,J,G,S,T,q,_,j,k,F,W,M,z=this,u=z._position,I=z._entities,s=new zr.Math.Matrix2d;for(y=0,w=I.length;w>y;y++)if(b=I[y],z.isNode(b)){if(J=b.getPosition(),G=b.getRotation(),S=b.getWidth(),T=b.getHeight(),q=b.getScale(),k=q.x*S,F=q.y*T,s.identity().scale(k,F).rotate(G).translate(J.x,J.y).translate(-u.x,-u.y).rotate(-z._64O),G=d(s.b*Math.sign(k),s.a*Math.sign(k)),s.scale(n,p),_=Math.cos(G),j=Math.sin(G),Math.abs(_)<.001?(W=s.b/j,M=-s.c/j):(W=s.a/_,M=s.d/_),"scale"===r)b.setScale(W/S,M/T);else if("size"===r){var v=W/q.x,e=M/q.y;b.setScale(Pb(W)*Math.abs(q.x),Pb(M)*Math.abs(q.y)),b.setSize(Math.max(.1,Math.abs(v)),Math.max(.1,Math.abs(e)))}s.rotate(z._64O).translate(u.x,u.y),b.setPosition(s.tx,s.ty)}},Bn.prototype.getMatrix=function(){var Z=this,x=Z._position,E=C.Default.getInternal(),u=Z._scale;return new E.Mat(Z._64O,x.x,x.y,u.x,u.y)},Bn.prototype.toGlobal=function(U){return this.getMatrix().tf(U)},Bn.prototype.getCorners=function(){var X=this,E=X._width,T=X._height,p=X._anchor,u=-E*p.x,Y=-T*p.y,Q=X.getMatrix();return[Q.tf(u,Y),Q.tf(u,Y+T),Q.tf(u+E,Y+T),Q.tf(u+E,Y)]},Bn.prototype.calcInfo=function(){var L,A,H,t,a,F,D=this,I=[],x=D._entities,u=D._64O;for(t=0,a=x.length;a>t;t++)F=x[t],D.isNode(F)&&F.getCorners&&I.push.apply(I,F.getCorners());if(I.length){var M=Math.cos(-u),T=Math.sin(-u),n=1/0,Y=-1/0,z=1/0,v=-1/0;for(t=0,a=I.length;a>t;t++)H=I[t],L=H.x,A=H.y,H.x=M*L-T*A,H.y=T*L+M*A,n=Math.min(n,H.x),Y=Math.max(Y,H.x),z=Math.min(z,H.y),v=Math.max(v,H.y);D._width=(Y-n)/D._scale.x,D._height=(v-z)/D._scale.y,M=Math.cos(u),T=Math.sin(u);var R=D._anchor;L=n+(Y-n)*R.x,A=z+(v-z)*R.y,D._position={x:M*L-T*A,y:T*L+M*A}}},Bn.prototype.isNode=function(X){return fr(X)?ao(X)?!1:!0:!1},Bn.prototype._42=function(E,d,F){var c,e,P,U,T,S,h,m,C=this,I=C._entities,z=C.rotateMode;for("batch"===z&&(m=C.getKeyOb()),c=0,e=I.length;e>c;c++)P=I[c],C.isNode(P)&&(S=P.getRect(),U=zr.toScreenPosition(F,{x:S.x,y:S.y}),T=zr.toScreenPosition(F,{x:S.x+S.width,y:S.y+S.height}),h={min:U,max:T},P===m&&(h.isKeyOb=!0),zr.Icons.DrawIcon(E,d,zr.Icons.GroupSubEntityRect,h))};var In=zr.CurveActiving=function(r,x){this._curve=r,this._interactor=r._interactor;for(var o in x)this[o]=x[o]};In.prototype={},In.prototype.constructor=In,$.defineProperties(In.prototype,{point:{get:function(){return this._point},set:function(R){var X=this;X._point=R,X.editingCtrl||X._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(K){var z=this;z._pairs=K,z.editingCtrl&&z._firePointChange()}}}),In.prototype._firePointChange=function(){var f=this,G=f.getCurrentEditingPoint();if(!G)return C.fi({kind:"selectPoint"}),void 0;var C=f._interactor,I=this._curve.target;if(I){var F=zr.getDataMatrix(I).invert(),o=G.e;G=F.apply(zr.toWorldPosition(C.gv,G)),G.e=o;var T=f._lastFirePoint;T&&Math.abs(G.x-T.x)<1e-5&&Math.abs(G.y-T.y)<1e-5&&(G.e==P&&T.e==P||Math.abs(G.e-T.e)<1e-5)||(f._lastFirePoint=G,C.fi({kind:"selectPoint",x:G.x,y:G.y,e:G.e}))}},In.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},In.prototype.getCurrentEditingPoint=function(){var v=this,$=v.editingCtrl;if($){var A=v.pairs;if(A){var O=A[$.pairId],L=O[$.type];if(L)return L}}return v._point};var Jc=zr.CursorFactory=function(I){var B=this;B._interactor=I,B._rotateCursorStyles={}};Jc.prototype={},Jc.prototype.constructor=Jc,Jc.prototype.getRotateCursor=function(I){var M=this;0>I&&(I+=2*Math.PI);var T=M._interactor,o=T.getStyle("rotateCursorSize"),Z=T.getStyle("rotateCursorRound"),W=Math.round(180*(I/Math.PI)/Z);W*Z>=360&&(W=0);var h=M._rotateCursorStyles,v="htCustomRotateStyle_"+o+"_"+Z+"_"+W;return h[v]||(M._produceRotateCursor(v,o,Z,W),h[v]=!0),v},Jc.prototype._produceRotateCursor=function(q,M,t,n){var Q=this;Q._interactor;var R=Q._canvas;R||(R=Q._canvas=H.createElement("canvas")),R.width=R.height=M*devicePixelRatio,R.style.width=R.style.height=M+" px";var A=R.getContext("2d");zr.setAntialias(A,!1),A.scale(devicePixelRatio,devicePixelRatio);var s,m,e,l,o,d=Math.round(M/2),u=""+d+" "+d+",auto !important;";s=Math.PI/180*n*t,A.clearRect(0,0,M,M),A.save(),A.scale(M/32,M/32),A.translate(16,16),A.rotate(s+Math.PI/2),A.beginPath(),A.moveTo(-8,0),A.lineTo(-8,3),A.lineTo(-5,3),A.moveTo(8,0),A.lineTo(8,3),A.lineTo(5,3),A.moveTo(-8,3),A.quadraticCurveTo(0,-6,8,3),A.restore(),A.strokeStyle="white",A.lineWidth=4,A.stroke(),A.strokeStyle="black",A.lineWidth=2,A.stroke(),m=JSON.stringify(R.toDataURL()),l="cursor:url("+m+")"+u,1!==devicePixelRatio&&(e='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+M+'px" height="'+M+'px"><image xlink:href='+m+' width="'+M+'" height="'+M+'"/></svg>',l+="cursor:url(data:image/svg+xml;base64,"+btoa(e)+")"+u,l+="cursor:-webkit-image-set(url("+m+")"+devicePixelRatio+"x,url("+m+")1x)"+u),o=H.createElement("style"),o.textContent="body."+q+" *, ."+q+"{"+l+"}",H.head.appendChild(o)};var Mq=zr.Guide.Grid=function(v){var z=this;z._interactor=v,z._alignmentGuideId=0,z._xAlignmentGuide=[],z._yAlignmentGuide=[]};Mq.prototype={},Mq.prototype.constructor=Mq,$.defineProperties(Mq.prototype,{gridBlockSize:{get:function(){var o=this;return o._gridBlockSize||o._interactor.getStyle("gridBlockSize")},set:function(p){this._gridBlockSize=p,this._interactor._42()}},gridThickLinesEvery:{get:function(){var D=this;return D._gridThickLinesEvery||D._interactor.getStyle("gridThickLinesEvery")},set:function(h){this._gridThickLinesEvery=h,this._interactor._42()}},gridEnabled:{get:function(){var M=this,v=M._interactor;return v.gridEnabled&&M.isValidGrid()}}}),Mq.prototype._42=function(){var v=this,t=v._interactor;v.gridEnabled&&v.drawGrid(),t.alignmentGuideEnabled&&v.drawAlignmentGuide()},Mq.prototype.makeMatrix=function(){var y=this,I=y._interactor.getStyle("gridAngle"),J=y._interactor.getStyle("gridRotation"),E=new zr.Math.Matrix2d,H=Math.sin(I),G=Math.cos(I);return E.set(1,0,G,H,0,0),E.rotate(J),E},Mq.prototype.isValidGrid=function(){var b=this,D=Math.PI,r=b._interactor,X=r.gv;if(X._zoom<r.getStyle("gridZoomThreshold"))return!1;var n=r.getStyle("gridAngle"),S=Math.abs(180*(n%D/D)),x=1-1e-8;return x>S||S>180-x?!1:!0},Mq.prototype.drawAlignmentGuide=function(){var S=this,m=S._interactor,$=m.gv,t=m._canvas,G=m._context,U=t.width,C=t.height,u=$.tx(),Z=$.ty(),n=$._zoom;G.beginPath(),G.strokeStyle=m.getStyle("gridAlignmentGuideColor"),G.lineWidth=1,S._xAlignmentGuide.forEach(function(B){var _=B.p*n+u;G.moveTo(_,0),G.lineTo(_,C)}),S._yAlignmentGuide.forEach(function(O){var l=O.p*n+Z;G.moveTo(0,l),G.lineTo(U,l)}),G.stroke()},Mq.prototype.drawGrid=function(){function B(w,b,$,B){var v=zr.toScreenPosition(W,E.apply({x:w,y:b})),X=zr.toScreenPosition(W,E.apply({x:$,y:B}));L.moveTo(v.x,v.y),L.lineTo(X.x,X.y)}var M=this,n=M._interactor,t=M.gridBlockSize,w=M.gridThickLinesEvery,c=n.getStyle("gridThickColor"),l=n.getStyle("gridLightColor"),W=n.gv,j=n._canvas,L=n._context,g=j.width,x=j.height,E=M.makeMatrix(),f=E.applyInverse(zr.toWorldPosition(W,{x:0,y:0})),V=E.applyInverse(zr.toWorldPosition(W,{x:g,y:0})),s=E.applyInverse(zr.toWorldPosition(W,{x:0,y:x})),u=E.applyInverse(zr.toWorldPosition(W,{x:g,y:x})),Q=Math.min(f.x,V.x,s.x,u.x),h=Math.max(f.x,V.x,s.x,u.x),$=Math.min(f.y,V.y,s.y,u.y),F=Math.max(f.y,V.y,s.y,u.y);g=h-Q,x=F-$;var y=Math.ceil(Q/t),p=Math.floor(h/t),e=Math.ceil($/t),T=Math.floor(F/t);W.tx(),W.ty(),W._zoom;var v,d,X;for(L.save(),L.lineWidth=1,L.beginPath(),L.strokeStyle=c,X=Math.ceil(y/w)*w;p>=X;X+=w)v=X*t,B(v,$,v,F);for(X=Math.ceil(e/w)*w;T>=X;X+=w)d=X*t,B(Q,d,h,d);for(L.stroke(),L.beginPath(),L.strokeStyle=l,X=y;p>=X;X++)0!==X%w&&(v=X*t,B(v,$,v,F));for(X=e;T>=X;X++)0!==X%w&&(d=X*t,B(Q,d,h,d));L.stroke(),L.restore()},Mq.prototype.getAlignmentGuides=function(){var m=this;return{x:m._xAlignmentGuide,y:m._yAlignmentGuide}},Mq.prototype.addAlignmentGuide=function(Y,F,J){var y=this,U="x"===Y?y._xAlignmentGuide:y._yAlignmentGuide,J=J?J:++y._alignmentGuideId,e={p:F,id:J};if(U.length){var O=y._findClosestAlignmentGuide(e.p,U);O.dis<0?U.splice(O.index+1,0,e):U.splice(O.index,0,e)}else U.push(e);return y._interactor._42(),J},Mq.prototype.findClosest=function(S,u,r){var K=this,F=K._interactor,N=F.gv;r&&(S=zr.toWorldPosition(N,S));var d,y,v,s=1/0,f=1/0,q=S.x,W=S.y;if(K.gridEnabled){var A=K.gridBlockSize,n=K.makeMatrix(),L=n.applyInverse(S);L=n.apply({x:Math.round(L.x/A)*A,y:Math.round(L.y/A)*A}),s=L.x-q,f=L.y-W,v=!0}if(F.alignmentGuideEnabled&&(d=K._findClosestAlignmentGuide(q,K._xAlignmentGuide).dis,y=K._findClosestAlignmentGuide(W,K._yAlignmentGuide).dis,Math.abs(d)<Math.abs(s)&&(s=d,v=!0),Math.abs(y)<Math.abs(f)&&(f=y,v=!0)),v){v=!1;var O=N._zoom,R=F.getStyle("smartGuideSensitivity")/O,G={};if(Math.abs(s)<R&&"y"!==u&&(G.x=r?s*O:s,v=!0),Math.abs(f)<R&&"x"!==u&&(G.y=r?f*O:f,v=!0),v)return G}},Mq.prototype._findClosestAlignmentGuide=function(U,A){if(!A.length)return{dis:1/0};for(var B,Q=0,u=A.length-1;u-Q>1;)B=Math.floor((Q+u)/2),A[B].p<U?Q=B:u=B;var L=A[Q].p-U,d=A[u].p-U;return Math.abs(L)<=Math.abs(d)?{line:A[Q],dis:L,index:Q}:{line:A[u],dis:d,index:u}},Mq.prototype.removeAllAlignmentGuide=function(o){var f=this;"y"!==o&&(f._xAlignmentGuide=[]),"x"!==o&&(f._yAlignmentGuide=[]),f._interactor._42()},Mq.prototype.removeAlignmentGuide=function(E){for(var u,P,p,S=this,N=S._xAlignmentGuide,i=0;2>i;i++)for(N=0===i?S._xAlignmentGuide:S._yAlignmentGuide,u=0,P=N.length;P>u;u++)if(p=N[u],p.id===E)return N.splice(u,1),S._interactor._42(),{axis:0===i?"x":"y",position:p.p};return!1},Mq.prototype.adjustAlignmentGuide=function(c,q){var g=this,t=g.removeAlignmentGuide(c);return t?(g.addAlignmentGuide(t.axis,q,c),!0):!1};var Lo=zr.Guide.Rect=function(k){var B=this;B._interactor=k};Lo.prototype={},Lo.prototype.constructor=Lo,Lo.prototype.gatherRects=function(){var r,h,c,A,z=this,U=z._interactor.gv,Q=[],t=[],j={x:Q,y:t},y={},_=U.getDataModel(),n=_.a("width"),O=_.a("height");n&&O&&(r=0,h=0,c=n,A=O,Q.push({node:_,type:0,p:r},{node:_,type:1,p:r+c/2},{node:_,type:2,p:r+c}),t.push({node:_,type:0,p:h},{node:_,type:1,p:h+A/2},{node:_,type:2,p:h+A}),y[_._id||0]={x:r,y:h,width:c,height:A}),_.each(function(m){if(fr(m)&&!U.isSelected(m)&&U.isVisible(m)){var Z=!1;if(U.sm().getSelection().each(function(q){Z||(m.isHostOn(q)?Z=!0:m.isDescendantOf(q)&&(Z=!0))}),!Z){var s=m.getRect();r=s.x,h=s.y,c=s.width,A=s.height,Q.push({node:m,type:0,p:r},{node:m,type:1,p:r+c/2},{node:m,type:2,p:r+c}),t.push({node:m,type:0,p:h},{node:m,type:1,p:h+A/2},{node:m,type:2,p:h+A}),y[m._id]=s}}}),Q.sort(function(z,w){return z.p-w.p}),t.sort(function(o,b){return o.p-b.p}),z._grid=j,z._87I=y},Lo.prototype.gatherLines=function(S,b,G){var X,L,T,Y,C,E,d,s,g,W,m,a,h=this,e=[h.findClosest({x:S.x,y:S.y},b),h.findClosest({x:S.x+S.w/2,y:S.y+S.h/2},b),h.findClosest({x:S.x+S.w,y:S.y+S.h},b)],i={},j=h._87I;G=G||255;var $,N;for(h._guideLine=[],X=0;2>X;X++)for(i={},0===X?(Y="y",s=S.x,g=s+S.w):(Y="x",s=S.y,g=s+S.h),L=0;3>L;L++)C=e[L],C&&isFinite(C[Y])&&($=1<<3*X+L,G&$&&(E=C[Y+"Line"],d=E.node,N=d._id||0,i[N]||(i[N]=!0,a=j[N],"y"===Y?(W=a.x,m=a.x+a.width):(W=a.y,m=a.y+a.height),T=E.p,h._guideLine.push({type:Y,a:s,b:g,c:W,d:m,p:T,center:1===E.type}))))
},Lo.prototype._binarySearchClosest=function(f,Q){if(!Q.length)return{dis:1/0};for(var j,D=0,T=Q.length-1;T-D>1;)j=Math.floor((D+T)/2),Q[j].p<f?D=j:T=j;var m=Q[D].p-f,J=Q[T].p-f;return Math.abs(m)<=Math.abs(J)?{line:Q[D],dis:m}:{line:Q[T],dis:J}},Lo.prototype.findClosest=function(A,j,f){var Z=this,k=Z._interactor,B=k.gv,s=Z._grid;f&&(A=zr.toWorldPosition(B,A));var c,q=Z._binarySearchClosest(A.x,s.x),g=Z._binarySearchClosest(A.y,s.y),x=q.dis,b=g.dis,a=B._zoom,H=k.getStyle("smartGuideSensitivity")/a,E={};return Math.abs(x)<H&&"y"!==j&&(E.x=f?x*a:x,E.xLine=q.line,c=!0),Math.abs(b)<H&&"x"!==j&&(E.y=f?b*a:b,E.yLine=g.line,c=!0),c?E:void 0},Lo.prototype._42=function(){var $=this,A=$._guideLine;if(A&&!C.Default.isCtrlDown()){var Z,j,N,q,i,W,z,E,K,Y,T,M,d,J,w,S,Q,g=$._interactor,L=g.gv,B=g._context,V=L.tx(),F=L.ty(),p=L._zoom,s=g.getStyle("guideLineTextSpacing");for(Z=0,j=A.length;j>Z;Z++)N=A[Z],E=N.type,K=N.p,Y=N.a,T=N.b,M=N.c,d=N.d,J=Math.min(Y,M),w=Math.max(T,d),"x"===E?(q=K*p+V,i=J*p+F,W=q,z=w*p+F):(q=J*p+V,i=K*p+F,W=w*p+V,z=i),zr.Icons.DrawIcon(g,B,zr.Icons.MoveLineGuide,{rect:[q,i,W,z],center:N.center}),d>=Y&&T>=M||(J=Y>d?d:T,w=Y>d?Y:M,Q=w-J,"x"===E?(N.center2center||(q-=s,W=q),i=J*p+F,z=w*p+F,S=zr.Icons.MoveLineGuideDistanceV):"y"===E&&(N.center2center||(i-=s,z=i),q=J*p+V,W=w*p+V,S=zr.Icons.MoveLineGuideDistanceH),zr.Icons.DrawIcon(g,B,S,{x0:q,y0:i,x1:W,y1:z,dis:Q}))}},Lo.prototype.clear=function(){this._guideLine=null},zr.DefaultStyleMap={pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideSensitivity:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,guideLineTextSpacing:0,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var Nc=zr.Icons={},uj=1e4,gl=null,Od="rgb(51,153,255)",Bl="rgb(183,232,135)",ie="rgb(255,204,153)",nh=6;C.Default.setImage("Icons.RectPoint",{width:nh,height:nh,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:Od,rect:[0,0,nh,nh]}]});var Nr="#e000e0";Nc.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var k=Nc.GroupSubEntityRect.data;if(!k)return[];var l=k.min,n=k.max;return[l.x,l.y,l.x,n.y,n.x,n.y,n.x,l.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Nc.GroupSubEntityRect.data.isKeyOb?Nr:"#666666"}}}]},Nc.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Nc.Line.data.P1.x,Nc.Line.data.P1.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Nc.Line.data.P2.x,Nc.Line.data.P2.y],nh,nh]}}}]},Nc.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return Nc.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},Nc.Rect={comps:[{type:"shape",points:{func:function(){var j=Nc.Rect.data;if(!j)return[];var c=j.LT,L=j.LB,V=j.RB,l=j.RT;return[c.x,c.y,L.x,L.y,V.x,V.y,l.x,l.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:Od},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},rect:{func:function(){return[[Nc.Rect.data.LT.x,Nc.Rect.data.LT.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},rect:{func:function(){return[[Nc.Rect.data.LB.x,Nc.Rect.data.LB.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},rect:{func:function(){return[[Nc.Rect.data.RB.x,Nc.Rect.data.RB.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},rect:{func:function(){return[[Nc.Rect.data.RT.x,Nc.Rect.data.RT.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},visible:{func:function(){return Nc.Rect.data.L?!0:!1}},rect:{func:function(){return[[Nc.Rect.data.L.x,Nc.Rect.data.L.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},visible:{func:function(){return Nc.Rect.data.R?!0:!1}},rect:{func:function(){return[[Nc.Rect.data.R.x,Nc.Rect.data.R.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},visible:{func:function(){return Nc.Rect.data.T?!0:!1}},rect:{func:function(){return[[Nc.Rect.data.T.x,Nc.Rect.data.T.y],nh,nh]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Nc.Rect.data.rotation}},visible:{func:function(){return Nc.Rect.data.B?!0:!1}},rect:{func:function(){return[[Nc.Rect.data.B.x,Nc.Rect.data.B.y],nh,nh]}}}]};var Vi=16;C.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:Od,borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:Od,shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),Nc.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[Nc.Anchor.data.POS.x,Nc.Anchor.data.POS.y],Vi,Vi]}}}]},Nc.TipShiftX=12,Nc.TipShiftY=12;var kh=[8,28];Nc.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[Nc.TipHelper.data.helperPos.x,Nc.TipHelper.data.helperPos.y,kh[0]*Nc.TipHelper.data.size,kh[1]]}},background:{func:function(){return gl.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return Nc.TipHelper.data.text}},rect:{func:function(){return[Nc.TipHelper.data.helperPos.x,Nc.TipHelper.data.helperPos.y,kh[0]*Nc.TipHelper.data.size,kh[1]]}},color:{func:function(){return gl.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var ri=7;Nc.ShapePoint={comps:[{type:"circle",rect:{func:function(){var v=Nc.ShapePoint.data.point;return[v,ri,ri]}},background:{func:function(){var i=Nc.ShapePoint.data.isEnd;return i?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:Od}]},Nc.ShapeBgCurve={comps:[{type:"shape",points:{func:function(){return Nc.ShapeBgCurve.data.P}},segments:{func:function(){return Nc.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:Od}]};var Ck=8;Nc.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var t=Nc.ShapeHighlighPoint.data;return[[t.x,t.y],Ck,Ck]}},background:{func:function(){return gl.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var Hl=10;Nc.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var X=Nc.ShapeHighlighRealPoint.data;return[[X.x,X.y],Hl,Hl]}},background:"#ffffff",borderWidth:2,borderColor:Od}]};var mp=8;Nc.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var O=Nc.ShapeHighlighCtrlPoint.data,p=O.x,z=O.y,K=mp/2;return[p-K,z-K,p-K,z+K,p+K,z+K,p+K,z-K]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return gl.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return gl.getStyle("shapeCtrlPointBorderColor")||Od}}}]};var Wo=3;Nc.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return Nc.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Wo,borderColor:{func:function(){return gl.getStyle("curveHighlightColor")}}}]},Nc.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return Nc.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},Nc.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return Nc.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return Nc.MoveLineGuide.data.center?Bl:ie}}}]};var rl=5;Nc.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var L=Nc.MoveLineGuideDistanceH.data,u=L.x0,b=L.y0;return[u,b-rl,u,b+rl]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:ie},{type:"shape",points:{func:function(){var w=Nc.MoveLineGuideDistanceH.data,k=w.x1,B=w.y1;return[k,B-rl,k,B+rl]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:ie},{type:"text",text:{func:function(){return Math.round(Nc.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var Z=Nc.MoveLineGuideDistanceH.data;return[[(Z.x0+Z.x1)/2,Z.y0-10],20,20]}},color:ie,font:"12px Arial",align:"center"}]},Nc.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var n=Nc.MoveLineGuideDistanceV.data,e=n.x0,v=n.y0;return[e-rl,v,e+rl,v]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:ie},{type:"shape",points:{func:function(){var u=Nc.MoveLineGuideDistanceV.data,l=u.x1,x=u.y1;return[l-rl,x,l+rl,x]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:ie},{type:"text",text:{func:function(){return Math.round(Nc.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var V=Nc.MoveLineGuideDistanceV.data;return[[V.x0-10,(V.y0+V.y1)/2],20,20]}},color:ie,font:"12px Arial",align:"center"}]},C.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),Nc.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var Y=Nc.EdgeElevationGuide.data,c=Y.x,d=Y.y,O=gl.getStyle("curveElevationIntersectSize"),p=gl.getStyle("curveElevationGuideShift");return c+=p[0],d+=p[1],[c-O,d-O,2*O,2*O]}}}]},C.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),C.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),Nc.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return Nc.ConnectGuide.data.rotation}},rect:{func:function(){var p=Nc.ConnectGuide.data.connect;p.x,p.y;var m=gl.getStyle("connectGuideIntersectSize");return[[p.x,p.y],2*m,2*m]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var V=Nc.ConnectGuide.data.cursorPos||Nc.ConnectGuide.data.connect,a=gl.getStyle("connectGuideIntersectSize");return[[V.x,V.y],2*a-2,2*a-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var g=Nc.ConnectGuide.data.connect,t=Nc.ConnectGuide.data.cursorPos||g;return[g.x,g.y,g.x+.5*(t.x-g.x),g.y,t.x+.5*(g.x-t.x),t.y,t.x,t.y]}}}]},C.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),C.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),Nc.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var L=Nc.ConnectGuideGarbage.data.hover;return L?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var W=Nc.ConnectGuideGarbage.data,$=gl.getStyle("connectGuideGarbageIntersectsize");return W.hover&&($+=5),[[W.x,W.y],2*$,2*$]}}}]};var oc=6;Nc.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return Nc.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var z=Nc.ShapeActivingCtrl.data;return[z.point.x,z.point.y,z.c1.x,z.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:Od},{type:"shape",visible:{func:function(){return Nc.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var M=Nc.ShapeActivingCtrl.data;return[M.point.x,M.point.y,M.c2.x,M.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:Od},{type:"shape",visible:{func:function(){return Nc.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var v=Nc.ShapeActivingCtrl.data.c1,t=v.x,o=v.y,n=oc/2;return"c1"===Nc.ShapeActivingCtrl.data.hl&&(n+=.5),[t-n,o-n,t-n,o+n,t+n,o+n,t+n,o-n]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return gl.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===Nc.ShapeActivingCtrl.data.hl?gl.getStyle("shapeCtrlPointHighlightBorder")||Od:gl.getStyle("shapeCtrlPointBorderColor")||Od}}},{type:"shape",visible:{func:function(){return Nc.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var r=Nc.ShapeActivingCtrl.data.c2,B=r.x,E=r.y,X=oc/2;return"c2"===Nc.ShapeActivingCtrl.data.hl&&(X+=.5),[B-X,E-X,B-X,E+X,B+X,E+X,B+X,E-X]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return gl.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===Nc.ShapeActivingCtrl.data.hl?gl.getStyle("shapeCtrlPointHighlightBorder")||Od:gl.getStyle("shapeCtrlPointBorderColor")||Od}}}]},Nc.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:Od,rect:{func:function(){return[[Nc.RoundPoint.data.x,Nc.RoundPoint.data.y],nh,nh]}}}]},Nc.AttachPoint={comps:[{type:"rect",background:{func:function(){return Nc.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:Od,rect:{func:function(){var e=Nc.AttachPoint.data.isAttach?nh+4:nh;return[[Nc.AttachPoint.data.x,Nc.AttachPoint.data.y],e,e]}}}]},zr.Icons.DrawIcon=function(R,Q,K,y){K.width=K.height=uj,K.data=y,gl=R,C.Default.drawImage(Q,K,0,0,uj,uj)},zr.Icons.MapPoints=function(S,z){for(var L=0,F=S.length;F>L;L++)S[L]/=z},zr.roundTo=function(p,d,I){var y=Math.abs(p%d);return I>y||I>d-y?d*Math.round(p/d):p},zr.toFixed=function(d){return Math.round(100*d)/100},zr.getDataMatrix=function(D){if(D instanceof C.Shape){var r=new C.Math.Matrix2d,k=D.getPosition();return r.translate(-k.x,-k.y).scale(D.getScale().x,D.getScale().y).rotate(D.getRotation()).translate(k.x,k.y),r}return D.getMatrix?D.getMatrix():new C.Math.Matrix2d};var Fr=zr.Math.Curve=function(){this._curves=[]};Fr.prototype={},Fr.prototype.constructor=Fr,Fr.prototype.createFromHtShape=function(q,z,y){z instanceof C.List&&(z=z.toArray());var u,Q,j,m,B,N,M,i=this,v=null,h=null,A=0,G=zr.Math.Vector2,T=zr.Math.CubicBezier,c=function(t){return new G(q[t],q[t+1],y?y[t/2]:P)};for(Q=0,j=z.length;j>Q;Q++){switch(m=z[Q],B=null,m){case 1:h=c(A),v=h,A+=2;break;case 2:u=c(A),A+=2,B=new T(h,h.clone(),u.clone(),u),h=u;break;case 3:N=c(A),u=c(A+2),A+=4,B=new T(h,N.clone().sub(h).multiplyScalar(2/3).add(h),N.clone().sub(u).multiplyScalar(2/3).add(u),u),h=u;break;case 4:N=c(A),M=c(A+2),u=c(A+4),A+=6,B=new T(h,N,M,u),h=u;break;case 5:if(!v)break;B=new T(h,h.clone(),v.clone(),v),h=null,v=null}B&&(B._index=i._curves.length,i._curves.push(B))}},Fr.prototype.checkPoint=function(v,$){var f,m,N,u,J,X=this,B=X._curves;for(f=0,m=B.length;m>f;f++)if(u=B[f],J=u.intersectRect(v,$,$),J.length)return N=0,J.forEach(function(K){N+=K.t}),N/=J.length,v=u.getPointAt(N),v.t=N,{bezier:u,intersection:v}},Fr.prototype.insertKnot=function(j,S){var t=j.insertKnot(S),p=this,h=p._curves;h.splice(j._index,1,t[0],t[1])},Fr.prototype._isCloseEnough=function(J,S){return Math.abs(J.x-S.x)<1e-6&&Math.abs(J.y-S.y)<1e-6},Fr.prototype._isSamePoint=function(Y,s){return Y===s},Fr.prototype.moveRealPoint=function(V,F){var R=this,B=R._curves,b=F.clone().sub(V);B.forEach(function(d){var v=d._p1;d._p2,d._p3;var t=d._p4;R._isSamePoint(v,V)&&(d._p2.add(b),d._p1=F),R._isSamePoint(t,V)&&(d._p3.add(b),d._p4=F)})},Fr.prototype.moveCtrlDueToRealPointMovement=function(t,U){var y=this,z=y._curves,Y=function(f){f.add(U),f.e&&U.e&&(f.e+=U.e)};z.forEach(function(h){var i=h._p1;h._p2,h._p3;var b=h._p4;y._isSamePoint(i,t)&&Y(h._p2),y._isSamePoint(b,t)&&Y(h._p3)})},Fr.prototype.moveCtrlPoint=function(m,J,V){var e=m[V];if(e){e.e!==P&&(J.e=e.e);var I=this,t=I._curves;J.clone().sub(e),t.forEach(function(p){var f;"c2"===V?f="_p2":"c1"===V&&(f="_p3"),I._isSamePoint(p[f],e)&&(p[f]=J)}),m[V]=J}},Fr.prototype.deleteRealPoint=function(p,s){var w,v,B,X,Z,l,Y,t=this,G=t._curves,b={},f=[],e=zr.Math.CubicBezier;for(v=0,B=G.length;B>v;v++)w=G[v],X=w._p1,Z=w._p2,l=w._p3,Y=w._p4,(b[v]||!t._isSamePoint(X,p))&&(t._isSamePoint(Y,p)?B>v+1&&t._isSamePoint(G[v+1]._p1,p)&&(s||f.push(new e(X,Z,G[v+1]._p3,G[v+1]._p4))):f.push(w));t._curves=f},Fr.prototype.findPairs=function($,m){var u,G,x,t,n,s,K,v,L=this,f=L._curves,A={},a=[];for(G=0,x=f.length;x>G;G++)u=f[G],t=u._p1,n=u._p2,s=u._p3,K=u._p4,!A[G]&&L._isSamePoint(t,$)&&(m?a.push({point:t,r2:K}):a.push({point:t,c2:n})),L._isSamePoint(K,$)&&(v=m?{point:K,r1:t}:{point:K,c1:s},x>G+1&&L._isSamePoint(f[G+1]._p1,$)&&(m?v.r2=f[G+1]._p4:v.c2=f[G+1]._p2,A[G+1]=!0),a.push(v));return a},Fr.prototype.toHtShape=function(){var _=this,s=_._curves,v=[],e=[],x={x:1/0,y:1/0};return s.forEach(function(T){var u=T._p1,Q=T._p2,C=T._p3,O=T._p4;return _._isCloseEnough(u,x)||(v.push(1),e.push(u.clone())),x=O,_._isCloseEnough(u,Q)&&_._isCloseEnough(C,O)?(v.push(2),e.push(O.clone()),void 0):(v.push(4),e.push(Q.clone(),C.clone(),O.clone()),void 0)}),{segments:v,points:e}};var Of=zr.Math.CubicBezier=function(j,V,x,w){var G=this;G._id=zr.Math.CubicBezier._globalId++,G._p1=j,G._p2=V,G._p3=x,G._p4=w};Of._globalId=1,Of.prototype={},Of.prototype.constructor=Of,Of.prototype.toString=function(){return this._id},Of.prototype.intersectRect=function(e,k,l){var E=k/2,H=l/2,f=e.x,i=e.y,C=zr.Math.Vector2,y=new C(-E+f,-H+i),I=new C(E+f,H+i),O=new C(I.x,y.y),J=new C(y.x,I.y),$=this,h=$.intersectLine(y,O),t=$.intersectLine(O,I),n=$.intersectLine(I,J),w=$.intersectLine(J,y),K=h.concat(t).concat(n).concat(w);return K},Of.prototype.intersectLine=function(x,P){var $,S,K,s,n,o,v,R,b,u,j,Y,t,e=this,T=x.clone().min(P),L=x.clone().max(P);s=e._p1,n=e._p2,o=e._p3,v=e._p4,$=s.clone().multiplyScalar(-1),S=n.clone().multiplyScalar(3),K=o.clone().multiplyScalar(-3),j=$.add(S).add(K).add(v),$=s.clone().multiplyScalar(3),S=n.clone().multiplyScalar(-6),K=o.clone().multiplyScalar(3),u=$.add(S).add(K),$=s.clone().multiplyScalar(-3),S=n.clone().multiplyScalar(3),b=$.add(S),R=s.clone(),t=new zr.Math.Vector2(x.y-P.y,P.x-x.x),Y=x.x*P.y-P.x*x.y;for(var O=e.getRoots(t.dot(j),t.dot(u),t.dot(b),t.dot(R)+Y),C=new Array,y=0,z=O.length;z>y;y++){var r=O[y];if(!(0>r||r>1)){var m=s.clone().lerp(n,r),a=n.clone().lerp(o,r),f=o.clone().lerp(v,r),J=m.lerp(a,r),A=a.lerp(f,r),G=J.lerp(A,r);G.t=r,x.x==P.x?T.y<=G.y&&G.y<=L.y&&C.push(G):x.y==P.y?T.x<=G.x&&G.x<=L.x&&C.push(G):G.x>=T.x&&G.y>=T.y&&G.x<=L.x&&G.y<=L.y&&C.push(G)}}return C},Of.prototype.solveTForPoint=function(i){var O,r,Y,j,G=this;O=G._p1.x-i.x,r=G._p2.x-i.x,Y=G._p3.x-i.x,j=G._p4.x-i.x;for(var M=G.getRoots(j-3*Y+3*r-O,3*Y-6*r+3*O,3*r-3*O,O),J=P,C=1/0,o=0,u=M.length;u>o;o++){var V=M[o];if(!(0>V||V>1)){var c=G._p1.clone().lerp(G._p2,V),F=G._p2.clone().lerp(G._p3,V),E=G._p3.clone().lerp(G._p4,V),t=c.lerp(F,V),f=F.lerp(E,V),B=t.lerp(f,V);B.t=V;var R=Math.abs(B.y-i.y);C>R&&(C=R,J=B)}}return J},Of.prototype.getPointAt=function(f){var C=this,S=C._p1,T=C._p2,L=C._p3,I=C._p4,Y=S.clone().lerp(T,f),A=T.clone().lerp(L,f),G=L.clone().lerp(I,f),d=Y.lerp(A,f),r=A.lerp(G,f);return d.lerp(r,f)},Of.prototype.getRoots=function(K,s,b,T){var n,v,m,t,w,z=new Array;if(Math.abs(K)<1e-6){var n=s,v=b/n,m=T/n,t=v*v-4*m;if(t>0){var w=Math.sqrt(t);z.push(.5*(-v+w)),z.push(.5*(-v-w))}else 0==t&&z.push(.5*-v)}s/=K,b/=K,T/=K,n=(3*b-s*s)/3,v=(2*s*s*s-9*b*s+27*T)/27;var M=s/3,h=v*v/4+n*n*n/27,c=v/2;if(Math.abs(h)<=1e-6&&(h=0),h>0){var E,$,w=Math.sqrt(h);E=-c+w,$=E>=0?Math.pow(E,1/3):-Math.pow(-E,1/3),E=-c-w,E>=0?$+=Math.pow(E,1/3):$-=Math.pow(-E,1/3),z.push($-M)}else if(0>h){var d=Math.sqrt(-n/3),Y=Math.atan2(Math.sqrt(-h),-c)/3,P=Math.cos(Y),_=Math.sin(Y),X=Math.sqrt(3);z.push(2*d*P-M),z.push(-d*(P+X*_)-M),z.push(-d*(P-X*_)-M)}else{var E;E=c>=0?-Math.pow(c,1/3):Math.pow(-c,1/3),z.push(2*E-M),z.push(-E-M)}return z},Of.prototype._70I=function(){var G=this;return G._p1.distanceToSquared(G._p2)<1e-10&&G._p3.distanceToSquared(G._p4)<1e-10},Of.prototype.insertKnot=function(W){var d=this,j=d._p1,n=d._p2,E=d._p3,p=d._p4,c=j.clone().lerp(n,W),i=n.clone().lerp(E,W),v=E.clone().lerp(p,W),r=c.clone().lerp(i,W),z=i.clone().lerp(v,W),U=r.clone().lerp(z,W);return d._70I()?(j.clone().lerp(p,W),[new zr.Math.CubicBezier(j,j.clone(),U.clone(),U),new zr.Math.CubicBezier(U,U.clone(),p.clone(),p)]):[new zr.Math.CubicBezier(j,c,r,U),new zr.Math.CubicBezier(U,z,v,p)]};var un=C.Default.getInternal().ui().EdgeUI,mi={_47O:function(e){var l=this,r=mi.getBackups()._47O;zr.inEdit(l.gv)||r.call(l,e)}};zr.Inject.registAsModule(mi,un);var Yo=C.Default.getInternal().ui().NodeUI,Kg={_47O:function(z){var q=this,M=Kg.getBackups()._47O;zr.inEdit(q.gv)||M.call(q,z)},getSelectWidth:function(){var z=this,V=z.gv,$=z._data;if(V.isEditable($)&&zr.inEdit(V))return 0;var x=Kg.getBackup("getSelectWidth");return x.call(z)}};zr.Inject.registAsModule(Kg,Yo);var up=C.graph.GraphView,qi={_editPointSize:function(){var h=C.Default.isTouchable,F=zr.getStyle("pointSize");return F[h?0:1]}(),isPointEditable:function(g){var x=this;if(zr.inEdit(x))return x._pointEditableFunc?x._pointEditableFunc(g):!0;var D=qi.getBackup("isPointEditable");D.call(x,g)},isEditable:function(V){var t,q=this,W=qi.getBackup("isEditable");if(t=V instanceof zr.Group?!0:W.call(q,V),!zr.inEdit(q))return t;if(!(V instanceof C.Edge))return t;if(!V.s("2d.editable"))return!1;var m=q.getEditableFunc();return m?m(V):!0},_42:function(w,R){var I=this,V=qi.getBackups()._42;if(V.call(I,w,R),zr.inEdit(I)){var g=I.getEditInteractor();g.drawImpl()}}};zr.Inject.registAsModule(qi,up);var yd=C.Default.getInternal().ui().ShapeUI,tf={_47O:function(l){var q=this,n=tf.getBackups()._47O;zr.inEdit(q.gv)||n.call(q,l)}};zr.Inject.registAsModule(tf,yd);var Gi=C.graph.DefaultInteractor,xc={handle_mousewheel:function(B){var Z=this,S=xc.getBackup("handle_mousewheel");zr.inEdit(Z.gv)||S.call(Z,B)}};zr.Inject.registAsModule(xc,Gi);var Zq=C.graph.MoveInteractor,sl={_calcShift:function(h,F){var K=this,G=sl.getBackup("_calcShift"),W=K.gv;if(!zr.inEdit(W))return G.call(K,h,F);var Q=W.getEditInteractor(),s=Q.getSubModule("Move").calcShift(h,F,K);return s||G.call(K,h,F)},clear:function(G){var V=this,j=sl.getBackup("clear");j.call(V,G);var z=V.gv;if(zr.inEdit(z)){var Y=z.getEditInteractor();Y.getSubModule("Move").clear(G)}}};zr.Inject.registAsModule(sl,Zq);var Lo=zr.Rect=function(X){this.catalog="Rect",this._interactor=X};Lo.prototype={},Lo.prototype.constructor=Lo,Lo.prototype.gatherInfo=function(G,N){var j=this;if(1===N.length){var g=N[0];return g instanceof C.Shape&&g._70I()?j.gatherLine(G,g):ao(g,G)?!1:j.gatherSingleTarget(G,g)}return N.length>1?j.gatherMultiTargets(G,N):!1},Lo.prototype.gatherSingleTarget=function(p,T){if(T.getCorners){var S,Z=this,X=Z.info;Z.target=T,S=Z.screenInfo={};var F=T.getCorners();X.LT=new zr.Math.Vector2(F[0]),X.LB=new zr.Math.Vector2(F[1]),X.RB=new zr.Math.Vector2(F[2]),X.RT=new zr.Math.Vector2(F[3]),X.T=X.LT.clone().add(X.RT).divideScalar(2),X.B=X.LB.clone().add(X.RB).divideScalar(2),X.L=X.LT.clone().add(X.LB).divideScalar(2),X.R=X.RT.clone().add(X.RB).divideScalar(2);for(var s in X)S[s]=zr.toScreenPosition(p,X[s]);var I=Z._interactor,G=I.getStyle("checkSize"),x=function(C,v,d){var _=v.clone().sub(C).setLength(-G),m=d.clone().sub(C).setLength(-G),s=_.add(m).add(C);return s};return S.rotLT=x(S.LT,S.RT,S.LB),S.rotLB=x(S.LB,S.LT,S.RB),S.rotRB=x(S.RB,S.LB,S.RT),S.rotRT=x(S.RT,S.LT,S.RB),S.rotT=S.rotLT.clone().add(S.rotRT).divideScalar(2),S.rotB=S.rotLB.clone().add(S.rotRB).divideScalar(2),S.rotL=S.rotLT.clone().add(S.rotLB).divideScalar(2),S.rotR=S.rotRT.clone().add(S.rotRB).divideScalar(2),S.rotation=T.getRotation(),Z.gatherConnectInfo(),!0}},Lo.prototype.gatherConnectInfo=function(){var S=this,f=S.target,L=S._interactor,i=S.screenInfo,v=L.gv;if(v.isConnectActionVisible(f)&&L.getStyle("connectGuideVisible")){var I;f.s&&(I=f.s("connectGuideShift")),I||(I=L.getStyle("connectGuideShift"));var m=f.getAnchor(),o=f.getSize(),Z=f.toGlobal({x:o.width*(I[0]-m.x),y:o.height*(I[1]-m.y)});Z=zr.toScreenPosition(v,Z),i.P1?Z.add(i.P2.clone().sub(i.P1).setLength(I[2])):(Z.add(i.RT.clone().sub(i.LT).setLength(I[2])),Z.add(i.LB.clone().sub(i.LT).setLength(I[3]))),i.connect=Z}},Lo.prototype.gatherMultiTargets=function(k,l){var Q=zr.Group.findOrCreateGroup(l);if(!Q)return!1;var Y=this;return Y.editing&&"rotate"!==Y.editing.mode||Q.calcInfo(),Y.gatherSingleTarget(k,Q)},Lo.prototype.gatherLine=function(S,T){this.target=T;var Q=this.screenInfo={},w=T.getPoints(),U=zr.getDataMatrix(T);return Q.P1=zr.toScreenPosition(S,U.apply(w.get(0))),Q.P2=zr.toScreenPosition(S,U.apply(w.get(1))),this.gatherConnectInfo(),!0},Lo.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],Lo.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],Lo.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],Lo.prototype.check=function(R,D,O){if(C.Default.isLeftButton(D)){var w=this;if(w.editing=null,w.tipInfo=null,w.screenInfo){var i=w.target,I=R.isEditable(i),g=w.screenInfo;if(I&&g.connect){var K=w._checkConnect(O);if(K)return K}if(g.P1)return w._checkLine(O);var E,J,A,Q=null,f=w._interactor,F=f.getStyle("checkSize");if(I&&R.isRectEditable(i))for(J=0;J<zr.Rect.ResizeKeys.length;J++)if(A=zr.Rect.ResizeKeys[J],zr.checkHit(O,g[A],F)){Q=A,E="resize";break}if(!Q&&I&&R.isRotationEditable(i)&&!f.getStyle("rotateAsClock")){var k=f.getStyle("rotateCheckSize");for(J=0;J<zr.Rect.RotateKeys.length;J++)if(A=zr.Rect.RotateKeys[J],zr.checkHit(O,g[A],k)){Q=A,E="rotate";break}}if(!Q)return f.setCursor("default"),void 0;if("rotate"===E){var W,l=R.lp(D);if(i instanceof zr.Group){var y=f.getStyle("groupRotateModeKey");"string"==typeof y&&(y=[y]);for(var n=!1,$=0,s=y.length;s>$;$++)if(D[y[$]]){n=!0;break}var H=f.getStyle("groupRotateModeDefault");W=n?"batch"===H?"block":"batch":H}var t="batch"===W?i.getAnchor2():i.getPosition(),c=Math.atan2(l.y-t.y,l.x-t.x);f._setRotateCursor(c),w.editing={mode:E,key:Q,pos:t,flipY:i.getScale().y<0,rotation:i.getRotation(),hitRot:c},W&&(w.editing.groupRotateMode=W)}else{var b=zr.Rect.ResizeKeys.indexOf(Q),j=zr.Rect.ResizeDirection[b],B=Math.cos(i.getRotation()),M=Math.sin(i.getRotation()),T=j.x*Math.sign(i.getScale().x),_=j.y*Math.sign(i.getScale().y),d=Math.atan2(-M*T-B*_,B*T-M*_),m=(Math.round(d/(Math.PI/4))+8)%8,r=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][m];this._interactor.setCursor(r);var v=i.getWidth(),e=i.getHeight(),N=i.getAnchor();w.editing={mode:E,key:Q,rect:{x:-v*N.x,y:-e*N.y,width:v,height:e},anchor:N,matrix:i.getMatrix()}}return Q}}},Lo.prototype._checkLine=function(Y){var q=this;q.screenInfo;var Q,T=q._interactor.getStyle("checkSize");if(zr.checkHit(Y,q.screenInfo.P1,T))Q="P1";else{if(!zr.checkHit(Y,q.screenInfo.P2,T))return this._interactor.setCursor("default"),void 0;Q="P2"}return q.editing={mode:"line",key:Q},Q},Lo.prototype._checkConnect=function(Q){var Y=this,R=Y.screenInfo,l=Y._interactor,J=l.getStyle("connectGuideIntersectSize"),U=R.connect,G=Q.x,_=U.x;if(_>G&&J>_-G&&Math.abs(U.y-Q.y)<J||G>=_&&zr.checkHit(Q,U,J)){var i="connect",L=k.getConnectAction(l.gv);if(Y.editing={mode:i},L&&L.delete)if(Y.target instanceof zr.Group){var D=!0;l.gv.sm().getSelection().each(function(v){L.delete.visible.call(null,l.gv,v)||(D=!1)}),Y.editing.hasDeleteAction=D}else L.delete.visible.call(null,l.gv,Y.target)&&(Y.editing.hasDeleteAction=!0);return l.setCursor("default"),i}},Lo.prototype._fireEditEvent=function(g,t){var R=this._interactor,m=this.editing;if(m){var E=m.mode;E="rotate"===E?"Rotation":"connect"===E?"Connection":E[0].toUpperCase()+E.slice(1),R.fi({kind:g+"Edit"+E,event:t})}},Lo.prototype.startEdit=function(g,z){g.startDragging(z);var R=this;R._interactor.fi({kind:"prepareEdit",event:z});var l=R.editing,U=R.target;if(l){if(R._fireEditEvent("begin",z),"rotate"===l.mode)return l.groupRotateMode&&U.beginRotate(l),void 0;if("connect"!==l.mode)("line"===l.mode||U&&0===U.getRotation())&&(R._inSmartGuide=!0,R._interactor.rectGuide.gatherRects());else if(l.hasDeleteAction){var q=g.gv,X=R._interactor.getStyle("connectGuideGarbageShift");l.garbageInfo={x:q.getWidth()*X[0]+X[2],y:q.getHeight()*X[1]+X[3],size:R._interactor.getStyle("connectGuideGarbageIntersectsize")},g._42()}}},Lo.prototype._46O=function(F){var v,I,J=this,G=J.editing,z=J.target;if(G){if("connect"===G.mode&&!G.canceled&&!G.deleted)try{G.garbageInfo&&G.garbageInfo.hover?k.doDeleteConnectionAction(J._interactor.gv,z):k.doConnectAction(J._interactor.gv,z,G.target)}catch(y){console.error(y)}I=G.freezeFlag,v=J.editing.groupRotateMode,J._fireEditEvent("end",F),J.editing=null}J.tipInfo=null,J._inSmartGuide&&(J._interactor.rectGuide.clear(),J._inSmartGuide=!1),v&&z&&z.endRotate(),z instanceof C.Block&&(I===P?delete z._freezeSyncFromChildren:z._freezeSyncFromChildren=I,z.updateFromChildren())},Lo.prototype.handleNormalStateDelete=function(){var h=this,$=h.editing;if($&&"connect"===$.mode&&!$.canceled&&!$.deleted){if($.garbageInfo){try{k.doDeleteConnectionAction(h._interactor.gv,h.target)}catch(r){console.error(r)}$.garbageInfo=null}return $.cursorPos=null,$.targetCorners=null,$.deleted=!0,h._interactor._42(),!0
}},Lo.prototype.handleNormalStateKeyDown=function(A){var b=this,N=b.editing;return!N||"connect"!==N.mode||N.canceled||N.deleted?void 0:C.Default.isEsc(A)?(N.cursorPos=null,N.targetCorners=null,N.canceled=!0,b._interactor._42(),!0):void 0},Lo.prototype.handleEdit=function($,s){var n=this,e=n.editing;if(e){var P,z,B,H,f,U=n.target,S=e.key,x=e.mode,r=$.lp(s),q=n._interactor;if("connect"===x){if(e.canceled)return;if(e.deleted)return;e.cursorPos=q._getLogicalPoint(s);var R=e.garbageInfo;return R&&zr.checkHit(e.cursorPos,R,R.size)?(R.hover=!0,e.target=null,e.targetCorners=null):(R&&(R.hover=!1),e.target=$.getDataAt(r,function(A){return $.isSelectable(A)?fr(A)?!0:!1:!1})||null,e.targetCorners=zr.getTargetCornersOnScreen($,e.target)),q._42(),void 0}if("rotate"===x){var j,y,t=e.pos,o=Math.atan2(r.y-t.y,r.x-t.x);if(e.groupRotateMode?y=o-e.hitRot:(j=o-e.hitRot,y=e.rotation+j),y%=2*Math.PI,0>y&&(y+=2*Math.PI),!C.Default.isCtrlDown(s)){var A,J;Bm(s)?(A=q.getStyle("shiftRotateRound"),J=A/2):(A=q.getStyle("rotateRound"),J=q.getStyle("rotateSensitivity")),y=zr.roundTo(y,A,J)}e.groupRotateMode?(j=y-(e.lastRotation||0),0!==j&&(U.addRotation(j,e.groupRotateMode),e.lastRotation=y)):U.setRotation(y),q._setRotateCursor(o),y>Math.PI&&(y-=2*Math.PI);var K=180*(y/Math.PI);K=K.toFixed(2),P=""+K+""}else if("resize"===x){var b=e.rect;B=b.x,H=b.y;var u,X=b.width,D=b.height,i=e.anchor,h=e.matrix,E=U.s&&U.s("keepAspectRatio")||q.getStyle("keepAspectRatio");Bm(s)&&(E=!E);var W=n._unionPointMode1,G=n._unionPointMode2;if(n._inSmartGuide&&!C.Default.isCtrlDown(s)&&!E){var k;"L"===S||"R"===S?k="x":("T"===S||"B"===S)&&(k="y"),n._adsorbedToClosest(r,k),f=!0}u=h.tfi(r);var _;"LT"===S?(b=W(u,{x:B+X,y:H+D},X,D,E),_=9):"T"===S?(b=G({x:B,y:u.y},{x:B+X,y:H+D},X,D,E,"v"),_=1):"RT"===S?(b=W(u,{x:B,y:H+D},X,D,E),_=33):"L"===S?(b=G({x:u.x,y:H},{x:B+X,y:H+D},X,D,E,"h"),_=8):"R"===S?(b=G({x:B,y:H},{x:u.x,y:H+D},X,D,E,"h"),_=32):"LB"===S?(b=W(u,{x:B+X,y:H},X,D,E),_=12):"B"===S?(b=G({x:B,y:H},{x:B+X,y:u.y},X,D,E,"v"),_=4):"RB"===S&&(b=W(u,{x:B,y:H},X,D,E),_=36);var Y=h.tf(b.x+b.width*i.x,b.y+b.height*i.y);U instanceof C.Block&&(e.hasOwnProperty("freezeFlag")||(e.freezeFlag=U._freezeSyncFromChildren,U._freezeSyncFromChildren=!0)),U.setPosition(Y),U.setSize(b.width,b.height),f&&(z=U.getRect(),q.rectGuide.gatherLines({node:U,x:z.x,y:z.y,w:z.width,h:z.height},k,_)),P=""+Math.round(b.width)+" * "+Math.round(b.height)}else if("line"===x){if(Bm(s)){var d=U.getPoints(),m="P1"===S?d.get(1):d.get(0),v={x:r.x-m.x,y:r.y-m.y},l=q.getStyle("shiftLineRotateRound"),M=n._shiftDirList;if(!M||n._shiftRotateRound!==l){n._shiftRotateRound=l,n._shiftDirList=M=[];for(var p=0;p<Math.PI;p+=l)M.push({x:c(p),y:T(p)})}for(var F,Q=0,I=0,O=M.length;O>I;I++){var L=M[I],g=L.x*v.x+L.y*v.y;Math.abs(g)>Math.abs(Q)&&(Q=g,F=L)}r={x:m.x+F.x*Q,y:m.y+F.y*Q},q.rectGuide.clear()}else n._inSmartGuide&&!C.Default.isCtrlDown(s)&&(n._adsorbedToClosest(r),f=!0);var V=zr.getDataMatrix(U).applyInverse(r);U.setPoint("P1"===S?0:1,V,!0);var w=U.getPoints(),N=w.get(0),Z=w.get(1);B=N.x-Z.x,H=N.y-Z.y,P=" "+Math.round(Math.sqrt(B*B+H*H))+" ",f&&(z=U.getRect(),q.rectGuide.gatherLines({node:U,x:z.x,y:z.y,w:z.width,h:z.height}))}if(P){var a=C.Default.getLogicalPoint(s,q._canvas);a.x+=zr.Icons.TipShiftX,a.y+=zr.Icons.TipShiftY,n.tipInfo={helperPos:a,text:P,size:P.length}}n._fireEditEvent("between",s)}},Lo.prototype._unionPointMode1=function(Y,u,l,V,F){if(F&&l&&V){var d=Y.x-u.x,q=Y.y-u.y;Math.abs(d*V)<Math.abs(q*l)?(q=Math.sign(q)*Math.abs(d*V/l),Y.y=u.y+q):(d=Math.sign(d)*Math.abs(q*l/V),Y.x=u.x+d)}return C.Default.unionPoint(Y,u)},Lo.prototype._unionPointMode2=function(I,e,o,d,A,Y){var L=C.Default.unionPoint(I,e);if(A&&o&&d){var g;"v"===Y?(g=L.x+L.width/2,L.width=o*L.height/d,L.x=g-L.width/2):(g=L.y+L.height/2,L.height=d*L.width/o,L.y=g-L.height/2)}return L},Lo.prototype._adsorbedToClosest=function(C,k){var s=this,Q=s._interactor,f=Q.rectGuide.findClosest(C,k),Z=Q.gridGuide.findClosest(C,k),p=1/0,X=1/0;f&&(isFinite(f.x)&&(p=f.x),isFinite(f.y)&&(X=f.y)),Z&&(isFinite(Z.x)&&Math.abs(Z.x)<Math.abs(p)&&(p=Z.x),isFinite(Z.y)&&Math.abs(Z.y)<Math.abs(X)&&(X=Z.y)),isFinite(p)&&(C.x+=p),isFinite(X)&&(C.y+=X)},Lo.prototype._42=function(g,Z,K){var A=this;A.info={},A.screenInfo=null;var v=A._interactor;if(!v.editDetail&&A.gatherInfo(Z,K)){var E=A.editing,d=E?E.groupRotateMode:null,C=A.screenInfo;"block"!==d&&(C.P1?zr.Icons.DrawIcon(v,g,zr.Icons.Line,C):zr.Icons.DrawIcon(v,g,zr.Icons.Rect,C),C.connect&&(zr.Icons.DrawIcon(v,g,zr.Icons.ConnectGuide,{rotation:C.rotation,connect:C.connect,cursorPos:E?E.cursorPos:null}),E&&(E.targetCorners&&zr.Icons.DrawIcon(v,g,zr.Icons.NodeHoverGuide,E.targetCorners),E.garbageInfo&&zr.Icons.DrawIcon(v,g,zr.Icons.ConnectGuideGarbage,E.garbageInfo))),A.tipInfo&&zr.Icons.DrawIcon(v,g,zr.Icons.TipHelper,A.tipInfo)),A.target instanceof zr.Group&&A.target._42(v,g,Z)}};var Rn=zr.Anchor=function(h){this.catalog="Anchor",this._interactor=h};Rn.prototype={},Rn.prototype.constructor=Rn,Rn.prototype.gatherInfo=function(E,o){var p=this;if(1===o.length){var x=o[0];if(!x.getAnchor)return;if(x instanceof C.Shape&&x._70I())return;if(ao(x,E))return;return p.gatherSingleTarget(E,o[0])}return o.length>1?p.gatherMultiTargets(E,o):!1},Rn.prototype.gatherSingleTarget=function(h,u){var b=this;return b.info.POS=u.getPosition(),b.screenInfo.POS=zr.toScreenPosition(h,b.info.POS),b.target=u,!0},Rn.prototype.gatherMultiTargets=function(Y,z){var N=this,i=zr.Group.findOrCreateGroup(z);return i?(N.screenInfo.POS=zr.toScreenPosition(Y,i.getAnchor2()),N.target=i,!0):!1},Rn.prototype.isVisible=function(){var n=this,X=n._interactor;if(X.getStyle("anchorVisible")===!1)return!1;var J=n.target;if(J){if(this.editing)return!0;var $=J.getAnchor(),H=X.getStyle("anchorOutsideVisibleThreshold");if($.x<-H||$.x>1+H||$.y<-H||$.y>1+H)return!0;var s=J.getSize(),G=J.getScale(),d=Math.min(Math.abs(s.width*G.x),Math.abs(s.height*G.y));if(d*X.gv._zoom<X.getStyle("anchorHideThreshold"))return!1}return!0},Rn.prototype.check=function(x,U,P){if(C.Default.isLeftButton(U)){var _=this,R=_._interactor;if(_.isVisible()&&R.getStyle("anchorMovable")!==!1){_.editing=null,_.tipInfo=null;var v=_.target;if(v&&x.isAnchorEditable(v)&&x.isEditable(v)){var L;if(_.screenInfo&&(L=_.screenInfo.POS)&&zr.checkHit(P,new zr.Math.Vector2(L),R.getStyle("checkSize"))){if(v instanceof zr.Group)return _.editing={},!0;var Q=v.getWidth(),$=v.getHeight(),X=v.getAnchor();return _.editing={rect:{x:-Q*X.x,y:-$*X.y,width:Q,height:$},anchor:X,matrix:v.getMatrix()},!0}}}}},Rn.prototype.startEdit=function(Q,t){Q.startDragging(t),Q.fi({kind:"beginEditAnchor",event:t})},Rn.prototype._46O=function(Z){var G=this;G.editing&&(G.editing=null,G._interactor.fi({kind:"endEditAnchor",event:Z})),G.tipInfo=null},Rn.prototype.handleEdit=function(J,A){var w=this,E=w.target;if(E){var v=w.editing;if(v){var L=J.lp(A),O=w._interactor;if(E instanceof zr.Group)return E.setAnchor2(L),O._42(),void 0;var g=v.matrix,u=g.tfi(L),Z=v.rect,Y=(u.x-Z.x)/Z.width,N=(u.y-Z.y)/Z.height;if(!C.Default.isCtrlDown(A)){var B=O.getStyle("anchorRound"),S=O.getStyle("anchorSensitivity");Y=zr.roundTo(Y,B,S),N=zr.roundTo(N,B,S)}E.setAnchor(Y,N,!0);var z=C.Default.getLogicalPoint(A,O._canvas);z.x+=zr.Icons.TipShiftX,z.y+=zr.Icons.TipShiftY;var M=""+Y.toFixed(2)+", "+N.toFixed(2);w.tipInfo={helperPos:z,text:M,size:M.length},O.fi({kind:"betweenEditAnchor",event:A})}}},Rn.prototype._42=function(S,y,U){var Q=this;Q.info={},Q.screenInfo={};var p=Q._interactor;p.editDetail||Q.gatherInfo(y,U)&&Q.isVisible()&&(zr.Icons.DrawIcon(p,S,zr.Icons.Anchor,Q.screenInfo),Q.tipInfo&&zr.Icons.DrawIcon(p,S,zr.Icons.TipHelper,Q.tipInfo))};var Jb=zr.RotateX=function(q){this.catalog="RotateX",this._interactor=q};Jb.prototype={},Jb.prototype.constructor=Jb,Jb.prototype.gatherInfo=function(V,c){var s=this;if(1===c.length){var d=c[0];return d instanceof C.Shape&&d._70I()||ao(d,V)?!1:s.gatherSingleTarget(V,d)}return c.length>1?s.gatherMultiTargets(V,c):!1},Jb.prototype.gatherSingleTarget=function(){var A=new C.Math.Vector2,V=new C.Math.Vector2,x=new C.Math.Vector2,R=new C.Math.Vector2,I=function(i,f){var u=i.x-f.x,B=i.y-f.y;return u*u+B*B};return function(b,l){if(l.getCorners){var t=this,J=l.getCorners(),B=15,E=l.getPosition();A.copy(J[0]),x.copy(J[1]),R.copy(J[3]),V.copy(A).add(R).divideScalar(2).add(A.sub(x).setLength(B/b.getZoom()));var y=Math.max(I(E,J[0]),I(E,J[1]),I(E,J[2]),I(E,J[3]));return t.info.POS=V.clone(),t.screenInfo.POS=zr.toScreenPosition(b,t.info.POS),t.screenInfo.LEN=Math.sqrt(y)*b.getZoom()+B,t.screenInfo.CENTER=zr.toScreenPosition(b,E),t.target=l,!0}}}(),Jb.prototype.gatherMultiTargets=function(r,M){var i=this,b=zr.Group.findOrCreateGroup(M);if(!b)return!1;var i=this;return i.gatherSingleTarget(r,b)},Jb.prototype.isVisible=function(){var a=this._interactor;if(!a.getStyle("rotateAsClock"))return!1;var k=this.target;if(!k)return!0;var q=a.gv;return q.isEditable(k)&&q.isRotationEditable(k)?!0:!1},Jb.prototype.check=function(s,m,O){var g=this,Z=g._checkImpl(s,m,O);return(Z||g._clockPainted)&&g._interactor._42(),Z},Jb.prototype._checkImpl=function($,H,D){if(C.Default.isLeftButton(H)){var L=this;L.editing=null,L.tipInfo=null;var J;if(L.screenInfo&&(J=L.screenInfo.POS)&&L.isVisible()){var x=L._interactor;if(zr.checkHit(D,J,x.getStyle("checkSize"))){var j=L.target,V=$.lp(H),q=j.getPosition(),G=Math.atan2(V.y-q.y,V.x-q.x);return x._setRotateCursor(G),L.editing={pos:q,rotation:j.getRotation(),hitRot:G,groupRotateMode:"block",screenInfo:{CENTER:L.screenInfo.CENTER,LEN:L.screenInfo.LEN}},!0}}}},Jb.prototype.startEdit=function(A,r){A.startDragging(r),A.fi({kind:"beginEditRotation",event:r}),this.target instanceof zr.Group&&this.target.beginRotate(this.editing)},Jb.prototype._46O=function(o){var E=this;E.editing&&(E.editing=null,E._interactor.fi({kind:"endEditRotation",event:o})),E.target instanceof zr.Group&&E.target.endRotate(),E.tipInfo=null},Jb.prototype.handleEdit=function(B,t){var I=this,b=I.editing;if(b){var G,L,D=I.target,d=B.lp(t),R=I._interactor,Z=b.pos,S=Math.atan2(d.y-Z.y,d.x-Z.x),s=D instanceof zr.Group;if(s?L=S-b.hitRot:(G=S-b.hitRot,L=b.rotation+G),L%=2*Math.PI,0>L&&(L+=2*Math.PI),!C.Default.isCtrlDown(t)){var a,v;Bm(t)?(a=R.getStyle("shiftRotateRound"),v=a/2):(a=R.getStyle("rotateRound"),v=R.getStyle("rotateSensitivity")),L=zr.roundTo(L,a,v)}s?(G=L-(b.lastRotation||0),0!==G&&(D.addRotation(G,b.groupRotateMode),b.lastRotation=L)):D.setRotation(L),R._setRotateCursor(S),L>Math.PI&&(L-=2*Math.PI);var V=180*(L/Math.PI),_=""+V.toFixed(2)+"",A=C.Default.getLogicalPoint(t,R._canvas);A.x+=zr.Icons.TipShiftX,A.y+=zr.Icons.TipShiftY,I.tipInfo={helperPos:A,text:_,size:_.length},R.fi({kind:"betweenEditRotation",event:t})}},Jb.prototype._42=function(w,D,t){var p=this;p._clockPainted=!1,p.info={},p.screenInfo={};var O=p._interactor;O.editDetail||p.gatherInfo(D,t)&&p.isVisible()&&(zr.Icons.DrawIcon(O,w,zr.Icons.RoundPoint,p.screenInfo.POS),p.tipInfo&&zr.Icons.DrawIcon(O,w,zr.Icons.TipHelper,p.tipInfo),p.editing&&p.drawClock(w))},Jb.prototype.drawClock=function(f){f.save();var C=this;C._clockPainted=!0;var P=C.editing||{},V=P.screenInfo||C.screenInfo,B=V.LEN,g=B+8,o=B+18;f.save(),f.translate(V.CENTER.x,V.CENTER.y),f.beginPath(),f.strokeStyle="rgb(150, 150, 150)";for(var W,y,U,Q,J,v=0;360>v;v++)W=v*Math.PI/180,0===v%5&&(y=T(W)*B,U=c(W)*B,Q=T(W)*g,J=c(W)*g,f.moveTo(y,U),f.lineTo(Q,J)),0===v%45&&(y=T(W)*B,U=c(W)*B,Q=T(W)*o,J=c(W)*o,f.moveTo(y,U),f.lineTo(Q,J));f.stroke(),f.rotate(-F);var X=P.lastRotation||C.target.getRotation();f.beginPath(),f.fillStyle="rgba(255, 0, 0, 0.1)",f.strokeStyle="rgb(157, 157, 157)",f.moveTo(0,0),f.arc(0,0,o,0,X,!1),f.fill(),f.beginPath(),f.moveTo(0+o,0),f.arc(0,0,o,0,X,!1),f.stroke(),f.restore()};var Fr=zr.Curve=function(d){this.catalog="Curve",this._interactor=d};Fr.prototype={},Fr.prototype.constructor=Fr,$.defineProperties(Fr.prototype,{activing:{get:function(){return this._activing},set:function(d){var h=this;if(d)h._activing=new zr.CurveActiving(this,d);else{var B=h._activing;B&&B.dispose(),h._activing=null}}}}),Fr.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},Fr.prototype.setUp=function(){var J=this,Q=J._interactor;Q&&Q.gv.mp(J._onGraphviewPropertyChanged,J)},Fr.prototype._onGraphviewPropertyChanged=function(V){("zoom"===V.property||"translateX"===V.property||"translateY"===V.property)&&this._handleDataChanged()},Fr.prototype.tearDown=function(){var D=this,R=D._interactor;R&&R.gv.ump(D._onGraphviewPropertyChanged,D)},Fr.prototype.canEnterEditDetailMode=function(){var h=this,y=h._interactor,M=y._getValidSelection();if(1===M.length){var t=M[0],v=t instanceof C.Edge;if(t instanceof C.Shape||v){if(v){var k=t.s("edge.type");if(k&&"points"!==k)return}var g=y.gv;if(g.isPointEditable(t)&&g.isEditable(t))return h.target=t,!0}}},Fr.prototype.preHandleScroll=function(){var S=this.editing;return S&&S.inEdit?!0:void 0},Fr.prototype.getCurrentSelectintStatus=function(){var l=this;if(l.activing&&!l.activing.selections){if(l.activing.status!=P)return l.activing.status;var v=function(Z){var v=l.activing.status;l.activing.status=Z,l._interactor.fp("shapePointStatus",v,Z)},j=zr.Curve.PointType,x=l.activing.point,O=l.activing.pairs;if(!O||1!==O.length)return v(j.Mirrored);var z=O[0],h=z.c1&&z.c1.isNearEnough(x),H=z.c2&&z.c2.isNearEnough(x);if(!z.c1||!z.c2)return h||H?v(j.Straight):v(j.Disconnected);if(h&&H)return v(j.Straight);if(h||H)return v(j.Asymmetric);var R=z.c1.clone().sub(x),K=z.c2.clone().sub(x);return Math.abs(R.x*K.y-R.y*K.x)>1e-5||R.x*K.x>0?v(j.Disconnected):Math.abs(R.length()-K.length())>1e-5?v(j.Asymmetric):v(j.Mirrored)}},Fr.prototype.handle_keydown=function(v){var w=this;if(w._interactor.editDetail){var n=zr.Curve.PointType;"1"===v.key?w._setCurrentSelectionStatus(n.Straight):"2"===v.key?w._setCurrentSelectionStatus(n.Mirrored):"3"===v.key?w._setCurrentSelectionStatus(n.Disconnected):"4"===v.key&&w._setCurrentSelectionStatus(n.Asymmetric)}},Fr.prototype.setCurrentSelectionStatus=function(e){var b=this,p=b._interactor;if(p){var s=p.gv;s.dm().beginTransaction(),this._setCurrentSelectionStatus(e),s.dm().endTransaction()}},Fr.prototype._setCurrentSelectionStatus=function(K){var I=this,E=I.activing;if(E){var C=I.getCurrentSelectintStatus();if(null!==C&&C!==K){E.status=K;var a=I.activing.point,q=I.activing.pairs;if(q&&1===q.length){var h=q[0],M=I.screenInfo.curve,H=zr.Curve.PointType,B=function(){I._writeToHt(),I._interactor.fp("shapePointStatus",C,K)};if(K===H.Straight)return M.moveCtrlPoint(h,a,"c1"),M.moveCtrlPoint(h,a,"c2"),B(),void 0;if(C===H.Straight){var y=M.findPairs(a,!0),$=y[0],D=$.r1||a,L=$.r2||a,R=L.clone().sub(D).multiplyScalar(.25);return M.moveCtrlPoint(h,a.clone().sub(R),"c1"),M.moveCtrlPoint(h,a.clone().add(R),"c2"),B(),void 0}var e=h.c1,P=h.c2;if(e&&P){if(K===H.Mirrored)return M.moveCtrlPoint(h,a.clone().multiplyScalar(2).sub(P),"c1"),B(),void 0;if(K===H.Asymmetric&&C===H.Disconnected){var u=e.clone().sub(a).length(),R=a.clone().sub(P).setLength(u).add(a);return M.moveCtrlPoint(h,R,"c1"),B(),void 0}}E._firePointChange(),I._interactor.fp("shapePointStatus",C,K)}}}},Fr.prototype._handleDataChanged=function(D){var N=this;if(N.screenInfo&&N.target){var G=N._interactor;N.gatherSingleTarget(G.gv,N.target,!0),N.check(G.gv,null,D?G._getLogicalPoint(D):new zr.Math.Vector2(G._lastClientPoint)),G._42()}},Fr.prototype.gatherSingleTarget=function(S,k,B){var L,I,i=this;i.screenInfo&&i.screenInfo.curve&&(I=i.screenInfo.curve._curves);var D=i.editing;L=D?i.screenInfo:i.screenInfo={};var w,X,b=k instanceof C.Edge;b?(w=k.s("edge.segments"),X=k.s("edge.points")||new C.List):(w=k._58O,X=k._59O),L.S=w;var q,_=L.P=[],A=zr.getDataMatrix(k);if(k instanceof C.Polyline&&(q=k.getElevation()||0,L.E=[]),X.each(function(D){L.E&&L.E.push(D.e||q),D=A.apply(D);var J=zr.toScreenPosition(S,D);_.push(J.x,J.y)}),b){var r=zr.toScreenPosition(S,k._lastSourcePoint),h=zr.toScreenPosition(S,k._lastTargetPoint);_.splice(0,0,r.x,r.y),_.push(h.x,h.y)}if(!L.S||!L.S.size()){L.S=new C.List,L.S.add(1);for(var T=0;T<_.length/2-1;T++)L.S.add(2)}if((!D||B)&&i.convertToCubicBezier(I),i.activing&&(B||!i.editing||"realPoint"===i.editing.type)){var K=L.curve.findPairs(i.activing.point);i.activing.pairs=K}b&&"points"!==k.s("edge.type")&&i._writeToHt()},Fr.prototype._convertToNewPoint=function(x,b,L){var A,v,s;for(A=0,v=b.length;v>A;A++){if(s=b[A],s._p1.isNearEnough(x))return s._p1;if(s._p4.isNearEnough(x))return s._p4}if(L)for(A=0,v=Math.min(L.length,v);v>A;A++){if(s=L[A],s._p1===x)return b[A]._p1;if(s._p4===x)return b[A]._p4}},Fr.prototype.convertToCubicBezier=function(y){var e,h,V=this,O=new zr.Math.Curve,k=V.screenInfo;if(O.createFromHtShape(k.P,k.S,k.E),k.curve=O,V.activing){var N=O._curves;if(e=V.activing.point,h=V._convertToNewPoint(e,N,y),h&&(V.activing.point=h),V.activing.selections){var W=-1,Q=V.activing.selections;Q.forEach(function(P){W++,h=V._convertToNewPoint(P,N,y),h&&(Q[W]=h)})}}},Fr.prototype.check=function(J,s,e){if(!s||C.Default.isLeftButton(s)){var d=this;if(d._interactor.setCursor("default"),d.editing=null,d.highlight=null,d.tipInfo=null,d.screenInfo){if(Qg())return d._interactor._42(),!0;if(d._checkEditCtrlPoint(e))return d._interactor._42(),!0;if(d._checkEditRealPoint(e))return d._interactor._42(),!0;if(d._checkEditElevation(e))return d._interactor._42(),!0;var l=d.screenInfo.curve,q=l.checkPoint(e,d._interactor.getStyle("curveIntersectSize"));if(q){var N=d.highlight={};N.type="insertKnot",N.bezier=q.bezier,N.point=q.intersection}return d._interactor._42(),!0}}},Fr.prototype._checkEditRealPoint=function(x){var O,A,m,n,E,F,C=this,z=C.screenInfo.curve._curves,K=C._interactor.getStyle("curvePointIntersectSize"),G=1/0;for(K*=K,m=0,n=z.length;n>m;m++)O=z[m],E=O._p1,F=x.distanceToSquared(E),G>F&&(G=F,A=E),E=O._p4,F=x.distanceToSquared(E),G>F&&(G=F,A=E);if(G>K)return!1;var g=C.highlight={};return g.type="changeRealPoint",g.point=A,C.editing={type:"realPoint",point:A,shiftGuide:{point:A.clone(),dir:"x",limit:0}},C._interactor.setCursor("crosshair"),!0},Fr.prototype._checkEditElevation=function(L){var M=this;if(!M._interactor.getStyle("curveElevationVisible"))return!1;var $=M.activing;if(!$)return!1;var x=$.getCurrentEditingPoint();if(!x)return!1;var p=M._interactor,P=p.getStyle("curveElevationGuideShift"),e=p.getStyle("curveElevationIntersectSize"),F=L.distanceToSquared({x:x.x+P[0],y:x.y+P[1]});if(!(F>e*e)){var B=M.highlight={};B.type="elevation";var m=new zr.Math.Vector2(L.x,L.y,x.e);return M.editing={type:"elevation",startPoint:m},M._interactor.setCursor("crosshair"),!0}},Fr.prototype._checkEditCtrlPoint=function(l){var Y=this;if(Y.activing&&!Y.activing.selections){var w=Y.getCurrentSelectintStatus();if(w!==zr.Curve.PointType.Straight){var V=Y.activing.pairs;if(V){var y=Y._interactor.getStyle("curvePointIntersectSize");y*=y;var T,J,f,A,O,t,S,K,j,r=1/0;for(S=0,j=V.length;j>S;S++)for(A=V[S],K=0;2>K;K++)O=0===K?"c1":"c2",A[O]&&(t=l.distanceToSquared(A[O]),r>t&&(r=t,T=A,J=S,f=O));if(r>y)return!1;Y.activing.hlpair=T,Y.activing.hltype=f;var u=Y.highlight={};return u.type="changeCtrlPoint",u.point=T[f],Y.editing={type:"ctrlPoint",pair:T,pairId:J,ctrlType:f,direction:T[f].clone().sub(Y.activing.point).normalize()},Y._interactor.setCursor("crosshair"),!0}}}},Fr.prototype.startEdit=function(B,H){B.startDragging(H);var g=this;g.highlight&&"insertKnot"===g.highlight.type&&(g.insertKnot(),g.gatherSingleTarget(g._interactor.gv,g.target),g.activing=null,g._checkEditRealPoint(g._interactor._getLogicalPoint(H)));var L=g._activing;if(L){var E=g.editing?g.editing.type:null;"ctrlPoint"===E?L.editingCtrl={pairId:g.editing.pairId,type:L.hltype}:"realPoint"===E&&(L.editingCtrl=!1)}var W=g.highlight,j=C.Default.isCtrlDown(H);if(!W||Qg()){var y=g._interactor.gv;if(!y.setFocus(H)||y._scrolling)return;return y.isPannable()&&Qe(H)&&!j&&(g._pan={tx:y.tx(),ty:y.ty()},B.fi({kind:"beginPan",event:H})),void 0}if("changeRealPoint"===W.type){var v,U=g.activing?g.activing.point:null,o=g.activing?g.activing.selections:null;if(j&&g.activing)U===W.point?(o?(g.activing={point:o[0]},o.length>1&&(o.splice(0,1),g.activing.selections=o)):g.activing=null,g.editing=null):o&&(v=o.indexOf(W.point))>=0?(o.length>1?o.splice(v,1):delete g.activing.selections,g.editing=null):o?(o.push(U),g.activing={point:W.point,selections:o}):g.activing={point:W.point,selections:[U]};else if(o)U===W.point||((v=o.indexOf(W.point))>=0?(o.splice(v,1,U),g.activing={point:W.point,selections:o}):g.activing={point:W.point});else{var u;U===W.point&&(u=g.activing.status),g.activing={point:W.point},u&&(g.activing.status=u)}B.fi({kind:"beginEditPoint",event:H})}},Fr.prototype.insertKnot=function(){var u=this,e=u.highlight,Y=u.screenInfo.curve;Y.insertKnot(e.bezier,e.point.t),u._writeToHt()},Fr.prototype._writeToHt=function(){var J,W,d,H,A=this,Q=A.screenInfo.curve,x=Q.toHtShape(),p=x.points,O=[],f=x.segments,m=A._interactor.gv,z=A.target,E=z instanceof C.Edge,B=zr.getDataMatrix(z).invert();H=z instanceof C.Polyline,H&&(d=z.getElevation());for(var T=0,w=p.length;w>T;T++)J=p[T],W=zr.toWorldPosition(m,J),W=B.apply(W),J.e!=P&&J.e!==d&&(W.e=J.e),O.push(W);if(z._writing=!0,E){z.s("edge.type","points"),z.setStyle("edge.segments",f),z.setStyle("edge.points",O.slice(1,O.length-1)),z.setStyle("edge.source.offset.x",0),z.setStyle("edge.source.offset.y",0),z.setStyle("edge.target.offset.x",0),z.setStyle("edge.target.offset.y",0);var r=A._nextChangeEdgeHost;delete A._nextChangeEdgeHost,r&&("source"===r.type?z.setSource(r.host):z.setTarget(r.host)),A._writeEdgeHostAnchor("source",O[0]),A._writeEdgeHostAnchor("target",O[O.length-1])}else O.length?(z.setSegments(f),z.setPoints(O,!0)):z.removeFromDataModel();delete z._writing},Fr.prototype._writeEdgeHostAnchor=function(N,V){var c=this,K=c.target,d=c._calcHostAnchor(K,N,V);K.s("edge."+N+".anchor.x",d.x),K.s("edge."+N+".anchor.y",d.y),d.offsetX||d.offsetY?(K.s("edge."+N+".offset.x",d.offsetX),K.s("edge."+N+".offset.y",d.offsetY)):(K.s("edge."+N+".offset.x",0),K.s("edge."+N+".offset.y",0))},Fr.prototype._calcHostAnchor=function(X,m,W,A){A||(A="source"===m?X.getSource():X.getTarget());var e=this._interactor.gv,x=e.calculateAttachPoint(A,W);if(x)return x.info;var P=A.getRotation(),j=A.getAnchor();if(ao(A,e)&&(P=0),P){var $=A.getMatrix(),c=$.tfi(W),K=A.getSize();return{x:c.x/K.width+j.x,y:c.y/K.height+j.y}}var f=vg(e,A),D={x:(W.x-f.x)/f.width,y:(W.y-f.y)/f.height};return D},Fr.prototype._handlePanning=function(L){var g=this,X=g._pan;if(X){X.started=!0;var G=g._interactor,F=G.gv,V=G._lastClientPoint,q=ih(L);F.setTranslate(X.tx+q.x-V.x,X.ty+q.y-V.y),g.gatherSingleTarget(G.gv,g.target),G._42(),G.fi({kind:"betweenPan",event:L})}},Fr.prototype.handleEdit=function(g,I){var X=this,O=X.editing;if(X._pan)return X._handlePanning(I),void 0;if(O){O.inEdit=!0;var l,r,N,E=X._interactor._getLogicalPoint(I),D=C.Default.isCtrlDown(I),t=C.Default.isShiftDown(I),J=O.type,L=X.activing;if(X._guideInfo=null,"ctrlPoint"===J&&t){var h=X.editing.direction.clone();l=L.point;var s=h.dot(E.clone().sub(l));E=h.setLength(s).add(l)}else if("ctrlPoint"===J||"realPoint"===J){var h;if("realPoint"===J&&t){var i=X.editing.shiftGuide;r=i.point;var $=Math.abs(E.x-r.x),v=Math.abs(E.y-r.y);$>v&&$>i.limit&&"y"===i.dir&&(i.dir="x"),v>$&&v>i.limit&&"x"===i.dir&&(i.dir="y"),h=i.dir,"x"===h?(E.y=r.y,i.limit=Math.max(i.limit,$)):"y"===h&&(E.x=r.x,i.limit=Math.max(i.limit,v))}var d=X._isEditEdgeSourceTarget();if(d){var q=X._editEdgeSourceTarget(d,E,D);q&&(N=q.tipText)}else if(!D){var S=X._guidingToEdit(E,h),Q="realPoint"===J?X._interactor.gridGuide.findClosest(E,h,!0):null,A=1/0,R=1/0;Q&&(Q.x&&(A=Q.x),Q.y&&(R=Q.y));var a=!1;S&&(S.xList&&(Math.abs(S.x)<=Math.abs(A)?(a=!0,A=S.x):delete S.xList),S.yList&&(Math.abs(S.y)<=Math.abs(R)?(a=!0,R=S.y):delete S.yList),a&&(X._guideInfo=S)),isFinite(A)&&(E.x+=A),isFinite(R)&&(E.y+=R),a&&(S.v=E)}}var H=X.screenInfo.curve;if("realPoint"===O.type){l=O.point,l.e!==P&&(E.e=l.e),H.moveRealPoint(l,E),O.point=E,X.highlight.point=E;var y=L.status,V=L.selections;if(X.activing={point:E,status:y},V){var z=E.clone().sub(l),u=0;V.forEach(function(G){var j=G.clone().add(z);H.moveRealPoint(G,j),V[u++]=j}),X.activing.selections=V}}else if("ctrlPoint"===O.type){var x=L.pairs,p=x[O.pairId];H.moveCtrlPoint(p,E,O.ctrlType);var K=L.status,B=zr.Curve.PointType;if((K===B.Mirrored||K===B.Asymmetric)&&p.c1&&p.c2){var l=new zr.Math.Vector2(L.point),j="c1"===O.ctrlType?"c2":"c1";if(K===zr.Curve.PointType.Mirrored)H.moveCtrlPoint(p,l.clone().multiplyScalar(2).sub(E),j);else if(K===B.Asymmetric){var s=p[j].clone().sub(l).length(),o=l.clone().sub(p[O.ctrlType]).setLength(s).add(l);isNaN(o.x)||H.moveCtrlPoint(p,o,j)}}L._firePointChange()}else if("elevation"===O.type){r=O.startPoint;var T=r.e+(r.y-E.y)/g._zoom;X._setCurrentPointImpl("e",T),L._firePointChange(),N="E: "+zr.toFixed(T)}var c=C.Default.getLogicalPoint(I,X._interactor._canvas);if(c.x+=zr.Icons.TipShiftX,c.y+=zr.Icons.TipShiftY,!N){var Y=zr.toWorldPosition(g,E);N=""+zr.toFixed(Y.x)+", "+zr.toFixed(Y.y)}X.tipInfo={helperPos:c,text:N,size:N.length},X._writeToHt(),X._interactor.fi({kind:"betweenEditPoint",event:I})}},Fr.prototype._setCurrentPointImpl=function(l,r){var N=this,c=N._activing;if(!c)return!1;var o=N.target;if(!o)return!1;var u=c.getCurrentEditingPoint();if(!u)return!1;var Q=c.editingCtrl;if(!Q)var _=u.clone();if("e"===l)u.e=r;else{var i;if("x"===l||"y"===l){var D=c._lastFirePoint;i="x"===l?{x:r,y:D?D.y:0}:{x:D?D.x:0,y:r}}else"object"==typeof l?(i=l,l.e!==P&&(u.e=l.e)):(i={x:arguments[0],y:arguments[1]},arguments[2]!==P&&(u.e=arguments[2]));var q=zr.getDataMatrix(o);i=zr.toScreenPosition(N._interactor.gv,q.apply(i)),u.x=i.x,u.y=i.y}if(!Q){var z=_.multiplyScalar(-1).add(u);u.e&&_.e&&(z.e=u.e-_.e),N.screenInfo.curve.moveCtrlDueToRealPointMovement(u,z)}return!0},Fr.prototype.setCurrentPoint=function(Y,D){return this._setCurrentPointImpl(Y,D)?(this._writeToHt(),!0):!1},Fr.prototype._isEditEdgeSourceTarget=function(){var s=this,t=s.target;if(!(t instanceof C.Edge))return!1;var P=s.editing.point,_=s.screenInfo.curve._curves;return P===_[0]._p1?"source":P===_[_.length-1]._p4?"target":!1},Fr.prototype._editEdgeSourceTarget=function(f,m,u){var C,L=this,i=L.target;if(C="source"===f?i.getSource():i.getTarget()){var v=L._interactor.gv,t=zr.toWorldPosition(v,m),D=L._calcHostAnchor(i,f,t,C);if(L._interactor.getStyle("edgeHostDetectPerFrame")||D.x<0||D.x>1||D.y<0||D.y>1){var $=v.getDataAt(t,function(E){return v.isSelectable(E)?fr(E)?!0:!1:!1});if($){var g=L._calcHostAnchor(i,f,t,$);C=$,L._nextChangeEdgeHost={type:f,host:$},D=g}}var B;if(!u){var c=L._interactor.getStyle("anchorRound"),z=L._interactor.getStyle("anchorSensitivity");B=v.calculateAttachPoint(C,t),B?D=B.info:(D.x=zr.roundTo(D.x,c,z),D.y=zr.roundTo(D.y,c,z))}if(!u){var k=C.getAttachPosition(D.x,D.y,D.offsetX,D.offsetY),F=zr.toScreenPosition(v,k);m.x=F.x,m.y=F.y}L._edgeHostGuideInfo={corners:zr.getTargetCornersOnScreen(v,C),attach:B?B.index:-1,host:C};var X=""+D.x.toFixed(2)+", "+D.y.toFixed(2);return(D.offsetX||D.offsetY)&&(X+=" offset: "+D.offsetX.toFixed(2)+", "+D.offsetY.toFixed(2)),{host:C,anchor:D,tipText:X}}},Fr.prototype._guidingToEdit=function(G,b){var X,B,O=this;if(X=O.screenInfo.curve){B=X._curves;var u,h,D,F,e,d,g,I,R=1/0,K=1/0,k=[];for(O.editing&&"realPoint"===O.editing.type&&(I=O.editing.point),e=0,d=2*B.length;d>e;e++)g=B[Math.floor(e/2)][e%2?"_p4":"_p1"],k.indexOf(g)>=0||(k.push(g),I&&I===g||(D=g.x-G.x,F=g.y-G.y,Math.abs(D)<Math.abs(R)?(R=D,u=[g]):D===R&&u.push(g),Math.abs(F)<Math.abs(K)?(K=F,h=[g]):F===K&&h.push(g)));var S=O._interactor.getStyle("smartGuideSensitivity");if((Math.abs(R)>S||"y"===b)&&(u=null),(Math.abs(K)>S||"x"===b)&&(h=null),u||h){var A=!1,U={};if(u&&(A=!0,U.xList=u,U.x=R),h&&(A=!0,U.yList=h,U.y=K),A)return U}}},Fr.prototype._46O=function(f){var q=this;q.editing&&(q.editing=null,q._interactor.fi({kind:"endEditPoint",event:f})),q._guideInfo=null,q._edgeHostGuideInfo=null,q._pan&&(q._pan=null,q._interactor.fi({kind:"endPan",event:f})),q.tipInfo=null},Fr.prototype._canDeletePoint=function(m,q){var z=this.target;if(!(z instanceof C.Edge))return!0;var j=m._curves[0],k=m._curves[m._curves.length-1];return j._p1===q||k._p4===q?!1:!0},Fr.prototype.handleDelete=function(){var i=this;if(i.activing&&i.screenInfo){var U=C.Default.isShiftDown(),J=i.screenInfo.curve;i._canDeletePoint(J,i.activing.point)&&J.deleteRealPoint(i.activing.point,U),i.activing.selections&&i.activing.selections.forEach(function($){i._canDeletePoint(J,$)&&J.deleteRealPoint($,U)}),i.activing=null,delete i.editing,delete i.tipInfo,delete i._pan,i._writeToHt(),i._interactor.fp("deleteShapePoint",!1,!0)}},Fr.prototype.handleDoubleClick=function(w){var e=this,q=e._interactor._getLogicalPoint(w);if(e.screenInfo&&e._checkEditRealPoint(q)){var l=e.getCurrentSelectintStatus(),Z=zr.Curve.PointType;return l=l===Z.Mirrored?Z.Straight:Z.Mirrored,e._setCurrentSelectionStatus(l),e._interactor._42(),!0}},Fr.prototype._drawHighlight=function(F){var J=this,o=J.highlight;if(o){var H=o.bezier,R=J._interactor;H&&zr.Icons.DrawIcon(R,F,zr.Icons.ShapeHighlightCurve,[H._p1.x,H._p1.y,H._p2.x,H._p2.y,H._p3.x,H._p3.y,H._p4.x,H._p4.y]);var U=o.point;U&&"insertKnot"===o.type&&zr.Icons.DrawIcon(R,F,zr.Icons.ShapeHighlighPoint,U)}},Fr.prototype._drawGuide=function(f){var H=this,m=H._guideInfo;if(m){var C,k,W,q,J=m.v;for(C=0;2>C;C++)if(q=0===C?m.xList:m.yList)for(k=0,W=q.length;W>k;k++)zr.Icons.DrawIcon(H._interactor,f,zr.Icons.ShapeGuideLine,[J.x,J.y,q[k].x,q[k].y])}},Fr.prototype._drawCurrentPoint=function(k){var X=this;if(X.activing){var e=X.activing,S=X.getCurrentSelectintStatus(),j=X._interactor;if(S!==zr.Curve.PointType.Straight){var q=e.pairs;e.hlpair,e.hltype;var D=e.selections,M=e.editingCtrl;if(q&&!D){var i,c,L;for(c=0,L=q.length;L>c;c++)i=q[c],M&&c===M.pairId&&i[M.type]?zr.Icons.DrawIcon(j,k,zr.Icons.ShapeActivingCtrl,{point:i.point,c1:i.c1,c2:i.c2,hl:M.type}):zr.Icons.DrawIcon(j,k,zr.Icons.ShapeActivingCtrl,i)}}zr.Icons.DrawIcon(j,k,zr.Icons.ShapeHighlighRealPoint,X.activing.point),D&&D.forEach(function(A){zr.Icons.DrawIcon(j,k,zr.Icons.ShapeHighlighRealPoint,A)})}},Fr.prototype.clear=function(){var l=this;l.editing=null,l._guideInfo=null,l.activing=null,l.highlight=null},Fr.prototype._42=function(l){var y=this;y.info={},y.editing||(y.screenInfo=null);var U=y._interactor;if(!U.editDetail)return y.clear(),void 0;var t=U.gv;if(!y.target||!t.isSelected(y.target)||!t.isVisible(y.target))return U.editDetail=!1,y.clear(),void 0;if(y.gatherSingleTarget(t,y.target),zr.Icons.DrawIcon(U,l,zr.Icons.ShapeBgCurve,y.screenInfo),y._drawHighlight(l),y._drawCurrentPoint(l),y._getRealPoint().forEach(function(b){zr.Icons.DrawIcon(U,l,zr.Icons.ShapePoint,b)}),y._drawGuide(l),y.tipInfo&&zr.Icons.DrawIcon(U,l,zr.Icons.TipHelper,y.tipInfo),y._edgeHostGuideInfo){zr.Icons.DrawIcon(U,l,zr.Icons.NodeHoverGuide,y._edgeHostGuideInfo.corners);var X=y._edgeHostGuideInfo.host;if(X){var v=t.getAttachPoints(X);if(v&&v.length)for(var J=0,K=v.length;K>J;J++){var o=v[J],Q=X.getAttachPosition(o.x,o.y,o.offsetX,o.offsetY);Q=zr.toScreenPosition(t,Q),Q.isAttach=y._edgeHostGuideInfo.attach===J,zr.Icons.DrawIcon(U,l,zr.Icons.AttachPoint,Q)}}}if(y._interactor.getStyle("curveElevationVisible")&&y.target instanceof C.Polyline&&y.activing){var H=y.activing.getCurrentEditingPoint();H&&zr.Icons.DrawIcon(U,l,zr.Icons.EdgeElevationGuide,H)}},Fr.prototype._getRealPoint=function(){var o,i=this.screenInfo,T=i.P,F=i.S,M=-1,_=[],r=-1,A=F.length;return F.each(function(C){r++;var Y=1;if(3===C)Y=2;else if(4===C)Y=3;else if(5===C)return;M+=Y,o=r+1>=A?!0:1===F.get(r+1)?!0:!1,_.push({point:{x:T[2*M],y:T[2*M+1]},segmentIndex:r,pointIndex:M,isEnd:o})}),_},Fr.prototype.getEditingPointsInfo=function(x){var c=this,K=c.activing;if(!K)return!1;var m=K.point;if(!m)return!1;var p=this._getRealPoint(),l=[{screen:m}];K.selections&&K.selections.forEach(function(j){l.push({screen:j})});var U,H,t=p.length;return l.forEach(function(y){for(U=0;t>U;U++)if(H=p[U],y.screen.isNearEnough(H.point)){y.segmentIndex=H.segmentIndex,y.pointIndex=H.pointIndex,y.point=c.target.getPoints().get(H.pointIndex);break
}}),x&&l.sort(function(l,D){return l.segmentIndex-D.segmentIndex}),l};var Vq=zr.MoveHelper=function(l){var r=this;r.catalog="Move",r._interactor=l};Vq.prototype={},Vq.prototype.constructor=Vq,Vq.prototype.calcShift=function(c,f,a){var Z,w,A=this,Y=A._interactor.gv,z=Y.lp(f);if("beginMove"===c&&A._gatherGridInfo(a._lastLogicalPoint||z),Z=A._target){var I=Z.downPosition;if(I){var H=A._interactor.getStyle("moveSensitivity")/Y._zoom;if(I.distanceTo(z)<H)return{x:0,y:0};delete Z.downPosition}var Q;w=C.Default.isShiftDown(f),w&&(z=A._dealShiftDown(z),Q=Z.shiftGuide.dir);var X,V=Z.rawPos={x:Z.pos.x+z.x-Z.lp.x,y:Z.pos.y+z.y-Z.lp.y};if(C.Default.isCtrlDown(f)){if(X=A._calcShiftByAddon(),A._target.node instanceof zr.Group){var u=A._target.node;u._position.x+=X.x,u._position.y+=X.y}return X}for(var r,S=Z.x+V.x,y=Z.y+V.y,J={x:S,y:y},b={x:S+Z.w/2,y:y+Z.h/2},$={x:S+Z.w,y:y+Z.h},g=A._interactor.rectGuide,G=A._interactor.gridGuide,B=[g.findClosest(J,Q),g.findClosest(b,Q),g.findClosest($,Q),G.findClosest(J,Q),G.findClosest(b,Q),G.findClosest($,Q)],O=1/0,l=1/0,n=0,d=B.length;d>n;n++)r=B[n],r&&(S=r.x,y=r.y,isFinite(S)&&Math.abs(S)<Math.abs(O)&&(O=S),isFinite(y)&&Math.abs(y)<Math.abs(l)&&(l=y));if(isFinite(O)||(O=0),isFinite(l)||(l=0),X=A._calcShiftByAddon(O,l),A._target.node instanceof zr.Group){var u=A._target.node;u._position.x+=X.x,u._position.y+=X.y}var p=Z.node;if(!ao(p,Y)){var K=V.x+O,L=V.y+l;A._interactor.rectGuide.gatherLines({node:p,x:Z.x+K,y:Z.y+L,w:Z.w,h:Z.h},Q)}return X}},Vq.prototype._calcShiftByAddon=function(K,I){var x=this._target,m=x.rawPos,J=x.node.getPosition();return K=K||0,I=I||0,{x:m.x-J.x+K,y:m.y-J.y+I}},Vq.prototype._dealShiftDown=function(L){var p=this,T=p._target.shiftGuide,j=p._target.lp,U=Math.abs(L.x-j.x),$=Math.abs(L.y-j.y);U>$&&U>T.limit&&"y"===T.dir&&(T.dir="x"),$>U&&$>T.limit&&"x"===T.dir&&(T.dir="y");var y=T.dir;return"x"===y?(L.y=j.y,T.limit=Math.max(T.limit,U)):"y"===y&&(L.x=j.x,T.limit=Math.max(T.limit,$)),L},Vq.prototype._gatherGridInfo=function(F){var l,J=this,L=J._interactor,i=L._getValidSelection();if(i.length){if(1===i.length){if(l=i[0],!l.getRect)return J._target=null,void 0}else if(l=zr.Group.findOrCreateGroup(i),!l)return J._target=null,void 0}else{var i=L.gv.sm().getSelection();if(i.length&&(l=i.get(0),!l.getRect))return J._target=null,void 0}var U=l.getPosition(),H=l.getRect();J._target={node:l,x:H.x-U.x,y:H.y-U.y,w:H.width,h:H.height,lp:{x:F.x,y:F.y},pos:{x:U.x,y:U.y},shiftGuide:{dir:"x",limit:0},downPosition:new zr.Math.Vector2(F)},L.rectGuide.gatherRects()},Vq.prototype.clear=function(){var h=this;h._interactor.rectGuide.clear(),h._interactor._42()};var $h="directional",hp="point",_k="spot",Al="light.color",vo=function(t,Z){Xd(Z)&&gd.test(Z)?kn(t,Z):Vl(Z)&&Z.modelType?vp(t,Z):Wi[t]=Z},$e=function(c){if(Vl(c))return c;var C=Wi[c];return c&&C===P&&gd.test(c)&&(Wm&&Wm[c]||kn(c,c)),C};yl(k,{graph3dViewAttributes:Y,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:O/60,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:jj,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:O/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,setShape3dModel:vo,getShape3dModel:$e,createMatrix:function(f,t){fk(f)||(f=[f]);for(var w=f.length-1;w>=0;w--){var X=f[w];t=Nk(X.mat,X.s3,X.r3,X.rotationMode,X.t3,t)}return t},transformVec:function(n,k){return uh(n,k)},createBoxModel:function(){return{vs:Gh,ns:Td,uv:$m,is:ug}},createRoundRectModel:function(X,O){return Br.roundRect(X,O)},createStarModel:function(b,N){return Br.star(b,N)},createRectModel:function(K,e){return Br.rect(K,e)},createTriangleModel:function(k,Z){return Br.triangle(k,Z)},createRightTriangleModel:function(Y,E){return Br.rightTriangle(Y,E)},createParallelogramModel:function(M,e){return Br.parallelogram(M,e)},createTrapezoidModel:function(e,k){return Br.trapezoid(e,k)},createSmoothSphereModel:function(F,r,R,N,n,T,C){return ye(new ml(F,r,R,N,n,T,C))},createSphereModel:function(p,W,E,u,g,P){return p?Mm(p,W,E,u,g,P):k.createSmoothSphereModel()},createSmoothConeModel:function(K,f,u,Z,W){return on(K,f,u,Z,W)},createConeModel:function(W,C,H,i,N,p){return W?xe(W,C,H,i,N,p):on(p)},createSmoothCylinderModel:function(C,x,f,q,m,P,n,B){return ye(new Ol(C,x,f,q,m,P,n,B))},createCylinderModel:function(I,A,M,n,W,K,q){return I?og(I,A,M,n,W,K,q):lj(K,q)},createSmoothTorusModel:function(S,u,h,x,b,o){return ye(new hb(S,u,h,x,b,o))},createTorusModel:function(m,i,W,q,t,X,Y){return m?cp(m,i,W,q,t,X,Y):We(X,Y)},createExtrusionModel:function(H,A,s,p,g,O,_,d){return Am(H,A,s,p,g,O,_,d)},createSmoothRingModel:function(L,z,b,v,u,K){for(var A=[],X=0;X<L.length-1;X+=2)A.push({x:L[X],y:L[X+1]});for(L=om(A,z,b)[0],A=[],X=0;X<L.length;X++){var Q=L[X];A.push(new xh(Q.x,0,Q.y))}return ye(new Il(A,K,v,u))},createTextGeometry:function(h,C){return ye(new Gg(h,C))},loadFontFace:function(J,E){k.xhrLoad(J,function(p){if(!p)return E();var R;try{R=JSON.parse(p)}catch(x){R=JSON.parse(p.substring(65,p.length-2))}Vo.loadFace(R),E&&E(R.familyName.toLowerCase())},E?null:{sync:!0})},createRingModel:function(m,l,L,s,B,j,H,r,K,E){for(var z=[],f=0;f<m.length-1;f+=2)z.push({x:m[f],y:m[f+1]});j=j||k.shapeSide,H=H||0,r=r||j;var V,q,Z,x,u,i,h,n,C,y,f,N,O,R,d,Q,P,I,G=[],M=[],g=K?[]:Y,$=K?[]:Y,F=E?[]:Y,p=E?[]:Y,D=s?[]:Y,A=s?[]:Y,e=B?[]:Y,b=B?[]:Y,m=om(z,l,L),t=Um(m),a=0,W=2*Math.PI/j;return m.forEach(function(w){if(Z=w.length,Z>1){if(x=w[0],s)for(i=x.x,n=x.y,f=H;r>f;f++)N=f+1,O=f*W,R=N*W,d=T(O),Q=c(O),P=T(R),I=c(R),D.push(d*i,n,-Q*i,P*i,n,-I*i,0,n,0),A.push(.5-.5*d,.5-.5*Q,.5-.5*P,.5-.5*I,.5,.5);for(y=0;Z>y;y++){for(u=w[y],i=x.x,h=u.x,n=x.y,C=u.y,V=a/t,a+=Qf(x,u),q=a/t,f=H;r>f;f++)N=f+1,O=f*W,R=N*W,d=T(O),Q=c(O),P=T(R),I=c(R),G.push(d*h,C,-Q*h,P*h,C,-I*h,d*i,n,-Q*i,P*h,C,-I*h,P*i,n,-I*i,d*i,n,-Q*i),M.push(f/j,q,N/j,q,f/j,V,N/j,q,N/j,V,f/j,V),K&&f===H&&(g.push(0,n,0,0,C,0,d*h,C,-Q*h,d*h,C,-Q*h,d*i,n,-Q*i,0,n,0),$.push(0,.5-n,0,.5-C,2*h,.5-C,2*h,.5-C,2*i,.5-n,0,.5-n)),E&&N===r&&(F.push(0,n,0,P*h,C,-I*h,0,C,0,P*h,C,-I*h,0,n,0,P*i,n,-I*i),p.push(1,.5-n,1-2*h,.5-C,1,.5-C,1-2*h,.5-C,1,.5-n,1-2*i,.5-n));x=u}if(B)for(i=x.x,n=x.y,f=H;r>f;f++)N=f+1,O=f*W,R=N*W,d=T(O),Q=c(O),P=T(R),I=c(R),e.push(P*i,n,-I*i,d*i,n,-Q*i,0,n,0),b.push(.5-.5*P,.5+.5*I,.5-.5*d,.5+.5*Q,.5,.5)}}),{vs:G,uv:M,bottom_vs:e,bottom_uv:b,top_vs:D,top_uv:A,from_vs:g,from_uv:$,to_vs:F,to_uv:p}}},!0),yl(j,{"3d.move.mode":P,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"shape.border.gradient.color":P,"edge.gradient.color":P,"edge.source.t3":P,"edge.target.t3":P,"light.type":hp,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":O/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":nq,"wf.short":!1,"wf.mat":P,"wf.geometry":!1,batch:P,"transparent.mask":!1,brightness:P,"select.brightness":.7,"repeat.uv.length":P,alphaTest:.4,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","shape3d.vector.dynamic.maxsize":2048,"label.face":Wh,"label.t3":P,"label.r3":P,"label.texture.scale":2,"label.rotationMode":eg,"label.light":!1,"label.blend":P,"label.reverse.flip":!1,"label.reverse.color":qp,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Wh,"label2.t3":P,"label2.r3":P,"label2.texture.scale":2,"label2.rotationMode":eg,"label2.light":!1,"label2.blend":P,"label2.reverse.flip":!1,"label2.reverse.color":qp,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Wh,"note.t3":P,"note.r3":P,"note.texture.scale":2,"note.rotationMode":eg,"note.light":!1,"note.blend":P,"note.reverse.flip":!1,"note.reverse.color":qp,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Wh,"note2.t3":P,"note2.r3":P,"note2.texture.scale":2,"note2.rotationMode":eg,"note2.light":!1,"note2.blend":P,"note2.reverse.flip":!1,"note2.reverse.color":qp,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:P,"shape3d.color":zh,"shape3d.top.color":P,"shape3d.bottom.color":P,"shape3d.from.color":P,"shape3d.to.color":P,"shape3d.image":P,"shape3d.top.image":P,"shape3d.bottom.image":P,"shape3d.from.image":P,"shape3d.to.image":P,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":P,"shape3d.side.to":P,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":P,"shape3d.opacity":P,"shape3d.reverse.flip":!1,"shape3d.reverse.color":qp,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":P,"shape3d.uv.scale":P,"shape3d.top.uv.offset":P,"shape3d.top.uv.scale":P,"shape3d.bottom.uv.offset":P,"shape3d.bottom.uv.scale":P,"shape3d.from.uv.offset":P,"shape3d.from.uv.scale":P,"shape3d.to.uv.offset":P,"shape3d.to.uv.scale":P,"shape3d.top.cap":P,"shape3d.bottom.cap":P,"shape3d.start.angle":0,"shape3d.sweep.angle":r,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":P,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"all.light":!0,"all.visible":!0,"all.color":zh,"all.image":P,"all.blend":P,"all.opacity":P,"all.reverse.flip":!1,"all.reverse.color":qp,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":P,"all.uv.offset":P,"all.uv.scale":P,"all.discard.selectable":!0,mat:P,"left.mat":P,"right.mat":P,"top.mat":P,"bottom.mat":P,"front.mat":P,"back.mat":P},!0);var cn,nd=!1,am=[0,0,0,0],ds={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:wp,2:lh,3:Gc,4:Xh,5:Wh,6:Bc}},So=function(j,d,C,p){if(d.getFaceVisible(j,C)){Do(d,Hg(j,d.getFaceMat(j,C)||d.getMat(j)));var e=d._26I;d.getFaceReverseCull(j,C)?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),De(e,d._prg.uFixPickReverseColor,ds[C]),Qm(e),ee(e,p,6),Fd(e),Xm(d)}},$o=function(B){return B instanceof rd},jp=function(F){return[F.x,F.e||0,F.y]},Jj=function(V,M,D){for(var M=lg(M),G=M[0],A=M[1],e=M[2];D--;)V.push(G,A,e)},wb=function(p,d,$){for(var d=lg(d),Q=d[0],X=d[1],Y=d[2],x=d[3];$--;)p.push(Q,X,Y,x)},nl=function(A,T,h){if(T)for(var P,W,j,u=T[0],x=T[1],Q=T[2],a=T[4],Z=T[5],G=T[6],v=T[8],o=T[9],X=T[10],O=T[12],f=T[13],J=T[14],e=h.length,t=0,t=0;e>t;t+=3)P=h[t],W=h[t+1],j=h[t+2],A.push(u*P+a*W+v*j+O,x*P+Z*W+o*j+f,Q*P+G*W+X*j+J);else ob(A,h)},qe=function(X,u){var b=u.s("light.intensity"),Z=lg(u.s(Al)),_=Z[0],O=Z[1],L=Z[2];1!==b&&(_*=b,O*=b,L*=b),X.push(_,O,L,u.s("light.disabled")?1:0)},Pl=function(D,i,h){De(i,h.uHeadlightRange,D._headlightRange);var Q=D._headlightIntensity,N=lg(D._headlightColor);1!==Q&&(N=[N[0]*Q,N[1]*Q,N[2]*Q]),De(i,h.uHeadlightColor,[N[0],N[1],N[2],D._headlightDisabled?1:0]);var V=D._59O,X=D._spots,k=D._dirs;if(V.length){var H=[],$=[],B=[];V.forEach(function(h){qe(H,h),ob($,D._transformPointToViewSpace(h.p3())),B.push(h.s("light.range"))}),i.uniform4fv(h.uPointColor,H),i.uniform1fv(h.uPointRange,B),i.uniform3fv(h.uPointPosition,$)}if(X.length){var n=[],E=[],w=[],p=[],j=[],g=[];X.forEach(function(x){qe(n,x),ob(E,D._transformPointToViewSpace(x.p3())),ob(j,D._transformDirectionToViewSpace(x.p3(),x.s("light.center"))),w.push(x.s("light.range")),p.push(T(x.s("light.angle")/2)),g.push(x.s("light.exponent"))}),i.uniform4fv(h.uSpotColor,n),i.uniform1fv(h.uSpotRange,w),i.uniform1fv(h.uSpotAngle,p),i.uniform1fv(h.uSpotExponent,g),i.uniform3fv(h.uSpotPosition,E),i.uniform3fv(h.uSpotDirection,j)}if(k.length){var t=[],o=[];k.forEach(function(K){qe(t,K),ob(o,D._transformDirectionToViewSpace(K.p3()))}),i.uniform4fv(h.uDirColor,t),i.uniform3fv(h.uDirDirection,o)}},tb=function(c){return c>0&&0===(c-1&c)},md=function(j){return j=B(0,D(O,j)),j=B(Ui,D(O-Ui,j))},Sk=function(){return.05+u()/2},hk=function(y,T,G,v){var i,z=y.getEye();return y.isOrtho()?(i=Lh(y.getCenter(),z),i[0]+=v[0],i[1]+=v[1],i[2]+=v[2]):i=z,Ci(T,G,v,i)},Ci=function(c,i,b,n){var T=sp(c,i),k=Lh(n,b,!0),w=sp(k,i);if(L(w)<Ui)return Y;var d=(T-sp(b,i))/w;return[b[0]+k[0]*d,b[1]+k[1]*d,b[2]+k[2]*d]},zp=function(e,L){return{x:2*e.x-L.x,y:2*e.y-L.y}},ps=function(w,y,t,Y){var _,A;if(!w)return _=d(y.y-t.y,t.x-y.x),{x:y.x+Y*c(_),y:y.y+Y*T(_)};if(!t)return _=d(w.y-y.y,y.x-w.x),{x:y.x+Y*c(_),y:y.y+Y*T(_)};var R=Lh([w.x,w.y,0],[y.x,y.y,0],!0),V=Lh([t.x,t.y,0],[y.x,y.y,0],!0),$=-(R[0]+V[0])/2,H=-(R[1]+V[1])/2,f=i($*$+H*H);if(Ui>f)return _=d(w.y-y.y,y.x-w.x),{x:y.x+Y*c(_),y:y.y+Y*T(_)};var Q=w.x-y.x,S=w.y-y.y,C=t.x-y.x,p=t.y-y.y,s=i(Q*Q+S*S),G=i(C*C+p*p);_=q(sp(R,V))/2,A=R[1]*V[0]-R[0]*V[1]>0?-1:1,$/=f,H/=f;var r=Y/c(_),n=B(s,G)/T(_);f=Math.min(r,n);var x={x:y.x+A*f*$,y:y.y+A*f*H};return t.b&&r>G/T(_)&&(x.adjust=!0),x},Fi=function(D){var L=D[1],s=D[2],U=D[3],$=D[6],u=D[7],E=D[11];D[1]=D[4],D[2]=D[8],D[3]=D[12],D[4]=L,D[6]=D[9],D[7]=D[13],D[8]=s,D[9]=$,D[11]=D[14],D[12]=U,D[13]=u,D[14]=E},Qi=function(u){var V=u[0],A=u[1],F=u[2],p=u[3],W=u[4],r=u[5],N=u[6],c=u[7],Z=u[8],m=u[9],f=u[10],i=u[11],C=u[12],I=u[13],e=u[14],J=u[15],n=V*r-A*W,d=V*N-F*W,b=V*c-p*W,G=A*N-F*r,O=A*c-p*r,h=F*c-p*N,$=Z*I-m*C,g=Z*e-f*C,q=Z*J-i*C,H=m*e-f*I,_=m*J-i*I,M=f*J-i*e,E=n*M-d*_+b*H+G*q-O*g+h*$;return E?(E=1/E,u[0]=(r*M-N*_+c*H)*E,u[1]=(F*_-A*M-p*H)*E,u[2]=(I*h-e*O+J*G)*E,u[3]=(f*O-m*h-i*G)*E,u[4]=(N*q-W*M-c*g)*E,u[5]=(V*M-F*q+p*g)*E,u[6]=(e*b-C*h-J*d)*E,u[7]=(Z*h-f*b+i*d)*E,u[8]=(W*_-r*q+c*$)*E,u[9]=(A*q-V*_-p*$)*E,u[10]=(C*O-I*b+J*n)*E,u[11]=(m*b-Z*O-i*n)*E,u[12]=(r*g-W*H-N*$)*E,u[13]=(V*H-A*g+F*$)*E,u[14]=(I*d-C*G-e*n)*E,u[15]=(Z*G-m*d+f*n)*E,void 0):Y},vf=function(s,T){if(T){var v=T[0],I=T[1],u=T[2];s[12]=s[0]*v+s[4]*I+s[8]*u+s[12],s[13]=s[1]*v+s[5]*I+s[9]*u+s[13],s[14]=s[2]*v+s[6]*I+s[10]*u+s[14],s[15]=s[3]*v+s[7]*I+s[11]*u+s[15]}},bc=function(f,Y){if(Y){var u=Y[0],r=Y[1],H=Y[2];f[0]=f[0]*u,f[1]=f[1]*u,f[2]=f[2]*u,f[3]=f[3]*u,f[4]=f[4]*r,f[5]=f[5]*r,f[6]=f[6]*r,f[7]=f[7]*r,f[8]=f[8]*H,f[9]=f[9]*H,f[10]=f[10]*H,f[11]=f[11]*H}},Xi=function(s,e,I){var o=e[0],P=e[1],V=e[2],r=e[3],m=e[4],y=e[5],b=e[6],K=e[7],D=e[8],W=e[9],R=e[10],H=e[11],B=e[12],l=e[13],n=e[14],c=e[15],T=I[0],U=I[1],z=I[2],M=I[3];return s[0]=T*o+U*m+z*D+M*B,s[1]=T*P+U*y+z*W+M*l,s[2]=T*V+U*b+z*R+M*n,s[3]=T*r+U*K+z*H+M*c,T=I[4],U=I[5],z=I[6],M=I[7],s[4]=T*o+U*m+z*D+M*B,s[5]=T*P+U*y+z*W+M*l,s[6]=T*V+U*b+z*R+M*n,s[7]=T*r+U*K+z*H+M*c,T=I[8],U=I[9],z=I[10],M=I[11],s[8]=T*o+U*m+z*D+M*B,s[9]=T*P+U*y+z*W+M*l,s[10]=T*V+U*b+z*R+M*n,s[11]=T*r+U*K+z*H+M*c,T=I[12],U=I[13],z=I[14],M=I[15],s[12]=T*o+U*m+z*D+M*B,s[13]=T*P+U*y+z*W+M*l,s[14]=T*V+U*b+z*R+M*n,s[15]=T*r+U*K+z*H+M*c,s},mc=function(Q,h,G,$){var Z,R,g,d,x,o,r,j,c,v,u=h[0],X=h[1],e=h[2],A=$[0],l=$[1],W=$[2],b=G[0],I=G[1],w=G[2];return L(u-b)<Ui&&L(X-I)<Ui&&L(e-w)<Ui?pc(Q):(r=u-b,j=X-I,c=e-w,v=1/i(r*r+j*j+c*c),r*=v,j*=v,c*=v,Z=l*c-W*j,R=W*r-A*c,g=A*j-l*r,v=i(Z*Z+R*R+g*g),v?(v=1/v,Z*=v,R*=v,g*=v):(Z=0,R=0,g=0),d=j*g-c*R,x=c*Z-r*g,o=r*R-j*Z,v=i(d*d+x*x+o*o),v?(v=1/v,d*=v,x*=v,o*=v):(d=0,x=0,o=0),Q[0]=Z,Q[1]=d,Q[2]=r,Q[3]=0,Q[4]=R,Q[5]=x,Q[6]=j,Q[7]=0,Q[8]=g,Q[9]=o,Q[10]=c,Q[11]=0,Q[12]=-(Z*u+R*X+g*e),Q[13]=-(d*u+x*X+o*e),Q[14]=-(r*u+j*X+c*e),Q[15]=1,Q)},ub=function(i,c,D,M,l){var J=1/G(c/2),q=1/(M-l);return i[0]=J/D,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=J,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(l+M)*q,i[11]=-1,i[12]=0,i[13]=0,i[14]=2*l*M*q,i[15]=0,i},jk=function(R,X,u,A,I,p,q){var j=1/(X-u),W=1/(A-I),L=1/(p-q);return R[0]=-2*j,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=-2*W,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=2*L,R[11]=0,R[12]=(X+u)*j,R[13]=(I+A)*W,R[14]=(q+p)*L,R[15]=1,R},kb=function(E,C){var T=C[0],y=C[1],g=C[2],c=C[3],o=T*T+y*y+g*g+c*c,u=o?1/o:0;return E[0]=-T*u,E[1]=-y*u,E[2]=-g*u,E[3]=c*u,E},_n=function(X,V){var A=V[0]+V[5]+V[10],R=0;return A>0?(R=2*Math.sqrt(A+1),X[3]=.25*R,X[0]=(V[6]-V[9])/R,X[1]=(V[8]-V[2])/R,X[2]=(V[1]-V[4])/R):V[0]>V[5]&V[0]>V[10]?(R=2*Math.sqrt(1+V[0]-V[5]-V[10]),X[3]=(V[6]-V[9])/R,X[0]=.25*R,X[1]=(V[1]+V[4])/R,X[2]=(V[8]+V[2])/R):V[5]>V[10]?(R=2*Math.sqrt(1+V[5]-V[0]-V[10]),X[3]=(V[8]-V[2])/R,X[0]=(V[1]+V[4])/R,X[1]=.25*R,X[2]=(V[6]+V[9])/R):(R=2*Math.sqrt(1+V[10]-V[0]-V[5]),X[3]=(V[1]-V[4])/R,X[0]=(V[8]+V[2])/R,X[1]=(V[6]+V[9])/R,X[2]=.25*R),X},Pc=function(l,h,Z){var c=h[0],g=h[1],$=h[2],d=h[3],b=c+c,H=g+g,t=$+$,T=c*b,B=c*H,M=c*t,s=g*H,O=g*t,y=$*t,Q=d*b,W=d*H,n=d*t;return l[0]=1-(s+y),l[1]=B+n,l[2]=M-W,l[3]=0,l[4]=B-n,l[5]=1-(T+y),l[6]=O+Q,l[7]=0,l[8]=M+W,l[9]=O-Q,l[10]=1-(T+s),l[11]=0,l[12]=Z[0],l[13]=Z[1],l[14]=Z[2],l[15]=1,l},vd=function(){var F=[0,0,0],S=[0,0,0],I=[0,0,0],r=function(c,V,z){c[0]=V[1]*z[2]-V[2]*z[1],c[1]=V[2]*z[0]-V[0]*z[2],c[2]=V[0]*z[1]-V[1]*z[0]},N=function(Z){return Z[0]*Z[0]+Z[1]*Z[1]+Z[2]*Z[2]},f=function(d){var R=Math.sqrt(N(d));d[0]/=R,d[1]/=R,d[2]/=R},W=function(v,H,d){v[0]=H[0]-d[0],v[1]=H[1]-d[1],v[2]=H[2]-d[2]};return function(U,v,e){var d=ck();return W(I,U,v),0===N(I)&&(I[2]=1),f(I),r(F,e,I),0===N(F)&&(1===Math.abs(e[2])?I[0]+=1e-4:I[2]+=1e-4,f(I),r(F,e,I)),f(F),r(S,I,F),d[0]=F[0],d[4]=S[0],d[8]=I[0],d[1]=F[1],d[5]=S[1],d[9]=I[1],d[2]=F[2],d[6]=S[2],d[10]=I[2],d}}(),yp=function(A,R){if(A.vr.enable){var H=A.vr.getViewMatrix(R);if(H)return H}return mc(R?R:ck(),A._eye,A._center,A._up)},Lr=function(p){if(p.vr.enable){var Y=p.vr.getProjectMatrix();if(Y)return Y}var Q=p.getAspect(),W=p._near,e=p._far,t=ck();if(p._ortho){var c=p._orthoWidth/2,y=c/Q;jk(t,-c,c,-y,y,W,e)}else ub(t,p._fovy,Q,W,e);return t},Dk=function(f,O){if(!f)return Y;var F=0,c=1,g=2,Z=[],X=0,u=f.length,T=u/3;if(O){for(;u>X;X++)Z[X]=0;for(X=0;X<O.length;X+=3){var W=[],l=[],d=[];W[F]=f[3*O[X+1]+F]-f[3*O[X]+F],W[c]=f[3*O[X+1]+c]-f[3*O[X]+c],W[g]=f[3*O[X+1]+g]-f[3*O[X]+g],l[F]=f[3*O[X+2]+F]-f[3*O[X+1]+F],l[c]=f[3*O[X+2]+c]-f[3*O[X+1]+c],l[g]=f[3*O[X+2]+g]-f[3*O[X+1]+g],d[F]=W[c]*l[g]-W[g]*l[c],d[c]=W[g]*l[F]-W[F]*l[g],d[g]=W[F]*l[c]-W[c]*l[F];for(var w=0;3>w;w++)Z[3*O[X+w]+F]+=d[F],Z[3*O[X+w]+c]+=d[c],Z[3*O[X+w]+g]+=d[g]}}else for(X=0;T>X;X+=3){var W=[],l=[],d=[];W[F]=f[3*(X+1)+F]-f[3*X+F],W[c]=f[3*(X+1)+c]-f[3*X+c],W[g]=f[3*(X+1)+g]-f[3*X+g],l[F]=f[3*(X+2)+F]-f[3*(X+1)+F],l[c]=f[3*(X+2)+c]-f[3*(X+1)+c],l[g]=f[3*(X+2)+g]-f[3*(X+1)+g],d[F]=W[c]*l[g]-W[g]*l[c],d[c]=W[g]*l[F]-W[F]*l[g],d[g]=W[F]*l[c]-W[c]*l[F];for(var w=0;3>w;w++)Z[3*(X+w)+F]=d[F],Z[3*(X+w)+c]=d[c],Z[3*(X+w)+g]=d[g]}for(X=0;u>X;X+=3){var V=[];V[F]=Z[X+F],V[c]=Z[X+c],V[g]=Z[X+g];var H=i(V[F]*V[F]+V[c]*V[c]+V[g]*V[g]);0===H&&(H=Ui),V[F]=V[F]/H,V[c]=V[c]/H,V[g]=V[g]/H,Z[X+F]=V[F],Z[X+c]=V[c],Z[X+g]=V[g]}return new Ve(Z)},Zb=function(j,J,n,d){if(n||(n=j.createTexture()),J){var D=j.TEXTURE_2D,Z=j.REPEAT,B=j.CLAMP_TO_EDGE,g=j.TEXTURE_MIN_FILTER;d!==j.NEAREST&&(d=j.LINEAR),Hr(j,n),j.texImage2D(D,0,j.RGBA,j.RGBA,j.UNSIGNED_BYTE,J),vk(j,j.TEXTURE_MAG_FILTER,d);var l=J.naturalWidth||J.width,M=J.naturalHeight||J.height;tb(l)&&tb(M)&&!J.clampToEdge?(vk(j,j.TEXTURE_WRAP_S,Z),vk(j,j.TEXTURE_WRAP_T,Z),vk(j,g,j.LINEAR_MIPMAP_LINEAR),j.generateMipmap(D)):(vk(j,j.TEXTURE_WRAP_S,B),vk(j,j.TEXTURE_WRAP_T,B),vk(j,g,d)),Hr(j,Y)}return n},Xe=function(e,h){var N=new Uint8Array(3);return h=h||e.createTexture(),Hr(e,h),vk(e,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGB,1,1,0,e.RGB,e.UNSIGNED_BYTE,N),h},Vh=function(F){F._26I&&F._prg&&(F._26I.deleteProgram(F._prg),F._prg=Y)},wg=function(w,o,A,d){var W=w.createShader(A);return w.shaderSource(W,d),w.compileShader(W),w.attachShader(o,W),W},ji=function(I){return I.createBuffer()},Hr=function(T,I){T.bindTexture(T.TEXTURE_2D,I)},Ti=function(c,u){c.frameStack?c.frameStack.push(u):c.frameStack=[u],c.bindFramebuffer(c.FRAMEBUFFER,u)},Zf=function(A){var i=A.frameStack;if(i){if(i.pop(),i.length)return A.bindFramebuffer(A.FRAMEBUFFER,i[i.length-1]),void 0;A.frameStack=null}A.bindFramebuffer(A.FRAMEBUFFER,null)},vk=function(w,S,M){w.texParameteri(w.TEXTURE_2D,S,M)},oe=function(w,m){w.enable(w.POLYGON_OFFSET_FILL),w.polygonOffset(m[0],m[1])},Rg=function(e){e.disable(e.POLYGON_OFFSET_FILL)},Wp=function(F,H){if(H){var H=lg(H);F.clearColor(H[0],H[1],H[2],H[3])}},gs=function(p,s){De(p,s.uFix,!0),fl(p,s.aNormal)},op=function(N,S){De(N,S.uFix,!1),Yg(N,S.aNormal)},js=function(w,b,P,W,s,T,N,f){w._picking||(P?(De(w,b.uBlend,!0),De(w,b.uBlendColor,P)):De(w,b.uBlend,!1),De(w,b.uLight,W==Y?!0:W),mn(s)&&1!==s&&De(w,b.uPartOpacity,s),De(w,b.uReverseFlip,T==Y?!1:T),De(w,b.uFixPickReverseColor,N||qp)),f?w.enable(w.CULL_FACE):w.disable(w.CULL_FACE)},ve=function(q,v){q._picking||De(q,v.uPartOpacity,1)},Qm=function(D,f,i,o,v,s,F,u,e){if(!i)return D.activeTexture(D.TEXTURE0),Hr(D,D._emptyTexture),D.activeTexture(D.TEXTURE1),Hr(D,D._emptyBlendTexture),void 0;De(D,f.uTexture,!0),De(D,f.uDiscardSelectable,sr(o)?o:!0),Yg(D,f.aUv),th(D,v,s,f.aUv,2),e?(De(D,f.uBlendTexture,!0),D.activeTexture(D.TEXTURE1),Hr(D,e),D.uniform1i(f.uBlendSampler,1)):(De(D,f.uBlendTexture,!1),D.activeTexture(D.TEXTURE1),Hr(D,D._emptyBlendTexture)),D.activeTexture(D.TEXTURE0),Hr(D,i),D.uniform1i(f.uSampler,0);var W=[0,0,1,1];F&&(W[0]=F[0],W[1]=F[1]),u&&(W[2]=u[0],W[3]=u[1]),De(D,f.uOffsetScale,W)},Fd=function(r,H,N){r.activeTexture(r.TEXTURE0),Hr(r,Y),r.activeTexture(r.TEXTURE1),Hr(r,Y),N&&(fl(r,H.aUv),De(r,H.uTexture,!1),De(r,H.uBlendTexture,!1))},Fm=function(N,c,h,d,X,s){!h||Q||dd||N.lineWidth(h),d&&!N._picking&&De(N,c.uFixPickReverseColor,d),X&&th(N,X,s,c.aPosition)},Cl=function(M,l,t,R){cn&&(R=M[cn]),M.drawArrays(R==Y?M.TRIANGLES:R,l,t);var f=M._renderInfo;f&&(f.calls++,f.vertices+=t,(R==Y||R===M.TRIANGLES)&&(f.faces+=t/3),R===M.LINES&&(f.lines+=t/2))},ee=function(e,G,z,n){cn&&(n=e[cn]),e.drawElements(n==Y?e.TRIANGLES:n,z,e.UNSIGNED_SHORT,G==Y?0:2*G);var R=e._renderInfo;R&&(R.calls++,R.vertices+=z,(n==Y||n===e.TRIANGLES)&&(R.faces+=z/3),n===e.LINES&&(R.lines+=z/2))},Uk=function(N,O,Q,s,x){var $=N.ARRAY_BUFFER;N.bindBuffer($,O),Q&&N.bufferData($,Q,N.STATIC_DRAW),s!=Y&&N.vertexAttribPointer(s,x?x:3,N.FLOAT,!1,0,0)},th=function(l,$,g,t,f){return g?(Rm(l,l.ARRAY_BUFFER,$,g),t!=Y&&l.vertexAttribPointer(t,f?f:3,l.FLOAT,!1,0,0),void 0):Uk(l,$,g,t,f)},sq=function(y,U,p){var m=y.ELEMENT_ARRAY_BUFFER;y.bindBuffer(m,U),p&&y.bufferData(m,p,y.STATIC_DRAW)},bq=function(S,v,b){Rm(S,S.ELEMENT_ARRAY_BUFFER,v,b)},Rm=function(F,Q,t,j){var u=j._bufId;u||(u=j._bufId=C.Math.generateIncreasingID());var t,J=F._bufPool;(t=J[u])&&t._buf?F.bindBuffer(Q,t._buf):(t=J[u]={_buf:ji(F)},F.bindBuffer(Q,t._buf),F.bufferData(Q,j,F.STATIC_DRAW)),t._fid=F._renderInfo.frame},De=function(V,T,m){if(m!=Y&&T!=Y){m=lg(m);var L=m.length;3===L?V.uniform3fv(T,m):4===L?V.uniform4fv(T,m):16===L?V.uniformMatrix4fv(T,!1,m):sr(m)?V.uniform1i(T,m?1:0):2===L?V.uniform2fv(T,m):V.uniform1f(T,m)}},Yg=function(g,T){T!=Y&&T>=0&&g.enableVertexAttribArray(T)},fl=function(A,m){m!=Y&&m>=0&&A.disableVertexAttribArray(m)},Xm=function(y,Q){var f=y.getGL(),p=y._prg;y._7O=y._8O.pop(),Q&&(De(f,p.uMVMatrix,y._7O),y._6O=Q,De(f,p.uNMatrix,Q))},Lb=function(t,F){return F||(F=ck()),Se(F,t),Qi(F),Fi(F),F},Do=function(K,_){var O=K.getGL(),L=K._prg,I=K._7O;_&&(K._8O.push(mh(I)),De(O,L.uMMatrix,_),Xi(I,I,_),K._7O=I),De(O,L.uMVMatrix,I),De(O,L.uNMatrix,Lb(I,K._6O))},gh=function(t,_,d,f,g,B){if(d){if(f){var a=d.value++,V=2147483648|a,R=[(255&V>>16)/255,(255&V>>8)/255,(255&V)/255,(255&V>>24)/255];d[a]={data:g,part:B}}else R=am;return De(t,_.uFixPickReverseColor,R),R}},_p=function(){var o={center:function(Q,y,s,i,o){var X=-y[1]/2,f={x:-y[0]/2,y:X,width:y[0],height:y[1]},E=ai(Q,f,s);return[E.x+i,-E.y-o,Sk()]},front:function(e,H,D,E,n){var f=-H[1]/2,G={x:-H[0]/2,y:f,width:H[0],height:H[1]},w=ai(e,G,D);return[w.x+E,-w.y-n,H[2]/2+Sk()]},back:function(R,Z,y,v,r){var C=-Z[0]/2,W=-Z[1]/2,G={x:C,y:W,width:Z[0],height:Z[1]},E=ai(R,G,y);return[-E.x-v,-E.y-r,-Z[2]/2-Sk()]},left:function(f,Y,d,m,P){var O=-Y[1]/2,a={x:-Y[2]/2,y:O,width:Y[2],height:Y[1]},M=ai(f,a,d);return[-Y[0]/2-Sk(),-M.y-P,M.x+m]},right:function(k,s,H,T,J){var p=-s[2]/2,c=-s[1]/2,q={x:p,y:c,width:s[2],height:s[1]},b=ai(k,q,H);return[s[0]/2+Sk(),-b.y-J,-b.x-T]},top:function(z,s,T,E,U){var O={x:-s[0]/2,y:-s[2]/2,width:s[0],height:s[2]},q=ai(z,O,T);return[q.x+E,s[1]/2+Sk(),q.y+U]},bottom:function(v,S,T,j,Y){var D=-S[2]/2,W={x:-S[0]/2,y:D,width:S[0],height:S[2]},A=ai(v,W,T);return[A.x+j,-S[1]/2-Sk(),-A.y-Y]}};return function(v,E,u,F,O,h){return o[F](v,E,u,O||0,h||0)}}(),er=function(X,I,C,g,t,$,q,H,Q,K){if(t&&(I[0]+=t[0],I[1]+=t[1],I[2]+=t[2]),vf(X,C),H){var l=ck();if(ud(l,Q,K),uh(I,l),vf(X,I),X.auto=H,X.pos=uh([0,0,0],X),$){var S=X.mat2=ck();ud(S,$,q)}}else ud(X,Q,K),vf(X,I),g===wp?Sq(X,-F):g===lh?Sq(X,F):g===Gc?Ir(X,-F):g===Xh?Ir(X,F):g===Bc&&Sq(X,O),ud(X,$,q);return X},jo=function(T,w){var u=w.auto,L=w.mat2,s=T.gv;if(u){var Z,i=ck(),P=[0,0,0,0];Z="string"==typeof u?[u.indexOf("x")<0?s._eye[0]:s._center[0],u.indexOf("y")<0?s._eye[1]:s._center[1],u.indexOf("z")<0?s._eye[2]:s._center[2]]:s._eye,_n(P,mc(ck(),Z,s._center,s._up)),Pc(i,kb(P,P),w.pos),L&&Xi(i,i,L),Do(s,i)}else Do(s,w)},Sr=function(h,D,A,o,d){var r=h.s,C=h.gv,T=C.getGL(),w=C._prg,a=C._buffer,N=C._1O;Zb(T,kc,N),jo(h,A),js(T,w,r(D+".blend"),r(D+".light"),r(D+".opacity"),r(D+".reverse.flip"),r(D+".reverse.color"),r(D+".reverse.cull")),Qm(T,w,N,d,a.uv,lf),th(T,a.vs,o,w.aPosition),th(T,a.ns,li,w.aNormal),bq(T,a.is,Ze),ee(T,0,Ze.length),Fd(T,w,N),ve(T,w),Xm(C)},zm=function(O,B,W){var h=O.gv,A=O.data,T=O[B]={blend:h.getBodyColor(A)||h.getFaceBlend(A,B),light:h.getFaceLight(A,B),color:h.getFaceColor(A,B),opacity:h.getFaceOpacity(A,B),transparent:h.getFaceTransparent(A,B),reverseFlip:h.getFaceReverseFlip(A,B),reverseColor:h.getFaceReverseColor(A,B),reverseCull:h.getFaceReverseCull(A,B),texture:h.getFaceImage(A,B),blendTexture:h.getFaceBlendImage(A,B),discardSelectable:h.getFaceDiscardSelectable(A,B)};if("csg"!==B){T.uv=h.getFaceUv(A,B)||W&&W[B+"Uv"],T.uvScale=h.getFaceUvScale(A,B)||W&&W[B+"UvScale"],T.uvOffset=h.getFaceUvOffset(A,B)||W&&W[B+"UvOffset"];var D=h.getFaceMat(A,B);D&&(T.mat=Hg(A,D))}return T},Kd=function(_,d,x,S,u){if(S){if(!u(S.transparent))return;var L=_.data,X=_.gv,Z=X._buffer,y=X.getTexture(S.texture,L),T=X.getTexture(S.blendTexture,L);Qm(d,x,y,S.discardSelectable,Z.uv,S.tuv,S.uvOffset,S.uvScale,T),js(d,x,S.blend,S.light,S.opacity,S.reverseFlip,S.reverseColor,S.reverseCull),De(d,x.uDiffuse,S.color),th(d,Z.vs,S.vs,x.aPosition),th(d,Z.ns,S.ns,x.aNormal),Cl(d,0,S.vs.length/3),ve(d,x),Fd(d,x,y)}},fo=function(q,Q,M,J,j,_){var x,Y,r,v,K,A,k,e,t,f,h,c=[J-Q,j-M],G=q?q.length:0;for(r=0;G>r;r++){for(v=2,x=q[r],K=x[0],A=x[1];v+1<x.length;){if(k=x[v],e=x[v+1],Y=Fe(Q,M,J,j,K,A,k,e,!0)){t=[k-K,e-A],f=Qf(t),t[0]/=f,t[1]/=f,f=sp(c,t),f=f>0?_:-_,h=[t[0]*f,t[1]*f];break}K=k,A=e,v+=2}if(h)break}if(h)for(J=Q+h[0],j=M+h[1],r=0;G>r;r++)for(v=2,x=q[r],K=x[0],A=x[1];v+1<x.length;){if(k=x[v],e=x[v+1],Y=Fe(Q,M,J,j,K,A,k,e,!0))return[0,0];K=k,A=e,v+=2}return h?h:[J-Q,j-M]},bp=C.graph3d={},Sd=function(d,J,_){jq(I+".graph3d."+d,J,_)},_l="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",yc="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-6/1!,!6/1!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~<spmpd!>!eJ|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw<*yfusfWw.)f{jmbnspo!>!F!4dfw<*mbnspOw)f{jmbnspo!>!O!4dfw!gjeof$!<ftvggjEv!>!spmpd!ftmf$!~<ftvggjEv!>!spmpd|ftmf~<spmpDidubCw!>!spmpd|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!<spmpd!5dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";
yl(k,{setBatchInfo:function(D,s){Mc[D]=s},getBatchInfo:function(w){return Mc[w]}},!0);var Hi=[1,1,1],zj=[1,0,0,0,0,1,0,1,1,1,1,0],ek=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],Fc=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],fb=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],Km=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],Uf=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],pb=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],Fb=function(Z,W){nr(Z,W,"_batchModelMap","_batchIndexMap"),ll(Z,W,"_wireframeModelMap","_wireframeIndexMap"),ll(Z,W,"_polylineModelMap","_polylineIndexMap"),ll(Z,W,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),ll(Z,W,"_polylineModelMapSwap","_polylineIndexMapSwap")},nr=function(p,v,D,o){if(!v)return p[D]={},p[o]={},void 0;var c=v._id,A=p[o],V=A[c];if(V){var R=p[D],u=V.batch,h=R[u],f=h.ds,l=V.index;if(h.invalidate=!0,delete A[c],f.splice(l,1),ti(f))return delete R[u],void 0;for(var T=V.begin,H=V.size,L=3*T,W=3*H,N=4*T,S=4*H,g=h.vs,J=h.ps,j=h.uv,O=h.cs,q=h.bs,d=h.rs,n=h.ns,I=h.ls;l<f.length;l++)V=A[f[l]._id],V.index--,V.begin-=H;g.splice(L,W),J.splice(N,S),j&&j.splice(2*T,2*H),O&&O.splice(N,S),q&&q.splice(L,W),d&&d.splice(T,H),n&&n.splice(L,W),I&&I.splice(T,H)}},ll=nr,uq=function(A,E,q,x){if(!x)return Y;var _=E[x];if(!_){var C=Mc[x]||cs,H=C.image?[]:Y;_=E[x]={vs:[],ns:[],uv:H,cs:H?Y:C.color?Y:[],bs:C.blend?[]:Y,ps:[],rs:C.brightness?[]:Y,ds:[]}}return _.invalidate=!0,A[q._id]={index:_.ds.length,begin:_.vs.length/3,batch:x},_.ds.push(q),_},Rr=function(n,S){return S!=Y&&1!==S?[n[0]*S,n[1]*S,n[2]*S,n[3]]:n},Sm=function($,K,U){var x=$.getBrightness(K),Z=lg(U.color||"white"),k=Z[3]<1,j=Math.ceil(U.width)||1,z=(k?"T":"O")+j,s=$._wireframeIndexMap,a=$._wireframeModelMap,h=a[z];h||(h=a[z]={vs:[],cs:[],ps:[],ds:[],T:k,W:j});var Q,Y=$.getData3dUI(K),W=Fl(Y);if(U.geometry){if(!W)return;if(Q=us(W),!Q)return}else Q=U.short?bs:yn;h.invalidate=!0;var d=h.vs,l=h.cs,S=h.ds,v=s[K._id]={index:S.length,begin:d.length/3,batch:z};S.push(K);var n=Hg(K,U.mat),b=Y._calcAnchorMat(K);b&&Xi(n,n,b),nl(d,n,Q);var o=v.size=d.length/3-v.begin;wb(l,Rr(Z,x),o)},tc=function(Z,n,$,L,w,K,G,M,l){var O=Z.getBrightness(n);O==Y&&(O=1);var W=Rr(lg(L),O),p=W[3]<1;K=Math.ceil(K)||1;var o=(p?"T":"O")+K;if(G){var F=G[0],q=(G[1]||F)+F;o+="-"+F+"-"+q,l&&(o+="-"+fj(l)+"-"+O,l=Rr(lg(l),O))}var E=Z._polylineIndexMap,R=Z._polylineModelMap,f=R[o];f||(f=R[o]={vs:[],cs:[],ps:[],ds:[],ls:G?[]:Y,T:p,W:K},G&&(f.D=F,f.G=q,f.A=l)),f.invalidate=!0;var N,m=f.vs,A=f.cs,y=f.ds,D=f.ls,X=E[n._id]={index:y.length,begin:m.length/3,batch:o};y.push(n),ob(m,$);var P,i=X.size=m.length/3-X.begin,C=$.length,I=0,H=[];if(G||w)for(N=0;C>N;N+=6)P=Qf([$[N],$[N+1],$[N+2]],[$[N+3],$[N+4],$[N+5]]),H.push(P),I+=P;if(I&&w){var h,Q=Rr(lg(w),O),r=[Q[0]-W[0],Q[1]-W[1],Q[2]-W[2],Q[3]-W[3]],B=0;for(N=0;C>N;N+=6)h=B/I,wb(A,[W[0]+r[0]*h,W[1]+r[1]*h,W[2]+r[2]*h,W[3]+r[3]*h],1),B+=H[N/6],h=B/I,wb(A,[W[0]+r[0]*h,W[1]+r[1]*h,W[2]+r[2]*h,W[3]+r[3]*h],1)}else wb(A,W,i);if(G)for(B=M||0,N=0;C>N;N+=6)D.push(B),B+=H[N/6],D.push(B)},Kh=function(h,d,u){if(d)for(var A=4*d.begin,U=u[d.batch].ps,n=0;n<d.size;n++)U[A++]=h[0],U[A++]=h[1],U[A++]=h[2],U[A++]=h[3]},_o=function($,S){var B=S+["32"],I=$[S],H=$[B];I?H&&H.length===I.length?(H.set(I),H._bufId=null):$[B]=new Ve(I):delete $[B]},Tn=function(c,t,N,s,w,T,u,v,$){if(fk(N))N.forEach(function(j){Tn(c,t,j,s,w,T,u,v,$)});else if(Xd(N))Tn(c,t,Fl(s,N),s,w,T,u,v,$);else if(Vl(N)){var n,y=hg(N.mat,t,c),_=hg(N.s3,t,c),a=hg(N.t3,t,c),d=hg(N.r3,t,c);if((_||d||a||y)&&(n=Nk(y,_,d,hg(N.rotationMode,t,c),a),T.push(n)),N.shape3d)Tn(c,t,N.shape3d,s,w,T,u,v,N);else{var L=s.s;$=$||cs;var G=T[0],r=T.length,f=L("shape3d.color",N.color,$.color);if(w||(w=L("shape3d.blend",N.blend,$.blend)),r>1){G=mh(G);for(var x=1;r>x;x++)Xi(G,G,T[x])}N.vs&&L(Pm,N.visible,$.visible)&&np(G,u,v,N.vs,N.uv,N.is,w,f),N.top_vs&&L(dg,N.topVisible,$.topVisible)&&np(G,u,v,N.top_vs,N.top_uv,N.top_is,w,L("shape3d.top.color",N.topColor,$.topColor)||f),N.bottom_vs&&L(qs,N.bottomVisible,$.bottomVisible)&&np(G,u,v,N.bottom_vs,N.bottom_uv,N.bottom_is,w,L("shape3d.bottom.color",N.bottomColor,$.bottomColor)||f),N.from_vs&&L(rr,N.fromVisible,$.fromVisible)&&np(G,u,v,N.from_vs,N.from_uv,N.from_is,w,L("shape3d.from.color",N.fromColor,$.fromColor)||f),N.to_vs&&L(gm,N.toVisible,$.toVisible)&&np(G,u,v,N.to_vs,N.to_uv,N.to_is,w,L("shape3d.to.color",N.toColor,$.toColor)||f)}n&&T.pop()}},np=function($,s,W,G,O,D,Y,V){var y,T=s.cs,i=s.uv,u=s.bs;if(D){y=D.length;for(var Z=0;y>Z;Z++){var F=D[Z];nl(W,$,[G[3*F],G[3*F+1],G[3*F+2]]),i&&ob(i,[O[2*F],O[2*F+1]])}}else y=G.length/3,nl(W,$,G),i&&ob(i,O);T&&wb(T,V,y),u&&(Y?Jj(u,Y,y):ob(u,Hi,y))},ae=function(T,k,D,t){var q=[];t?Tn(T.gv,T.data,t,T,T.getBodyColor(),[k],D,q):(oj(T,wp,k,D,q),oj(T,lh,k,D,q),oj(T,Wh,k,D,q),oj(T,Bc,k,D,q),oj(T,Gc,k,D,q),oj(T,Xh,k,D,q),oj(T,"csg",k,D,q)),q.length&&(ob(D.vs,q),ob(D.ns,Dk(q)))},oj=function(O,Q,K,P,f){var i=O[Q];if(i){var k=i.tuv;if(k){var B,x,J,o,X=i.uvScale,c=i.uvOffset;if(X)for(B=k.length,x=X[0],J=X[1],o=0;B>o;o+=2)k[o]*=x,k[o+1]*=J;if(c)for(B=k.length,x=c[0],J=c[1],o=0;B>o;o+=2)k[o]+=x,k[o+1]+=J}np(K,P,f,i.vs,k,Y,i.blend,i.color)}},qb=function(O,X,x,R,S,J,i,B){var b,I=x.cs,u=x.uv,y=x.bs;if(O.getFaceVisible(X,J)){var F=O.getFaceMat(X,J);if(F&&(S=Hg(X,F)),nl(i,S,B),I&&wb(I,O.getFaceColor(X,J),6),u){var s=O.getFaceUv(X,J)||R[J+"Uv"],f=O.getFaceUvScale(X,J)||R[J+"UvScale"],T=O.getFaceUvOffset(X,J)||R[J+"UvOffset"];s=s?[s[6],s[7],s[0],s[1],s[2],s[3],s[2],s[3],s[4],s[5],s[6],s[7]]:zj;var P=s[0],l=s[1],c=s[2],N=s[3],W=s[4],M=s[5],o=s[6],D=s[7],t=s[8],d=s[9],j=s[10],E=s[11];if(f){var A=f[0],g=f[1];P*=A,l*=g,c*=A,N*=g,W*=A,M*=g,o*=A,D*=g,t*=A,d*=g,j*=A,E*=g}if(T){var k=T[0],Y=T[1];P+=k,l+=Y,c+=k,N+=Y,W+=k,M+=Y,o+=k,D+=Y,t+=k,d+=Y,j+=k,E+=Y}u.push(P,l,c,N,W,M,o,D,t,d,j,E)}y&&(b=O.getBodyColor(X)||O.getFaceBlend(X,J),b?Jj(y,b,6):ob(y,Hi,6))}},Go=function(K,F,$,J){var V=K.getGL(),r=K._prg,u=K._buffer;if(!K.drawFilter&&!Cr(F)){Do(K),gs(V,r);for(var R in F){var Q=F[R];if(!(J&&!Q.T||!J&&Q.T)){Q.invalidate?(Q.invalidate=!1,_o(Q,"vs"),_o(Q,"cs"),_o(Q,"ls"),_o(Q,"ps")):$&&_o(Q,"ps");var w=Q.vs32,p=$?Q.ps32:Q.cs32;Fm(V,r,Q.W,Y,u.vs,w);var a=Q.D,T=!K._dashDisabled&&a;De(V,r.uAlphaTest,j.alphaTest),T&&(De(V,r.uDash,!0),De(V,r.uDashDistance,a),De(V,r.uDashGapDistance,Q.G),Yg(V,r.aLineDistance),th(V,u.lineDistance,Q.ls32,r.aLineDistance,1),De(V,r.uDiffuse,Q.A||ym));var I=!K._batchColorDisabled;I&&(De(V,r.uBatchColor,!0),Yg(V,r.aBatchColor),th(V,u.batchColor,p,r.aBatchColor,4)),Qm(V),Cl(V,0,w.length/3,V.LINES),Fd(V),I&&(De(V,r.uBatchColor,!1),fl(V,r.aBatchColor)),T&&(De(V,r.uDash,!1),fl(V,r.aLineDistance))}}op(V,r)}},Mb=function(i,C,k){var I,T,q,d,g,R,D,w,e,f,o,X=i.getGL(),l=i._prg,M=i._buffer,z=i._batchModelMap;if(!Cr(z)){Do(i);for(I in z)if(T=Mc[I]||cs,!(k&&!T.transparent||!k&&T.transparent)&&(q=z[I],C||!T.transparentMask)){var _=k&&T.autoSort!==!1&&(i._33Q||q.invalidate);if(q.invalidate?(q.invalidate=!1,_o(q,"vs"),_o(q,"ns"),_o(q,"cs"),_o(q,"rs"),_o(q,"ps"),_o(q,"bs"),_o(q,"uv")):C&&_o(q,"ps"),g=q.vs32,R=C?q.ps32:q.cs32,e=q.uv32,D=q.bs32,w=q.rs32,o=g.length/3,_&&(q.is=_h(g,i.getEye())),o){d=T.light,f=i.getTexture(T.image),js(X,l,Y,T.light,T.opacity,T.reverseFlip,T.reverseColor,T.reverseCull),R?i._batchColorDisabled||(De(X,l.uBatchColor,!0),Yg(X,l.aBatchColor),th(X,M.batchColor,R,l.aBatchColor,4)):De(X,l.uDiffuse,T.color||ym);var x=T.alphaTest;De(X,l.uAlphaTest,x===P?j.alphaTest:x);var S=D&&!i._batchBlendDisabled;S&&(De(X,l.uBatchBlend,!0),Yg(X,l.aBatchBlend),th(X,M.batchBlend,D,l.aBatchBlend));var m=w&&!i._batchBrightnessDisabled;m&&(De(X,l.uBatchBrightness,!0),Yg(X,l.aBatchBrightness),th(X,M.batchBrightness,w,l.aBatchBrightness,1)),e?Qm(X,l,f,T.discardSelectable,M.uv,e,T.uvOffset,T.uvScale):Qm(X),th(X,M.vs,g,l.aPosition),th(X,M.ns,q.ns32,l.aNormal),q.is?(sq(X,M.is,q.is),ee(X,0,o)):Cl(X,0,o),e?Fd(X,l,f):Fd(X),R&&!i._batchColorDisabled&&(De(X,l.uBatchColor,!1),fl(X,l.aBatchColor)),S&&(De(X,l.uBatchBlend,!1),fl(X,l.aBatchBlend)),m&&(De(X,l.uBatchBrightness,!1),fl(X,l.aBatchBrightness)),ve(X,l)}}}},_h=function(U,b){for(var l=U.length/3,I=new Array(l),t=l/3,O=new Array(t),n=0;t>n;n++)O[n]=n;O.sort(function(_,R){var D=9*_,N=[(U[D]+U[D+3]+2*U[D+6])/4,(U[D+1]+U[D+4]+2*U[D+7])/4,(U[D+2]+U[D+5]+2*U[D+8])/4];D=9*R;var o=[(U[D]+U[D+3]+2*U[D+6])/4,(U[D+1]+U[D+4]+2*U[D+7])/4,(U[D+2]+U[D+5]+2*U[D+8])/4],t=Qf(b,N)-Qf(b,o);return t>0?-1:0>t?1:0});for(var n=0;t>n;n++){var L=3*n,K=3*O[n];I[L]=K,I[L+1]=K+1,I[L+2]=K+2}return new Io(I)},Og={obj:function(J,c){var b={mat:J.mat,s3:J.s3,r3:J.r3,rotationMode:J.rotationMode,t3:J.t3,cube:J.cube==Y?!0:J.cube,center:J.center==Y?!0:J.center,ignoreMtls:J.ignoreMtls,ignoreTransparent:J.ignoreTransparent,ignoreColor:J.ignoreColor,ignoreImage:J.ignoreImage,ignoreNormal:J.ignoreNormal,prefix:J.prefix,flipY:J.flipY,flipFace:J.flipFace,reverseFlipMtls:J.reverseFlipMtls,finishFunc:function(r,u){if(r){var u=[];for(var D in r){var U=r[D];u.rawS3=U.rawS3,u.push(U),J.eachModel&&J.eachModel(D,U)}u.json=J,c(u)}else c()}};k.loadObj(J.obj,J.mtl,b)}};k.getModelTypeHandlers=function(){return Og},k.setModelTypeHandler=function(C,I){Og[C]=I},k.getModelTypeHandler=function(n){return Og[n]},k.handleModelLoaded=function(){},k.handleUnfoundModel=function(){};var Wm=Y,ed=Y,vi=function(X){Wm&&!X._loadingModelView_&&(ed||(ed={}),ed[X._loadingModelView_=yi()]=X)},kn=function(g,T){Wm||(Wm={});var z=Wm[g];if(z){if(z.url===T)return;z.request.onload=ci,z.request.onerror=ci}var q=new If;if(Wm[g]={request:q,url:T},T=k.beforeLoadURL(T),T.data){var s=k.parse(T.data);vp(g,s,T)}else{q.onload=function(J){if(200===this.status||0===this.status){var f=k.parse(J.target.response||J.target.responseText);vp(g,f,T)}else xq(g,k.handleUnfoundModel(g,T)||Y)},q.onerror=function(){xq(g,k.handleUnfoundModel(g,T)||Y)};var h={};h.url=encodeURI(T),h.sync=!1,q.send(h)}},vp=function(O,s,P){var u=s.modelType;if(!u)return xq(O,s),k.handleModelLoaded(O,s),void 0;var U=k.getModelTypeHandler(u);if(U){var G=function(o){o?(xq(O,o),k.handleModelLoaded(O,o)):xq(O,k.handleUnfoundModel(O,P)||Y)};U(s,G)}else xq(O,k.handleUnfoundModel(O,P)||Y)},xq=function(I,m){if(Wi[I]=m,delete Wm[I],Cr(Wm)&&(Wm=Y,ed)){for(var v in ed){var n=ed[v];n._2O&&(n._2O={}),n.invalidateAll&&n.invalidateAll(P,"modelLoaded",I),n.redraw&&n.redraw(),n.iv(),delete n._loadingModelView_}ed=Y}if(m&&ed)for(var v in ed){var n=ed[v];n.invalidateAll&&n.invalidateAll(P,"modelLoading",I),n.redraw&&n.redraw(),n.iv()}},lf=new Ve([0,0,0,1,1,1,1,0]),li=new Ve([0,0,1,0,0,1,0,0,1,0,0,1]),Ze=new Io([0,1,2,2,3,0]),Gh=new Ve([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),ug=new Io([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),$m=new Ve([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),Td=Dk(Gh,ug),ui=(new Ve([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new Io([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[wp,Wh,lh,Bc,Gc,Xh]),yn=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],bs=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Mm=function(N,g,Z,J,y,F){F=F||16,N=N||16,g=g||0,Z=Z||N;var b,d,I,s,x,K,t,S,X=.5,e=[],$=[],D=r/N,B=O/F;for(b=0;F>b;b++)for(x=b+1,s=b*B,S=x*B,d=g;Z>d;d++)K=d+1,I=d*D,t=K*D,e.push(X*c(s)*T(I),X*T(s),-X*c(s)*c(I),X*c(S)*T(t),X*T(S),-X*c(S)*c(t),X*c(s)*T(t),X*T(s),-X*c(s)*c(t),X*c(s)*T(I),X*T(s),-X*c(s)*c(I),X*c(S)*T(I),X*T(S),-X*c(S)*c(I),X*c(S)*T(t),X*T(S),-X*c(S)*c(t)),$.push(d/N,b/F,K/N,x/F,K/N,b/F,d/N,b/F,d/N,x/F,K/N,x/F);if(J){var C=[],o=[];for(I=g*D,b=0;F>b;b++)x=b+1,s=b*B,S=x*B,C.push(0,0,0,X*c(S)*T(I),X*T(S),-X*c(S)*c(I),X*c(s)*T(I),X*T(s),-X*c(s)*c(I)),o.push(0,.5,g/N,x/F,g/N,b/F)}if(y){var Q=[],P=[];for(I=Z*D,b=0;F>b;b++)x=b+1,s=b*B,S=x*B,Q.push(0,0,0,X*c(s)*T(I),X*T(s),-X*c(s)*c(I),X*c(S)*T(I),X*T(S),-X*c(S)*c(I)),P.push(1,.5,Z/N,b/F,Z/N,x/F)}return{vs:e,uv:$,from_vs:C,from_uv:o,to_vs:Q,to_uv:P}},We=function(w,q,B){w=w||.17,q=q||12,B=B||18,0>w?w=0:w>.25&&(w=.25);var L,X,s,p,V,R,m,v=.5,u=[],J=[],K=[],$=r/B,f=r/q,h=v-w;for(X=0;q>=X;X++)for(p=-O+X*f,R=T(p),V=c(p),L=0;B>=L;L++)s=L*$,m=h+w*R,u.push(T(s)*m,V*w,-c(s)*m),J.push(L/B,1-X/q);for(X=0;q>X;X++){var g=X*(B+1),b=(X+1)*(B+1);for(L=0;B>L;L++)K.push(g+L,b+L+1,b+L,g+L,g+L+1,b+L+1)}return{vs:u,uv:J,is:K}},cp=function(x,X,b,N,U,h,F){F=F||12,x=x||18,X=X||0,b=b||x,h=h||.17,0>h?h=0:h>.25&&(h=.25);var t,p,S,W,D,E,G,C,g,e,u=.5,Z=[],s=[],w=r/x,o=r/F,v=u-h;for(S=0;F>S;S++)for(W=S+1,G=-O+S*o,C=-O+W*o,t=X;b>t;t++)p=t+1,D=t*w,E=p*w,g=v+h*T(G),e=v+h*T(C),Z.push(T(D)*g,c(G)*h,-c(D)*g,T(E)*g,c(G)*h,-c(E)*g,T(E)*e,c(C)*h,-c(E)*e,T(D)*g,c(G)*h,-c(D)*g,T(E)*e,c(C)*h,-c(E)*e,T(D)*e,c(C)*h,-c(D)*e),s.push(t/x,1-S/F,p/x,1-S/F,p/x,1-W/F,t/x,1-S/F,p/x,1-W/F,t/x,1-W/F);if(N){var z=[],B=[];for(S=0;F>S;S++)W=S+1,G=-O+S*o,C=-O+W*o,D=X*w,g=v+h*T(G),e=v+h*T(C),z.push(T(D)*g,c(G)*h,-c(D)*g,T(D)*e,c(C)*h,-c(D)*e,T(D)*v,0,-c(D)*v),B.push(.5+.5*T(G),.5-.5*c(G),.5+.5*T(C),.5-.5*c(C),.5,.5)}if(U){var H=[],k=[];for(S=0;F>S;S++)W=S+1,G=-O+S*o,C=-O+W*o,D=b*w,g=v+h*T(G),e=v+h*T(C),H.push(T(D)*g,c(G)*h,-c(D)*g,T(D)*v,0,-c(D)*v,T(D)*e,c(C)*h,-c(D)*e),k.push(.5-.5*T(G),.5-.5*c(G),.5,.5,.5-.5*T(C),.5-.5*c(C))}return{vs:Z,uv:s,from_vs:z,from_uv:B,to_vs:H,to_uv:k}},lj=function(o,e){for(var S,b,D,A=.5,_=16,p=[],C=[],K=[],Y=r/_,l=0;_>=l;l++)S=l*Y,b=T(S)*A,D=c(S)*A,p.push(b,-A,D,b,A,D),C.push(1-l/_,1,1-l/_,0);for(l=0;_>l;l++)K.push(2*l,2*l+1,2*l+3,2*l,2*l+3,2*l+2);if(e){var Q=[],W=[],w=[];for(Q.push(0,-A,0),W.push(.5,.5),l=0;_>=l;l++)S=l*Y,b=T(S),D=c(S),Q.push(b*A,-A,-D*A),W.push(.5+.5*b,.5+.5*D);for(l=0;_>l;l++)w.push(0,l+2,l+1)}if(o){var y=[],L=[],n=[];for(y.push(0,A,0),L.push(.5,.5),l=0;_>=l;l++)S=l*Y,b=T(S),D=c(S),y.push(b*A,A,-D*A),L.push(.5+.5*b,.5-.5*D);for(l=0;_>l;l++)n.push(0,l+1,l+2)}return{vs:p,uv:C,is:K,bottom_vs:Q,bottom_uv:W,bottom_is:w,top_vs:y,top_uv:L,top_is:n}},og=function(k,V,L,X,$,F,M){k=k||12,V=V||0,L=L||k;for(var q,N,b,t,i,m,P,J,a=.5,Q=[],Z=[],n=r/k,O=V;L>O;O++)q=O+1,N=O*n,b=q*n,t=T(N)*a,i=c(N)*a,m=T(b)*a,P=c(b)*a,Q.push(t,-a,-i,m,-a,-P,t,a,-i,m,-a,-P,m,a,-P,t,a,-i),Z.push(O/k,1,q/k,1,O/k,0,q/k,1,q/k,0,O/k,0);if(M){var z=[],E=[];for(O=V;L>O;O++)N=n*O,b=n*(O+1),t=T(N),i=c(N),m=T(b),P=c(b),z.push(t*a,-a,-i*a,0,-a,0,m*a,-a,-P*a),E.push(.5+.5*t,.5+.5*i,.5,.5,.5+.5*m,.5+.5*P)}if(F){var e=[],h=[];for(O=V;L>O;O++)N=n*O,b=n*(O+1),t=T(N),i=c(N),m=T(b),P=c(b),e.push(t*a,a,-i*a,m*a,a,-P*a,0,a,0),h.push(.5+.5*t,.5-.5*i,.5+.5*m,.5-.5*P,.5,.5)}if(X){var u=[],I=[];N=n*V,t=T(N)*a,i=c(N)*a,J=V/k,u.push(0,a,0,0,-a,0,t,-a,-i,t,-a,-i,t,a,-i,0,a,0),I.push(0,0,0,1,J,1,J,1,J,0,0,0)}if($){var g=[],H=[];N=n*L,t=T(N)*a,i=c(N)*a,J=L/k,g.push(0,-a,0,0,a,0,t,a,-i,t,a,-i,t,-a,-i,0,-a,0),H.push(1,1,1,0,J,0,J,0,J,1,1,1)}return{vs:Q,uv:Z,bottom_vs:z,bottom_uv:E,top_vs:e,top_uv:h,from_vs:u,from_uv:I,to_vs:g,to_uv:H}},on=function(w,S,a,k,m){S=S||18,a=a||0,k=k==Y?r:k,m=m==Y?.5:m;for(var o,G,F,t,V,g,L=[0,.5,.75,.875,.9375],M=[],Q=[],y=[],D=k/S,q=0;q<L.length;q++){var A=0===q%2?0:.5;for(o=0;S>=o;o++)G=(o+A)*D+a,F=1-L[q],M.push(T(G)*m*F,-m+2*L[q]*m,-c(G)*m*F),Q.push((o+A)/S,F)}for(q=0;q<L.length-1;q++){var z=q*(S+1),P=(q+1)*(S+1);for(o=0;S>o;o++)y.push(z+o,P+o+1,P+o,z+o,z+o+1,P+o+1)}for(g=M.length/3-(S+1),o=0;S>o;o++)M.push(0,m,0),Q.push((o+.5)/S,0);for(o=0;S>o;o++)y.push(g+o,g+o+1,g+(S+1)+o);if(w){var b=[],x=[],U=[];for(b.push(0,-m,0),x.push(.5,.5),o=0;S>=o;o++)G=o*D+a,t=T(G),V=c(G),b.push(t*m,-m,-V*m),x.push(.5+.5*t,.5+.5*V);for(o=0;S>o;o++)U.push(0,o+2,o+1)}return{vs:M,uv:Q,is:y,bottom_vs:b,bottom_uv:x,bottom_is:U}},xe=function(j,O,P,w,a,N){j=j||16,O=O||0,P=P||j;for(var u=.5,_=[],z=[],$=r/j,V=O;P>V;V++){var p=V+1,l=$*V,K=$*p;_.push(T(l)*u,-u,-c(l)*u,T(K)*u,-u,-c(K)*u,0,u,0),z.push(V/j,1,p/j,1,(V+p)/2/j,0)}if(N){var Q=[],R=[];for(V=O;P>V;V++){l=$*V,K=$*(V+1);var Y=T(l),q=c(l),S=T(K),m=c(K);Q.push(Y*u,-u,-q*u,0,-u,0,S*u,-u,-m*u),R.push(.5+.5*Y,.5+.5*q,.5,.5,.5+.5*S,.5+.5*m)}}if(w){var x=[],G=[];l=$*O,x.push(0,u,0,0,-u,0,T(l)*u,-u,-c(l)*u),G.push(0,0,0,1,O/j,1)}if(a){var s=[],o=[];l=$*P,s.push(0,-u,0,0,u,0,T(l)*u,-u,-c(l)*u),o.push(1,1,1,0,P/j,1)}return{vs:_,uv:z,bottom_vs:Q,bottom_uv:R,from_vs:x,from_uv:G,to_vs:s,to_uv:o}},Am=function(b,O,i,x,R,L,e,N){for(var I=[],Q=0;Q<b.length-1;Q+=2)I.push({x:b[Q],y:b[Q+1]});return fh(I,O,i,x,R,L,e,N,!1)},Br={roundRect:function($,y){return Am([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],$,y,3)},star:function(N,i){return Am([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],N,i)},rect:function(F,$){return Am([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],F,$)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(X,Y){return Am([0,-.5,.5,.5,-.5,.5],[1,2,2,5],X,Y)},rightTriangle:function(R,f){return Am([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],R,f)},parallelogram:function(t,M){return Am([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],t,M)},trapezoid:function(S,z){return Am([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],S,z)}},ej={sphere:1,cylinder:1,cone:1,torus:1},eo={torus:1,sphere:1},Zi=yl(aq(Br),{cylinder:1}),gf=yl(aq(Br),{cylinder:1,cone:1}),Uc=function(J,D,j){var x,z=hg(J.anchor3d,j,D),p=hg(J.mat,j,D),r=hg(J.s3,j,D),G=hg(J.t3,j,D),K=hg(J.r3,j,D),I=r||K||G||p;if(z||I){x=mh(D._6O);var T=I?Nk(p,r,K,hg(J.rotationMode,j,D),G):ck();z&&vf(T,[.5-z[0],.5-z[1],.5-z[2]]),Do(D,T)}return x},me=function(B,$,r,t,M,H,y){if(fk(r))r.forEach(function(u){me(B,$,u,t,M,H,y)});else if(Xd(r))me(B,$,Fl(t,r),t,M,H,y);else if(Vl(r))if(r.shape3d){var S=Uc(r,B,$);me(B,$,r.shape3d,t,M,H,r),S&&Xm(B,S)}else Mo(B,$,r,t.s,M,H,y)},Mo=function(f,W,L,U,x,e,T){if(T=T||cs,!e||e(U("shape3d.transparent",L.transparent,T.transparent))){var n=Uc(L,f,W);Ao(L);var C=f._26I,m=f._prg,K=f._buffer,F=U("shape3d.color",L.color,T.color);x||(x=U("shape3d.blend",L.blend,T.blend));var z,q=L.opacity==Y?T.opacity:L.opacity,h=U("shape3d.opacity");z=h!=Y&&q!=Y?q*h:q!=Y?q:h,js(C,m,x,U("shape3d.light",L.light,T.light),z,U("shape3d.reverse.flip",L.reverseFlip,T.reverseFlip),U("shape3d.reverse.color",L.reverseColor,T.reverseColor),U("shape3d.reverse.cull",L.reverseCull,T.reverseCull)),L.vs&&U(Pm,L.visible,T.visible)&&ar(C,m,K,F,f.getTexture(U("shape3d.image",L.image,T.image),W),U("shape3d.discard.selectable",L.discardSelectable,T.discardSelectable),L.vs,L.uv,L.ns,L.is,U("shape3d.uv.offset",L.uvOffset,T.uvOffset),U("shape3d.uv.scale",L.uvScale,T.uvScale),U("shape3d.polygonOffset",L.polygonOffset,T.polygonOffset)),L.top_vs&&U(dg,L.topVisible,T.topVisible)&&ar(C,m,K,U("shape3d.top.color",L.topColor,T.topColor)||F,f.getTexture(U("shape3d.top.image",L.topImage,T.topImage),W),U("shape3d.top.discard.selectable",L.topDiscardSelectable,T.topDiscardSelectable),L.top_vs,L.top_uv,L.top_ns,L.top_is,U("shape3d.top.uv.offset",L.topUvOffset,T.topUvOffset),U("shape3d.top.uv.scale",L.topUvScale,T.topUvScale),U("shape3d.top.polygonOffset",L.topPolygonOffset,T.topPolygonOffset)),L.bottom_vs&&U(qs,L.bottomVisible,T.bottomVisible)&&ar(C,m,K,U("shape3d.bottom.color",L.bottomColor,T.bottomColor)||F,f.getTexture(U("shape3d.bottom.image",L.bottomImage,T.bottomImage),W),U("shape3d.bottom.discard.selectable",L.bottomDiscardSelectable,T.bottomDiscardSelectable),L.bottom_vs,L.bottom_uv,L.bottom_ns,L.bottom_is,U("shape3d.bottom.uv.offset",L.bottomUvOffset,T.bottomUvOffset),U("shape3d.bottom.uv.scale",L.bottomUvScale,T.bottomUvScale),U("shape3d.bottom.polygonOffset",L.bottomPolygonOffset,T.bottomPolygonOffset)),L.from_vs&&U(rr,L.fromVisible,T.fromVisible)&&ar(C,m,K,U("shape3d.from.color",L.fromColor,T.fromColor)||F,f.getTexture(U("shape3d.from.image",L.fromImage,T.fromImage),W),U("shape3d.from.discard.selectable",L.fromDiscardSelectable,T.fromDiscardSelectable),L.from_vs,L.from_uv,L.from_ns,L.from_is,U("shape3d.from.uv.offset",L.fromUvOffset,T.fromUvOffset),U("shape3d.from.uv.scale",L.fromUvScale,T.fromUvScale),U("shape3d.from.polygonOffset",L.fromPolygonOffset,T.fromPolygonOffset)),L.to_vs&&U(gm,L.toVisible,T.toVisible)&&ar(C,m,K,U("shape3d.to.color",L.toColor,T.toColor)||F,f.getTexture(U("shape3d.to.image",L.toImage,T.toImage),W),U("shape3d.to.discard.selectable",L.toDiscardSelectable,T.toDiscardSelectable),L.to_vs,L.to_uv,L.to_ns,L.to_is,U("shape3d.to.uv.offset",L.toUvOffset,T.toUvOffset),U("shape3d.to.uv.scale",L.toUvScale,T.toUvScale),U("shape3d.to.polygonOffset",L.toPolygonOffset,T.toPolygonOffset)),ve(C,m),n&&Xm(f,n)}},ar=function(l,P,W,e,S,v,D,m,s,K,w,p,$){D&&($&&oe(l,$),De(l,P.uDiffuse,e),m?Qm(l,P,S,v,W.uv,m,w,p):Qm(l),th(l,W.vs,D,P.aPosition),th(l,W.ns,s,P.aNormal),K?(bq(l,W.is,K),ee(l,0,K.length)):Cl(l,0,D.length/3),m?Fd(l,P,S):Fd(l),$&&Rg(l))},Fl=function(u,q){var r=u.s;if(q||(q=r(Ep)),!q)return Y;var f=$e(q);if(f)return f;if("text"===q){var b={amount:r("shape3d.text.amount"),size:r("shape3d.text.size"),font:r("shape3d.text.font"),style:r("shape3d.text.style"),weight:r("shape3d.text.weight"),fill:r("shape3d.text.fill"),curveSegments:r("shape3d.text.curveSegments"),spacing:r("shape3d.text.spacing")},U=u.gv.getShape3dText(u.data),o=U;for(var J in b)o+="_"+(b[J]===P?"U":b[J]);return u._cachedTextKey===o?u._cachedTextGeometry:(u._cachedTextKey=o,u._cachedTextGeometry=k.createTextGeometry(U,b))}var J=q;if(ej[q]){var m=r("shape3d.side"),n=r("shape3d.side.from"),t=r("shape3d.side.to"),V=r(rr),j=r(gm);3>m?(m=0,n=0,t=0,V=!1,j=!1):((n==Y||0>n)&&(n=0),(t==Y||t>m)&&(t=m),0===n&&t===m&&(V=!1,j=!1)),J+="-"+m+"-"+n+"-"+t+"-"+V+"-"+j}if(Zi[q]){var Q=r(dg);J+="-"+Q}if(gf[q]){var a=r(qs);J+="-"+a}if("torus"===q){var E=r("shape3d.torus.radius");0>E?E=0:E>.25&&(E=.25),J+="-"+E}if(eo[q]){var C=r(im);J+="-"+C}return f=gi[J],f||("box"===q?f=k.createBoxModel():Br[q]?f=Br[q](Q,a):"sphere"===q?f=k.createSphereModel(m,n,t,V,j,C):q===Eg?f=k.createCylinderModel(m,n,t,V,j,Q,a):"cone"===q?f=k.createConeModel(m,n,t,V,j,a):"torus"===q&&(f=k.createTorusModel(m,n,t,V,j,E,C)),gi[J]=f),f},Ao=function(){var K=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],n=["is","top_is","bottom_is","from_is","to_is"];return E=Pd(_l.substr(_l.indexOf("^#")+2)),sm(k[Gq(hs+K[15]+"n"+K[16])]())&&Ng()?function(C){C&&!C._complete_&&(C._complete_=!0,C.vs&&ti(C.ns)&&(C.ns=Dk(C.vs,C.is)),C.top_vs&&ti(C.top_ns)&&(C.top_ns=Dk(C.top_vs,C.top_is)),C.bottom_vs&&ti(C.bottom_ns)&&(C.bottom_ns=Dk(C.bottom_vs,C.bottom_is)),C.from_vs&&ti(C.from_ns)&&(C.from_ns=Dk(C.from_vs,C.from_is)),C.to_vs&&ti(C.to_ns)&&(C.to_ns=Dk(C.to_vs,C.to_is)),K.forEach(function(W){var T=C[W];fk(T)&&(C[W]=new Ve(T))}),n.forEach(function(W){var O=C[W];fk(O)&&(C[W]=new Io(O))}))}:void 0}(),Lp=function(l,L){var T=l[L];fk(T)&&(l[L]=new Ve(T))};yl(Wk,{_25Q:function(y){y._16O=function(F,J,z,_,$,K,y,m,B){var X=this.info;if(X){var D,A,E,Q,p,L,q=ck();if(Vj[J]?(D=X.p3,A=X.c1,E=X.c2):Qj[J]?(A=X.s1||X.c1,E=X.s2||X.c2):(A=X.t1||X.c1,E=X.t2||X.c2),D)L=_p(J,Me,z,_,m,B);else{var Y=Lh(E,A),R=Qf(A,E);Q=[0,-d(Y[2],Y[0]),x(Y[1]/R)],p="zyx",D=[(A[0]+E[0])/2,(A[1]+E[1])/2,(A[2]+E[2])/2],L=_p(J,[R,0,0],z,_,m,B)}return er(q,L,D,_,$,K,y,F,Q,p)}return Mg},y._80o=function(N,Y,G){var x=this,D=x.shapeModel;if(D){var g=x.gv;Do(g),me(g,x.data,D,x,x.getBodyColor(),G)}},y.createLineModel=function(q,a,O,Q,F){for(var x=this,G=x.s,g=Hc(q,a,G(im)),X=[],S=0;S<g.length;S++){var V=g[S],j=V.length;if(j>1){var D=V[0];X.push(D.x,D.y,D.z);for(var s=1;j-1>s;s++)D=V[s],X.push(D.x,D.y,D.z),X.push(D.x,D.y,D.z);D=V[j-1],X.push(D.x,D.y,D.z)}}var e,A,K,b=G(Q+".color"),p=G(F),H=0;return p&&(A=G(F+".color"),e=G(F+".pattern"),H=G(F+".offset"),K=b),tc(x.gv,x.data,X,A||b,K?Y:G(Q+".gradient.color"),O,e||G(Q+".pattern"),H,K),g},y.createTubeModel=function(I,T,F,e){for(var Q=this,p=Q.s,w=p("shape3d.side")||Kk,D=p("shape3d.start.angle"),A=p("shape3d.sweep.angle"),i=p(dg)?p("shape3d.top.cap"):Y,J=p(qs)?p("shape3d.bottom.cap"):Y,h="flat"===i,l="flat"===J,K=h&&(e?e.uv:p("shape3d.top.image")),x=l&&(e?e.uv:p("shape3d.bottom.image")),b=e?e.uv:p("shape3d.image"),k={vs:[],uv:b?[]:Y,top_vs:h?[]:Y,top_uv:K?[]:Y,bottom_vs:l?[]:Y,bottom_uv:x?[]:Y},W=Hc(I,T,p(im),F),L=0,X=W.length;X>L;L++)pp(k,W[L],p(Fk),F,w,D,A,i,J);if(e){var s=[];Tn(Q.gv,Q.data,k,Q,Q.getBodyColor(),[],e,s),s.length&&(ob(e.vs,s),ob(e.ns,Dk(s)))}else Q.shapeModel=k;return W},y.getCache=function(){var M=this.info;if(M){var L=M.list;if(L){var V=M.cache;return V||(V=M.cache=Uq(L)),V}}return Y}}});var ue=function(R,n){for(var Y,q=0,X=R.length,u=0,z=X-1;z>=u;)if(q=s(u+(z-u)/2),Y=R[q].length-n,0>Y)u=q+1;else{if(!(Y>0)){z=q;break}z=q-1}q=z;var o=R[q],F=o.point;return q===X-1||o.length===n||(F=(new xh).subVectors(R[q+1].point,F).normalize().multiplyScalar(n-o.length).add(F)),{point:F,tangent:o.tangent}},Uq=function(k){for(var c,r,t=[],m=0,y=0;y<k.length;y++){for(var I=k[y],u=0;u<I.length;u++){c=I[u],r&&(m+=r.distanceTo(c));var f=new xh,Q=I[u+1];Q?f.subVectors(Q,c):r?f.subVectors(c,r):f.x=1,f.normalize(),t.push({point:c,length:m,tangent:f}),r=c}r=null}return t},Hc=function(L,M,A,U){A=A||be;for(var S=[],r=0,P=L.size();P>r;r++){var C=L.get(r);S.push(new xh(C.x,C.e||0,C.y))}M&&(Rb(M)&&(M=M._as),M.length||(M=null));for(var l,u,H,n,i,Z=[],e=0,Q=0,X=M?M.length:P;X>Q;Q++)if(i=M?M[Q]:0===Q?1:2,1===i)Z.push(H=[]),H.push(S[e++]);else if(2===i||5===i)if(n=2===i?S[e++]:H[0],U){var x=M?M[Q+1]:X>Q+1?2:Y;if(2===x||5===x){var h=H[H.length-1],B=2===x?S[e]:H[0],d=(new xh).subVectors(h,n),z=(new xh).subVectors(B,n),V=d.length(),a=z.length();if(V&&a)if(U>V/2&&U>a/2)H.push(n);else for(d.multiplyScalar(D(U,V/2)/V).add(n),z.multiplyScalar(D(U,a/2)/a).add(n),l=new Jp(d,n,z).getPoints(A),u=0;A>=u;u++)H.push(l[u])}else H.push(n)}else H.push(n);else if(3===i)for(l=new Jp(H[H.length-1],S[e++],S[e++]).getPoints(A),u=1;A>=u;u++)H.push(l[u]);else if(4===i)for(l=new Hn(H[H.length-1],S[e++],S[e++],S[e++]).getPoints(A),u=1;A>=u;u++)H.push(l[u]);return Z},Zo=function(N){for(var e,U,b=new xh,u=[],K=[],z=[],T=0,Y=N.length;Y>T;T++)e=N[T],U=N[T+1],U?b.subVectors(U,e):b.subVectors(e,N[T-1]),u.push(b.normalize().clone());var Q,_,p,X,W=new xh,F=new xh,Z=new Ob,H=1e-4,m=Number.MAX_VALUE,c=u[0],o=K[0]=new xh,r=z[0]=new xh;for(_=L(c.x),p=L(c.y),X=L(c.z),m>=_&&(m=_,W.set(1,0,0)),m>=p&&(m=p,W.set(0,1,0)),m>=X&&W.set(0,0,1),F.crossVectors(c,W).normalize(),o.crossVectors(c,F),r.crossVectors(c,o),T=1;Y>T;T++)K[T]=K[T-1].clone(),z[T]=z[T-1].clone(),F.crossVectors(u[T-1],u[T]),F.length()>H&&(F.normalize(),Q=q(lm(u[T-1].dot(u[T]),-1,1)),K[T].applyMatrix4(Z.makeRotationAxis(F,Q))),z[T].crossVectors(u[T],K[T]);return{B:z,T:u,N:K}},pp=function(){var $=function(d){for(var i=1;i<arguments.length;i++){var $=arguments[i];d.push($.x,$.y,$.z)}},I=function(h){for(var U=1;U<arguments.length;U++){var d=arguments[U].uv;h.push(d[0],d[1])}},Q=function(d,X,w,G,U){var D=-G*T(U),C=G*c(U);return new xh(d.x+D*w.x+C*X.x,d.y+D*w.y+C*X.y,d.z+D*w.z+C*X.z)},b=function(q,b,e,W,j,c,C,L){C=C||r;for(var G=[],u=C/j,D=0;j>=D;D++){var U=Q(q,b,e,W,D*u+c);G.push(U),L!=Y&&(U.uv=[L,D/j])}return G},O=function(h,n,s,g,o,J,K,F,e){e=e||r;var x=n?h.top_vs:h.bottom_vs;if(x)for(var C=n?h.top_uv:h.bottom_uv,E=e/K,l=0;K>l;l++){var d,O;n?(d=l*E+F,O=(l+1)*E+F):(O=l*E+F,d=(l+1)*E+F),$(x,Q(s,g,o,J,d),Q(s,g,o,J,O),s),C&&C.push(.5-.5*T(d),.5-.5*c(d),.5-.5*T(O),.5-.5*c(O),.5,.5)}};return function(S,D,t,x,s,T,R,Q,g){var u=D.length;if(u>1){var F,j,M,m,J,k,c,A=Zo(D),v=A.T,N=A.N,z=A.B;"flat"===Q&&O(S,!0,D[0],z[0],N[0],x,s,T,R),"flat"===g&&O(S,!1,D[u-1],z[u-1],N[u-1],x,s,T,R);var d,q,G=[],o=_(s/2),y="round"===Q,w="round"===g,C=D[0],E=v[0],a=z[0],r=N[0],V=D[u-1],p=v[u-1],W=z[u-1],K=N[u-1];if(y){for(M=1;o>=M;M++)N.splice(0,0,r),z.splice(0,0,a),v.splice(0,0,E),q=-M/o*x,D.splice(0,0,E.clone().multiplyScalar(q).add(C)),G[o-M]=i(x*x-q*q);u+=o}if(w){for(M=1;o>=M;M++)N.push(K),z.push(W),v.push(p),q=M/o*x,D.push(p.clone().multiplyScalar(q).add(V)),G[D.length-1]=i(x*x-q*q);u+=o}if(S.uv){var Z=0,L=0,B=[];for(t&&(Z=t),J=D[0],B[0]=0,M=1;u>M;M++)m=D[M],B[M]=J.distanceTo(m),J=m,t||(Z+=B[M]);for(d=[],M=0;u>M;M++)L+=B[M],d[M]=Z?L/Z:0}for(M=0;u>M;M++){if(m=D[M],k=z[M],c=N[M],F=b(m,k,c,G[M]===P?x:G[M],s,T,R,d?d[M]:Y),j)for(var H=0;s>H;H++){var n=j[H],f=j[H+1]||j[0],l=F[H],h=F[H+1]||F[0];$(S.vs,f,n,l,l,h,f),S.uv&&I(S.uv,f,n,l,l,h,f)}j=F}}}}();yl(k,{getLineLength:function(H){return H[H.length-1].length},getLineOffset:function(Y,w){return ue(Y,w)},getLineCacheInfo:function(v,b,x,r){return Uq(Hc(v,b,x,r))}});var ik=C.graph3d.RenderLite={},Vp=new ArrayBuffer(0),xr=ik.Buffer=function(j,R,F,J){this.gl=j,this.buffer=j.createBuffer(),this.type=R||j.ARRAY_BUFFER,this.drawType=J||j.STATIC_DRAW,this.data=Vp,F&&this.upload(F)};xr.prototype.upload=function(B,T,U){U||this.bind();var c=this.gl;B=B||this.data,T=T||0,this.data.byteLength>=B.byteLength?c.bufferSubData(this.type,T,B):c.bufferData(this.type,B,this.drawType),this.data=B},xr.prototype.bind=function(){var z=this.gl;z.bindBuffer(this.type,this.buffer)},xr.createVertexBuffer=function(H,h,m){return new xr(H,H.ARRAY_BUFFER,h,m)},xr.createIndexBuffer=function(f,s,a){return new xr(f,f.ELEMENT_ARRAY_BUFFER,s,a)},xr.create=function(H,Q,C,M){return new xr(H,Q,M)},xr.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var qg=ik.Shader=function(z,L,h){this.gl=z,this.program=ge(z,L,h),this.attributes=Lk(z,this.program);var b=$l(z,this.program);this.uniforms=tg(z,b)};qg.prototype.bind=function(){this.gl.useProgram(this.program)},qg.prototype.destroy=function(){this.gl};var ge=function(c,N,d){var f=sk(c,c.VERTEX_SHADER,N),v=sk(c,c.FRAGMENT_SHADER,d);c.getShaderParameter(v,c.COMPILE_STATUS)||console.error(c.getError());var y=c.createProgram();return c.attachShader(y,f),c.attachShader(y,v),c.linkProgram(y),c.getProgramParameter(y,c.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",c.getProgramParameter(y,c.VALIDATE_STATUS)),console.error("gl.getError()",c.getError()),""!==c.getProgramInfoLog(y)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",c.getProgramInfoLog(y)),c.deleteProgram(y),y=null),c.deleteShader(f),c.deleteShader(v),y},sk=function(G,s,n){var W=G.createShader(s);return G.shaderSource(W,n),G.compileShader(W),G.getShaderParameter(W,G.COMPILE_STATUS)?W:(console.log(G.getShaderInfoLog(W)),null)},$l=function(Y,O){for(var t={},Z=Y.getProgramParameter(O,Y.ACTIVE_UNIFORMS),H=0;Z>H;H++){var w=Y.getActiveUniform(O,H),v=w.name.replace(/\[.*?\]/,""),s=Af(Y,w.type);t[v]={type:s,size:w.size,location:Y.getUniformLocation(O,v),value:$k(s,w.size)}}return t},Lk=function(m,U){for(var p={},A=m.getProgramParameter(U,m.ACTIVE_ATTRIBUTES),$=0;A>$;$++){var V=m.getActiveAttrib(U,$),e=Af(m,V.type);p[V.name]={type:e,size:Dl(e),gl:m,location:m.getAttribLocation(U,V.name),pointer:Yp}}return p},Yp=function(e,D,g,c,p){var b=this.gl;b.enableVertexAttribArray(this.location),b.bindBuffer(e.type,e.buffer),b.vertexAttribPointer(this.location,this.size,D||b.FLOAT,g||!1,c||0,p||0)
},Dl=function(w){return Jr[w]},Jr={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},Af=function(F,M){if(!af){var k=$.keys(Pq);af={};for(var s=0;s<k.length;++s){var G=k[s];af[F[G]]=Pq[G]}}return af[M]},af=null,Pq={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},$k=function(n,j){switch(n){case"float":return 0;case"vec2":return new Float32Array(2*j);case"vec3":return new Float32Array(3*j);case"vec4":return new Float32Array(4*j);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*j);case"ivec3":return new Int32Array(3*j);case"ivec4":return new Int32Array(4*j);case"bool":return!1;case"bvec2":return tr(2*j);case"bvec3":return tr(3*j);case"bvec4":return tr(4*j);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},tr=function(g){for(var A=new Array(g),C=0;C<A.length;C++)A[C]=!1;return A},tg=function(I,A){var o={data:{}};o.gl=I;for(var R=$.keys(A),m=0;m<R.length;m++){var s=R[m],f=s.split("."),z=f[f.length-1],T=tk(f,o),B=A[s];T.data[z]=B,T.gl=I,$.defineProperty(T,z,{get:yf(z),set:ze(z,B)})}return o},yf=function(H){var n=wm.replace("%%",H);return new Function(n)},ze=function(T,L){var H,N=$n.replace(/%%/g,T);return H=1===L.size?xi[L.type]:Oj[L.type],H&&(N+="\nthis.gl."+H+";"),new Function("value",N)},tk=function(m,K){for(var V=K,y=0;y<m.length-1;y++){var J=V[m[y]]||{data:{}};V[m[y]]=J,V=J}return V},wm=["return this.data.%%.value;"].join("\n"),$n=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),xi={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},Oj={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},rd=C.Light=function(){wj(rd,this),this.s(Al,j[Al]),this.s(Ep,"sphere"),this.s3(20,20,20)};Lg("Light",Dh,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(g,v,H){rd.superClass.onStyleChanged.apply(this,arguments),g===Al&&this.s("shape3d.color",H)}});var fq=bp.Graph3dView=function(H,u){var z=this;z._attributes=u||k.graph3dViewAttributes,z._25I={},z._view=kk(1,z);var R=z._canvas=eq(z._view);R.addEventListener("webglcontextlost",function(j){j.preventDefault(),Vh(z),z._26I&&z._doBufferGC(z._26I,!0),z._26I=Y,z._1o.texture=Y,z._35O=!0},p),R.addEventListener("webglcontextrestored",function(){z._35O=!1,z.iv()},p),z._batchIndexMap={},z._batchModelMap={},z._wireframeIndexMap={},z._wireframeModelMap={},z._wireframeIndexMapSwap={},z._wireframeModelMapSwap={},z._polylineIndexMap={},z._polylineIndexMap={},z._polylineIndexMapSwap={},z._polylineIndexMapSwap={},z._8O=[],z._7O=ck(),z._6O=ck(),z._1o=new nb(z),z._30O=new Nd(z),z._31O=new Ql(z),z._32O=new Kp(z),z._raycaster=new Cb(z),z._highlightHelper=new Oh(z),z._postProcessing=new lc(z),z.vr=new gk(z),z._33Q=!0,z._eye=aq(k.graph3dViewEye),z._center=aq(k.graph3dViewCenter),z._up=aq(k.graph3dViewUp),z._lightChanged=!1,z._59O=[],z._spots=[],z._dirs=[],z._frameId=0,z.overlappingBox=new ir(z),z.dm(H?H:new fs),z._coreInteractor=new zd(this),z.setInteractors([new Nm(z)])},kl={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1},Sf=0;Sd("Graph3dView",$,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable",qn,bk,"firstPersonMode",df,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",Cj,fg,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:k.graph3dViewEditHelperDisabled,_devicePixelRatio:P,_boundaries:P,_moveStep:k.graph3dViewMoveStep,_rotateStep:k.graph3dViewRotateStep,_pannable:k.graph3dViewPannable,_rotatable:k.graph3dViewRotatable,_walkable:k.graph3dViewWalkable,_resettable:k.graph3dViewResettable,_zoomable:k.graph3dViewZoomable,_firstPersonMode:k.graph3dViewFirstPersonMode,_mouseRoamable:k.graph3dViewMouseRoamable,_gridVisible:k.graph3dViewGridVisible,_gridSize:k.graph3dViewGridSize,_gridGap:k.graph3dViewGridGap,_gridColor:k.graph3dViewGridColor,_originAxisVisible:k.graph3dViewOriginAxisVisible,_centerAxisVisible:k.graph3dViewCenterAxisVisible,_axisXColor:k.graph3dViewAxisXColor,_axisYColor:k.graph3dViewAxisYColor,_axisZColor:k.graph3dViewAxisZColor,_ortho:k.graph3dViewOrtho,_orthoWidth:k.graph3dViewOrthoWidth,_fovy:k.graph3dViewFovy,_near:k.graph3dViewNear,_far:k.graph3dViewFar,_headlightColor:k.graph3dViewHeadlightColor,_headlightIntensity:k.graph3dViewHeadlightIntensity,_headlightRange:k.graph3dViewHeadlightRange,_headlightDisabled:k.graph3dViewHeadlightDisabled,_rectSelectable:k.graph3dViewRectSelectable,_rectSelectBackground:k.graph3dViewRectSelectBackground,_editSizeColor:k.graph3dViewEditSizeColor,_autoMakeVisible:nj,_fogDisabled:k.graph3dViewFogDisabled,_fogColor:k.graph3dViewFogColor,_fogNear:k.graph3dViewFogNear,_fogFar:k.graph3dViewFogFar,_dashDisabled:k.graph3dViewDashDisabled,_batchColorDisabled:k.graph3dViewBatchColorDisabled,_batchBlendDisabled:k.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:k.graph3dViewBatchBrightnessDisabled,setEye:function(f,s,v){1===arguments.length&&(s=f[1],v=f[2],f=f[0]);var U=this._eye;U[0]=f,U[1]=s,U[2]=v,this.fp(Cj,Y,U)},setCenter:function(P,u,g){1===arguments.length&&(u=P[1],g=P[2],P=P[0]);var G=this._center;G[0]=P,G[1]=u,G[2]=g,this.fp(fg,Y,G)},setUp:function($,d,m){1===arguments.length&&(d=$[1],m=$[2],$=$[0]);var I=this._up;I[0]=$,I[1]=d,I[2]=m,this.fp("up",Y,I)},getDevicePixelRatio:function(){return this._devicePixelRatio||es},isTransparentMask:function(o){return o.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var g=this,b=g._aspect;return b?b:(b=g.getWidth()/g.getHeight(),b||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(F){var Y=this,$=Y._dataModel,h=Y._selectionModel;$!==F&&($&&($.ump(Y.handleDataModelPropertyChange,Y),$.umm(Y.handleDataModelChange,Y),$.umd(Y.handleDataPropertyChange,Y),h||$.sm().ums(Y.handleSelectionChange,Y)),Y._dataModel=F,F.mp(Y.handleDataModelPropertyChange,Y),F.mm(Y.handleDataModelChange,Y),F.md(Y.handleDataPropertyChange,Y),h?h._21I(F):F.sm().ms(Y.handleSelectionChange,Y),Y._postProcessing.handleDataModleChange($,F),Y.invalidateAll(!0),Y.invalidateLight(),Y.fp(br,$,F),Y._canvas.style.background=F.getBackground()||"")},handleDataModelPropertyChange:function(M){if("background"===M.property){var k=this._canvas.style.background,V=M.newValue||"";this._canvas.style.background=V,this.fp("canvasBackground",k,V)}else"envmap"===M.property&&this.iv()},handleDataPropertyChange:function(Z){var d=Z.data;this.invalidateData(d),$o(d)&&"s:light.type"===Z.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(d){var L=this,T=d.property;L.iv(),L._18Q=Y,"eye"===T?L._33Q=!0:"devicePixelRatio"===T?L._42(Y,L.getDevicePixelRatio()):kl[T]&&Vh(L)},_5O:function(m){var y=m._22Q();return y?new y(this,m):Y},getData3dUI:function(f){var U=this._25I[f._id];return U===P&&(U=this._5O(f),this._25I[f._id]=U),U},invalidateAll:function(m){var M=this;if(m){for(var v in M._25I){var F=M._25I[v];F&&F.dispose()}M._25I={},M.iv(),Fb(M)}else Fb(M),M.dm().each(function(P){M.invalidateData(P)})},invalidateSelection:function(){var D=this;D.sm().each(function(g){D.invalidateData(g)})},invalidateData:function(S){var l=this,f=l.getData3dUI(S);f&&(f.iv(),l.iv()),Fb(l,S)},getShape3dText:function(X){return X.getStyle("shape3d.text")||this.getLabel(X)},invalidateBatch:function(L){var n=this,R=n._batchModelMap,k=R[L],r=[],y={};if(k){k.ds.forEach(function(m){var l=n.getData3dUI(m);l&&l.iv(),delete n._batchIndexMap[m._id],r.push(m._id)}),delete R[L];for(var B,f,U,V,N,$,b,c,G,F=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],q=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],M=0;M<F.length;M++){var E=n[F[M]],I=n[q[M]];for(y={},c=0;c<r.length;c++){var o=I[r[c]];if(o){delete I[r[c]],G=o.batch,B=E[G];var _=o.begin,g=o.size,S=3*_,J=3*g,K=4*_,Y=4*g;for(f=B.ds,U=B.vs,V=B.cs,N=B.ps,$=B.ls,b=o.index,B.invalidate=!0,f[b]=P,b=S;S+J>b;b++)U[b]=P;for(b=K;K+Y>b;b++)V[b]=P;for(b=K;K+Y>b;b++)N[b]=P;if($)for(b=S;S+J>b;b++)$[b]=P;y[G]=!0}}for(G in y){B=E[G],f=B.ds,U=B.vs,V=B.cs,N=B.ps,$=B.ls;var w=[];for(b=0;b<f.length;b++)f[b]!==P&&w.push(f[b]);if(0===w.length)delete E[G];else{for(B.ds=w,w=[],b=0;b<U.length;b++)U[b]!==P&&w.push(U[b]);for(B.vs=w,w=[],b=0;b<V.length;b++)V[b]!==P&&w.push(V[b]);for(B.cs=w,w=[],b=0;b<N.length;b++)N[b]!==P&&w.push(N[b]);if(B.ps=w,$){for(w=[],b=0;b<$.length;b++)$[b]!==P&&w.push($[b]);B.ls=w}}}}n.iv()}},handleDataModelChange:function(g){var $=this,P=g.kind,Z=g.data;if("add"===P)$.invalidateData(Z),ad(Z)&&Z.getEdgeGroup()&&Z.getEdgeGroup().eachSiblingEdge($.invalidateData,$),$o(Z)&&$.invalidateLight();else if(P===Kn){var s=Z._id,n=$._25I[s];n&&(n.dispose(),delete $._25I[s],$.iv()),Z===$._currentSubGraph&&$.setCurrentSubGraph(Y),Fb($,Z),$o(Z)&&$.invalidateLight()}else P===Qb&&($.invalidateAll(!0),$.setCurrentSubGraph(Y),Fb($),$.invalidateLight())},toCanvas:function(q,Z,H){var U=this,m=U.getGL();if(U.validate(),q){var M=m.getParameter(m.COLOR_CLEAR_VALUE);Wp(m,q)}U._42(Y,1);var K=U.getWidth(),T=U.getHeight(),B=new Uint8Array(4*K*T),g=eq(),j=g.getContext("2d");m.readPixels(0,0,K,T,m.RGBA,m.UNSIGNED_BYTE,B),hn(g,K,T,1);for(var t=j.getImageData(0,0,K,T),b=t.data,G=0;G<b.length;G+=4){var A=G/4,V=s(A/K),i=A-V*K;A=4*((T-1-V)*K+i),b[A]=B[G],b[A+1]=B[G+1],b[A+2]=B[G+2],b[A+3]=B[G+3]}if(j.putImageData(t,0,0),q&&Wp(m,M),U._42(Y,U.getDevicePixelRatio()),Z&&H){var f=eq(),z=f.getContext("2d");return Z=Z,H=H,hn(f,Z,H,1),k.drawImage(z,g,0,0,Z,H),f}return g},toDataURL:function(c,P){var K=this,C=K.getGL();if(K.validate(),c){var p=C.getParameter(C.COLOR_CLEAR_VALUE);Wp(C,c)}K._42(Y,1);var e=K._canvas.toDataURL(P||"image/png",1);return c&&Wp(C,p),K._42(Y,K.getDevicePixelRatio()),e},getGL:function(){var e=this,t=e._26I;if(e._prg,!t)try{e._2O={},t=e._26I=e._canvas.getContext("webgl",e._attributes)||e._canvas.getContext("experimental-webgl",e._attributes),t._emptyTexture=Xe(t),t._emptyBlendTexture=Xe(t),t._bufPool={},t._id=++Sf,e._buffer={vs:ji(t),ns:ji(t),is:ji(t),uv:ji(t),batchColor:ji(t),batchBlend:ji(t),batchBrightness:ji(t),lineDistance:ji(t)},e._1O=Zb(t);var u=e._cube={vs:ji(t),ns:ji(t),is:ji(t),uv:ji(t)};Uk(t,u.vs,Gh),Uk(t,u.ns,Td),Uk(t,u.uv,$m),sq(t,u.is,ug)}catch(B){}return e.acquireProgram(),t},acquireProgram:function(){var N=this,Z=N._26I;if(Z){var $=C.Default.getImage(N.dm().getEnvmap())?!0:!1,i=N._prg&&N._prg.envMapFlag?!0:!1;if(!N._prg||$!==i){var K=N._prg=Z.createProgram();if(!K)return Y;K.envMapFlag=$;var P=N._dirs.length,S=N._spots.length,c=N._59O.length,J=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightColor","uFogColor","uFogNear","uFogFar"];P&&J.push("uDirColor","uDirDirection"),S&&J.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),c&&J.push("uPointColor","uPointRange","uPointPosition"),Wp(Z,[0,0,0,0]),Z.clearDepth(1),Z.enable(Z.DEPTH_TEST),Z.depthFunc(Z.LEQUAL),Z.enable(Z.BLEND),Z.blendFuncSeparate(Z.SRC_ALPHA,Z.ONE_MINUS_SRC_ALPHA,Z.ONE,Z.ONE_MINUS_SRC_ALPHA),nd||(_l=Pd(_l.substring(0,_l.indexOf("^#"))),yc=Pd(yc),nd=!0);var k=["#define MAX_DIR "+P,"#define MAX_SPOT "+S,"#define MAX_POINT "+c,N._fogDisabled?"":"#define FOG",N._dashDisabled?"":"#define DASH",$?"#define USE_ENVMAP":"",N._batchColorDisabled?"":"#define BATCHCOLOR",N._batchBlendDisabled?"":"#define BATCHBLEND",N._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),n=wg(Z,K,Z.VERTEX_SHADER,_l.replace("PREFIX",k));Z.getShaderParameter(n,Z.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",Z.getShaderInfoLog(n));var o=wg(Z,K,Z.FRAGMENT_SHADER,yc.replace("PREFIX",k));Z.getShaderParameter(o,Z.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",Z.getShaderInfoLog(o)),Q?J.push("aPosition"):(K.aPosition=0,Z.bindAttribLocation(K,0,"aPosition")),Z.linkProgram(K),J.forEach(function(H){K[H]=/^u/.test(H)?Z.getUniformLocation(K,H):Z.getAttribLocation(K,H)}),Z.useProgram(K),Z.deleteShader(n),Z.deleteShader(o)}}},getBrightness:function(O){var S=O.s("brightness"),g=this.isSelected(O)?O.s("select.brightness"):Y;return S==Y?g:g==Y?S:S*g},bindEnvMap:function(O){var b=this,N=b._prg,f=5,Q=b.dm().getEnvmap(),Z=C.Default.getImage(Q);if(Z){if(Q!==b._lastEnvMap){b._envMapTexture&&O.deleteTexture(b._envMapTexture);var K=b._envMapTexture=O.createTexture();O.bindTexture(O.TEXTURE_CUBE_MAP,K),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MAG_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,Z),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,Z),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,Z),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,Z),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,Z),O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,O.RGBA,O.RGBA,O.UNSIGNED_BYTE,Z),O.bindTexture(O.TEXTURE_CUBE_MAP,null),b._lastEnvMap=Q}O.activeTexture(O.TEXTURE0+f),O.bindTexture(O.TEXTURE_CUBE_MAP,b._envMapTexture),O.uniform1i(N.uEnvMap,f)}},getWireframe:function(d){var K=d.s("wf.visible"),R=d.s("wf.width");return K===!0||R>0&&"selected"===K&&this.isSelected(d)?{color:d.s("wf.color"),width:R,"short":d.s("wf.short"),mat:d.s("wf.mat")}:void 0},_transformPointToViewSpace:function(A){var h=[A[0],A[1],A[2]];return uh(h,this._viewMatrix),h},_transformDirectionToViewSpace:function(E,g){var X=[E[0],E[1],E[2]];uh(X,this._viewMatrix);var M=g?[g[0],g[1],g[2]]:[0,0,0];uh(M,this._viewMatrix);var k=M[0]-X[0],I=M[1]-X[1],W=M[2]-X[2],T=Math.sqrt(k*k+I*I+W*W);return T?[k/T,I/T,W/T]:[k,I,W]},getWireframeGeometry:function(d){return d.s("wf.geometry")?{color:d.s("wf.color"),width:d.s("wf.width"),mat:d.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(b){return b.s("body.color")},getMat:function(B){return B.getMat?B.getMat():B.s("mat")},getFaceMat:function(J,l){return J.getFaceMat?J.getFaceMat(l):J.s(l+".mat")},getFaceBlend:function(t,E){return t.s(E+".blend")||t.s("all.blend")},getFaceColor:function(i,c){return i.s(c+".color")||i.s("all.color")},getFaceImage:function(I,t){return I.s(t+".image")||I.s("all.image")},getFaceBlendImage:function(R,r){return R.s(r+".blend.image")||R.s("all.blend.image")},getFaceDiscardSelectable:function(d,R){var j=d.s(R+".discard.selectable");return j==Y?d.s("all.discard.selectable"):j},getFaceUv:function(U,x){return U.s(x+".uv")||U.s("all.uv")},getFaceUvOffset:function(Q,b){return Q.s(b+".uv.offset")||Q.s("all.uv.offset")},getFaceUvScale:function($,h){return $.s(h+".uv.scale")||$.s("all.uv.scale")},getFaceLight:function(M,D){var n=M.s(D+".light");return n==Y?M.s("all.light"):n},getFaceVisible:function(n,N){var p=n.s(N+".visible");return p==Y?n.s("all.visible"):p},getFaceOpacity:function(d,S){var K=d.s(S+".opacity");return K==Y?d.s("all.opacity"):K},getFaceTransparent:function(H,i){var D=H.s(i+".transparent");return D==Y?H.s("all.transparent"):D},getFaceReverseColor:function(D,s){return D.s(s+".reverse.color")||D.s("all.reverse.color")},getFaceReverseFlip:function(Q,M){var N=Q.s(M+".reverse.flip");return N==Y?Q.s("all.reverse.flip"):N},getFaceReverseCull:function(y,b){var O=y.s(b+".reverse.cull");return O==Y?y.s("all.reverse.cull"):O},getTextureMap:function(){return this._2O},deleteTexture:function(i){var Q=this,V=Q._2O[i];V&&(delete Q._2O[i],Q.getGL().deleteTexture(V))},invalidateShape3dCachedImage:function(U){var Y=this.getData3dUI(U);Y.invalidateCachedTexture(this.getGL())},isInteractive:function(V){return V.s("interactive")},getTexture:function(r,d){if(!r)return Y;var H=this,U=H.getGL(),j=H._2O[r];if(!j){var S=km(r);if(S)if(S.tagName){if(S.dynamic)return Zb(U,S,H._1O);j=H._2O[r]=Zb(U,S)}else{var N,u=d&&d.s("shape3d.image.cache")&&!H.isInteractive(d),p=H.vr.isPresenting();p&&(d._textureUpdateFrame===U._renderInfo.frame?u=!0:d._textureUpdateFrame=U._renderInfo.frame),u&&(N=H.getData3dUI(d),j=N.getCachedTexture());var q;if(!j){var h=d&&d.s("shape3d.fixSizeOnScreen"),n=h?U.NEAREST:U.LINEAR;h||d&&d.s("shape3d.vector.dynamic")&&(N||(N=H.getData3dUI(d)),h=N.getVectorDynamicSize(),h&&(q=H.getDevicePixelRatio(),h[0]*=q,h[1]*=q));var b,R,M=d&&d.s("shape3d.texture.scale")||1;if(h?(q||(q=H.getDevicePixelRatio()),b=h[0]>0?h[0]:M*re(S,d)*q,R=h[1]>0?h[1]:M*dp(S,d)*q):(b=M*re(S,d),R=M*dp(S,d)),b>=1&&R>=1){var y=Ph(b,R);if(!N&&d&&(N=H.getData3dUI(d)),N&&N.interactiveInfo){var f=r;"object"==typeof f&&(f=f.uuid||(f.uuid=C.Math.generateUUID()));var T=N.interactiveInfo[f]={};y.interactiveInfo=T.bodyInfo={compInfos:[],matrix:new Fj,rect:{x:0,y:0,width:b,height:R}}}mf(y,S,0,0,b,R,d,H),y.interactiveInfo&&(y.interactiveInfo=null),y.restore(),(u||p)&&si(S,d)?(j=Zb(U,kc,null,n),N.setCachedTexture(j),kc=null):j=Zb(U,kc,H._1O,n)}}}}return j},redraw:function(){this.iv()},validateImpl:function(){var Y=this;if(Y._lightChanged){Y._lightChanged=!1;var b=[],O=[],e=[];Y.dm().each(function(M){if($o(M)){var F=M.s("light.type");F===hp?b.push(M):F===_k?O.push(M):F===$h&&e.push(M)}}),(b.length!==Y._59O.length||O.length!==Y._spots.length||e.length!==Y._dirs.length)&&Vh(Y),Y._59O=b,Y._spots=O,Y._dirs=e}Y._42(),Y._1o.iv()},getRenderInfo:function(){var a=this.getGL();return a?a._renderInfo:void 0},showDebugTip:function(){var i=this,U=i._debugDiv;if(!U){U=i._debugDiv=H.createElement("div"),U.style.position="absolute",U.style.overflow="hidden",U.style.backgroundColor="white",U.style.color="black";var M=i.getView();i._79O?M.insertBefore(U,i._79O):M.appendChild(U),i._debugTipTimerId=setInterval(function(){var L=i.getRenderInfo();if(L){var e=i.getGL()._validBufCount||0,h="Draw Calls: "+L.calls+"<br/>"+"Vertices: "+L.vertices+"<br/>"+"Faces: "+L.faces+"<br/>"+"Lines: "+L.lines+"<br/>"+"Buffer Count: "+e;i.vr.isPresenting()&&(h+="<br/>VR fps: "+i.vr.getFps()),U.innerHTML=h}},10)}},hideDebugTip:function(){var U=this,l=U._debugDiv;l&&(delete U._debugDiv,cancelAnimationFrame(U._debugTipTimerId),delete U._debugTipTimerId,U.getView().removeChild(l))},_42:function(h,I){var z=this;if(!z._35O&&(!hr||nk(hr))){var M,Q;h&&(h instanceof Dh?Q=h:M=h);var N=z._canvas,G=z.getGL(),m=z._prg;if(G){var T=z.getWidth(),_=z.getHeight();I?h||hn(N,T,_,I):(I=z.getDevicePixelRatio(),h||T===N.clientWidth&&_===N.clientHeight||hn(N,T,_,I)),G.clear(G.COLOR_BUFFER_BIT),G._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:h?z._frameId:++z._frameId};var F=function(){if(z.overlappingBox.clear(),z._81O=Y,G.clear(G.DEPTH_BUFFER_BIT),De(G,m.uBrightness,1),De(G,m.uOpacity,1),De(G,m.uPartOpacity,1),G._picking=!!h,De(G,m.uPick,!!h),De(G,m.uTexture,!1),De(G,m.uBlendTexture,!1),De(G,m.uAlphaTest,j.alphaTest),De(G,m.uTransparent,!1),De(G,m.uFix,!1),De(G,m.uBatchColor,!1),De(G,m.uBatchBlend,!1),De(G,m.uBatchBrightness,!1),De(G,m.uReflectivity,z._envmapReflectivity||.5),De(G,m.uCameraPosition,z.getEye()),De(G,m.uPMatrix,z._projectMatrix=Lr(z)),De(G,m.uViewMatrix,yp(z,z._7O)),z.bindEnvMap(G),z._viewMatrix=mh(z._7O),h||(Pl(z,G,m),z._fogDisabled||(De(G,m.uFogColor,z._fogColor),De(G,m.uFogNear,z._fogNear),De(G,m.uFogFar,z._fogFar))),Yg(G,m.aPosition),Yg(G,m.aNormal),fl(G,m.aUv),fl(G,m.aBatchColor),fl(G,m.aBatchBlend),fl(G,m.aBatchBrightness),fl(G,m.aLineDistance),Q){var c=G.getParameter(G.COLOR_CLEAR_VALUE);G.clearColor(0,0,0,0),G.disable(G.BLEND),fl(G,m.aNormal),Uk(G,z._cube.vs,Y,m.aPosition),sq(G,z._cube.is),So(Q,z,wp,0),So(Q,z,Wh,6),So(Q,z,lh,12),So(Q,z,Bc,18),So(Q,z,Gc,24),So(Q,z,Xh,30),Yg(G,m.aNormal),Wp(G,c)}else if(M){M.value=2;var c=G.getParameter(G.COLOR_CLEAR_VALUE);G.clearColor(0,0,0,0),G.disable(G.BLEND),z._95I(G,m,M),Mb(z,M),Go(z,z._polylineModelMap,M),Go(z,z._wireframeModelMap,M),De(G,m.uTransparent,!0),z._95I(G,m,M,!0),Mb(z,M,!0),Go(z,z._polylineModelMap,M,!0),Go(z,z._wireframeModelMap,M,!0),De(G,m.uTransparent,!1),G.clear(G.DEPTH_BUFFER_BIT),z._swapLineMap(),z._95I(G,m,M,!1,!0),Go(z,z._polylineModelMap,M),Go(z,z._wireframeModelMap,M),z._swapLineMap(),z._swapLineMap(),z._95I(G,m,M,!1,!0),Go(z,z._polylineModelMap,M),Go(z,z._wireframeModelMap,M),De(G,m.uTransparent,!0),z._95I(G,m,M,!0,!0),Go(z,z._polylineModelMap,M,!0),Go(z,z._wireframeModelMap,M,!0),De(G,m.uTransparent,!1),z._swapLineMap(),G.disable(G.DEPTH_TEST),z.drawFilter||z._30O._42(G,m,M),G.enable(G.DEPTH_TEST),Wp(G,c)}else G.disable(G.BLEND),z.drawSky(G,m),z._31O._42(G,m),z._95I(G,m),Mb(z),Go(z,z._polylineModelMap),Go(z,z._wireframeModelMap),G.enable(G.BLEND),De(G,m.uTransparent,!0),G.depthMask(!1),z._95I(G,m,Y,!0),Mb(z,Y,!0),Go(z,z._polylineModelMap,Y,!0),Go(z,z._wireframeModelMap,Y,!0),G.depthMask(!0),De(G,m.uTransparent,!1),G.clear(G.DEPTH_BUFFER_BIT),z._swapLineMap(),G.disable(G.BLEND),z._95I(G,m,Y,!1,!0),Go(z,z._polylineModelMap),Go(z,z._wireframeModelMap),G.enable(G.BLEND),De(G,m.uTransparent,!0),G.depthMask(!1),z._95I(G,m,Y,!0,!0),Go(z,z._polylineModelMap,Y,!0),Go(z,z._wireframeModelMap,Y,!0),G.depthMask(!0),De(G,m.uTransparent,!1),z._swapLineMap(),G.disable(G.DEPTH_TEST),G.disable(G.BLEND),z._32O._42(G,m),z._30O._42(G,m),z._highlightHelper._42(G,m),G.enable(G.DEPTH_TEST);Uk(G,Y),sq(G,Y)},w=!1,P=T*I,H=_*I,n=z.vr;n.enable&&n._42(G,P,H,F)&&(w=!0);var E=z.envRenderer;E&&E.enable&&E._42(G,P,H,F)&&(w=!0);var r=z._postProcessing;r._42(G,P,H,F,h)&&(w=!0),w||(z.setViewport(G,0,0,T*I,_*I),F()),z._33Q=!1,z._doBufferGC(G)}}},enablePostProcessing:function(S,i){return this._postProcessing.enableModule(S,i)},getPostProcessingModule:function(r){return this._postProcessing.getModule(r)},setViewport:function(U,T,e,Z,z){this._viewport=[T,e,Z,z],U.viewport(T,e,Z,z)},getViewport:function(){return this._viewport},setBufferGCInterval:function(C){this._bufferGCInterval=C},_doBufferGC:function(F,t){var g,r,K=F._bufPool,W=0,B=0,U=F._renderInfo.frame,A=this._bufferGCInterval||10;for(g in K)W++,r=K[g],r&&(t||U-r._fid>A?(F.deleteBuffer(r._buf),r._buf=null,K[g]=null):B++);if(W/2>B&&W>128){var k={};for(g in K)K[g]&&(k[g]=K[g]);F._bufPool=k}F._validBufCount=B},_swapLineMap:function(){var o=this;w=o._polylineModelMap,o._polylineModelMap=o._polylineModelMapSwap,o._polylineModelMapSwap=w,w=o._wireframeModelMap,o._wireframeModelMap=o._wireframeModelMapSwap,o._wireframeModelMapSwap=w,w=o._polylineIndexMap,o._polylineIndexMap=o._polylineIndexMapSwap,o._polylineIndexMapSwap=w,w=o._wireframeIndexMap,o._wireframeIndexMap=o._wireframeIndexMapSwap,o._wireframeIndexMapSwap=w},_updateSkyBox:function(P){if(this._skyBox&&P){var e=P.property,Z=!1,W=this._skyBox;if("eye"===e||"forceUpdate"===e){var I=this._eye;W.p3(I[0],I[1],I[2]),Z=!0}if("near"===e||"far"===e||"forceUpdate"===e){var a=this._near,E=this._far,R=W.getFinalScale3d();if(R[0]/=2,R[1]/=2,R[2]/=2,R[0]<=a||R[0]>=E||R[1]<=a||R[1]>=E||R[2]<=a||R[2]>=E){var $=2*a*E/(a+E),s=Math.min(R[0],R[1],R[2]),j=$/s,K=W.getScale3d();W.setScale3d(K[0]*j,K[1]*j,K[2]*j),Z=!0}}Z&&this.invalidateData(W)}},setSkyBox:function(d){var y=this._skyBox;y&&this._skyBoxStyleMap&&(y.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null),this._skyBox=d,this.ump(this._updateSkyBox,this),d&&(d.dm()&&d.dm().remove(d),this._skyBoxStyleMap=C.Default.clone(d.getStyleMap()),d.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBox,this),this._updateSkyBox({property:"forceUpdate"})),this.fp("skyBox",y,d)},drawSky:function(R,D,C){var F=this,G=F._skyBox;if(G){var L=F._headlightIntensity,W=lg(F._headlightColor),D=F._prg;1!==L&&(W=[W[0]*L,W[1]*L,W[2]*L]),De(R,D.uHeadlightColor,[W[0],W[1],W[2],1]);var T=F.getData3dUI(G);T&&T._42(R,D,C,function(){return!0}),R.clear(R.DEPTH_BUFFER_BIT),De(R,D.uHeadlightColor,[W[0],W[1],W[2],F._headlightDisabled?1:0])}},_95I:function(Q,n,Z,Y,N){function p(r){if(!!r.s("shape3d.alwaysOnTop")==!!N&&$.isVisible(r)&&(!K||v)){if(!Z&&$.isTransparentMask(r))return;var X=$.getData3dUI(r);X&&X._42(Q,n,Z,l)}}var $=this,l=function(L){return Y?L:!L};$.sky&&Q.clear(Q.DEPTH_BUFFER_BIT);var J=$.drawFilter;J?$.dm().each(function(I){J(I)||p(I)}):$.dm().each(function(y){p(y)})},getLogicalPoint:function(L){return Zr(L,this._canvas)},isRectOverlapping:function(g){var T=this.getData3dUI(g);return T._rectOverlapping},getHitFaceInfo:function(k){k.target&&(k=this.lp(k));var R=this.getDataInfoAt(k);if(R){var g=this._1o.face(R.data,bn(k.x,k.y));if(g)return{data:R.data,face:g}}return Y},unproject:function(p,o){var X=this,J=X.getWidth(),c=X.getHeight(),w=p.target?X.lp(p):p,z=w.x-J/2,e=w.y-c/2,M=2*(z/J),N=2*(-1*e/c);o=o||0;var k=ck(),$=Lr(X),S=yp(X);Xi(k,$,S),Qi(k);var T=Ej([M,N,o,1],k);return[T[0]/T[3],T[1]/T[3],T[2]/T[3]]},getDataAt:function(e){var R=this.getDataInfoAt(e);return R?R.data:Y},getDataInfoAt:function(b,M){return b.target&&(b=this.lp(b)),this._1o.get(bn(b.x,b.y,M),!0)},getDatasInRect:function(p){return this._1o.get(p)},setEditable:function(K){var u=this,I=u._editable;u._editable=K,this.fp(Jq,I,K)},isEditable:function(j){var F=this;return F._editable?fr(j)?j.s("3d.editable")?F._editableFunc?F._editableFunc(j):!0:!1:!1:!1},isSelectable:function(Z){return Z.s("3d.selectable")&&this.sm().isSelectable(Z)},isMovable:function(G){var k=this;return ad(G)&&G.getStyle(_r)!==Ap?!1:G.s("3d.movable")?k._movableFunc?k._movableFunc(G):!0:!1},isSizeEditable:function(P){return fr(P)?this._sizeEditableFunc?this._sizeEditableFunc(P):!0:!1},isRotationEditable:function(e){return fr(e)&&e.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(e):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(g){this.setZoom(Nj,g)},zoomOut:function(z){this.setZoom(1/Nj,z)},setZoom:function(M,d){if(1!==M){var A=this;if(A._ortho)return A.setOrthoZoom(M,d),void 0;A._14o&&A._14o.stop(!0);var $=1/M,P=A._eye,b=A._center,R=b[0]+(P[0]-b[0])*$-P[0],Q=b[1]+(P[1]-b[1])*$-P[1],t=b[2]+(P[2]-b[2])*$-P[2];if(!(Qf(P,b)<A._moveStep&&1>$)){if(d=Zj(d)){var y=aq(P);return d.action=function(i){A.fi({kind:A._zooming?"betweenZoom":"beginZoom"}),A._zooming=1,P[0]=y[0]+R*i,P[1]=y[1]+Q*i,P[2]=y[2]+t*i,A.fp(Cj,Y,P)},d._37o=function(){delete A._14o,delete A._zooming,A.fi({kind:"endZoom"}),A.onZoomEnded()},A._14o=kg(d)}P[0]+=R,P[1]+=Q,P[2]+=t,A.fp(Cj,Y,P)}}},setOrthoZoom:function(i,j){if(1!==i){var W=this;W._14o&&W._14o.stop(!0);var k=W._orthoWidth,J=k/i-k;if(!(k<W._moveStep&&i>1))return(j=Zj(j))?(j.action=function(v){W.fi({kind:W._zooming?"betweenZoom":"beginZoom"}),W._zooming=1,W.setOrthoWidth(k+J*v)},j._37o=function(){delete W._14o,delete W._zooming,W.fi({kind:"endZoom"}),W.onZoomEnded()},W._14o=kg(j)):(W.setOrthoWidth(k/i),void 0)}},getPositionInfo:function(_){var $=this,v=$._eye,r=$._center,o=$.getAspect(),x=_?sp(Lh(r,v,!0),Lh(_,v)):Qf(v,r);if($._ortho){var V=$._orthoWidth;return{length:x,height:V/o,width:V}}var b=2*G($._fovy/2)*x;return{length:x,height:b,width:b*o}},getCenterInfo:function(){var I=this;return I._81O||(I._81O=I.getPositionInfo()),aq(I._81O)},rotate:function(H,E,P,C){var D=this;if(H||E){C==Y&&(C=D._firstPersonMode),D._88O&&D._88O.stop(!0);var O=D._center,q=D._eye,l=D.getCenterInfo().length,F=C?O:q,N=C?q:O,p=Lh(F,N),o=d(p[0],p[2]),g=d(i(p[0]*p[0]+p[2]*p[2]),p[1]),$=C?fg:Cj;return C&&(E=-E),(P=Zj(P))?(P.action=function(m){D.fi({kind:D._rotating?"betweenRotate":"beginRotate"}),D._rotating=1;var j=o+H*m,s=g+E*m;s=md(s),p[0]=l*c(s)*c(j),p[1]=l*T(s),p[2]=l*c(s)*T(j),F[0]=N[0]+p[0],F[1]=N[1]+p[1],F[2]=N[2]+p[2],D.fp($,Y,F)},P._37o=function(){delete D._88O,delete D._rotating,D.fi({kind:"endRotate"}),D.onRotateEnded()},D._88O=kg(P)):(o+=H,g+=E,g=md(g),p[0]=l*c(g)*c(o),p[1]=l*T(g),p[2]=l*c(g)*T(o),F[0]=N[0]+p[0],F[1]=N[1]+p[1],F[2]=N[2]+p[2],D.fp($,Y,F),void 0)}},pan:function(K,V,l,L){if(K||V){var N=this;L==Y&&(L=N._firstPersonMode),N._89O&&N._89O.stop(!0);var g=yp(N),c=[g[0]*K,g[4]*K,g[8]*K],j=[g[1]*V,g[5]*V,g[9]*V],P=c[0]+j[0],A=c[1]+j[1],m=c[2]+j[2],e=N._center,B=N._eye;if(L){var u=fo(N.getBoundaries(),B[0],B[2],B[0]+P,B[2]+m,i(P*P+m*m));P=u[0],m=u[1]}if(l=Zj(l)){var G=aq(B),x=aq(e);return l.action=function(u){N.fi({kind:N._panning?"betweenPan":"beginPan"}),N._panning=1,e[0]=x[0]+P*u,e[1]=x[1]+A*u,e[2]=x[2]+m*u,B[0]=G[0]+P*u,B[1]=G[1]+A*u,B[2]=G[2]+m*u,N.fp(Cj,Y,B),N.fp(fg,Y,e)},l._37o=function(){delete N._89O,delete N._panning,N.fi({kind:"endPan"}),N.onPanEnded()},N._89O=kg(l)}e[0]+=P,e[1]+=A,e[2]+=m,B[0]+=P,B[1]+=A,B[2]+=m,N.fp(Cj,Y,B),N.fp(fg,Y,e)}},walk:function(F,x,z){if(F){var A=this;z==Y&&(z=A._firstPersonMode),A._90O&&A._90O.stop(!0);var w=A._center,j=A._eye,J=Lh(w,j,!0);if(z){var M=fo(A.getBoundaries(),j[0],j[2],j[0]+J[0]*F,j[2]+J[2]*F,L(F));if(F=Qf(M),!F)return;J=[M[0]/F,0,M[1]/F]}if(x=Zj(x)){var S=aq(j),r=aq(w);return x.action=function(B){A.fi({kind:A._walking?"betweenWalk":"beginWalk"}),A._walking=1;var P=F*B;j[0]=S[0]+J[0]*P,j[1]=S[1]+J[1]*P,j[2]=S[2]+J[2]*P,w[0]=r[0]+J[0]*P,w[1]=r[1]+J[1]*P,w[2]=r[2]+J[2]*P,A.fp(Cj,Y,j),A.fp(fg,Y,w)},x._37o=function(){delete A._90O,delete A._walking,A.fi({kind:"endWalk"}),A.onWalkEnded()},A._90O=kg(x)}j[0]+=J[0]*F,j[1]+=J[1]*F,j[2]+=J[2]*F,w[0]+=J[0]*F,w[1]+=J[1]*F,w[2]+=J[2]*F,A.fp(Cj,Y,j),A.fp(fg,Y,w)}},handleScroll:function(w,_){w.preventDefault();var S=this,R=S._moveStep;
S.isFirstPersonMode()?S.isPannable()&&S.pan(0,_>0?R:-R):S.isZoomable()&&S.setZoom(0>_?1/yb:yb)},handlePinch:function(d,c){this.isZoomable()&&this.setZoom(c>d?1/$i:$i)},reset:function(){this.setCenter(k.graph3dViewCenter),this.setEye(k.graph3dViewEye),this.setUp(k.graph3dViewUp)},moveSelection:function(N,a,W){var x=this;x.dm().beginTransaction(),Dr(this.sm().toSelection(this.isMovable,this),N,a,W),x.dm().endTransaction()},getMoveMode:function(A,S){var X=S.s("3d.move.mode");if(X)return X;var b="88",J="89",v="90";return Bm(A)||ii[b]&&ii[J]&&ii[v]?"xyz":ii[b]&&ii[J]?"xy":ii[b]&&ii[v]?"xz":ii[J]&&ii[v]?"yz":ii[b]?"x":ii[J]?"y":ii[v]?"z":"xz"},handleTick:function(){var U=this,E=!1,c=U._moveStep,r=c,T=!1,A=!0,$=U._rotateStep*(A?-1:1);if(U.isWalkable()||(r=0),U.isPannable()||(c=0),U.isRotatable()||($=0),U._32Q){var H=(Pe()-U._32Q)/50;r*=H,c*=H,$*=H}U._31Q&&(ic(U._31Q),delete U._31Q,delete U._32Q),Kj()&&(E=!0,U.pan(-c,0,T,A)),ts()&&(E=!0,U.pan(c,0,T,A)),Ib()&&(E=!0,Bm()?U.pan(0,c,T,A):U.walk(r,T,A)),Cn()&&(E=!0,Bm()?U.pan(0,-c,T,A):U.walk(-r,T,A)),Ml()&&(E=!0,U.rotate(-$,0,T,A)),Tb()&&(E=!0,U.rotate($,0,T,A)),Kb()&&(E=!0,U.rotate(0,-$/2,T,A)),Db()&&(E=!0,U.rotate(0,$/2,T,A)),E&&(U._32Q=Pe(),U._31Q=an(U.handleTick,U))},handleKeyDown:function(X){var w=this;!En(X)&&Yr[X.keyCode]?w.handleTick():Lq(X)?w.selectAll():gq(X)?w.handleDelete(X):Qg(X)&&this.isResettable()&&w.reset()},checkDoubleClickOnNote:function(n,$,C){var O=this;if(C===Di){if($.s("note.toggleable"))return $.s(Pi,!$.s(Pi)),O.fi({kind:"toggleNote",event:n,data:$,part:C}),!0}else if(C===pi&&$.s("note2.toggleable"))return $.s(kf,!$.s(kf)),O.fi({kind:"toggleNote2",event:n,data:$,part:C}),!0;return!1},checkDoubleClickOnRotation:function(z,y,m){return m===Zk?(y.setRotationX(0),!0):m===zn?(y.setRotationY(0),!0):m===Pk?(y.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(Z){var f=this;if(f.isOrtho())return f.getWidth()/f.getOrthoWidth();var n=f.getCenter(),g=f.getHeight(),P=f.getEye(),z=[n[0]-P[0],n[1]-P[1],n[2]-P[2]],e=[Z[0]-P[0],Z[1]-P[1],Z[2]-P[2]],x=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]),s=1/Math.tan(f.getFovy()/2);return g*x*s/(e[0]*z[0]+e[1]*z[1]+e[2]*z[2])},inViewSpace:function(f){var h,L=this,E=L._transformPointToViewSpace(f),y=L.getAspect(),O=L.getNear(),K=L.getFar();return-E[2]<O||-E[2]>K?!1:L.isOrtho()?(h=L.getOrthoWidth()/2,Math.abs(E[0])<=h&&Math.abs(E[1]*y)<=h):(h=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])*Math.tan(L.getFovy()/2),Math.abs(E[1]<=h)&&Math.abs(E[0])<=h*y)},toViewPosition:function(r){var P=this,C=P.getWidth()/2,p=P.getHeight()/2,B=P._18Q;return B&&B._wh===C/p||(B=Lr(P),P._18Q=Xi(B,B,yp(P)),P._18Q._wh=C/p),r=Ej([r[0],r[1],r[2],1],B),{x:C+C*r[0]/r[3],y:p-p*r[1]/r[3]}},getHitPosition:function(u,n,W){var p=this,V=p.getWidth(),U=p.getHeight(),S=u.target?p.lp(u):u,z=S.x-V/2,o=S.y-U/2,c=p.getCenterInfo(),v=yp(p);n=n?n:[0,0,0],W=W?W:[0,1,0],z=z/V*c.width,o=-1*o/U*c.height;var Y=[v[0]*z,v[4]*z,v[8]*z],D=[v[1]*o,v[5]*o,v[9]*o],N=[Y[0]+D[0],Y[1]+D[1],Y[2]+D[2]],g=p.getCenter(),L=hk(p,n,W,[N[0]+g[0],N[1]+g[1],N[2]+g[2]]);return L?L:[0,0,0]},intersectObject:function(D,V){return this._raycaster.intersectObject(D,V)},intersectObjects:function(I,k,p){return this._raycaster.intersectObjects(I,k,p)},getLineLength:function(g){this.validate();var p=this.getData3dUI(g);if(p&&p.getCache){var w=p.getCache();if(w)return w[w.length-1].length}return 0},getLineOffset:function(O,F){var J=this.getData3dUI(O);if(J&&J.getCache){var h=J.getCache();if(h)return ue(h,F)}return Y},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(m,Z,s){var L=this,H=L.getEye();H=[H[0],H[1],H[2]];var I=L.getCenter();if(I=[I[0],I[1],I[2]],m||(m=H),Z||(Z=I),L._flyAnim&&L._flyAnim.stop(!0),s=Zj(s),!s)return L.setEye(m[0],m[1],m[2]),L.setCenter(Z[0],Z[1],Z[2]),delete L._flyAnim,!0;var i=[m[0]-H[0],m[1]-H[1],m[2]-H[2]],g=[Z[0]-I[0],Z[1]-I[1],Z[2]-I[2]];return s.action=function(D){L.setCenter(I[0]+g[0]*D,I[1]+g[1]*D,I[2]+g[2]*D),L.setEye(H[0]+i[0]*D,H[1]+i[1]*D,H[2]+i[2]*D)},s._37o=function(){delete L._flyAnim},L._flyAnim=kg(s)},flyTo:function(){function N(r,b,F){if(F instanceof C.Node){X.fromArray(Hg(F,b.getMat(F)));var O=F.getAnchor3d();r.push((new _m).set(0-O.x,0-O.y,0-O.z).applyMatrix4(X)),r.push((new _m).set(0-O.x,0-O.y,1-O.z).applyMatrix4(X)),r.push((new _m).set(0-O.x,1-O.y,0-O.z).applyMatrix4(X)),r.push((new _m).set(0-O.x,1-O.y,1-O.z).applyMatrix4(X)),r.push((new _m).set(1-O.x,0-O.y,0-O.z).applyMatrix4(X)),r.push((new _m).set(1-O.x,0-O.y,1-O.z).applyMatrix4(X)),r.push((new _m).set(1-O.x,1-O.y,0-O.z).applyMatrix4(X)),r.push((new _m).set(1-O.x,1-O.y,1-O.z).applyMatrix4(X))}}var o=new _m,H=new _m,L=new _m,l=new _m,X=new jh,y=new C.Math.Quaternion,D=new ec;return function(g,S,e){var q=this;if(e!==P)S={animation:S,ratio:e};else{var W=typeof S;("boolean"===W||"object"===W&&S.duration)&&(S={animation:S})}S=S||{},o.fromArray(q.getEye()),H.fromArray(q.getCenter());var n,i,a=[],f=S.center,G=S.distance===P;if(f&&L.fromArray(f),g instanceof C.Node)f||L.fromArray(g.p3()),G&&(N(a,q,g),n=a.length);else{if(g||(g=q.dm().getDatas()),!g.length)return;if((G||!f)&&(a=[],g.forEach(function(G){N(a,q,G)}),n=a.length),!n)return;if(!f){for(L.set(0,0,0),i=0;n>i;i++)L.add(a[i]);L.multiplyScalar(1/n)}}if(q.setCenter(L.x,L.y,L.z),l.subVectors(o,H),S.direction||S.worldDirection){!S.worldDirection&&g instanceof C.Node?y.setFromEuler(D.set(g.r3(),g.getRotationMode(),!0)):y.set(0,0,0,1);var U=l.length();l.fromArray(S.worldDirection||S.direction).applyQuaternion(y).setLength(U)}if(G){for(var Y,F,X,t,w,v=q.getNear(),O=10,e=S.ratio||.8;O--;){for(q._eye[0]=l.x+L.x,q._eye[1]=l.y+L.y,q._eye[2]=l.z+L.z,Y=Lr(q),Xi(Y,Y,yp(q)),t=!0,w=-1/0,i=0;n>i;i++){if(X=a[i],F=Ej([X.x,X.y,X.z,1],Y),F[3]<v&&O){l.multiplyScalar(2),t=!1;break}w=Math.max(w,Math.max(Math.abs(F[0]),Math.abs(F[1]))/e-F[3])}if(t)break}l.setLength(w+l.length()).add(L)}else l.setLength(S.distance).add(L);q._flyAnim&&q._flyAnim.stop(!0);var A=Zj(S.animation);if(A){q.setEye(o.x,o.y,o.z),q.setCenter(H.x,H.y,H.z);var r=(new _m).subVectors(l,o),E=(new _m).subVectors(L,H),Q=new _m,h=new _m;return A.action=function(Y){Q.copy(o).addScaledVector(r,Y),h.copy(H).addScaledVector(E,Y),q.setCenter(h.x,h.y,h.z),q.setEye(Q.x,Q.y,Q.z)},A._37o=function(){delete q._flyAnim},{lastEye:o,lastCenter:H,eye:l,center:L,animation:q._flyAnim=kg(A)}}return q.setEye(l.x,l.y,l.z),delete q._flyAnim,{lastEye:o,lastCenter:H,eye:l,center:L}}}(),getBoundingBox:function(){function $(x,j,$){U.fromArray(Hg($,j.getMat($)));var S=$.getAnchor3d();x.push((new _m).set(0-S.x,0-S.y,0-S.z).applyMatrix4(U)),x.push((new _m).set(0-S.x,0-S.y,1-S.z).applyMatrix4(U)),x.push((new _m).set(0-S.x,1-S.y,0-S.z).applyMatrix4(U)),x.push((new _m).set(0-S.x,1-S.y,1-S.z).applyMatrix4(U)),x.push((new _m).set(1-S.x,0-S.y,0-S.z).applyMatrix4(U)),x.push((new _m).set(1-S.x,0-S.y,1-S.z).applyMatrix4(U)),x.push((new _m).set(1-S.x,1-S.y,0-S.z).applyMatrix4(U)),x.push((new _m).set(1-S.x,1-S.y,1-S.z).applyMatrix4(U))}var U=new jh;return function(E){if(E=E||this.sm().getSelection(),E instanceof C.Node&&(E=[E]),0===E.length)return Y;var F=[];E.forEach(function(u){$(F,this,u)},this);var o=[1/0,1/0,1/0],B=[-1/0,-1/0,-1/0];return F.forEach(function(t){o[0]=Math.min(t.x,o[0]),o[1]=Math.min(t.y,o[1]),o[2]=Math.min(t.z,o[2]),B[0]=Math.max(t.x,B[0]),B[1]=Math.max(t.y,B[1]),B[2]=Math.max(t.z,B[2])}),{min:o,max:B}}}()}),bp.RenderEnv=function(X){this.gv=X,this.enable=!1},$.defineProperties(bp.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(d){this._debugOn=d,this.capture&&this.capture()}}}),$.assign(bp.RenderEnv.prototype,{renderEnvToCube:function(w,u,t,F){var L=this,T=L.gv;if(!w||!u||!t)return L.enable=!1,L._42=null,void 0;L.enable=!0;var g=Math.floor(F/w*u),X=T.getGL(),e=L._renderTargets;e?e.length<t&&(e=L._renderTargets=e.concat(new Array(t-e.length))):e=L._renderTargets=new Array(t);for(var D=0;t>D;D++)e[D]?e[D].setSize(X,F,g):e[D]=new bp.RenderTarget(T,X,F,g);var b=!1;L.capture=function(){b=!0,T._42(),b=!1};var c=new _m,P=new _m,q=new _m,A=new _m,Q=(new _m).setY(0),I=2*Math.PI/t,x=w/2/Math.tan(Math.PI/t),y=2*Math.atan2(u/2,x),n=w/u;L._42=function(H,j,k,Y){var Z=L._debugOn;if(!b&&!Z)return!1;c.copy(T.getEye()),A.copy(T.getCenter()).sub(c);var i=Math.atan2(A.z,A.x),E=T.getNear(),a=T.getFovy(),g=T.getAspect();P.copy(T.getCenter());for(var W,N=0;t>N;N++)if(W=e[N],Q.setZ(Math.cos(i)).setX(Math.sin(i)).multiplyScalar(x),i-=I,q.addVectors(c,Q),T.setNear(x),T.setCenter([q.x,q.y,q.z]),T.setFovy(y),T.setAspect(n),Z){var K=Math.round(j/t);H.viewport(K*N,0,K,k),Y()}else Ti(H,W.frame),H.viewport(0,0,W.width,W.height),H.clear(H.COLOR_BUFFER_BIT),Y(),Zf(H),W.assureTexture();return T.setNear(E),T.setCenter([P.x,P.y,P.z]),T.setFovy(a),T.setAspect(g),!0},L.capture()},getTextureInfo:function(T){var U=this._renderTargets;if(!U)return null;var W=this._renderTargets[T];return W?{index:T,texture:W.texture,textureName:W.uuid}:null}}),$.assign(bp.Graph3dView.prototype,{renderEnvToCube:function(f,S,s,w){var Q=this;Q.envRenderer||(Q.envRenderer=new bp.RenderEnv(Q)),Q.envRenderer.renderEnvToCube(f,S,s,w)}}),bp.RenderTarget=function(m,H,s,G,M){var X=this;M=M||{},X.uuid=C.Math.generateUUID(),X.gv=m,X.init(m,H,M),X.setSize(H,s,G)},$.assign(bp.RenderTarget.prototype,{init:function(F,N,c){var l=this,k=l.texture=N.createTexture();N.activeTexture(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,k),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,c.minFilter||N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,c.magFilter||N.LINEAR),N.bindTexture(N.TEXTURE_2D,null),l.render=N.createRenderbuffer(),l.frame=N.createFramebuffer(),F._2O[l.uuid]=k},assureTexture:function(){var o=this,f=o.uuid,z=o.gv._2O;z[f]||(z[f]=o.texture)},setSize:function($,V,P){var u=this;if(u.width!==V||u.height!==P){var v=$.RGBA,m=$.TEXTURE_2D,k=$.RENDERBUFFER,X=$.FRAMEBUFFER;Hr($,u.texture),$.texImage2D(m,0,v,V,P,0,v,$.UNSIGNED_BYTE,Y),$.bindRenderbuffer(k,u.render),$.renderbufferStorage(k,$.DEPTH_COMPONENT16,V,P),Ti($,u.frame),$.framebufferTexture2D(X,$.COLOR_ATTACHMENT0,m,u.texture,0),$.framebufferRenderbuffer(X,$.DEPTH_ATTACHMENT,k,u.render),Hr($,Y),$.bindRenderbuffer(k,Y),Zf($),u.width=V,u.height=P}},toCanvas:function(){var E=this,X=E.gv.getGL();Ti(X,E.frame);var d=E.width,k=E.height,z=new Uint8Array(4*d*k);X.readPixels(0,0,d,k,X.RGBA,X.UNSIGNED_BYTE,z),Zf(X);var u=H.createElement("canvas");u.width=d,u.height=k;var T=u.getContext("2d"),P=T.createImageData(d,k);return P.data.set(z),T.putImageData(P,0,0),u}});var bf=bp.Interactor=function(k){this.gv=k};Sd("Interactor",$,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var Nm=bp.DefaultInteractor=function(l){wj(Nm,this,[l])};Sd("DefaultInteractor",bf,{handle_contextmenu:function(w){vj(w)},handle_mousewheel:function(q){this.gv.handleScroll(q,q.wheelDelta/40)},handle_DOMMouseScroll:function(i){2===i.axis&&this.gv.handleScroll(i,-i.detail)},handle_keydown:function(T){this.gv.handleKeyDown(T)},handle_mousedown:function(T){this.handle_touchstart(T)},handle_touchstart:function(t){vj(t);var _=this,b=_.gv,z=Qe(t),i=b.getDataInfoAt(t),l=i?i.data:Y,u=i?i.part:Y,q=b.sm(),S=sj(t),c=Lc(t);b.setFocus(t)&&(_._62O=Y,_._57I=Y,l?En(t)?q.co(l)?q.rs(l):q.as(l):q.co(l)||q.ss(l):z&&(En(t)?b.isRectSelectable()&&(_._62O=Uj):_._57I=ih(t)),_._31Q&&(ic(_._31Q),delete _._31Q,delete _._32Q),_._62O||(b.isFirstPersonMode()&&(Bm(t)||c>2?_._62O="pan":b.isMouseRoamable()||hc?(_._62O="roaming",_.foward=S&&Qe(t),_._32Q=Pe(),_._31Q=an(_.tick,_)):z||(_._62O="roaming")),_._62O||(z&&S&&zg[u]?(_._62O=u,_.p3=l.p3()):z&&S&&fr(l)&&b.isSelected(l)?b.isMovable(l)?(_._62O="move",_.p3=l.p3(),_.movedata=l):b.isInteractive(l)&&(_._62O="none"):hc&&(c>2?_._62O="pan":2===c&&(_.dist=No(t),_._62O="pinch")))),_.point=b.lp(t),rc(_,t),Bs(t)?b.handleDoubleClick(t,l,u):b.handleClick(t,l,u))},tick:function(){var e=this,h=e.gv,G=h._moveStep;e.point&&h.isWalkable()&&(e._32Q&&(G*=(Pe()-e._32Q)/50),h.walk(e.foward?G:-G),e._32Q=Pe(),e._31Q=an(e.tick,e))},handle_mouseup:function(R){this.handle_touchend(R)},handle_touchend:function(d){var G=this._57I;G&&(Qf(G,ih(d))<=1&&this.gv.sm().cs(),this._57I=Y)},handleWindowMouseMove:function(f){this.handleWindowTouchMove(f)},handleWindowTouchMove:function(U){var c,C,v=this,k=v.gv,N=v._62O,j=v.point,E=k.dm(),a=k.lp(U),l=a.x-j.x,W=a.y-j.y,z=k.getWidth(),R=k.getHeight();if(z&&R){var V=-r*l/z,g=-r*W/R;if("roaming"===N)v.rotate(U,V/2,g/2);else if(N===Zk||N===zn||N===Pk)k._86O||E.beginTransaction(),k.fi({kind:k._86O?"betweenEditRotation":"beginEditRotation",event:U}),k._86O=1,k.sm().each(function(A){if(fr(A)&&k.isRotationEditable(A)){var l=L(V)>L(g)?V:g;N===Zk?A.setRotationX(A.getRotationX()+l):N===zn?A.setRotationY(A.getRotationY()+l):N===Pk&&A.setRotationZ(A.getRotationZ()+l)}});else if("move"===N||zg[N]){N===oo||N===Wc||N===Xl?(k._87O||E.beginTransaction(),k.fi({kind:k._87O?"betweenEditScale":"beginEditScale",event:U}),k._87O=1):(k._moving||E.beginTransaction(),k.fi({kind:k._moving?"betweenMove":"beginMove",event:U}),k._moving=1);var F,O=v.p3,e=k.getPositionInfo(O),I=yp(k);F=N===Bf?"x":N===Jk?"y":N===Om?"z":N===oo?"sx":N===Wc?"sy":N===Xl?"sz":k.getMoveMode(U,v.movedata),l=l/z*e.width,W=-1*W/R*e.height;var S,$,o=[I[0]*l,I[4]*l,I[8]*l],n=[I[1]*W,I[5]*W,I[9]*W],y=o[0]+n[0],h=o[1]+n[1],p=o[2]+n[2],X=[O[0]+y,O[1]+h,O[2]+p],B=Lh(k.getEye(),X,!0);if("xyz"===F?(S=X,k.moveSelection(y,h,p)):"xz"===F?(S=hk(k,O,[0,1,0],X),S&&k.moveSelection(S[0]-O[0],0,S[2]-O[2])):"xy"===F?(S=hk(k,O,[0,0,1],X),S&&k.moveSelection(S[0]-O[0],S[1]-O[1],0)):"yz"===F?(S=hk(k,O,[1,0,0],X),S&&k.moveSelection(0,S[1]-O[1],S[2]-O[2])):"x"===F||"sx"===F?(B[0]=0,S=hk(k,O,B,X),S&&($=S[0]-O[0],"x"===F?k.moveSelection($,0,0):k.sm().each(function(J){fr(J)&&k.isSizeEditable(J)&&(c=J.getScaleX()+$/100,C=c/J.getScaleX(),J.setScaleX(c),Bm(U)&&(J.setScaleY(J.getScaleY()*C),J.setScaleTall(J.getScaleTall()*C)))}))):"y"===F||"sy"===F?(B[1]=0,S=hk(k,O,B,X),S&&($=S[1]-O[1],"y"===F?k.moveSelection(0,$,0):k.sm().each(function(G){fr(G)&&k.isSizeEditable(G)&&(c=G.getScaleTall()+$/100,C=c/G.getScaleTall(),G.setScaleTall(c),Bm(U)&&(G.setScaleY(G.getScaleY()*C),G.setScaleX(G.getScaleX()*C)))}))):("z"===F||"sz"===F)&&(B[2]=0,S=hk(k,O,B,X),S&&($=S[2]-O[2],"z"===F?k.moveSelection(0,0,$):k.sm().each(function(W){fr(W)&&k.isSizeEditable(W)&&(c=W.getScaleY()+$/100,C=c/W.getScaleY(),W.setScaleY(c),Bm(U)&&(W.setScaleX(W.getScaleX()*C),W.setScaleTall(W.getScaleTall()*C)))}))),!S)return;v.p3=S}else if(N===Uj){var Y=v.div;Y||(Y=v.div=Aj(),Hb(v.getView(),Y),Y.op=j,Y.style.background=k.getRectSelectBackground()),k.fi({kind:k._rectSelecting?"betweenRectSelect":"beginRectSelect",event:U}),k._rectSelecting=1,Y.rect=ig(Y.op,a),dk(Y,Y.rect)}else if("pinch"===N&&2===Lc(U)){k.fi({kind:k._pinching?"betweenPinch":"beginPinch",event:U}),k._pinching=1;var $=No(U);k.handlePinch($,v.dist),v.dist=$}else"pan"===N||Bm(U)?v.pan(U,l,W):"none"===N||k.isFirstPersonMode()||(Qe(U)?v.rotate(U,V,g):(v.pan(U,l,0),k.isWalkable()&&(k.fi({kind:k._walking?"betweenWalk":"beginWalk",event:U}),k._walking=1,k.walk(W/k.getHeight()*k.getCenterInfo().height))));v.point=a}},pan:function(j,d,J){var c=this.gv;if(c.isPannable()){var T=c.getWidth(),m=c.getHeight();if(!T||!m)return;var Y=c.getCenterInfo(),Z=d/T*Y.width,u=-1*J/m*Y.height;c.fi({kind:c._panning?"betweenPan":"beginPan",event:j}),c._panning=1,c.pan(-Z,-u)}},rotate:function(n,y,A){var I=this.gv;I.isRotatable()&&(I.fi({kind:I._rotating?"betweenRotate":"beginRotate",event:n}),I._rotating=1,I.rotate(y,A))},handleWindowMouseUp:function(n){this.handleWindowTouchEnd(n)},handleWindowTouchEnd:function(J){var z=this,c=z.gv,I=c.dm(),u=z.div;if(u){var K=c.getDatasInRect(u.rect);if(!K.isEmpty()){var d=c.sm(),h=d.toSelection();K.each(function(z){d.co(z)?h.remove(z):h.add(z)}),d.ss(h)}rn(u)}c._moving&&(delete c._moving,c.fi({kind:"endMove",event:J}),c.onMoveEnded(),I.endTransaction()),c._panning&&(delete c._panning,c.fi({kind:"endPan",event:J}),c.onPanEnded()),c._rotating&&(delete c._rotating,c.fi({kind:"endRotate",event:J}),c.onRotateEnded()),c._86O&&(delete c._86O,c.fi({kind:"endEditRotation",event:J}),I.endTransaction()),c._87O&&(delete c._87O,c.fi({kind:"endEditScale",event:J}),I.endTransaction()),c._pinching&&(delete c._pinching,c.fi({kind:"endPinch",event:J}),c.onPinchEnded()),c._rectSelecting&&(delete c._rectSelecting,c.fi({kind:"endRectSelect",event:J}),c.onRectSelectEnded()),c._walking&&(delete c._walking,c.fi({kind:"endWalk",event:J}),c.onWalkEnded()),z.dist=z.point=z._62O=z.p3=z.movedata=z.div=z._57I=z._32Q=z._31Q=z.foward=Y}});var kd=bp.MapInteractor=function(d){wj(kd,this,[d]),this._minPhi=0,this._maxPhi=5*O/12,this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01};Sd("MapInteractor",bf,{handle_contextmenu:function(u){vj(u)},handle_mousewheel:function(B){this.gv.handleScroll(B,B.wheelDelta/40)},handle_DOMMouseScroll:function(c){2===c.axis&&this.gv.handleScroll(c,-c.detail)},handle_keydown:function(T){this.gv.handleKeyDown(T)},handle_mousedown:function(d){this.handle_touchstart(d)},handle_touchstart:function(K){vj(K);var a=this,Z=a.gv;if(Z.setFocus(K)){Z.lp(K);var x=Z.getDataInfoAt(K),T=x?x.data:Y,o=x?x.part:Y;if(!T||!Z.isInteractive(T)){var u=a.editing={point:Z.lp(K)};hc?u.touch=!0:(u.touch=!1,u.pan=Qe(K)),rc(a,K)}Bs(K)?Z.handleDoubleClick(K,T,o):Z.handleClick(K,T,o)}},handle_mouseup:function(K){this.handle_touchend(K)},handle_touchend:function(){},handleWindowMouseMove:function(O){this.handleWindowTouchMove(O)},handleWindowTouchMove:function($){var X=this,T=X.gv,q=X.editing;if(q){var s=T.lp($),p=q.point,C=s.x-p.x,e=s.y-p.y;if(!q.moved){if(Math.abs(C)<X.threshold&&Math.abs(e)<X.threshold&&!($.touches&&$.touches.length>1))return;q.moved=!0}if(q.point=s,q.touch){var J=$.touches.length;if(2!==J)X.pan($,C,e);else{if(1>=J)return;var L=$.touches,z={x:L[0].clientX,y:L[0].clientY},t={x:L[1].clientX,y:L[1].clientY},A={x:t.x-z.x,y:t.y-z.y},d=q.lastCenter,H=Math.atan2(A.y,A.x),w=q.theta,h=0;w==Y?w=q.theta=H:(h=H-w,q.thetaStarted||Math.abs(h)>X.touchRotateThreshold?(q.thetaStarted=!0,q.theta=H):h=0);var K=O*(z.y+t.y)/2/T.getHeight(),y=q.phi,D=0;y==Y?y=q.phi=K:(D=K-y,q.phiStarted||Math.abs(D)>X.touchRotateThreshold?(q.phiStarted=!0,q.phi=K):D=0);var N,u=Math.sqrt(A.x*A.x+A.y*A.y),k=q.vlen;if(k){var R=z.x-d.x,M=z.y-d.y,j=t.x-d.x,B=t.y-d.y,c=Math.sqrt(R*R+M*M),Z=Math.sqrt(j*j+B*B),n=k/2,P=X._sign2(c-n),g=X._sign2(Z-n);0>P*g||0===P&&0===g?(N=1,q.vlen=u):(N||(N=u/k),q.scaleStarted||Math.abs(N-1)>X.touchScaleThreshold?(q.vlen=u,q.scaleStarted=!0):N=1)}else k=q.vlen=u,N=1;1!==N&&T.setZoom(N),(D||h)&&X.rotate($,h,-D),q.lastCenter={x:(t.x+z.x)/2,y:(t.y+z.y)/2}}}else if(q.pan)X.pan($,C,e);else{var F=T.getWidth(),i=T.getHeight();if(!F||!i)return;var a=-r*C/F,l=-r*e/i;X.rotate($,a,l)}}},_sign2:function(Z){return Math.abs(Z)<this._touchScaleCheckAccuracy?0:Z>0?1:-1},handleWindowMouseUp:function(n){this.handleWindowTouchEnd(n)},handleWindowTouchEnd:function(a){var R=this,e=R.editing;if(R.editing=null,e){var Y=R.gv;if(!e.moved&&e.pan){var p=Y.getDataAt(a);p?Y.sm().setSelection([p]):Y.sm().clearSelection()}else Y._panning=null,Y._rotating=null,Y.fi({kind:e.pan?"endPan":"endRotate",event:a})}},pan:function(g,y,o){var m=this,C=m.gv;if(C.isPannable()){var S=C.getWidth(),O=C.getHeight();if(S&&O){var V=C.getCenterInfo(),A=-y/S*V.width,f=1*o/O*V.height;C.fi({kind:C._panning?"betweenPan":"beginPan",event:g}),C._panning=1;var G=m.keepHorizon,R=m.editing.touch;if((R&&g.touches&&g.touches.length>1||!R&&Bm(g))&&(G=!G),!G)return C.pan(A,f);if(A||f){var T=yp(C),Q=[T[0]*A,T[4]*A,T[8]*A],j=[T[1],0,T[9]],p=Math.sqrt(j[0]*j[0]+j[2]*j[2]);p&&(j=[j[0]/p*f,0,j[2]/p*f]);var K=Q[0]+j[0],U=Q[1]+j[1],F=Q[2]+j[2],l=C._center,D=C._eye;l[0]+=K,l[1]+=U,l[2]+=F,D[0]+=K,D[1]+=U,D[2]+=F,C.fp(Cj,Y,D),C.fp(fg,Y,l)}}}},rotate:function(z,V,h){var $=this,p=$.gv;if(p.isRotatable()){var W=p._center,l=p._eye,m=Lh(l,W),k=d(i(m[0]*m[0]+m[2]*m[2]),m[1]),g=k+h;g=Math.max($.minPhi,Math.min($.maxPhi,g)),h=g-k,p.fi({kind:p._rotating?"betweenRotate":"beginRotate",event:z}),p._rotating=1,p.rotate(V,h)}}}),$.defineProperties(kd.prototype,{minPhi:{get:function(){return this._minPhi},set:function(E){this._minPhi=E}},maxPhi:{get:function(){return this._maxPhi},set:function(_){this._maxPhi=_}},keepHorizon:{get:function(){return this._keepHorizon},set:function(Q){this._keepHorizon=Q}},threshold:{get:function(){return this._threshold},set:function(n){this._threshold=n}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(h){this._touchScaleThreshold=h}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(W){this._touchRotateThreshold=W}}});var nb=function(R){this.gv=R};jq(nb,$,{_iv:!0,iv:function(){this._iv=!0},face:function(C,O){var L=this,h=L.gv.getGL();if(!h||!fr(C))return Y;var Z=O.x,R=O.width,x=O.height,M=L.height-O.y-x,X=s(R/2),Q=new Uint8Array(4*R*x),_=0;for(L.iv(),L.validate(C),Ti(h,L.frame),h.readPixels(Z,M,R,x,h.RGBA,h.UNSIGNED_BYTE,Q),Zf(h),L.iv();X>=_;_++)for(var N=X-_,t=X+_,S=N;t>=S;S++)for(var q=N;t>=q;q++)if(S===N||S===t||q===N||q===t){var o=ds.m[Q[4*(S*R+q)]];if(o)return o}},get:function(j,g){this.validate();var G=this,U=G.gv.getGL();if(!U)return Y;var p,c,l=j.x,d=j.width,L=j.height,q=G.height-j.y-L,O=s(d/2),R=new Uint8Array(4*d*L),m=0,K=R.length,Z=g?Y:new rp,$=g?Y:{};if(Ti(U,G.frame),U.readPixels(l,q,d,L,U.RGBA,U.UNSIGNED_BYTE,R),Zf(U),g){for(;O>=m;m++)for(var Q=O-m,f=O+m,n=Q;f>=n;n++)for(var D=Q;f>=D;D++)if((n===Q||n===f||D===Q||D===f)&&(p=G.info(R,4*(n*d+D))))return p}else for(;K>m;m+=4)p=G.info(R,m),p&&(c=p.data,$[c._id]||(Z.add(c),$[c._id]=c));return Z},info:function(c,B){return this.colorMap[(c[B]<<16)+(c[B+1]<<8)+c[B+2]+((127&c[B+3])<<24)]},validate:function(b){var Q=this,o=Q.gv,T=o.getGL();if(T){var A=o.getWidth(),H=o.getHeight(),t=T.RGBA,F=T.TEXTURE_2D,R=T.RENDERBUFFER,v=T.FRAMEBUFFER;Q.texture||(Q.texture=Zb(T),Q.render=T.createRenderbuffer(),Q.frame=T.createFramebuffer()),(Q.width!==A||Q.height!==H)&&(Hr(T,Q.texture),T.texImage2D(F,0,t,A,H,0,t,T.UNSIGNED_BYTE,Y),vk(T,T.TEXTURE_MIN_FILTER,T.LINEAR),T.bindRenderbuffer(R,Q.render),T.renderbufferStorage(R,T.DEPTH_COMPONENT16,A,H),Ti(T,Q.frame),T.framebufferTexture2D(v,T.COLOR_ATTACHMENT0,F,Q.texture,0),T.framebufferRenderbuffer(v,T.DEPTH_ATTACHMENT,R,Q.render),Hr(T,Y),T.bindRenderbuffer(R,Y),Zf(T),Q.width=A,Q.height=H),Q._iv&&(Q._iv=!1,Ti(T,Q.frame),o._42(b||(Q.colorMap={}),1),Zf(T))}}});var Ql=function(S){this.gv=S};jq(Ql,$,{gap:0,size:0,_42:function(h,V){var H=this,L=H.gv,m=L._gridGap,w=L._gridSize;if(L._gridVisible){if(H.gap!==m||H.size!==w){for(var n=[],u=L._gridSize/2,x=m*u,O=0;2*u+1>O;O++){var j=6*O,z=6*(2*u+1)+j;n[j]=-x,n[j+1]=0,n[j+2]=-x+O*m,n[j+3]=x,n[j+4]=0,n[j+5]=-x+O*m,n[z]=-x+O*m,n[z+1]=0,n[z+2]=-x,n[z+3]=-x+O*m,n[z+4]=0,n[z+5]=x}H.vs=new Ve(n),H.gap=m,H.size=w}Do(L),gs(h,V),Qm(h),Fm(h,V,1,L._gridColor,L._buffer.vs,H.vs),Cl(h,0,H.vs.length/3,h.LINES),Fd(h),op(h,V)}else H.vs=H.gap=H.size=Y}});var Kp=function(v){this.gv=v};jq(Kp,$,{_42:function(C,$){var Z=this.gv,n=Z._buffer.vs,R=Z._axisXColor,e=Z._axisYColor,_=Z._axisZColor,N=Z._originAxisVisible,S=Z._centerAxisVisible;if(N||S){var m=Q?C.TRIANGLES:C.TRIANGLE_FAN,I=C.LINES;if(Do(Z),gs(C,$),Qm(C),N){var x=Z.getCenterInfo(),y=D(x.width,x.height)/5,s=.8*y,V=.05*y;Fm(C,$,1.5,R,n,new Ve([0,0,0,y,0,0,s,V,0,s,0,V,s,-V,0,s,0,-V,s,V,0,0,0,0,0,y,0,V,s,0,0,s,V,-V,s,0,0,s,-V,V,s,0,0,0,0,0,0,y,V,0,s,0,V,s,-V,0,s,0,-V,s,V,0,s])),Cl(C,0,2,I),Cl(C,1,6,m),Fm(C,$,Y,e),Cl(C,7,2,I),Cl(C,8,6,m),Fm(C,$,Y,_),Cl(C,14,2,I),Cl(C,15,6,m)}if(S){var r=Z._center,j=r[0],J=r[1],f=r[2],x=Z.getPositionInfo(r);y=D(x.width,x.height)/20,Fm(C,$,1.5,R,n,new Ve([j,J,f,j+y,J,f,j,J,f,j,J+y,f,j,J,f,j,J,f+y])),Cl(C,0,2,I),Fm(C,$,Y,e),Cl(C,2,2,I),Fm(C,$,Y,_),Cl(C,4,2,I)}Fd(C),op(C,$)}}});var Oh=function(G){this.gv=G,this.onMouseOver=this.onMouseOver.bind(this),this.mode=2};Oh.Mode={Disable:0,Selection:1,MouseOver:2},jq(Oh,$,{onMouseOver:function(J){k.preventDefault(J);var o=this.gv.getDataAt(J);o!==this.mouseOverData&&(this.mouseOverData=o,this.gv.iv())},setFetchTargetFunc:function(Z){this.fetchTargetFunc=Z},_42:function($,Z){var c,N=this,q=N._mode;if(q!==Oh.Mode.Disable&&(q===Oh.Mode.Selection?c=N.gv.sm().getSelection().toArray():q===Oh.Mode.MouseOver&&N.mouseOverData&&(c=[N.mouseOverData]),N.fetchTargetFunc&&(c=N.fetchTargetFunc(c)),c&&c.length)){var p=N.gv,h=p.vr.isPresenting(),C=p.getWidth();if(h){var M=p.getWidth;C/=2,p.getWidth=function(){return C};var l=p.getViewport()}var F,b=p.getDevicePixelRatio(),W=C*b,d=p.getHeight()*b;(F=N._renderTarget)?F.setSize($,W,d):N._renderTarget=F=new bp.RenderTarget(p,$,W,d),Ti($,F.frame),p.drawFilter=function(E){return c.indexOf(E)<0?!0:void 0},p._42({}),p.drawFilter=null,Zf($),h&&(p.getWidth=M,p.setViewport($,l[0],l[1],l[2],l[3])),N.shader||(N.shader=new ik.Shader($,db.vs,db.fs));var n=N.shader;if(N.shader.bind(),$.enable($.BLEND),$.activeTexture($.TEXTURE0+0),$.bindTexture($.TEXTURE_2D,F.texture),n.uniforms.image=0,n.uniforms.textureSize=[W,d],n.uniforms.edgeWidth=j["highlight.width"],N.highlightColor!==j["highlight.color"]){var L=fj(N.highlightColor=j["highlight.color"]);N.highlightColorData=[L[0]/255,L[1]/255,L[2]/255,L[3]/255]}n.uniforms.edgeColor=N.highlightColorData,N.ibuffer?(N.ibuffer.upload(),N.vbuffer.upload()):(N.ibuffer=ik.Buffer.createIndexBuffer($,new Uint16Array([0,2,1,1,2,3])),N.vbuffer=ik.Buffer.createVertexBuffer($,new Float32Array([0,0,1,0,0,1,1,1]))),n.attributes.pos.pointer(N.vbuffer),$.drawElements($.TRIANGLES,6,$.UNSIGNED_SHORT,0),$.disable($.BLEND),$.bindTexture($.TEXTURE_2D,null),$.useProgram(Z)}}}),$.defineProperties(Oh.prototype,{mode:{get:function(){return this._mode},set:function(G){var d=this._mode;G!==d&&(this._mode=G,G===Oh.Mode.MouseOver?this.gv.getView().addEventListener("mousemove",this.onMouseOver,!1):d===Oh.Mode.MouseOver&&this.gv.getView().removeEventListener("mousemove",this.onMouseOver))}}});var db={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},Nd=function(b){this.gv=b},Bf="edit_tx",Jk="edit_ty",Om="edit_tz",Zk="edit_rx",zn="edit_ry",Pk="edit_rz",oo="edit_sx",Wc="edit_sy",Xl="edit_sz",zg={};zg[Bf]=1,zg[Jk]=1,zg[Om]=1,zg[Zk]=1,zg[zn]=1,zg[Pk]=1,zg[oo]=1,zg[Wc]=1,zg[Xl]=1,jq(Nd,$,{_42:function(x,w,e){var n=this,g=n.gv,Y=g.sm().ld();if(Y&&g.isEditable(Y)&&!g.isEditHelperDisabled()&&fr(Y)&&(!g.isFirstPersonMode()||!g.isMouseRoamable()&&!hc)){Do(g);var h,s,T=g.isMovable(Y),L=g.isRotationEditable(Y),C=g.isSizeEditable(Y),M=g._axisXColor,_=g._axisYColor,X=g._axisZColor,p=g._editSizeColor,Q=Y.p3(),S=Qf(g.getEye(),Q)/10,U=S/(e?5:10),b=.7*S,v=.4*b,j=Q[0],R=Q[1],z=Q[2];h=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],T&&n._17O(x,w,Y,e,Bf,M,h,[j,R-U,z,j+b,R-U,z,j+b,R,z,j+b,R,z,j,R,z,j,R-U,z,j,R-U,z+U,j+b,R-U,z+U,j+b,R-U,z,j+b,R-U,z,j,R-U,z,j,R-U,z+U]),s=j+b,C&&n._17O(x,w,Y,e,oo,p,h,[s,R-U,z,s+v,R-U,z,s+v,R,z,s+v,R,z,s,R,z,s,R-U,z,s,R-U,z+U,s+v,R-U,z+U,s+v,R-U,z,s+v,R-U,z,s,R-U,z,s,R-U,z+U]),s+=v,L&&n._17O(x,w,Y,e,Zk,M,h,[s,R-U,z,s+v,R-U,z,s+v,R,z,s+v,R,z,s,R,z,s,R-U,z,s,R-U,z+U,s+v,R-U,z+U,s+v,R-U,z,s+v,R-U,z,s,R-U,z,s,R-U,z+U]),h=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],T&&n._17O(x,w,Y,e,Jk,_,h,[j,R,z,j,R+b,z,j-U,R+b,z,j-U,R+b,z,j-U,R,z,j,R,z,j,R,z,j,R,z-U,j,R+b,z-U,j,R+b,z-U,j,R+b,z,j,R,z]),s=R+b,C&&n._17O(x,w,Y,e,Wc,p,h,[j,s,z,j,s+v,z,j-U,s+v,z,j-U,s+v,z,j-U,s,z,j,s,z,j,s,z,j,s,z-U,j,s+v,z-U,j,s+v,z-U,j,s+v,z,j,s,z]),s+=v,L&&n._17O(x,w,Y,e,zn,_,h,[j,s,z,j,s+v,z,j-U,s+v,z,j-U,s+v,z,j-U,s,z,j,s,z,j,s,z,j,s,z-U,j,s+v,z-U,j,s+v,z-U,j,s+v,z,j,s,z]),h=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],T&&n._17O(x,w,Y,e,Om,X,h,[j,R,z,j,R,z+b,j,R-U,z+b,j,R-U,z+b,j,R-U,z,j,R,z,j,R-U,z,j-U,R-U,z,j-U,R-U,z+b,j-U,R-U,z+b,j,R-U,z+b,j,R-U,z]),s=z+b,C&&n._17O(x,w,Y,e,Xl,p,h,[j,R,s,j,R,s+v,j,R-U,s+v,j,R-U,s+v,j,R-U,s,j,R,s,j,R-U,s,j-U,R-U,s,j-U,R-U,s+v,j-U,R-U,s+v,j,R-U,s+v,j,R-U,s]),s+=v,L&&n._17O(x,w,Y,e,Pk,X,h,[j,R,s,j,R,s+v,j,R-U,s+v,j,R-U,s+v,j,R-U,s,j,R,s,j,R-U,s,j-U,R-U,s,j-U,R-U,s+v,j-U,R-U,s+v,j,R-U,s+v,j,R-U,s])}},_17O:function(i,y,U,o,g,m,S,V){var p=this.gv._buffer;gh(i,y,o,!0,U,g),js(i,y,Y,!0,Y,!0,Y,!1),De(i,y.uDiffuse,m),Uk(i,p.vs,new Ve(V),y.aPosition),Uk(i,p.ns,new Ve(S),y.aNormal),Qm(i),Cl(i,0,12),Fd(i),ve(i,y)}});var Cb=C.Raycaster=function(w){this.gv=w,this.maxTriangleTest=1/0};Lg("Raycaster",$,{intersect:function(W){var o=this,k=o.gv,G=k.getDataAt(W);return G?o.intersectObject(W,G):null},intersectObjects:function(x,o,h){var D,u,E,V,j=this,w=1/0,l=x.origin||(new _m).fromArray(j.gv.getEye()),J=j.maxTriangleTest,P=[];return o.forEach(function(g){h&&h(g)===!1||g.s("intersect")!==!1&&P.push(g)}),P.sort(function(d,q){return l.distanceToSquared2(d.p3())-l.distanceToSquared2(q.p3())}),j.countTriangles=0,P.forEach(function(a){j.countTriangles>J||(D=j.intersectObject(x,a),D&&(u=l.distanceToSquared(D.world),w>u&&(E=a,V=D,w=u)))}),j.countTriangles=0,{data:E,intersect:V}},intersectObject:function(A,_){if(A instanceof bi)return this._intersectObjectImpl(A,_);var e,V,p=this,d=p.gv;V=d.unproject(A);var j=d.getEye();d.isOrtho()?(e=Lh(d.getCenter(),j),e[0]+=e[0],e[1]+=e[1],e[2]+=e[2]):e=j,e=new _m(e);var n=new _m(V).sub(e).normalize(),Q=new C.Math.Ray(e,n);return p._intersectObjectImpl(Q,_)},_intersectObjectImpl:function(){function G(){var R=new _m;return R.subVectors(p,F),W.subVectors(N,F),R.cross(W).normalize(),R}function w(p,A,s,k,N,z,g){return Vd.barycoordFromPoint(p,A,s,k,S),N.multiplyScalar(S.x),z.multiplyScalar(S.y),g.multiplyScalar(S.z),N.add(z).add(g),N.clone()}var J=new jh,E=new jh,t=new bi,v=new _m,A=new _m,Z=new _m,V=new _m,Y=new _m,N=new _m,F=new _m,p=new _m,I=new xl,h=new xl,x=new xl,W=new _m,M={vs:Gh,is:ug,uv:$m},S=new _m;return function(u,y){var B=this.gv.getData3dUI(y),D=y.mat||B.mat;if(D){J.fromArray(D),E.getInverse(J),t.copy(u).applyMatrix4(E);var $,i,q="body",b=B.shapeModel;if(b||(b=Fl(B)),b||(y instanceof C.Node&&!(y instanceof C.Shape)?($=!0,b=M):(i=!0,b=[B.left,B.front,B.right,B.back,B.top,B.bottom])),!b)return console.log("Can not find shape model."),null;fk(b)||(b=[b]);var U,d,T,K,o,z,r,s,e,Q,X,O,a,W,k,c,R=1/0,m=["","top_","bottom_"],P=!1;for(U=0,d=b.length;d>U;U++)if(a=b[U])for(T=0,K=m.length;K>T;T++)if(W=m[T],r=a[W+"vs"],s=a[W+"is"],e=a[W+"uv"]||a[W+"tuv"],r){if(k=a[W+"boundingBox"]){var X=t.intersectBox(k);if(!X)continue;if(t.origin.distanceTo(X)>R)continue;c=!1}else a[W+"boundingBox"]=k=new C.Math.Box3,c=!0;for(o=0,z=s?s.length:r.length/3;z>o;o+=3)this.countTriangles++,s?(A.fromArray(r,3*s[o]),Z.fromArray(r,3*s[o+1]),V.fromArray(r,3*s[o+2])):(A.fromArray(r,3*o),Z.fromArray(r,3*(o+1)),V.fromArray(r,3*(o+2))),c&&(k.expandByPoint(A),k.expandByPoint(Z),k.expandByPoint(V)),Q=t.intersectTriangle(A,Z,V,!0,v),Q&&(O=t.origin.distanceTo(Q),R>O&&(R=O,Y.copy(Q),N.copy(A),F.copy(Z),p.copy(V),""!==W?q=W.slice(0,-1):$?q=ui[Math.floor(o/6)]:i&&(q=ui[U]),e&&(P=!0,s?(I.fromArray(e,2*s[o]),h.fromArray(e,2*s[o+1]),x.fromArray(e,2*s[o+2])):(I.fromArray(e,2*o),h.fromArray(e,2*(o+1)),x.fromArray(e,2*(o+2))))))
}if(!isFinite(R))return null;var j,f=Y.clone().applyMatrix4(J);P&&(j=w(Y,N,F,p,I,h,x));var S=G(N,F,p),l=G(N.applyMatrix4(J),F.applyMatrix4(J),p.applyMatrix4(J)),n=t.direction.dot(S);return n>0&&(S.multiplyScalar(-1),l.multiplyScalar(-1)),{world:f,local:Y.clone(),worldNormal:l,normal:S,uv:j,part:q}}}}()});var Wf=function(K,O){this.gv=K,this.s=function(A,U,h){return U==Y&&(U=h),U==Y?O.getStyle(A):hg(U,O,K)},this.data=O};jq(Wf,$,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(q,E,V,u){var P=this,c=P.data;if(!(c instanceof Ff)){var x,w,o,n,z,S,L,I=P.gv,H=c._id,l=P.s("shape3d.alwaysOnTop")?null:P.s("batch"),d=I._batchIndexMap,R=I._batchModelMap,m=I.isSelectable(c),Q=I.getBrightness(c),K=Q!=Y&&1!==Q;if(P.needValidate(q)){if(o=uq(d,R,c,l),P.validate(o,l?Mc[l]||cs:Y),o&&(n=d[H],z=n.size=o.vs.length/3-n.begin,L=o.rs))for(Q=K?Q:1,S=0;z>S;S++)L.push(Q);if(fr(c)){var C=I.getWireframeGeometry(c);if(C)Sm(I,c,C);else{var r=I.getWireframe(c);r&&Sm(I,c,r)}}P.labelInfo=P.label2Info=P.noteInfo=P.note2Info=P._38o=Y,P._24O(lb,"getLabel"),P._24O(Jl,"getLabel2"),P._26O(Di,"getNote"),P._26O(pi,"getNote2"),P._15O(),P.interactiveInfo=I.isInteractive(c)?{}:Y,P._iv=!1}K&&De(q,E.uBrightness,Q),De(q,E.uAlphaTest,P.s("alphaTest")),De(q,E.uUseEnvMap,c.s("envmap")?!0:!1),De(q,E.uReflectivity,c.s("envmap")||.01),w=gh(q,E,V,m,c,Tk),w&&(Kh(w,d[H],R),Kh(w,I._polylineIndexMap[H],I._polylineModelMap),Kh(w,I._wireframeIndexMap[H],I._wireframeModelMap)),d[H]||P._80o(q,E,u),I.isLabelVisible(c)&&((x=P.labelInfo)&&(gh(q,E,V,m,c,lb),P._28O(x,lb,u)),(x=P.label2Info)&&(gh(q,E,V,m,c,Jl),P._28O(x,Jl,u))),I.isNoteVisible(c)&&((x=P.noteInfo)&&(gh(q,E,V,m,c,Di),P._29O(x,Di,u)),(x=P.note2Info)&&(gh(q,E,V,m,c,pi),P._29O(x,pi,u))),(x=P._38o)&&P._99O(q,E,x,V,m,u),K&&De(q,E.uBrightness,1)}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return Mg},_80o:function(){},dispose:function(){},_calcAnchorMat:function(U){if(U.hasOwnProperty("_anchor")||U.hasOwnProperty("_anchorElevation")){var w=U.getAnchor3d(),W={x:w.x-.5,y:w.y-.5,z:w.z-.5},Q=ck();return vf(Q,[-W.x,-W.y,-W.z]),Q}},getBodyColor:function(M){var l=this.data,J=this.gv.getBodyColor(l);return J?J:M?l.getStyle(M):Y},_24O:function(x,N){var Z=this,W=Z.data,r=Z.gv,y=Z.s,L=r[N](W);if(L!=Y){var h=y(x+".scale"),I=y(x+".max"),f=Z[x+"Info"]={label:L,textureScale:y(x+".texture.scale"),color:r[N+"Color"](W),font:y(x+".font"),align:y(x+".align"),background:r[N+"Background"](W)},e=f.rect=Dc(f,L);I>0&&I<e.width&&(f.labelWidth=e.width,e.width=I),e.x=e.y=0,e.width*=h,e.height*=h,f.mat=Z._16O(y(x+".autorotate"),y(x+".position"),e,y(x+".face"),y(x+".t3"),y(x+".r3"),y(x+".rotationMode"));var t=e.width/2,g=e.height/2;f.vs=new Ve([-t,g,0,-t,-g,0,t,-g,0,t,g,0]),e.width/=h,e.height/=h}},_26O:function(V,R){var T=this,A=T.data,N=T.gv,y=T.s,J=N[R](A);if(J!=Y){var c=y(V+".scale"),u=this[V+"Info"]={note:J,textureScale:y(V+".texture.scale"),expanded:y(V+".expanded"),font:y(V+".font"),color:y(V+".color"),align:y(V+".align"),borderWidth:y(V+".border.width"),borderColor:y(V+".border.color"),background:N[R+"Background"](A)};if(u.expanded){var d=y(V+".max"),m=Dc(u,J);m.width+=6,m.height+=2,d>0&&d<m.width&&(u.labelWidth=m.width,m.width=d);var W={x:-m.width/2,y:-8-m.height,width:m.width,height:m.height+8}}else W={x:-6,y:-18,width:12,height:18};u.mat=T._16O(y(V+".autorotate"),y(V+".position"),Y,y(V+".face"),y(V+".t3"),y(V+".r3"),y(V+".rotationMode")),u.rect=W,1!==c&&(W=aq(W),W.x*=c,W.height*=c,W.y=-W.height,W.width*=c);var s=W.x,Z=W.y,I=W.width,B=W.height;u.vs=new Ve([s,-Z,0,s,-Z-B,0,s+I,-Z-B,0,s+I,-Z,0])}},_28O:function(J,z,W){if(W(this.s(z+".transparent"))){var Y=J.rect,u=J.textureScale,j=Y.width*u,x=Y.height*u;if(j>=1&&x>=1){var O=Ph(j,x);1!==u&&(O.translate(O,Y.x,Y.y),O.scale(u,u),O.translate(O,-Y.x,-Y.y)),qd(O,J),O.restore(),Sr(this,z,J.mat,J.vs,!0)}}},_29O:function(Q,h,W){if(W(this.s(h+".transparent"))){var L=Q.rect,X=Q.textureScale,I=L.x,s=L.y,e=L.width*X,c=L.height*X;if(e>=1&&c>=1){L.x=L.y=0;var n=Ph(e,c);1!==X&&n.scale(X,X),pk(n,Q),n.restore(),L.x=I,L.y=s,Sr(this,h,Q.mat,Q.vs,!1)}}},_99O:function(g,D,l,S,w,J){if(l){var v=this,Q=v.gv,H=v.data,c=Q._buffer,e=Q._1O,U=l.icons;for(var $ in U){var N=U[$],m=l.rects[$];if(m&&J(hg(N.transparent,H,Q))){gh(g,D,S,w,H,$);var n=hg(N.shape3d,H,Q),B=n?[n]:hg(N.names,H,Q),K=B?B.length:0,a=hg(N.textureScale,H,Q)||1,d=hg(N.light,H,Q);d==Y&&(d=n?!0:!1),js(g,D,hg(N.blend,H,Q),d,hg(N.opacity,H,Q),hg(N.reverseFlip,H,Q),hg(N.reverseColor,H,Q),hg(N.reverseCull,H,Q));for(var E=0;K>E;E++){var s=B[E],t=m[E];if(jo(v,t.mat),n)me(Q,H,Fl(v,n),v);else{var R=km(s);if(R){var h=t.width*a,r=t.height*a;if(h>=1&&r>=1){var k=Ph(h,r);Cq(k,R,hg(N.stretch,H,Q),0,0,h,r,H,Q),k.restore(),Zb(g,kc,e),Qm(g,D,e,hg(N.discardSelectable,H,Q),c.uv,lf),Uk(g,c.vs,t.vs,D.aPosition),th(g,c.ns,li,D.aNormal),bq(g,c.is,Ze),ee(g,0,Ze.length),Fd(g,D,e)}}}Xm(Q)}ve(g,D)}}}}});var Dm=function(T,d){wj(Dm,this,[T,d])};jq(Dm,Wf,{_16O:function(_,h,V,Y,$,m,z,Z,W){var K=this.data,U=K.getFinalScale3d(),b=_p(h,U,V,Y,Z,W);if(K.hasOwnProperty("_anchor")||K.hasOwnProperty("_anchorElevation")){var Q=K.getAnchor3d();b[0]-=(Q.x-.5)*U[0],b[1]-=(Q.y-.5)*U[1],b[2]-=(Q.z-.5)*U[2]}return er(ck(),b,K.p3(),Y,$,m,z,_,K.getFinalRotation3d(),K.getRotationMode())},clear:function(){var w=this;w.faceMat=w.mat=w.shapeModel=w.left=w.right=w.front=w.back=w.top=w.bottom=w.csg=Y},needValidate:function(s){if(this._iv)return this._validateFrameId=s._renderInfo.frame,!0;if(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var b=s._renderInfo.frame;if(this._validateFrameId!==b)return this._validateFrameId=b,!0}return!1},validate:function(K,e){var g=this,A=g.gv,d=g.data,L=Fl(g);g._updateAutoRotation(),g._updateFixSize2d(),g._updateOverlapping(),(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen"))&&(ll(A,d,"_wireframeModelMap","_wireframeIndexMap"),ll(A,d,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var B=Hg(d,A.getMat(d),L?g.s("shape3d.scaleable"):!0),u=g._calcAnchorMat(d);if(u&&Xi(B,B,u),d.mat=B,g.clear(),K){var s=[];L?Tn(A,d,L,g,g.getBodyColor(),[B],K,s):(qb(A,d,K,e,B,wp,s,ek),qb(A,d,K,e,B,lh,s,Fc),qb(A,d,K,e,B,Gc,s,fb),qb(A,d,K,e,B,Xh,s,Km),qb(A,d,K,e,B,Wh,s,Uf),qb(A,d,K,e,B,Bc,s,pb)),s.length&&(ob(K.vs,s),ob(K.ns,Dk(s)))}else g.mat=B,(g.shapeModel=L)||(g._cubeUvs=null,g.vf(wp,0),g.vf(lh,16),g.vf(Wh,8),g.vf(Bc,24),g.vf(Gc,32),g.vf(Xh,40))},_updateAutoRotation:function(){var y=new ec;return function(){var i=this,A=i.data,X=i.s("shape3d.autorotate");if(!X)return A._dynamicRotation&&delete A._dynamicRotation,void 0;var l,o=i.gv;l="string"==typeof X?[X.indexOf("x")<0?o._eye[0]:o._center[0],X.indexOf("y")<0?o._eye[1]:o._center[1],X.indexOf("z")<0?o._eye[2]:o._center[2]]:o._eye;var T=o._center,g=A.p3(),f=vd([g[0]+l[0]-T[0],g[1]+l[1]-T[1],g[2]+l[2]-T[2]],g,o._up),F=A.r3();y.set(0,0,0,A.getRotationMode(),!0).setFromRotationMatrix(f),Math.abs(F[0]-y.x)<1e-5&&Math.abs(F[1]-y.y)<1e-5&&Math.abs(F[2]-y.z)<1e-5||(A._dynamicRotation=[y.x,y.y,y.z])}}(),_updateFixSize2d:function(){var u=this,K=u.data,g=u.s("shape3d.fixSizeOnScreen");if(!g)return K._dynamicScale3d&&delete K._dynamicScale3d,void 0;var T=u.gv;K.getFinalScale3d();var s=Hg(K,T.getMat(K)),i=uh([0,0,0],s),H=T.toViewPosition(i);if(!isNaN(H.x)&&!isNaN(H.y)){var h=uh([1,0,0],s),w=T.toViewPosition(h),z=uh([0,1,0],s),I=T.toViewPosition(z),L=w.x-H.x,Y=I.y-H.y,q=K._dynamicScale3d||[1,1,1],P=km(K.s("shape3d.image")),O=g[0]>0?g[0]:P?re(P,u):20,M=g[1]>0?g[1]:P?dp(P,u):20,y=Math.abs(L/O),d=Math.abs(Y/M);Math.abs(y-1)<.001&&Math.abs(d-1)<.001||(K._dynamicScale3d=[q[0]/y,q[1]/d,q[2]])}},_updateOverlapping:function(){var N=this,e=N.s("hide.overlapping.group");if(!e)return N._rectOverlapping&&(N._rectOverlapping=P),void 0;var A,L,K,Y=N.gv,q=N.data,b=Hg(q,Y.getMat(q)),i=1/0,s=1/0,X=-1/0,v=-1/0,C=q.getAnchor3d(),x=C.x,G=C.y,m=C.z;for(A=0;8>A;A++){if(L=uh([(A>>2)-x,(1&A>>1)-G,(1&A)-m],b),K=Y.toViewPosition(L),isNaN(K.x)||isNaN(K.y))return;i=Math.min(i,K.x),X=Math.max(X,K.x),s=Math.min(s,K.y),v=Math.max(v,K.y)}var r={x:i,y:s,w:X-i,h:v-s};N._rectOverlapping=Y.overlappingBox.isOverlapping(e,r)},getVectorDynamicSize:function(){var $,M=this,l=M.s("shape3d"),j=M.data;if("billboard"===l||"plane"===l||($=j._currentCubeElementId)!=Y){var m,r,x=M.gv,K=Hg(j,x.getMat(j)),A=j.getAnchor3d(),g=.5-A.x,d=.5-A.y,c=.5-A.z,B=M.s("shape3d.vector.dynamic.maxsize"),u=function(s,e){s[0]+=g,s[1]+=d,s[2]+=c,e[0]+=g,e[1]+=d,e[2]+=c;var v=x.toViewPosition(uh(s,K)),w=x.toViewPosition(uh(e,K)),D=v.x-w.x,q=v.y-w.y;return Math.min(B,Math.sqrt(D*D+q*q))};if("billboard"===l)m=u([-.5,0,0],[.5,0,0]),r=u([0,-.5,0],[0,.5,0]);else if("plane"===l)m=u([-.5,0,0],[.5,0,0]),r=u([0,0,-.5],[0,0,.5]);else if(j._currentCubeElementId!=Y){var z=3*ug[$+1],X=3*ug[$],O=3*ug[$+2];m=u([Gh[z],Gh[z+1],Gh[z+2]],[Gh[O],Gh[O+1],Gh[O+2]]),r=u([Gh[z],Gh[z+1],Gh[z+2]],[Gh[X],Gh[X+1],Gh[X+2]])}return[m,r]}},getCachedTexture:function(){var D=this,u=D.data,O=u._currentCubeElementId;return O!=Y?D._cubeCachedImage?D._cubeCachedImage[O]:null:D._shape3dCachedImage},setCachedTexture:function(D){var K=this,O=K.data,x=O._currentCubeElementId;if(x!=Y){if(!K._cubeCachedImage)return K._cubeCachedImage={};K._cubeCachedImage[x]=D}else K._shape3dCachedImage=D},invalidateCachedTexture:function(H){var F,W,$,x=this;if(($=x._shape3dCachedImage)&&(H.deleteTexture($),x._shape3dCachedImage=null),W=x._cubeCachedImage){for(F in W)H.deleteTexture(W[F]);x._cubeCachedImage=null}},vf:function(M,g){var z=this;if(z.gv.getFaceVisible(z.data,M)){var s=zm(z,M);s.mat&&(z.faceMat=!0);var r=s.uv;if(r){var B=z._cubeUvs;B||(B=z._cubeUvs=new Ve([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var L=0;8>L;L++)B[g+L]=r[L]}return s}},_80o:function(m,J,L){var l=this;if(l._rectOverlapping)return!0;var R=l.gv,V=l.data,j=R._cube,I=l.shapeModel;Do(R,l.mat),I?me(R,V,I,l,l.getBodyColor(),L):(Uk(m,j.vs,Y,J.aPosition),Uk(m,j.ns,Y,J.aNormal),sq(m,j.is),l._18O(m,J,l.left,0,L),l._18O(m,J,l.front,6,L),l._18O(m,J,l.right,12,L),l._18O(m,J,l.back,18,L),l._18O(m,J,l.top,24,L),l._18O(m,J,l.bottom,30,L)),Xm(R),l.faceMat&&(l._18O(m,J,l.left,0,L,!0),l._18O(m,J,l.front,6,L,!0),l._18O(m,J,l.right,12,L,!0),l._18O(m,J,l.back,18,L,!0),l._18O(m,J,l.top,24,L,!0),l._18O(m,J,l.bottom,30,L,!0))},_18O:function(e,f,O,R,G,q){if(O){if(!G(O.transparent))return;if(q&&!O.mat||!q&&O.mat)return;q&&Do(this.gv,O.mat);var n=this,c=n.data;c._currentCubeElementId=R;var x=n.gv,P=x.getTexture(O.texture,c),o=O.uv,V=O.uvScale,j=O.uvOffset,i=O.discardSelectable;P?o?Qm(e,f,P,i,x._buffer.uv,n._cubeUvs,j,V):Qm(e,f,P,i,x._cube.uv,Y,j,V):Qm(e),js(e,f,O.blend,O.light,O.opacity,O.reverseFlip,O.reverseColor,O.reverseCull),De(e,f.uDiffuse,O.color),ee(e,R,6),ve(e,f),Fd(e,f,P),q&&Xm(x),c._currentCubeElementId=null}}});var gp=function(T,g){wj(gp,this,[T,g])};jq(gp,Wf,{_25Q:1,validate:function(B){var Z=this,P=Z.gv,I=Z.data,U=Z.s,E=U("edge.width"),y=I._40I,V=I._41I;if(Z.shapeModel=Z.info=Y,y&&V){var e,A,N,H,F,f,S,g,z,R,q=I.isLooped(),K=U(_r),J=k.getEdgeType(K);if(J){var n=J(I,hj(Z,P,I,q,K),P,Z._19Q);if(!n.points||n.points.isEmpty())return;f=Z.info={},S=n.segments,F=n.points,g=F.size();for(var v=y.getElevation(),x=V.getElevation(),o=0;g>o;o++){var u=F.get(o);u.e==Y&&(u.e=v+(x-v)*o/(g-1))}z=jp(F.get(0)),R=jp(F.get(g-1));var t=g%2;0===t?(f.c1=jp(F.get(g/2-1)),f.c2=jp(F.get(g/2))):f.p3=jp(F.get((g-t)/2)),f.s1=z,f.s2=jp(F.get(1)),f.t1=jp(F.get(g-2)),f.t2=R}else{F=new rp,f=Z.info={};var Q=U("edge.offset"),a=U("edge.center"),M=U("edge.source.t3"),$=U("edge.target.t3"),s=y.p3(),r=V.p3();if(M&&(s[0]+=M[0],s[1]+=M[1],s[2]+=M[2]),$&&(r[0]+=$[0],r[1]+=$[1],r[2]+=$[2]),K===Ap){S=U("edge.segments");var h=f.points=U(Hj)||Ah;if(g=h.size()){z=jp(h.get(0)),R=jp(h.get(g-1)),!a&&Q&&(N=Lh(z,s,!0),Q=D(Q,Qf(s,z)),s=[s[0]+N[0]*Q,s[1]+N[1]*Q,s[2]+N[2]*Q],N=Lh(r,R,!0),Q=D(Q,Qf(R,r)),r=[r[0]-N[0]*Q,r[1]-N[1]*Q,r[2]-N[2]*Q]);var t=g%2;0===t?(e=jp(h.get(g/2-1)),A=jp(h.get(g/2))):f.p3=jp(h.get((g-t)/2)),f.s1=s,f.s2=z,f.t1=R,f.t2=r}else!a&&Q&&(N=Lh(r,s,!0),H=Qf(s,r),Q=os(Q,H),s=[s[0]+N[0]*Q,s[1]+N[1]*Q,s[2]+N[2]*Q],r=[r[0]-N[0]*Q,r[1]-N[1]*Q,r[2]-N[2]*Q]),e=s,A=r;F.add({x:s[0],y:s[2],e:s[1]}),F.addAll(h),F.add({x:r[0],y:r[2],e:r[1]})}else{var G=hj(Z,P,I,q,K);if(Z._19Q||(G=-G),q){var O=s[0],X=s[1],W=s[2],l=y.getTall()/2+G;e=[O-G,X+l,W],A=[O+G,X+l,W],F.add({x:O-G,y:W,e:X}),F.add({x:O-G,y:W,e:X+l}),F.add({x:O+G,y:W,e:X+l}),F.add({x:O+G,y:W,e:X})}else{N=Lh(r,s,!0),H=Qf(s,r);var _={x:s[0],y:s[2]},m={x:r[0],y:r[2]},L=ps(Y,_,m,G),p=L.x-_.x,C=L.y-_.y;Q=os(Q,H),N[0]*=Q,N[1]*=Q,N[2]*=Q,e=[s[0]+N[0]+p,s[1]+N[1],s[2]+N[2]+C],A=[r[0]-N[0]+p,r[1]-N[1],r[2]-N[2]+C],a?(F.add({x:s[0],y:s[2],e:s[1]}),F.add({x:e[0],y:e[2],e:e[1]}),F.add({x:A[0],y:A[2],e:A[1]}),F.add({x:r[0],y:r[2],e:r[1]})):(F.add({x:e[0],y:e[2],e:e[1]}),F.add({x:A[0],y:A[2],e:A[1]}))}}f.c1=e,f.c2=A}f.list=U(Ep)===Eg?Z.createTubeModel(F,S,E/2,B):Z.createLineModel(F,S,E,"edge","edge.dash")}}});var Ek=function(A,G){wj(Ek,this,[A,G])};jq(Ek,Dm,{_80o:function(R,T,f){var g=this,J=g.gv,e=g.shapeModel;Do(J,g.mat),e?me(J,g.data,e,g,g.getBodyColor(),f):(Kd(g,R,T,g.left,f),Kd(g,R,T,g.front,f),Kd(g,R,T,g.right,f),Kd(g,R,T,g.back,f),Kd(g,R,T,g.top,f),Kd(g,R,T,g.bottom,f)),Xm(J)},validate:function($,i){var h,n,E=this,k=E.s,Q=E.data,U=Q.p3(),w=Q._thickness/2,e=Q.isClosePath(),t=Q.getPoints(),c=Q.getSegments(),S=k(im),F=$&&$.uv;if(E.clear(),0>w)n=E.shapeModel=fh(t,c,k(dg),k(qs),S,k(Fk),Q.getTall(),Q.getShapeElevation(),e),k(Pm)?k("shape3d.image")||delete n.uv:(delete n.vs,delete n.ns,delete n.uv),k("shape3d.top.image")||delete n.top_uv,k("shape3d.bottom.image")||delete n.bottom_uv;else if(k(Ep)===Eg)h=om(t,c,S,e),n=E.shapeModel={vs:[]},k("shape3d.image")&&(n.uv=[],n.sum=k(Fk)||Um(h)||1,n.len=0),k(dg)&&!e&&(n.top_vs=[],k("shape3d.top.image")&&(n.top_uv=[])),k(qs)&&!e&&(n.bottom_vs=[],k("shape3d.bottom.image")&&(n.bottom_uv=[])),E._12O(h,w);else{var M,b,l,N,m,u,C,r,V,J;if(h=om(t,c,S,e),m=E.vf(Wh,F,!1,i),w&&(u=E.vf(Bc,F,!1,i),C=e?Y:E.vf(wp,F,!1,i),r=e?Y:E.vf(lh,F,!1,i),V=E.vf(Gc,F,!1,i),J=E.vf(Xh,F,!1,i)),w){for(var d=0,I=h.length;I>d;d++)h[d]=E._tryRemoveBezierPoints(h[d],w);E._12O(h,w)}else m&&h.forEach(function(n){if(N=n.length,N>0)for(M=n[0],l=1;N>l;l++)b=n[l],E.addV(m.vs,M,b),M=b});E._20Q(h),$||(m&&(m.ns=Dk(m.vs),Lp(m,"vs"),Lp(m,$d)),w&&(u&&(u.ns=Dk(u.vs),Lp(u,"vs"),Lp(u,$d)),C&&(C.ns=Dk(C.vs),Lp(C,"vs"),Lp(C,$d)),r&&(r.ns=Dk(r.vs),Lp(r,"vs"),Lp(r,$d)),V&&(V.ns=Dk(V.vs),Lp(V,"vs"),Lp(V,$d)),J&&(J.ns=Dk(J.vs),Lp(J,"vs"),Lp(J,$d))))}var A=E.mat=ck();vf(A,U),ud(A,Q.getFinalRotation3d(),Q.getRotationMode());var x=Q.getScale3d(),f=Q._dynamicScale3d;f&&(x[0]*=f[0],x[1]*=f[1],x[2]*=f[2]),bc(A,x),vf(A,Nh(U)),$&&(ae(E,A,$,n),E.clear())},_20Q:function(M){var p,c,x,U,$,y,A,O=this,u=O.front,b=O.back,d=O.top,h=O.bottom,I=u?u.tuv:Y,t=b?b.tuv:Y,w=d?d.tuv:Y,i=h?h.tuv:Y,n=0;(I||t||w||i)&&(p=O.s(Fk)||Um(M)||1,M.forEach(function(E){if(c=E.length,c>0)for(y=E[0],x=1;c>x;x++)A=E[x],U=n/p,n+=Qf(y,A),$=n/p,O._14O(u,U,$),O._14O(b,1-$,1-U),O._14O(d,U,$),O._14O(h,U,$),y=A}))},_14O:function(h,y,d){if(h){var n=h.uv,b=h.tuv;if(b){if(n)var c=n[0]+(n[6]-n[0])*y,U=n[1]+(n[7]-n[1])*y,C=n[2]+(n[4]-n[2])*y,A=n[3]+(n[5]-n[3])*y,E=n[2]+(n[4]-n[2])*d,x=n[3]+(n[5]-n[3])*d,g=n[0]+(n[6]-n[0])*d,e=n[1]+(n[7]-n[1])*d;else c=y,U=0,C=y,A=1,E=d,x=1,g=d,e=0;b.push(C,A,E,x,g,e,g,e,c,U,C,A)}}},_13O:function(n){var E=n.uv,j=n.tuv;j&&(E?j.push(E[2],E[3],E[4],E[5],E[6],E[7],E[6],E[7],E[0],E[1],E[2],E[3]):j.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(H,G){var l=H.length;if(4>l)return H;var f,b,W,N,J,d,I=!1,P=function(u){return H[u]},O=function(L){return H[l-1-L]};for(J=0;1>=J;J++)for(d=J?O:P,b=d(0),W=d(1),f=2;l-1>f;f++)if(N=d(f),!N.remove)if(N.b){var A=ps(b,W,N,G);A.adjust?(N.remove=!0,I=!0):(b=W,W=N)}else b=W,W=N;if(!I)return H;var c=[];for(f=0;l>f;f++)H[f].remove||c.push(H[f]);return c},_12O:function(V,i){var z,x,p,N,P,l=this;V.forEach(function(g){if(P=g.length,P>0)for(z={p:g[0],n:!0},N=1;P>N;N++)x=g[N],p=P-1>N?g[N+1]:Y,l.addPoint(z,x,p,i,g)})},addPoint:function(H,X,S,N,D){var O,$,z,P,e,n,Z,f,L,x=this,V=H.p,t=H.f,k=H.b,K=x.s("shape3d.side")||Kk,B=x.s("shape3d.start.angle"),I=x.s("shape3d.sweep.angle"),W=x.shapeModel,m=x.data.isClosePath();if(H.n&&(H.n=!1,t=m&&D.length>2?ps(D[D.length-2],V,X,N):ps(Y,V,X,N),k=zp(V,t),W?W.top_vs&&x._10O(k,t,K,B,I,W.top_vs,W.top_uv):(O=x.left)&&(x.addV(O.vs,k,t),x._13O(O))),$=S?ps(V,X,S,N):m&&D.length>2?ps(V,X,D[1],N):ps(V,X,Y,N),z=zp(X,$),W){var l,u,i=W.vs,j=W.uv,F=W.sum;for(j&&(l=W.len/F,W.len+=Qf(V,X),u=W.len/F),n=x._9O(k,t,K,B,I),Z=x._9O(z,$,K,B,I),f=0;K>f;f++)L=f+1,ob(i,n[L]),ob(i,Z[f]),ob(i,n[f]),ob(i,Z[f]),ob(i,n[L]),ob(i,Z[L]),j&&(P=f/K,e=L/K,j.push(l,e,u,P,l,P,u,P,l,e,u,e));!S&&W.bottom_vs&&x._10O(z,$,K,B,I,W.bottom_vs,W.bottom_uv,!0)}else!S&&(O=x.right)&&(x.addV(O.vs,$,z),x._13O(O)),(O=x.front)&&x.addV(O.vs,t,$),(O=x.back)&&x.addV(O.vs,z,k),(O=x.top)&&x.addH(O.vs,t,$,z,k,!0),(O=x.bottom)&&x.addH(O.vs,k,z,$,t);H.p=X,H.f=$,H.b=z},_10O:function(d,O,Q,v,m,Z,e,P){var t,U,J=this,y=J.data,L=J._9O(d,O,Q,v,m),W=(d.x+O.x)/2,k=(d.y+O.y)/2,n=y.getShapeElevation(),_=0;for(_=0;Q>_;_++)P?(ob(Z,L[_]),ob(Z,L[_+1])):(ob(Z,L[_+1]),ob(Z,L[_])),ob(Z,[W,n,k]),e&&(P?(t=r*(_+1)/Q+v,U=r*_/Q+v):(t=r*_/Q+v,U=r*(_+1)/Q+v),e.push(.5-.5*T(U),.5-.5*c(U),.5-.5*T(t),.5-.5*c(t),.5,.5))},_9O:function(o,U,s,i,t){var u,m,p=this,b=p.data,k=[],P=(o.x+U.x)/2,A=(o.y+U.y)/2,d=b.getTall()/2,Y=b.getShapeElevation(),F=0;for(t=t||r;s>=F;F++)u=t*F/s+i,m=T(u),k.push([P+(o.x-P)*m,Y+d*c(u),A+(o.y-A)*m]);return k},addV:function(g,n,i){var w=n.x,j=n.y,G=i.x,y=i.y,c=this.data,b=c.getShapeElevation(),M=c.getTall()/2;g.push(w,b-M,j,G,b-M,y,G,b+M,y,G,b+M,y,w,b+M,j,w,b-M,j)},addH:function(G,f,S,e,Q,k){var j=this.data,u=j.getTall()/2,L=j.getShapeElevation()+(k?u:-u);G.push(f.x,L,f.y,S.x,L,S.y,e.x,L,e.y,e.x,L,e.y,Q.x,L,Q.y,f.x,L,f.y)},vf:function(O,u,m,A){var F,p=this,K=p.gv.getFaceVisible(p.data,O);return(m||K)&&(F=zm(p,O,A),F.vs=[],F.tuv=K&&(F.texture||u)?[]:Y,F.visible=K),F}});var Pr=function(n,P){wj(Pr,this,[n,P])};jq(Pr,Wf,{_25Q:1,validate:function(y){var v=this,X=v.data,n=v.s,c=X.getPoints(),J=c.size();if(v.shapeModel=v.info=Y,J>1){var z=v.info={},R=X.getSegments(),a=X.getThickness(),E=jp(c.get(0)),g=jp(c.get(J-1)),P=J%2;0===P?(z.c1=jp(c.get(J/2-1)),z.c2=jp(c.get(J/2))):z.p3=jp(c.get((J-P)/2)),z.s1=E,z.s2=jp(c.get(1)),z.t1=jp(c.get(J-2)),z.t2=g,z.list=n(Ep)===Eg?v.createTubeModel(c,R,a/2,y):v.createLineModel(c,R,a,"shape.border","shape.dash")}var L=X.p3(),C=v.mat=ck();vf(C,L),ud(C,X.getFinalRotation3d(),X.getRotationMode());var A=X.getScale3d(),S=X._dynamicScale3d;S&&(A[0]*=S[0],A[1]*=S[1],A[2]*=S[2]),bc(C,A),vf(C,Nh(L))},_80o:function(I,Z,O){var f=this,$=f.shapeModel;if($){var c=f.gv;Do(c,f.mat),me(c,f.data,$,f,f.getBodyColor(),O),Xm(c)}}});var gk=C.graph3d.VR=function(H){var V=this;V.gv=H,V._controllers=[],V.switch=new zs(V),V._enable=!1,V._defaultCallLater=C.Default.callLater,V._defaultCancelLater=ic,"undefined"!=typeof f&&"VRFrameData"in f&&(V._frameData=new f.VRFrameData),V.measureOflength=1,V.eyesOffset=[0,0,0],V._orientation=new C.Math.Quaternion,V._lastHeadPose=[0,0,0],V._offsetToBeAdd=[0,0,0],V._fpsInfo={time:0,fps:0,frames:0}};jq(gk,$,{ms_fire:!0,_42:function(Y,R,h,W){var M=this,v=M.gv;if(!v.drawFilter&&M._deviceInAction){var a=M._device;if(a){var o=M._measureOflength;a.depthNear=v.getNear()*o,a.depthFar=v.getFar()*o;var V=M._offsetToBeAdd;if(M.eyesOffset[0]+=V[0],M.eyesOffset[1]+=V[1],M.eyesOffset[2]+=V[2],V[0]=0,V[1]=0,V[2]=0,a.isPresenting===!1)return M._controllers.forEach(function(b){b&&b.update()}),v.iv(),!1;var n=M._frameData;a.getFrameData(n);var i=n.pose.position;if(i){var c=M.toViewPosition(i);v.setEye(c),M._orientation.fromArray(n.pose.orientation);var X=new C.Math.Vector3(0,0,-10*M._scaleFactor);X.applyQuaternion(M._orientation),v.setCenter([c[0]+X.x,c[1]+X.y,c[2]+X.z])}M._controllers.forEach(function(u){u&&u.update()}),v.setViewport(Y,0,0,R/2,h),M._viewMatrix=M._copyViewMatrix(n.leftViewMatrix),M._projectMatrix=M._copyProjectMatrix(n.leftProjectionMatrix),W(),v.setViewport(Y,R/2,0,R/2,h),M._viewMatrix=M._copyViewMatrix(n.rightViewMatrix),M._projectMatrix=M._copyProjectMatrix(n.rightProjectionMatrix),W(),M._lastViewMatrix=M._viewMatrix,M._lastProjectMatrix=M._projectMatrix,M._viewMatrix=null,M._projectMatrix=null,M.submitFrame();var D=Date.now(),q=M._fpsInfo;return D-q.time>1e3?(q.fps=Math.round(1e3*(q.frames+1)/(D-q.time)),q.time=D,q.frames=0):q.frames++,!0}}},onVRDisplayPresentChange:function(){var v=this.isPresenting();this._injectGraphView(v),this.fp("present",!v,v)},getOrientation:function(){return this._orientation},addController:function(Y){Y=Y||0;var O=this,J=O.getController(Y);return J?J:(J=new Ne(O,Y),O._controllers.push(J),J)},getController:function(L){L=L||0;for(var D=this._controllers,a=0,V=D.length;V>a;a++)if(D[a]&&D[a].id===L)return D[a];return null},removeController:function(i){i=i||0;for(var P=this._controllers,h=0,M=P.length;M>h;h++)if(P[h]&&P[h].id===i)return P.splice(h,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(D,o){var $=this,a=$._scaleFactor,E=$._eyesOffset,Z=$._lastHeadPose;return Z[0]=D[0]*a,Z[1]=D[1]*a,Z[2]=D[2]*a,o?(o[0]=Z[0]+E[0],o[1]=Z[1]+E[1],o[2]=Z[2]+E[2],o):[Z[0]+E[0],Z[1]+E[1],Z[2]+E[2]]},addEyesOffset:function(c,f,U){var m=this._offsetToBeAdd;m[0]+=c,m[1]+=f,m[2]+=U},_copyViewMatrix:function(_){var z=this.dup(_),K=this._scaleFactor;z[12]*=K,z[13]*=K,z[14]*=K;var e=this._eyesOffset;if(e&&(e[0]||e[1]||e[2])){var j=e[0],P=e[1],x=e[2];z[12]-=z[0]*j+z[4]*P+z[8]*x,z[13]-=z[1]*j+z[5]*P+z[9]*x,z[14]-=z[2]*j+z[6]*P+z[10]*x}return z},shutdown:function(){var e=this._device;e&&e.isPresenting&&e.exitPresent()},isPresenting:function(){var m=this._device;return m&&m.isPresenting},_copyProjectMatrix:function(L){var B=this.dup(L),f=this._scaleFactor;return B[14]*=f,B},dup:function(o,b){for(var R=o.length,F=b||new Array(R);R--;)F[R]=o[R];return F},getViewMatrix:function(J){var T=this._viewMatrix;return T?this.dup(T,J):void 0},getProjectMatrix:function(){var j=this._projectMatrix;return j?this.dup(j):void 0},submitFrame:function(){var E=this;if(E._enable&&E._deviceInAction){var N=E._device;N&&N.isPresenting&&(N.submitFrame(),E.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(j){var O=this.gv;return O.intersectObjects(j,O.dm().getDatas())},setDevice:function(F){var D=this;D._device=F},_injectGraphView:function(){var G,n,S;return function(F){var Q=this.gv;if(!F)return G&&(Q.getWidth=G,Q.getHeight=n,Q.getDevicePixelRatio=S),void 0;var c=this._device,B=c.getEyeParameters("left"),H=B.renderWidth,p=B.renderHeight;G=Q.getWidth,n=Q.getHeight,S=Q.getDevicePixelRatio,Q.getWidth=function(){return 2*H},Q.getHeight=function(){return p},Q.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function(d){var t=this;if(!d)return an=C.Default.callLater=t._defaultCallLater,ic=C.Default.cancelLater=t._defaultCancelLater,void 0;var t=this;an=C.Default.callLater=function(w,z,q,Q){var C=t._device;return C&&C.isPresenting?Q?N(function(){an(w,z,q)},Q):C.requestAnimationFrame(function(){t._deviceInAction=!0,w.apply(z,q),t._deviceInAction=!1}):t._defaultCallLater(w,z,q,Q)},ic=C.Default.cancelLater=function(S,N){var _=t._device;return _&&_.isPresenting?N?z(S):_.cancelAnimationFrame(S):t._defaultCancelLater(S,N)}}}),$.defineProperties(gk.prototype,{enable:{get:function(){return this._enable},set:function(Y){var T=this;T._enable!==Y&&(T._enable=Y,Y?(T.switch.showButton(),T._injectCallLaterFunc(!0)):(T.shutdown(),T.switch.hideButton(),T._injectCallLaterFunc(!1)),T.fp("enable",!Y,Y))}},measureOflength:{get:function(){return this._measureOflength},set:function(y){this._measureOflength=y;var h=this._scaleFactor=1/y;this._controllers.forEach(function(j){j&&j._setScaleFactor(h)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(W){this._eyesOffset=W}},controllerModel:{get:function(){return this._controllerModel},set:function(s){var D;"object"==typeof s?(D=s.mtl,s=s.obj):(D=s+".mtl",s+=".obj");var t=this,c=t._controllerModel;c&&c.obj===s&&c.mtl===D||(c=t._controllerModel={obj:s,mtl:D},k.loadObj(s,D,{finishFunc:function($,W){t._controllerModel===c&&k.setShape3dModel("vrControllerModel",W)}}))}},interactive:{get:function(){return!!this._interactive},set:function(J){!!J!=!!this._interactive&&(this._interactive=J,J&&this.addController(0),this.gv.getCoreInteractor().enableVR(J))}}});var Ne=function(F,w){function b(z){var x=navigator.getGamepads&&navigator.getGamepads();if(x)for(var C=0,I=0,V=x.length;V>C;C++){var $=x[C];if($){var h=$.id;if("OpenVR Gamepad"===h||"OpenVR Controller"===h||0===h.indexOf("Oculus Touch")||0===h.indexOf("Spatial Controller")){if(I===z)return $;I++}}}}function a(B,G,n){return Math.abs(B[0]-G[0])<n&&Math.abs(B[1]-G[1])<n&&Math.abs(B[2]-G[2])<n?!0:!1}var Q=this;Q.vr=F,Q.id=w;var E,N,S=[0,0],d=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],u=new Dh;u.s("shape3d","vrControllerModel"),u.isController=!0,u.s("intersect",!1),Q.getGamepad=function(){return N},Q.isButtonPressed=function(w){for(var R,g=0,A=d.length;A>g;g++)if(R=d[g],R.id===w)return R.pressed;return!1},Q.getNode=function(){return u};var x=.003;Q.setRotationEpsilon=function(f){x=f};var H=5e-4,A=H;Q.setPositionEpsilon=function(k){H=k,A=k*Q.vr._scaleFactor},Q._setScaleFactor=function(O){u.s3(O,O,O),A=H*O},Q._setScaleFactor(Q.vr._scaleFactor);var W,T=new rj,i=new jh,l=[0,0,0],M=[0,0,0],f=new ec,U=new _m,I=new bi;Q.getRay=function(){return W?(I.origin.fromArray(l),I.direction.copy(U),W=!1,I):I},Q.update=function(){if(E=N,N=b(w),E!=N&&console.log("gamepad changed",N),!N||N.pose===P)return N=null,u.s("3d.visible",!1),void 0;if(k.getShape3dModel("vrControllerModel")){u.dm()||F.gv.dm().add(u),u.s("3d.visible",!0);var K=N.pose;if(null!==K){K.position&&(Q.vr.toViewPosition(K.position,l),a(u.p3(),l,A)||(W=!0,u.p3(l))),K.orientation&&(T.fromArray(K.orientation),U.set(0,0,-1).applyQuaternion(T).normalize(),i.makeRotationFromQuaternion(T),f.set(0,0,0,u.getRotationMode(),!0).setFromRotationMatrix(i),M[0]=f.x,M[1]=f.y,M[2]=f.z,a(u.r3(),M,x)||(W=!0,u.r3(M))),W&&F.fp("gamepad.pose",null,{position:l,rotation:M,id:w});var I=N.axes;(S[0]!==I[0]||S[1]!==I[1])&&(S=[I[0],I[1]],F.fp("gamepad.axes",null,{id:w,axes:S}));var L,t,y,Z,o=N.buttons;for(L=0,t=o.length;t>L;L++)if(y=o[L],Z=y.pressed,Z!==d[L].pressed){d[L].pressed=Z;var j={id:w},H="state";j[H]=j._62O=Z?"down":"up",F.fp("gamepad.button."+d[L].id,null,j)}}}}},zs=function(F){this.vr=F,this._button=null};jq(zs,$,{showButton:function(){var x=this.assureButton();if(!x.parentNode){var y=this.vr.gv,z=y.getView();y._79O?z.insertBefore(x,y._79O):z.appendChild(x)}},hideButton:function(){var x=this._button;x&&x.parentNode&&x.parentNode.removeChild(x)},assureButton:function(){var a=this._button;return a?a:this._button=this.createButton(this.vr.gv)},createButton:function(j){function P(J,s){J.textContent=s&&s.isPresenting?" VR ":" VR "}function M(H){A.style.display="",A.style.cursor="pointer",A.style.left="calc(50% - 50px)",A.style.width="100px",P(A,H),A.onmouseenter=function(){A.style.opacity="1.0"},A.onmouseleave=function(){A.style.opacity="0.5"},A.onclick=function(){H.isPresenting?H.exitPresent():H.requestPresent([{source:j.getCanvas()}])},j.vr.setDevice(H)}function y(){A.style.display="",A.style.cursor="auto",A.style.left="calc(50% - 75px)",A.style.width="150px",P(A,null),A.onmouseenter=null,A.onmouseleave=null,A.onclick=null,j.vr.setDevice(null)}function N(E){E.style.position="absolute",E.style.bottom="20px",E.style.padding="12px 6px",E.style.border="1px solid #fff",E.style.borderRadius="4px",E.style.color="#000",E.style.font="normal 13px sans-serif",E.style.textAlign="center",E.style.opacity="0.5",E.style.outline="none",E.style.zIndex="999"}if("getVRDisplays"in navigator){var A=this._button=H.createElement("button");return A.style.display="none",N(A),f.addEventListener("vrdisplayconnect",function(B){M(B.display)},p),f.addEventListener("vrdisplaydisconnect",function(){y()},p),f.addEventListener("vrdisplaypresentchange",function(y){P(A,y.display),j.vr.onVRDisplayPresentChange()},p),navigator.getVRDisplays().then(function(x){x.length>0?M(x[0]):y()}),A}var z=H.createElement("a");return z.href="https://webvr.info",z.innerHTML=" webvr",z.style.left="calc(50% - 90px)",z.style.width="180px",z.style.textDecoration="none",N(z),z}}),$.defineProperties(zs.prototype,{});var lc=C.graph3d.PostProcessing=function(K){function S(){if(!q){var z=K.getGL();q=new bp.RenderTarget(K,z),O=new ik.Shader(z,E.vs,E.fs),U=ik.Buffer.createIndexBuffer(z,new Uint16Array([0,2,1,1,2,3])),o=ik.Buffer.createVertexBuffer(z,new Float32Array([0,0,1,0,0,1,1,1]))}}var q,O,U,o,v=this,Q={},j=!1;!function(){var V;for(V in lc)Q[V]=new lc[V](K)}(),v.getModule=function(D){return D?Q[D]:Q},v.getModuleList=function(){return $.keys(Q)},v.handleDataModleChange=function(U,X){U&&(U.setPostProcessingData(v.serialize()),U.removeSerializeListener(v.onDataModelSerialize,v)),X&&(X.addSerializeListener(v.onDataModelSerialize,v),v.deserialize(X.getPostProcessingData()))},v.onDataModelSerialize=function(T){"serialize"===T.type?K.dm()._postProcessingData=v.serialize():"deserialize"===T.type&&v.deserialize(K.dm().getPostProcessingData())},v.serialize=function(){var S,X,n,s={};for(S in Q)X=Q[S],s[S]={enable:X.enable},n=X.serializeProperties,n&&n.forEach(function(G){s[S][G]=X[G]});return s},v.deserialize=function(f){if(f){var b,x,V,n;for(b in f){x=Q[b],V=f[b],v.enableModule(b,V.enable);for(n in V)"enable"!==n&&(x[n]=V[n])}}else{var b,x;for(b in Q)x=Q[b],x.enable=!1,x.resetProperties&&x.resetProperties()}},v.enableModule=function(e,B){var r,g,A,P=e.split(",");for(r=0,g=P.length;g>r;r++)A=P[r].trim(),Q[A]&&(Q[A].enable=B);j=!1;for(A in Q)if(Q[A].enable){j=!0;break}j&&S()};var E={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};v._42=function(H,F,Z,Y,C){if(j&&!C){q.setSize(H,F,Z),Ti(H,q.frame),H.clear(H.COLOR_BUFFER_BIT|H.DEPTH_BUFFER_BIT),K.setViewport(H,0,0,F,Z),Y();var M,i=q;for(M in Q)i=Q[M]._42(H,i)||i;return Zf(H),K.setViewport(H,0,0,F,Z),H.clear(H.COLOR_BUFFER_BIT|H.DEPTH_BUFFER_BIT),O.bind(),H.activeTexture(H.TEXTURE0+0),H.bindTexture(H.TEXTURE_2D,i.texture),O.uniforms.image=0,U.upload(),o.upload(),O.attributes.pos.pointer(o),H.drawElements(H.TRIANGLES,6,H.UNSIGNED_SHORT,0),H.bindTexture(H.TEXTURE_2D,null),H.useProgram(K._prg),!0}}},Qo=C.graph3d.PostProcessing.Bloom=function(F){function L(){var e=F.getWidth(),U=F.getHeight();if(e&&U){X=[e,U],K=!0;var h,k=F.getGL(),g=Math.round(X[0]/2),L=Math.round(X[1]/2);for(j=new bp.RenderTarget(F,k,g,L),h=0;b>h;h++)J.push(new bp.RenderTarget(F,k,g,L)),p.push(new bp.RenderTarget(F,k,g,L)),g=Math.round(g/2),L=Math.round(L/2);N=new ik.Shader(k,Qo.highPassShader.vs,Qo.highPassShader.fs);for(var h=0;b>h;h++)r[h]=new ik.Shader(k,Qo.blurShader.vs,Qo.blurShader.fs.replace(/DEFINE_VALUE/g,R[h]));I=new ik.Shader(k,Qo.compositeShader.vs,Qo.compositeShader.fs.replace(/NUM_MIPS/g,b)),S=new ik.Shader(k,Qo.finalShader.vs,Qo.finalShader.fs),t=ik.Buffer.createIndexBuffer(k,new Uint16Array([0,2,1,1,2,3])),i=ik.Buffer.createVertexBuffer(k,new Float32Array([0,0,1,0,0,1,1,1]))}}var T,q,Y,t,i,M=this,l=!1,K=!1;this.serializeProperties="strength,threshold,radius".split(","),this.resetProperties=function(){T=1.5,q=.55,Y=.4},$.defineProperties(M,{enable:{get:function(){return l},set:function(i){!!l!=!!i&&(l=i,i&&!K&&L())}},strength:{get:function(){return T},set:function(b){T=b}},threshold:{get:function(){return q},set:function(z){q=z}},radius:{get:function(){return Y},set:function(g){Y=g}}}),this.resetProperties();var j,N,I,S,X=[256,256],J=[],p=[],b=5,R=[3,5,7,9,11],r=[];M._42=function(m,f){function s(X,z,k,s){Ti(m,z.frame),F.setViewport(m,0,0,z.width,z.height),s?s(m):m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),u!==X&&X.bind();
var d=0;for(var n in k){var J=k[n];J instanceof WebGLTexture&&(m.activeTexture(m.TEXTURE0+d),m.bindTexture(m.TEXTURE_2D,J),J=d,d++),X.uniforms[n]=J}for(u!==X&&(t.upload(),i.upload(),X.attributes.pos.pointer(i),u=X),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0);d--;)m.activeTexture(m.TEXTURE0+d),m.bindTexture(m.TEXTURE_2D,null);Zf(m)}if(l){K||L();var u;s(N,j,{smoothWidth:.01,luminosityThreshold:q,tDiffuse:f.texture});var Q,W=j,e=Math.round(X[0]/2),o=Math.round(X[1]/2);for(Q=0;b>Q;Q++)s(r[Q],J[Q],{colorTexture:W.texture,direction:[1,0],texSize:[e,o]}),s(r[Q],p[Q],{colorTexture:J[Q].texture,direction:[0,1],texSize:[e,o]}),e=Math.round(e/2),o=Math.round(o/2),W=p[Q];return s(I,J[0],{blurTexture1:p[0].texture,blurTexture2:p[1].texture,blurTexture3:p[2].texture,blurTexture4:p[3].texture,blurTexture5:p[4].texture,bloomStrength:T,bloomRadius:Y,bloomTintColor:[1,1,1]}),s(S,f,{image:J[0].texture},function(x){x.enable(x.BLEND),x.blendEquation(x.FUNC_ADD),x.blendFunc(x.SRC_ALPHA,x.ONE)}),m.blendEquationSeparate(m.FUNC_ADD,m.FUNC_ADD),m.blendFuncSeparate(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA,m.ONE,m.ONE_MINUS_SRC_ALPHA),f}}};Qo.highPassShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D tDiffuse;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float v = dot( texel.xyz, luma );","vec4 outputColor = vec4(0.0, 0.0, 0.0, 0.0);","float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","gl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},Qo.blurShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D colorTexture;","uniform vec2 texSize;","uniform vec2 direction;","#define KERNEL_RADIUS DEFINE_VALUE","#define SIGMA DEFINE_VALUE","float gaussianPdf(in float x, in float sigma) {","return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;","}","void main() {","vec2 invSize = 1.0 / texSize;","float fSigma = float(SIGMA);","float weightSum = gaussianPdf(0.0, fSigma);","vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;","for( int i = 1; i < KERNEL_RADIUS; i ++ ) {","float x = float(i);","float w = gaussianPdf(x, fSigma);","vec2 uvOffset = direction * invSize * x;","vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;","vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;","diffuseSum += (sample1 + sample2) * w;","weightSum += 2.0 * w;","}","gl_FragColor = vec4(diffuseSum/weightSum, 1.0);","}"].join("\n")},Qo.compositeShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D blurTexture1;","uniform sampler2D blurTexture2;","uniform sampler2D blurTexture3;","uniform sampler2D blurTexture4;","uniform sampler2D blurTexture5;","uniform sampler2D dirtTexture;","uniform float bloomStrength;","uniform float bloomRadius;","uniform vec3 bloomTintColor;","float lerpBloomFactor(const in float factor) {","float mirrorFactor = 1.2 - factor;","return mix(factor, mirrorFactor, bloomRadius);","}","void main() {","gl_FragColor = bloomStrength * ( lerpBloomFactor(1.0) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture1, vUv) + ","lerpBloomFactor(0.8) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture2, vUv) + ","lerpBloomFactor(0.6) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture3, vUv) + ","lerpBloomFactor(0.4) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture4, vUv) + ","lerpBloomFactor(0.2) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture5, vUv) );","}"].join("\n")},Qo.finalShader={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")},yl(k,{accordionViewExpandIcon:Ul(ms),accordionViewCollapseIcon:Ul(ms,!0),accordionViewLabelColor:Eo,accordionViewLabelFont:fi,accordionViewTitleBackground:jb,accordionViewSelectBackground:nq,accordionViewSelectWidth:3,accordionViewSeparatorColor:P,splitViewDividerSize:1,splitViewDividerBackground:jb,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:Rl,rect:[2,2,12,12],background:ms}]},propertyViewLabelColor:bl,propertyViewLabelSelectColor:Eo,propertyViewLabelFont:fi,propertyViewExpandIcon:Ul(of),propertyViewCollapseIcon:Ul(of,!0),propertyViewBackground:rk,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:dh,propertyViewColumnLineColor:dh,propertyViewSelectBackground:nq,listViewLabelColor:bl,listViewLabelSelectColor:Eo,listViewLabelFont:fi,listViewRowLineVisible:!1,listViewRowLineColor:dh,listViewSelectBackground:nq,treeViewLabelColor:bl,treeViewLabelSelectColor:Eo,treeViewLabelFont:fi,treeViewExpandIcon:Ul(wd),treeViewCollapseIcon:Ul(wd,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:dh,treeViewSelectBackground:nq,treeViewDoubleClickToToggle:!0,tableViewLabelColor:bl,tableViewLabelSelectColor:Eo,tableViewLabelFont:fi,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:dh,tableViewColumnLineColor:dh,tableViewSelectBackground:nq,treeTableViewLabelColor:bl,treeTableViewLabelSelectColor:Eo,treeTableViewLabelFont:fi,treeTableViewExpandIcon:Ul(wd),treeTableViewCollapseIcon:Ul(wd,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:dh,treeTableViewColumnLineColor:dh,treeTableViewSelectBackground:nq,tableHeaderLabelColor:bl,tableHeaderLabelFont:fi,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:Wl,tableHeaderBackground:rk,tableHeaderMoveBackground:Fn,tableHeaderInsertColor:nq,tableHeaderSortDescIcon:Or(of,!0),tableHeaderSortAscIcon:Or(of),tabViewTabGap:1,tabViewLabelColor:Eo,tabViewLabelFont:fi,tabViewTabBackground:jb,tabViewSelectWidth:3,tabViewSelectBackground:nq,tabViewMoveBackground:Fn,tabViewInsertColor:nq,toolbarLabelColor:bl,toolbarLabelSelectColor:Eo,toolbarLabelFont:fi,toolbarBackground:rk,toolbarSelectBackground:nq,toolbarItemGap:8,toolbarSeparatorColor:Vc},!0);var hi={translateX:1,sortColumn:1},wk={sortable:1,sortOrder:1,sortFunc:1},Zd={focusData:1},yq={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Ii={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},Rq=function(s,C){C.add(s),s.hasChildren()&&s.eachChild(function(V){Rq(V,C)})},kj=function(y,J,d,u,M,x,z,e,F,V,v){var S,R=d.getValueType(V),i=d.getAlign(V);if(d.getEnumValues(V)){var X=d.toEnumLabel(J,V),I=ap||0,q=0,$=x,E=k.getTextSize(u,X).width;return S=km(d.toEnumIcon(J,V)),S&&(q=x+ap/2,"center"===i?q+=(e-(I+E))/2:"right"===i&&(q=q+e-(I+E)),vr(y,S,q,z+F/2,V,v),$=q+ap/2),X!=Y&&(S?qq(y,X,u,M,$,z,e-($-x),F):qq(y,X,u,M,x,z,e,F,i)),void 0}return J=d.formatValue(J),J!=Y?R===Ym?(_e(y,x,z,e,F,J),void 0):R===Xq||!R&&sr(J)?(S=km(J?Ri:Bo),vr(y,S,x+e/2,z+F/2,V,v),void 0):(qq(y,J,u,M,x,z,e,F,i),void 0):void 0},Sb=function(c,x){var m=x.view,X=Mn(c),V=x.column||x.property;m.getDataModel().beginTransaction(),x.editor=c,c.info=x,m.setCurrentEditor(c),m.getView().insertBefore(X,m._79O),dk(c,x.editorRect),c.setFocus?c.setFocus():_c(c),c.commitValue=function(v,d){c._17Q&&(c=c._17Q),d||m.setValue(x.data,V,c.getValue?c.getValue():c.value),c.close&&c.close(),rn(X)},V.onEditorCreated&&V.onEditorCreated(x)},$c=function(i,X,r,d,G){var M=di(i,r),g=X.value,w=X.view,c=G.getValueType(X.data);return M.onblur=M.onchange=function(){w.endEditing()},"input"===i?(g=G.formatValue(g),g!=Y&&(M.value=g),M.onkeydown=function(a){Jf(a)?w.endEditing():xs(a)&&w.endEditing(!0)},(c===hs||c===vl)&&M.addEventListener(um,k.numberListener,p)):i===Uj&&d.forEach(function(n){var i=H.createElement("option");i.innerHTML=G.toEnumLabel(n),i.value=n,G.isEnumEqual(g,n)&&(i.selected=!0),Hb(M,i)}),Sb(M,X),M},Cf=C.widget={},kq=function(b,c,G){jq(I+".widget."+b,c,G)};yl(Wk,{ms_value:function(e){e.getValue=function(B){var T=this.getItemById(B),O=T.element;return Xd(O)?O:O?O.getValue?O.getValue():O.value:T.selected},e.setValue=function(L,o){var y=this.getItemById(L);if(y){var u=y.element;u&&!Xd(u)?u.setValue?u.setValue(o):u.value=o:sr(o)?(y.selected=o,this.iv()):(y.element=o,this.iv())}},e.v=function(w,D){var O=this;if(2===arguments.length)O.setValue(w,D);else{if(!Vl(w))return O.getValue(w);for(var n in w)O.setValue(n,w[n])}return O}},_46o:function(o){o._icon=Y,o._accessType=Y,o._valueType=Y,o._editable=!1,o._batchEditable=!0,o._align=wp,o._nullable=!0,o._emptiable=!1,o.setParent=xn,o.formatValue=function(j){var u=this,Z=u._valueType;return u.getEnumValues()?u.toEnumLabel(j):Z===Xq?!!j:j!=Y&&Z===hs?R(j):j},o.setEnum=function(C,S,j,a,O,B,i){var n=this;C&&!fk(C)&&C.values&&(a=C.editable,j=C.icons,S=C.labels,O=C.strict,B=C.maxHeight,i=C.dropDownWidth,C=C.values),Rb(C)&&(C=C._as),Rb(S)&&(S=S._as),Rb(j)&&(j=j._as),n._enumValues=C,n._enumLabels=S,n._enumIcons=j,n._enumEditable=a,n._enumStrict=O==Y?!0:O,n._enumMaxHeight=B,n._enumDropDownWidth=i,C&&C.length&&mn(C[0])&&(n._valueType=vl),n.fp("enum",!1,!0)},o.getEnumDropDownWidth=function(){return this._enumDropDownWidth},o.getEnumMaxHeight=function(){return this._enumMaxHeight},o.isEnumEditable=function(){return this._enumEditable},o.getEnumValues=function(){return this._enumValues},o.getEnumLabels=function(){return this._enumLabels},o.getEnumIcons=function(){return this._enumIcons},o.isEnumStrict=function(){return this._enumStrict},o.isEnumEqual=function($,U){return this._enumStrict?$===U:$==U},o.toEnumLabel=function(v,S){var X=this,A=X.getEnumValues(S),D=X.getEnumLabels(S);if(A&&D)for(var q=0;q<A.length;q++)if(X.isEnumEqual(v,A[q]))return D[q];return v},o.toEnumIcon=function(G,I){var k=this,z=k.getEnumValues(I),h=k.getEnumIcons(I);if(z&&h)for(var T=0;T<z.length;T++)if(k.isEnumEqual(G,z[T]))return h[T];return P}},_45o:function(f){f._87o=function(T,h,s,x,j,I){if(T){var K=this,V=K._90I,u=Aj(1);K._columnLineVisible&&(j-=1),K._rowLineVisible&&(I-=1),0>=j||0>=I||(K._90I||(V=K._90I={}),V[h]||(V[h]=new rp),dk(u,K.tx()+s,K.ty()+x,j,I),Hb(u,T),K._view.insertBefore(u,K._79O),T.onParentAdded&&T.onParentAdded(u),V[h].add(u))}},f._76o=function(){var M=this,K=M._90I;if(K){for(var q in K)K[q].each(function(k){rn(k)});delete M._90I}},f._77o=function(q){var G=this;if(G._90I){var R=G._90I[q];R&&(R.each(function(h){rn(h)}),delete G._90I[q])}}},_47o:function(e){e.getValue=function(i,n){return n.getValue?n.getValue(i,n,this):Ij(i,n.getAccessType(),n.getName())},e.setValue=function(v,a,K){if(a.isEmptiable(v)||""!==K||(K=P),a.isNullable(v)||K!=Y){var i=this,U=a.getName(v),u=a.getAccessType(v),f=a.getValueType(v);f===hs&&Xd(K)?K=n(K):f===vl&&Xd(K)?K=parseFloat(K):f===Xq&&Xd(K)&&(K="true"===K),i._batchEditable&&a._batchEditable&&i.isSelected(v)?i.sm().each(function(b){a.setValue?a.setValue(b,a,K,i):ah(b,u,U,K)}):a.setValue?a.setValue(v,a,K,i):ah(v,u,U,K)}},e.setCurrentEditor=function(b){this.endEditing(),this._currentEditor=b,this.redraw()},e.isEditing=function(S,q){var Z=this,D=Z._currentEditor;if(!D)return!1;if(q){var p=D.info;return p?(p.column||p.property)===q&&p.data===S:!1}return!0},e.endEditing=function(k){var E=this,x=E._currentEditor;x&&(delete E._currentEditor,x.commitValue&&x.commitValue(x.info,k),E.redraw(),E.getDataModel().endTransaction())},e.beginEditing=function(W){this.endEditing();var I=this,K=W.column||W.property;if(K.beginEditing)K.beginEditing(W);else{var O=W.data,w=W.value,h=I.getSelectBackground(O),G=K.getEnumValues(O),C=K.getSlider(O),Q=K.getColorPicker(O);if(C){var c=se(Cf.Slider,C);return c.setValue(w),c.getView().onblur=function(){I.endEditing()},c.isInstant()&&(c.onValueChanged=function(){I.setValue(O,K,c.getValue())}),Sb(c,W),void 0}if(Q||K.getValueType(O)===Ym){var X=se(Cf.ColorPicker,Q);return X.setValue(w),X.onClosed=function(){I.endEditing()},X.isInstant()&&(X.onValueChanged=function(G,A){I.setValue(O,K,A)}),Sb(X,W),X.open(),void 0}if(G){if(Cf.ComboBox){var u=new Cf.ComboBox;u.setValue(w),u.setValues(G),u.setLabels(K.getEnumLabels(O)),u.setIcons(K.getEnumIcons(O)),u.setEditable(K.isEnumEditable(O)),u.setStrict(K.isEnumStrict(O)),u.setMaxHeight(K.getEnumMaxHeight(O)),u.setDropDownWidth(K.getEnumDropDownWidth(O)),u.onClosed=function(){I.endEditing()},Sb(u,W),u.open()}else $c(Uj,W,h,G,K);return}var P=K.getValueType(O);if(P===Xq||sr(w))return I.setValue(O,K,!w),void 0;if(K.getItemEditor(O)){var B=ns(K.getItemEditor(O)),n=new B(O,K,I,W),z=n.getView();return z._17Q=n,n.setValue(w),xb(z),Sb(z,W),n.editBeginning&&n.editBeginning(),void 0}$c("input",W,h,Y,K)}}},_44o:function(H){H.init=function(q){var C=this,Y=C.th=new yk(q),k=C._view=kk(1,C);C.tv=C._tableView=q,Hb(k,Y.getView()),Hb(k,q.getView()),Y.mp(function(i){i.property===Gb&&C.iv()}),C.iv()},H.getTableView=function(){return this.tv},H.getTableHeader=function(){return this.th},H.getDataModel=function(){return this.tv.dm()},H.getColumnModel=function(){return this.tv.getColumnModel()},H.setColumns=function(m){this.tv.setColumns(m)},H.addColumns=function(T){this.tv.addColumns(T)},H.endEditing=function(){this.tv.endEditing()},H.validateImpl=function(){var K=this,J=K.th,q=em(J),p={x:0,y:0,width:K.getWidth(),height:q};dk(J,p),p.y=q,p.height=B(0,K.getHeight()-q),dk(K.tv,p)}},ms_vs:function(X){X._41o=function(){return this._29I.height<this._59I},X._43o=function(){var c=this;c._41o()&&(c._58I||(N(function(){c._94O()},dl),c.iv()),c._58I=new Date)},X._94O=function(){var S=this;if(S._58I){var o=new Date;o.getTime()-S._58I.getTime()>=dl?(delete S._58I,S.iv()):N(function(){S._94O()},dl)}},X._93I=function(){var c=this,L=c._27I;if(c._58I||!c._autoHideScrollBar){L||Hb(c._79O,L=c._27I=Aj());var r=c._29I,v=r.height,m=c._59I,G=c.getScrollBarSize(),s=r.width-G-2,d=v*(-c.ty()/m),X=v*(v/m),_=L.style;m>v?(Qd>X&&(d=d+X/2-Qd/2,0>d&&(d=0),d+Qd>v&&(d=v-Qd),X=Qd),_.visibility=hq,_.background=c.getScrollBarColor(),_.borderRadius=G/2+Md,dk(L,s,d,G,X)):_.visibility=Wb}else L&&(L.style.visibility=Wb)}},ms_hs:function(e){e._40o=function(){return this._29I.width<this._91I},e._42o=function(){var I=this;I._40o()&&(I._95O||(N(function(){I._94I()},dl),I.iv()),I._95O=new Date)},e._94I=function(){var I=this;if(I._95O){var X=new Date;X.getTime()-I._95O.getTime()>=dl?(delete I._95O,I.iv()):N(function(){I._94I()},dl)}},e._92I=function(){var y=this,A=y._28I;if(y._95O||!y._autoHideScrollBar){A||Hb(y._79O,A=y._28I=Aj());var n=y._29I,c=n.width,l=y._91I,s=y.getScrollBarSize(),B=n.height-s-2,t=c*(-y.tx()/l),f=c*(c/l),E=A.style;l>c?(Qd>f&&(t=t+f/2-Qd/2,0>t&&(t=0),t+Qd>c&&(t=c-Qd),f=Qd),E.visibility=hq,E.background=y.getScrollBarColor(),E.borderRadius=s/2+Md,dk(A,t,B,f,s)):E.visibility=Wb}else A&&(A.style.visibility=Wb)}}}),Hq(Ri,Ai(16,16,[{type:xo,rect:[1,1,14,14],background:nq},{type:Ag,rect:[1,1,14,14],width:1,color:or},{type:ak,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),Hq(Bo,Ai(16,16,{type:Ag,rect:[1,1,14,14],width:1,color:or})),Hq(he,Ai(16,16,[{type:zq,rect:[2,2,12,12],borderWidth:1,borderColor:or,background:"#FFF"},{type:zq,rect:[4,4,8,8],background:nq}])),Hq(te,Ai(16,16,{type:zq,rect:[2,2,12,12],borderWidth:1,borderColor:or})),Wk._15Q=function(F){F._29I=Zc,F._59I=0,F._91I=0,F._5o=function(j){var i=this;i._30I=new rp,i._rows=new rp,i._rowMap={},i._31I=0,i._14I=0,i._view=kk(1,i),i._canvas=eq(i._view),Hb(i._view,i._79O=Aj()),i.dm(j?j:new fs)},F.getCheckIcon=function(q){var Y=this.sm(),K=Y.co(q);return Y.sg()?km(K?he:te):km(K?Ri:Bo)},F.checkData=function(D){var v=this.sm(),k=v.co(D);v.sg()&&k||(this._32o=1,k?v.rs(D):v.as(D),delete this._32o)},F.getDataAt=function(x){x.target&&(x=this.lp(x));var v=s(x.y/this._rowHeight),V=this._rows;return 0>v||v>=V.size()?Y:V.get(v)},F.onDataDoubleClicked=function(){},F.onDataClicked=function(){},F.adjustTranslateX=function(){return 0},F.adjustTranslateY=function(e){var P=this.getHeight()-this._59I;return P>e&&(e=P),e>0?0:R(e)},F.onPropertyChanged=function(K){var $=this,N=K.property;yq[N]?$.ivm():Zd[N]||$.redraw(),N===mb?$._42o():N===Bh&&$._43o()},F.getLabel=function(H){return H.toLabel()},F.getLabelFont=function(){return this._labelFont},F.getLabelColor=function(L){var y=this;if(y.isCheckMode()){if(y._focusData===L)return y._labelSelectColor}else if(y.isSelected(L))return y._labelSelectColor;return y._labelColor},F.getStartRowIndex=function(){return this._31I},F.getEndRowIndex=function(){return this._14I},F.getRowDatas=function(){return this._rows},F.getRowIndex=function(C){return this._rowMap[C._id]},F.getRowSize=function(){return this._rows.size()},F.getViewRect=function(){return aq(this._29I)},F.isVisible=function(y){return this._visibleFunc?this._visibleFunc(y):!0},F.getCurrentSortFunc=function(){return this._sortFunc},F.setDataModel=function(C){var p=this,B=p._dataModel,M=p._selectionModel;B!==C&&(B&&(B.umm(p.handleDataModelChange,p),B.umd(p.handleDataPropertyChange,p),B.umh(p.handleHierarchyChange,p),M||B.sm().ums(p.handleSelectionChange,p)),p._dataModel=C,C.mm(p.handleDataModelChange,p),C.md(p.handleDataPropertyChange,p),C.mh(p.handleHierarchyChange,p),M?M._21I(C):C.sm().ms(p.handleSelectionChange,p),p.fp("dataModel",B,C))},F.validateModel=function(){var R=this;R._rows.clear(),R._rowMap={},R.buildChildren(R._dataModel._roots);var y=R._rows=R._rows.toList(R.isVisible,R),q=0,K=R.getCurrentSortFunc(),x=y.size();for(K&&y.sort(K);x>q;q++)R._rowMap[y.get(q)._id]=q},F.buildChildren=function(t){var z=this;t.each(function($){z._rows.add($),z.buildChildren($._children)})},F.handleDataModelChange=function(){this.ivm()},F.handleDataPropertyChange=function(p){"parent"===p.property?this.ivm():this.invalidateData(p.data)},F.handleHierarchyChange=function(){this.ivm()},F.handleSelectionChange=function(o){o.datas.each(this.invalidateData,this),this.onSelectionChanged(o)},F.onSelectionChanged=function(Z){var f=this,g=f.sm();!f.isAutoMakeVisible()||1!==g.size()||"set"!==Z.kind&&"append"!==Z.kind||f._32o||f.makeVisible(g.ld())},F.handleBackgroundClick=function(C){Qe(C)&&!this.isCheckMode()&&this.sm().cs()},F.makeVisible=function(T){T&&(this._23I=T,this.iv())},F.scrollToIndex=function(B){var s=this,N=s._29I,O=N.height,R=s._rowHeight,$=R*B;B>=0&&B<s._rows.size()&&O>0&&($+R>N.y+O?s.ty(-$+O-R):$<N.y&&s.ty(-$))},F.autoScroll=function(R,c){var C=this,p=C._rowHeight,X=p,I=p/4,j=C._29I,V=C.lp(R),w={x:C.tx(),y:C.ty()};return p>0&&j&&(V.x-j.x<X?C.translate(I,0):j.x+j.width-V.x<X&&C.translate(-I,0),V.y-j.y<X?C.translate(0,I):j.y+j.height-V.y<X&&C.translate(0,-I)),w.x=C.tx()-w.x,w.y=C.ty()-w.y,c&&(c.x+=w.x,c.y+=w.y),w},F.getTopRowOrderSelection=function(){var a=this.sm().getTopSelection(),$={},B=new rp;return a.each(function(u){$[u._id]=u}),this._rows.each(function(L){$[L._id]&&B.add(L)}),B},F.getRowOrderSelection=function(){var K=new rp;return this._rows.each(function(j){this.isSelected(j)&&K.add(j)},this),K},F.ivm=function(){this.invalidateModel()},F.invalidateModel=function(){var b=this;b._96I||(b._96I=1,b._32I=1,delete b._24I),b.iv()},F.redraw=function(){var _=this;_._32I||(_._32I=1,delete _._24I,_.iv())},F.invalidateData=function(P){var Z=this;h?Z.redraw():Z._32I||(Z._24I||(Z._24I={}),Z._24I[P._id]=P,Z.iv())},F.getFocusData=function(){return this._focusData},F.setFocusDataById=function(G){this.setFocusData(this.dm().getDataById(G))},F.setFocusData=function(M){var t=this,w=t._focusData;w!==M&&(t._focusData=M,t.fp("focusData",w,M),w&&t.invalidateData(w),M&&(t.invalidateData(M),t.isAutoMakeVisible()&&t.makeVisible(M)))},F.drawRowBackground=function(P,k,j,q,V,C,z){var e=this,O=e.isCheckMode();(k===e._focusData&&O||j&&!O)&&_e(P,q,V,C,z,e.getSelectBackground(k))},F.drawData=function(p,H,_){var b=this,h=b._rowHeight,z=h*_,s=b._29I,q=s.x,u=s.width;p.save(),p.beginPath(),p.rect(q,z,u,h),p.clip(),b._87o(b.drawRow(p,H,b.isSelected(H),q,z,u,h),_,q,z,u,h),p.restore(),b._rowLineVisible&&_e(p,q,z+h-1,u,1,b._rowLineColor)},F._12I=function(h){var z=this,Z=z._31I,t=z._29I,X=t.x,A=t.y,w=t.width,b=t.height;for(h.beginPath(),h.rect(X,A,w,b),h.clip(),h.clearRect(X,A,w,b),z._76o(),z._93db(h);Z<z._14I;Z++)z.drawData(h,z._rows.get(Z),Z);z._92db(h)},F._13I=function(c){for(var O,q=this,w=q._rowHeight,N=q._29I,$=N.x,V=N.width,r=q._31I,U=q._30I;r<q._14I;r++)O=q._rows.get(r),q._24I[O._id]&&U.add({data:O,index:r});U.isEmpty()||(c.beginPath(),U.each(function(M){c.rect($,M.index*w,V,w)}),c.clip(),U.each(function(_){c.clearRect($,_.index*w,V,w)}),U.each(function(O){q._77o(O.index)}),q._93db(c),U.each(function(d){q.drawData(c,d.data,d.index)}),q._92db(c),U.clear())},F.preValidateModel=function(){this.endEditing&&this.endEditing()},F.validateImpl=function(){var O=this,L=O._canvas,V=O.getWidth(),M=O.getHeight(),Z=O._rowHeight,A=O._32I;(V!==L.clientWidth||M!==L.clientHeight)&&(hn(L,V,M),A=1);var H=K&&!v;O._96I&&!H&&(O.preValidateModel(),O.validateModel());var i=O._29I,R={x:-O.tx(),y:-O.ty(),width:V,height:M},t=O._rows.size(),h=sf(L),g=O._23I;A||Sj(R,i)||(A=1),O._29I=R,O._59I=t*Z+O.getScrollBarSize(),O._31I=s(R.y/Z),O._14I=_((R.y+R.height)/Z),O._31I<0&&(O._31I=0),O._14I>t&&(O._14I=t),O._99I&&A&&O._99I(),$r(h,O.tx(),O.ty(),1),A?O._12I(h):O._24I&&O._13I(h),O._93I(),O._92I(),h.restore(),O._32I=O._24I=O._96I=Y,g&&(O.scrollToIndex(O.getRowIndex(g)),delete O._23I),O.tx(O.tx()),O.ty(O.ty())}},Wk._48o=function(B){B._rootVisible=!0,B._rootData=Y,B._35o=function(){this._expandMap={},this._levelMap={}},B.validateModel=function(){var H=this,p=H._rootData;H._rows.clear(),H._levelMap={},H._rowMap={},H._currentLevel=0,p?H._rootVisible?H.isVisible(p)&&H.buildData(p):H.buildChildren(p):H.buildChildren(),delete H._currentLevel},B.buildData=function(m){var Q=this,b=m._id,i=Q._rows;Q._rowMap[b]=i.size(),i.add(m),Q._levelMap[b]=Q._currentLevel,Q.isExpanded(m)&&(Q._currentLevel++,Q.buildChildren(m),Q._currentLevel--)},B.buildChildren=function(T){var C=this,W=T?T._children:C._dataModel._roots,m=C.getCurrentSortFunc();m&&C.isChildrenSortable(T)?W.toList(C.isVisible,C).sort(m).each(C.buildData,C):W.each(function(o){C.isVisible(o)&&C.buildData(o)})},B.getLevel=function(o){return this._levelMap[o._id]},B.getToggleIcon=function(I){var X=this,S=X._loader,R=X._collapseIcon;return S&&!S.isLoaded(I)?R:I.hasChildren()?X.isExpanded(I)?X._expandIcon:R:Y},B.isCheckMode=function(){return this._checkMode!=Y},B.isChildrenSortable=function(){return!0},B.handleDataModelChange=function(j){var i=this;j.kind===Kn?delete i._expandMap[j.data._id]:j.kind===Qb&&(i._expandMap={}),i.ivm()},B.toggle=function(T){var $=this;$.isExpanded(T)?$.collapse(T):$.expand(T)},B.isExpanded=function(Q){return 1===this._expandMap[Q._id]},B.expand=function(H){var L=this,n=L._loader;L.isExpanded(H)||(n&&!n.isLoaded(H)&&n.load(H),L._expandMap[H._id]=1,L.ivm(),L.onExpanded(H))},B.onExpanded=function(){},B.collapse=function(c){var n=this;n.isExpanded(c)&&(delete n._expandMap[c._id],n.ivm(),n.onCollapsed(c))},B.onCollapsed=function(){},B.expandAll=function(t){if(t)this.expand(t),t.eachChild(function(o){this.expandAll(o)},this);else{var Q=this;Q._dataModel.each(function(D){D.hasChildren()&&(Q._expandMap[D._id]=1)}),Q.ivm()}},B.collapseAll=function(){this._expandMap={},this.ivm()},B.makeVisible=function(C){if(C){var h=this;if(!h._rootData||C.isDescendantOf(h._rootData)){for(var r=C._parent;r;)h.expand(r),r=r._parent;h._23I=C,h.iv()}}},B.checkData=function(L){var A,F=this,B=F._checkMode,t=F.sm(),Z=t.co(L);if(!t.sg()||!Z){if(F._32o=1,B===Pp)Z?t.rs(L):t.as(L);else if(B===Fo)A=new rp(L),A.addAll(L._children);else if("descendant"===B)A=new rp,Rq(L,A);else if("all"===B&&(A=new rp,Rq(L,A),!Z))for(var y=L._parent;y;)A.add(y),y=y._parent;A&&(Z?t.rs(A):t.as(A)),delete F._32o}},B._97I=function(Y,z,X,q,u,l,F){var O=this,S=O._indent,g=O._levelMap[z._id],_=O.getIconWidth(z),G=km(O.getToggleIcon(z));G?(q+=S*g,vr(Y,G,q+S/2,u+F/2,z,O),q+=S):q+=S*(g+1),O._checkMode&&(vr(Y,O.getCheckIcon(z),q+S/2,u+F/2,z,O),q+=S),O.drawIcon(Y,z,q,u,_,F),O.drawLabel(Y,z,q+_,u,F)}},Wk._14Q=function(w){w.getIcon=function($){return $.getIcon()},w.getIconWidth=function(f){return this.getIcon(f)?this._indent:0},w.drawIcon=function(O,H,s,C,X,j){if(X){var b=this,t=b.getBodyColor(H),T=km(b.getIcon(H),t);T&&(j-=b.isRowLineVisible()?1:0,Cq(O,T,Ih,s,C,X,j,H,b,t),sb(O,b.getBorderColor(H),s,C,X,j))}},w.drawLabel=function(A,E,W,c,o){var U=this;qq(A,U.getLabel(E),U.getLabelFont(E),U.getLabelColor(E),W,c,0,o)}},Wk._50o=function(b){b._98I=function(){var P=this,M=P._39o=new fs;P._60I=new rp,M.mm(P._17o,P),M.md(P._18o,P),M.mh(P._19o,P)},b.setColumns=function(C){this._39o.clear(),this.addColumns(C)},b.addColumns=function(M){var S=this._39o;M.forEach(function(m){if(!(m instanceof $b)){var P=ns(m.className);m=se(P?P:$b,m)}S.add(m)})},b.onColumnClicked=function(){},b.onCheckColumnClicked=function(){},b._3Q=function(x){for(var O,t=0,E=this._60I,f=E.size();f>t;t++)if(O=E.get(t),O.column===x)return O;return Y},b.getColumnAt=function(B){var O=this._4Q(B);return O?O.column:Y},b._4Q=function(p){for(var S=this,s=p.target?S.lp(p).x:p.x,f=S._60I,q=0;q<f.size();q++){var m=f.get(q),M=m.startX;if(s>=M&&s<M+m.column.getWidth())return m}return Y},b.getToolTip=function(v){var M=this,J=M.getDataAt(v),A=M.getColumnAt(v);return J&&A?A.getToolTip(J,M):Y},b.adjustTranslateX=function(K){var $=this.getWidth()-this._91I;return $>K&&(K=$),K>0?0:R(K)},b._99I=function(){var $=this,U=$._29I,g=$._60I;g.clear(),$._91I=0,$._39o._roots.each(function(K){if(K.isVisible()){var S=$._91I+K.getWidth();$._91I<=U.x+U.width&&S>=U.x&&g.add({column:K,startX:$._91I}),$._91I=S}}),$._91I+=$.getScrollBarSize()},b.drawData=function(u,R,n){var k=this,M=k._rowHeight,l=M*n,v=k.isSelected(R),Y=k._29I,c=Y.x,O=Y.width;k.drawRowBackground(u,R,v,c,l,O,M),k._60I.each(function(J){var D=J.column,t=J.startX,x=D.getWidth();x>0&&!k.isEditing(R,D)&&(u.save(),u.beginPath(),u.rect(t,l,x,M),u.clip(),k._87o(k.drawCell(u,R,v,D,t,l,x,M),n,t,l,x,M),k._columnLineVisible&&_e(u,t+x-1,l,1,M,k._columnLineColor),u.restore())}),k._rowLineVisible&&_e(u,c,l+M-1,O,1,k._rowLineColor)},b.drawCell=function(x,C,T,W,t,q,Q,J){var r=this;if(W.drawCell)return W.drawCell(x,C,T,W,t,q,Q,J,r);var I=r.getValue(C,W);kj(x,I,W,r.getLabelFont(C,W,I),r.getLabelColor(C,W,I),t,q,Q,J,C,r)},b.getColumnModel=function(){return this._39o},b._17o=function(){this.redraw()},b._18o=function(c){var I=this;c.data===I._sortColumn&&wk[c.property]?I.ivm():(I._42o(),I.redraw())},b._19o=function(){this.redraw()},b.getCurrentSortFunc=function(){var X=this,B=X._sortColumn;if(B&&B.isSortable()){var P=B.getSortFunc(),K=Oo===B.getSortOrder()?1:-1;return P||(P=Tr),function($,N){return P.call(X,X.getValue($,B),X.getValue(N,B),$,N)*K}}return X._sortFunc},b.isCellEditable=function(J,k,Q){return k.isEditable()&&this.isEditable()?k.isCellEditable?k.isCellEditable(J,k,Q,this):!0:!1},b._37O=function(w,Q){if(Qe(Q))for(var z=this,R=z.lp(Q),M=z._60I,F=z._rowHeight,g=z._29I,P=g.x,a=g.y,E=g.width,c=g.height,q=0;q<M.size();q++){var p=M.get(q),f=p.startX,I=p.column,o=I.getWidth();if(I!==z._31o&&I!==z._4o&&R.x>=f&&R.x<f+o&&z.isCellEditable(w,I,Q)){var i={x:f,y:z.getRowIndex(w)*F,width:o,height:F},S={x:i.x+z.tx(),y:i.y+z.ty(),width:i.width,height:i.height},H=0,m=0;return i.x<P?H=i.x-P:i.x+i.width>P+E&&(H=i.x+i.width-P-E),H&&(z.tx(z.tx()-H),S.x-=H),i.y<a?m=i.y-a:i.y+F>a+c&&(m=i.y+F-a-c),m&&(z.ty(z.ty()-m),S.y-=m),z.beginEditing({data:w,column:I,value:z.getValue(w,I),event:Q,rect:i,editorRect:S,view:z}),void 0}}}},Cf.BaseItemEditor=function(w,z,Z,y){this._data=w,this._column=z,this._master=Z,this._editInfo=y},kq("BaseItemEditor",$,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var vs=C.Tab=function(){wj(vs,this)};Lg("Tab",uo,{ms_ac:["view","closable","disabled"],_icon:Y,_closable:!1,_disabled:!1,setParent:xn});var $b=C.Column=function(){wj($b,this)};Lg("Column",uo,{_46o:1,ms_ac:["accessType","valueType",hq,Jq,Nl,wl,"align",Ym,"sortOrder",To,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:Oo,_sortFunc:Y,_sortable:!0,_clickable:!0,setWidth:function(r){16>r&&(r=16);var S=this._width;this._width=r,this.fp(wl,S,r)},getToolTip:function(E,h){return this.formatValue(h.getValue(E,this))}});var Eb=C.Property=function(){wj(Eb,this)};Lg("Property",uo,{_46o:1,ms_ac:["accessType","valueType",Jq,Nl,"categoryName",Ym,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:Y,getToolTip:function(I,F,T){var B=this;return F?B.formatValue(T.getValue(I,B)):T.getPropertyName(B)}}),Cf.AccordionView=function(){var q=this;q._20o={},q._21o=new rp,q._10o=Y,q._9o=Y,q._11o=Y,q._view=kk(0,q),q.iv()},kq("AccordionView",$,{ms_v:1,ms_fire:1,ms_ac:[bm,Dn,"titleHeight",ln,Zp,"titleBackground","selectWidth",dc,"orientation","separatorColor"],_expandIcon:k.accordionViewExpandIcon,_collapseIcon:k.accordionViewCollapseIcon,_titleHeight:Yn,_labelColor:k.accordionViewLabelColor,_labelFont:k.accordionViewLabelFont,_titleBackground:k.accordionViewTitleBackground,_selectBackground:k.accordionViewSelectBackground,_selectWidth:k.accordionViewSelectWidth,_orientation:"v",_separatorColor:k.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(L,y,W,I){var j=this,U=Aj();if(j._20o[L])throw L+" already exists";U.onmousedown=vj,U.style.cursor=uc,U.addEventListener(hc?Hk:Ac,function(S){vj(S)},p),U.addEventListener(hc?qm:cd,function(b){vj(b),Qe(b)&&(j._10o===L?j.collapse():j.expand(L))},p),Hb(j._view,U),j._20o[L]={content:y,div:U,canvas:eq(U),icon:I},j._21o.add(L),W&&j.expand(L),j.iv()},remove:function(w){var W=this,N=W._20o[w];N&&(rn(N.div),delete W._20o[w],W._21o.remove(w),W.iv())},clear:function(){var p=this;p._21o.toArray().forEach(p.remove,p),p._20o={},p._21o.clear(),p.iv()},isExpanded:function(M){return this._10o===M},expand:function(R){var L=this;L._20o[R]&&L._10o!==R&&(L._10o=R,L.onExpanded(R),L.iv())},onExpanded:function(){},collapse:function(){var A=this;A._10o&&(A.onCollapsed(A._10o),delete A._10o,A.iv())},onCollapsed:function(){},initCanvas:function(I,r,q){hn(I,r,q);var i=sf(I);return $r(i,0,0,1),i.clearRect(0,0,r,q),i},drawTitle:function(u,i,A,B,z){var o=this,$=km(z.icon),E=o.isExpanded(i),C=o._titleHeight,r=o._titleBackground,P=o._selectWidth,G=o._separatorColor,K=km(E?o._expandIcon:o._collapseIcon),n=P+4;_e(u,0,0,A,B,r),E&&P&&_e(u,0,0,P,B,o._selectBackground),(E||o._21o.get(o._21o.size()-1)!==i)&&_e(u,0,B-1,A,1,G?G:kp(r)),$&&(vr(u,$,n+re($)/2,C/2),n+=re($)+2),qq(u,i,o.getLabelFont(i),o.getLabelColor(i),n,0,0,C),K&&vr(u,K,A-re(K)/2-4,C/2)},validateImpl:function(){var M=this,Z=M._view,v=0,V=0,E=M.getWidth(),Y=M.getHeight(),m=M._titleHeight,H=M._21o.size()*m,i=M._11o,k=M._9o;delete M._11o,delete M._9o,M._21o.each(function(C){var I,$,J=M._20o[C],W=J.content,S=M._10o===C;co(M)?(dk(J.div,v,0,m,Y),I=M.initCanvas(J.canvas,m,Y),Jd(I,0,Y),hh(I,-F),M.drawTitle(I,C,Y,m,J),I.restore(),S?($=B(0,E-H),W&&(M._11o=W,M._9o=Mn(W),dk(W,v+m,0,$,Y)),v+=m+$):v+=m):(dk(J.div,0,V,E,m),I=M.initCanvas(J.canvas,E,m),M.drawTitle(I,C,E,m,J),I.restore(),S?($=B(0,Y-H),W&&(M._11o=W,M._9o=Mn(W),dk(W,0,V+m,E,$)),V+=m+$):V+=m)});var J=M._9o;i&&i!==M._11o&&i.endEditing&&i.endEditing(),J&&J!==k&&Hb(Z,J),k&&k!==J&&rn(k)}}),Cf.SplitView=function(k,Z,D,B){var w=this,I=w._dividerDiv=Aj(),T=w._60O=eq(),u=w._61O=eq(),z=T.style,y=u.style;w._view=kk(1,w),Hb(w._view,I),z.msTouchAction=cb,z.pointerEvents=cb,z.cursor=uc,y.msTouchAction=cb,y.pointerEvents=cb,y.cursor=uc,k&&w.setLeftView(k),Z&&w.setRightView(Z),D&&w.setOrientation(D),B!=Y&&w.setPosition(B),w.setStatus(aj),new is(w)
},kq("SplitView",$,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:k.splitViewDividerSize,_dividerBackground:k.splitViewDividerBackground,_dragOpacity:k.splitViewDragOpacity,_toggleIcon:k.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(E,U){var b=this,m=b._position;isNaN(E)||(U||(b._82O=0>E?-1:E>1?1:0),b._position=E,b.fp(kr,m,E))},getLeftView:function(){return this._leftView},setLeftView:function(Z){var R=this,f=R._leftView,E=R._view;if(R._leftView!==Z){if(f&&f!==R._rightView){var d=Mn(f);d.parentNode===E&&rn(d)}if(R._leftView=Z,Z){var l=Mn(Z);l.parentNode!==E&&E.insertBefore(l,R._dividerDiv)}R.fp("leftView",f,Z)}},getRightView:function(){return this._rightView},setRightView:function(b){var f=this,U=f._rightView,C=f._view;if(f._rightView!==b){if(U&&U!==f._leftView){var Q=Mn(U);Q.parentNode===C&&rn(Q)}if(f._rightView=b,b){var l=Mn(b);l.parentNode!==C&&C.insertBefore(l,f._dividerDiv)}f.fp("rightView",U,b)}},validateImpl:function(){var H=this,I=H._draggable,L=H._position,_=H.getWidth(),j=H.getHeight(),x=H._dividerSize,n=H._dividerBackground,f=hc?18:8,X=H._dividerDiv,o=H._82O,V=H._60O,c=H._61O,r=H._toggleIcon,S=H._status,m=X.style,h=null,Y=hc?20:4,J=r.comps[0];x>=f||0===x?H._coverDiv&&(rn(H._coverDiv),delete H._coverDiv):H._coverDiv||(H._coverDiv=Aj(),Q&&(H._coverDiv.style.background=oi),Hb(X,H._coverDiv)),H._togglable?V.parentNode||(Hb(X,V),Hb(X,c)):(rn(V),rn(c));var k=H._coverDiv,K=H._leftView,Z=H._rightView;if(co(H)){if(x>_&&(x=_),S===aj)if(1===o)var A=D(L,_),e=B(0,_-x-A);else-1===o?(e=D(-L,_),A=B(0,_-x-e)):(A=R((_-x)*L),e=B(0,_-x-A));else"cl"===S?(A=0,e=B(0,_-x)):"cr"===S&&(e=0,A=B(0,_-x));K&&dk(K,0,0,A,j),Z&&dk(Z,A+x,0,e,j),dk(X,A,0,x,j),H._22o=A,k&&(dk(k,x/2-f/2,0,f,j),k.style.cursor=I?Jn:""),X.style.cursor=I?Jn:"";var z=X.clientHeight/2,s=X.clientWidth;hn(V,s,s),dk(V,0,z-s-Y,s,s),h=sf(V),$r(h,0,0,1),J.rotation=-F,mf(h,r,0,0,s,s),h.restore(),hn(c,s,s),dk(c,0,z+Y,s,s),h=sf(c),$r(h,0,0,1),J.rotation=F,mf(h,r,0,0,s,s),h.restore()}else{if(x>j&&(x=j),S===aj)if(1===o)var i=D(L,j),w=B(0,j-x-i);else-1===o?(w=D(-L,j),i=B(0,j-x-w)):(i=R((j-x)*L),w=B(0,j-x-i));else"cl"===S?(i=0,w=B(0,j-x)):"cr"===S&&(w=0,i=B(0,j-x));K&&dk(K,0,0,_,i),Z&&dk(Z,0,i+x,_,w),dk(X,0,i,_,x),H._22o=i,k&&(dk(k,0,x/2-f/2,_,f),k.style.cursor=I?pj:""),m.cursor=I?pj:"";var T=X.clientWidth/2,s=X.clientHeight;hn(V,s,s),dk(V,T-s-Y,0,s,s),h=sf(V),$r(h,0,0,1),J.rotation=0,mf(h,r,0,0,s,s),h.restore(),hn(c,s,s),dk(c,T+Y,0,s,s),h=sf(c),$r(h,0,0,1),J.rotation=O,mf(h,r,0,0,s,s),h.restore()}m.background=n}});var is=function(S){this.sv=S,this.addListeners()};jq(is,$,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(a){var f=this,A=f.sv,H=A._dividerDiv,p=A._60O,q=A._61O,Z=A._status,m=a.target;if(m===p)Z===aj?A.setStatus("cl"):"cr"===Z&&A.setStatus(aj);else if(m===q)Z===aj?A.setStatus("cr"):"cl"===Z&&A.setStatus(aj);else if(sj(a)&&(m===H||m===A._coverDiv)&&(vj(a),A.isDraggable())){A.getLeftView(),A.getRightView();var G=f.maskDiv=Aj();if(G.style.left=0,G.style.top=0,G.style.width=A.getWidth()+"px",G.style.height=A.getHeight()+"px",A.getView().appendChild(G),!A.isContinuousLayout()){var F=f.resizeDiv=Aj();F.style.left=H.style.left,F.style.top=H.style.top,F.style.width=H.style.width,F.style.height=H.style.height,F.style.opacity=A.getDragOpacity(),F.style.background=A.getDividerBackground(),Hb(f.getView(),F)}f._lastAbsPosition=A._22o,f._86o=co(A)?ih(a).x:ih(a).y,rc(f,a)}},handleWindowTouchMove:function(h){sj(h)&&this.update(h,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(A){var p=this;p.update(A,!0),p.sv.setStatus(aj),p.maskDiv&&rn(p.maskDiv),p.resizeDiv&&rn(p.resizeDiv),p.maskDiv=p.resizeDiv=Y},handle_mousedown:function(k){Qe(k)&&this.handle_touchstart(k)},handleWindowMouseMove:function(s){this.handleWindowTouchMove(s)},handleWindowMouseUp:function(M){this.handleWindowTouchEnd(M)},update:function(z,y){var X=this,P=X.sv,i=co(P)?P.getWidth():P.getHeight(),R=P._dividerSize,f=X._lastAbsPosition-X._86o;co(P)?(f+=ih(z).x,f>i-R&&(f=i-R),0>f&&(f=0),X.resizeDiv&&(X.resizeDiv.style.left=f+Md)):(f+=ih(z).y,f>i-R&&(f=i-R),0>f&&(f=0),X.resizeDiv&&(X.resizeDiv.style.top=f+Md)),y&&i!==R&&(1===P._82O?P.setPosition(f,1):-1===P._82O?P.setPosition(f-i+R,1):P.setPosition(f/(i-R),1))}}),Cf.TabView=function(){var x=this,O=x._view=kk(1,x),$=x._91O=Aj(1),p=x._tabModel=new fs,H=p.sm(),l=x.invalidate;x._7o=new rp,x._canvas=eq($),Hb(O,$),Hb(O,x._92O=Aj(1)),H.setSelectionMode(pn),H.ms(x.handleSelectionChange,x),p.mm(l,x),p.md(l,x),p.mh(l,x),x._interactor=new _f(x),x.iv()},kq("TabView",$,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",ln,Zp,"tabBackground","selectWidth",dc,"moveBackground","insertColor"],_tabPosition:Gc,_tabHeight:Yn,_tabGap:k.tabViewTabGap,_labelColor:k.tabViewLabelColor,_labelFont:k.tabViewLabelFont,_tabBackground:k.tabViewTabBackground,_selectWidth:k.tabViewSelectWidth,_selectBackground:k.tabViewSelectBackground,_moveBackground:k.tabViewMoveBackground,_insertColor:k.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(U,f,M){var d,R=this._tabModel;return U instanceof vs?(d=U,f&&d.setView(f)):(d=new vs,d.setName(U),d.setView(f)),R.add(d),M&&R.sm().ss(d),d},getLabel:function(k){return k.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(v){this._23o=v,this.iv()},get:function(N){var B=this,m=B._tabModel;if(mn(N))return m._roots.get(N);if(Xd(N)){var o;return m.each(function(b){N===B.getLabel(b)&&(o=b)}),o}return N instanceof vs?N:Y},select:function(H){this._tabModel.sm().ss(this.get(H))},remove:function(Z){var A=this;if(Z=A.get(Z)){var o=A._tabModel,e=o._roots.indexOf(Z);A._tabModel.remove(Z),A.selectByIndex(--e)}},getCurrentTab:function(){return this._8o},hideTabView:function(F,E){E.parentNode===this._92O&&(gr(E)?(E.style.display=Cp,E._tab_=F):rn(E),Xk())},showTabView:function(i,J){gr(J)&&(J.style.display="block",J._tab_=i),J.parentNode!==this._92O&&(Hb(this._92O,J),Xk())},_24o:function(){var r,_=this,A=_._8o,N=_._9o,z=_._tabModel.sm().ld();z&&(r=Mn(z.getView())),r!==N&&(N&&(A.getView()&&A.getView().endEditing&&A.getView().endEditing(),_.hideTabView(A,N)),r&&_.showTabView(z,r)),_._8o=z,_._9o=r,A!==z&&_.onTabChanged(A,z)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function($,x){this.selectByIndex(--x)},selectByIndex:function(K){var R=this,f=R._tabModel,Z=f.size();if(Z&&!f.sm().ld()){K==Y&&(K=0),K>=Z&&(K=Z-1),0>K&&(K=0);for(var q=K;q>=0;q--){var p=R.get(q);if(!p.isDisabled())return R.select(p),p}for(q=K+1;Z>q;q++)if(p=R.get(q),!p.isDisabled())return R.select(p),p}},getTabWidth:function(x){var I=4,i=km(x.getIcon());i&&(I+=re(i,x)+4);var Z=this.getLabel(x);return Z&&(I+=Ie(this.getLabelFont(x),Z).width+4),x.isClosable()&&(I+=10),I},drawTab:function(H,B,l,y,g,A,j){var k,J=this,m=J._tabPosition,d=l+4,b=J._selectWidth,G=km(B.getIcon()),_=B.isDisabled(),N=J.getLabelColor(B),f=J.getLabelFont(B),I=J.getLabel(B),r=J._selectBackground,u=m===wp+"-vertical",h=m===lh+"-vertical";(u||h)&&(d=y+4),_&&(H.globalAlpha=Xo),_e(H,l,y,g,A,j),B===J._8o&&b&&(m===Gc?_e(H,l,y+A-b,g,b,r):m===wp?_e(H,l+g-b,y,b,A,r):m===lh?_e(H,l,y,b,A,r):u?_e(H,l+g-b,y,b,A,r):h?_e(H,l,y,b,A,r):_e(H,l,y,g,b,r));var S=g/2;if(u&&(Jd(H,S,y+A/2),hh(H,O),Jd(H,-S,-y-A/2)),G){var X=dp(G,B),e=re(G,B);if(u||h){var q=l+g/2,Y=d+X/2;Jd(H,q,Y),hh(H,F),Jd(H,-q,-Y),vr(H,G,l+g/2,d+X/2,B,J),Jd(H,q,Y),hh(H,-F),Jd(H,-q,-Y),d+=X+4}else vr(H,G,d+e/2,y+A/2,B,J),d+=e+4}return u||h?(Jd(H,g/2,d+g/2),hh(H,F),Jd(H,-g/2,-d-g/2),qq(H,I,f,N,l,d,A,g),Jd(H,g/2,d+g/2),hh(H,-F),Jd(H,-g/2,-d-g/2)):qq(H,I,f,N,d,y,g,A),u&&(Jd(H,S,y+A/2),hh(H,-O),Jd(H,-S,-y-A/2)),B.isClosable()&&(k=h?{x:l+g-12,y:y+A-12,width:12,height:12}:{x:l+g-12,y:y+2,width:12,height:12},this.drawCloseIcon(B,H,N,k)),_&&(H.globalAlpha=1),k},drawCloseIcon:function(f,R,s,u){var H=u.x,F=u.y;R.strokeStyle=s,R.lineWidth=1,R.beginPath(),R.moveTo(H+2,F+8),R.lineTo(H+8,F+2),R.moveTo(H+8,F+8),R.lineTo(H+2,F+2),R.stroke()},getTabAt:function(O){var L=this._interactor._8Q(O);return L?L.tab:null},validateImpl:function(){var p=this;p._24o();var y,M=p._canvas,T=p._tabPosition,n=p._91O,l=p._92O,Y=p._tabModel,X=p.getWidth(),r=p.getHeight(),D=p._tabHeight,F=p._7o,z=p._tabGap,q=T===Gc,P=T===wp,L=T===lh,H=T===wp+"-vertical",u=T===lh+"-vertical",A=p._23o,U=0;if((P||L)&&Y._roots.each(function(L){U=B(p.getTabWidth(L),U)}),q?(dk(n,0,0,X,D),y={x:0,y:D,width:X,height:B(0,r-D)}):P?(dk(n,0,0,U,r),y={x:U,y:0,width:B(0,X-U),height:r}):L?(dk(n,X-U,0,U,r),y={x:0,y:0,width:B(0,X-U),height:r}):H?(dk(n,0,0,D,r),y={x:D,y:0,width:B(0,X-D),height:r}):u?(dk(n,X-D,0,D,r),y={x:0,y:0,width:B(0,X-D),height:r}):(dk(n,0,r-D,X,D),y={x:0,y:0,width:X,height:B(0,r-D)}),dk(l,y),H||u){p._9o&&(y.x=0,dk(p._8o.getView(),y)),hn(M,D,r);var C=sf(M),e=0;if($r(C,0,p.ty(),1),C.clearRect(0,0,D,r),F.clear(),Y._roots.each(function(r){var w,G=p.getTabWidth(r);A&&A.tab===r||(w=p.drawTab(C,r,0,e,D,G,p._tabBackground)),F.add({_75o:w,tab:r,startY:e,endY:e+G,height:G}),e+=G+z}),p._23Q=B(0,e-z),A){var w=A.position;p.drawTab(C,A.tab,0,A.startY,D,A.height,p._moveBackground),_e(C,0,w,D,1,p._insertColor)}if(C.restore(),p._selectionChanged){p._selectionChanged=!1;for(var I=p.ty(),E=0;E<F.size();E++){var Z=F.get(E);if(Z.tab===p._8o){if(Z.endY+I<0){p.ty(-Z.startY);break}if(Z.startY+I>r){p.ty(r-Z.endY);break}}}}p.ty(p.ty())}else if(P||L){p._9o&&(y.x=0,dk(p._8o.getView(),y)),hn(M,U,r);var C=sf(M),e=0;if($r(C,0,p.ty(),1),C.clearRect(0,0,U,r),F.clear(),Y._roots.each(function(o){var j;A&&A.tab===o||(j=p.drawTab(C,o,0,e,U,D,p._tabBackground)),F.add({_75o:j,tab:o,startY:e,endY:e+D,height:D}),e+=D+z}),p._23Q=B(0,e-z),A){var w=A.position;p.drawTab(C,A.tab,0,A.startY,U,A.height,p._moveBackground),_e(C,0,w,U,1,p._insertColor)}if(C.restore(),p._selectionChanged){p._selectionChanged=!1;for(var I=p.ty(),E=0;E<F.size();E++){var Z=F.get(E);if(Z.tab===p._8o){if(Z.endY+I<0){p.ty(-Z.startY);break}if(Z.startY+I>r){p.ty(r-Z.endY);break}}}}p.ty(p.ty())}else{p._9o&&(y.y=0,dk(p._8o.getView(),y)),hn(M,X,D);var C=sf(M),j=0;if($r(C,p.tx(),0,1),C.clearRect(0,0,X,D),F.clear(),Y._roots.each(function(q){var V,t=p.getTabWidth(q);A&&A.tab===q||(V=p.drawTab(C,q,j,0,t,D,p._tabBackground)),F.add({_75o:V,tab:q,startX:j,endX:j+t,width:t}),j+=t+z}),p._64I=B(0,j-z),A){var w=A.position;p.drawTab(C,A.tab,A.startX,0,A.width,D,p._moveBackground),Sc(C,p._insertColor,w,0,D)}if(C.restore(),p._selectionChanged){p._selectionChanged=!1;for(var c=p.tx(),E=0;E<F.size();E++){var Z=F.get(E);if(Z.tab===p._8o){if(Z.endX+c<0){p.tx(-Z.startX);break}if(Z.startX+c>X){p.tx(X-Z.endX);break}}}}p.tx(p.tx())}for(var s=[],d=l.children,E=0;E<d.length;E++){var S=d[E],R=S._tab_;R&&!Y.contains(R)&&s.push(S)}s.forEach(function(S){l.removeChild(S)})}});var _f=function(G){this.tv=G,this.addListeners()};jq(_f,$,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(I){this.handleScroll(I,10*(I.wheelDelta/40))},handle_DOMMouseScroll:function(I){this.handleScroll(I,10*-I.detail)},handleScroll:function(R,p){vj(R);var y=this.tv,e=y._tabPosition;!y._40o()||e!==Gc&&e!==Xh||y.tx(this.tv.tx()+p),!y._41o()||e!==wp&&e!==lh&&e!==wp+"-vertical"&&e!==lh+"-vertical"||y.ty(this.tv.ty()+p)},_8Q:function(l){var w,q,D=this.tv,X=D._tabPosition,s=D._7o;if(X===Gc||X===Xh){var c=D.lp(l).x;for(w=0;w<s.size();w++)if(q=s.get(w),q.startX<=c&&c<=q.endX)return q}else if(X===wp||X===lh||X===wp+"-vertical"||X===lh+"-vertical"){var I=D.lp(l).y;for(w=0;w<s.size();w++)if(q=s.get(w),q.startY<=I&&I<=q.endY)return q}return Y},isClickable:function(M){var X=this.tv,d=X._tabPosition,K=this._73o=this._8Q(M);return!X._40o()||d!==Gc&&d!==Xh?!X._41o()||d!==wp&&d!==lh&&d!==wp+"-vertical"&&d!==lh+"-vertical"?K&&(!K.tab.isDisabled()||X.isMovable()):!0:!0},handle_mousemove:function(B){var z=this;no?z._74o=z._8Q(B):z.getView().style.cursor=z.isClickable(B)?uc:""},handle_mousedown:function(R){this.handle_mousemove(R),this.handle_touchstart(R)},handle_touchstart:function(n){var Z=this,D=Z.tv,a=D._tabPosition;vj(n),Qe(n)&&Z.isClickable(n)&&(a===Gc||a===Xh?(Z.x=ih(n).x,Z.lp=D.lp(n),Z.tx=D.tx()):(Z.y=ih(n).y,Z.lp=D.lp(n),Z.ty=D.ty()),rc(Z,n))},handleWindowMouseMove:function(P){this.handleWindowTouchMove(P)},handleWindowTouchMove:function(G){var Z,M=this,u=M.tv,s=u._tabPosition,A=M._73o;if(s===Gc||s===Xh){if(Z=ih(G).x-M.x,!M._25o&&!M.moving&&L(Z)>2&&(u._40o()&&!En(G)?M._25o=1:A&&u.isMovable()&&(M.moving=1)),M._25o)u.tx(M.tx+Z);else if(M.moving){var a=M.lp.x+Z,W=u._tabGap/2;u._7o.each(function(V){var f=V.endX,$=a-V.startX<f-a;a>=V.startX&&f>=a&&u._7Q({tab:A.tab,startX:A.startX+Z,width:A.width,front:$,insertTab:V.tab,position:$?B(0,V.startX-W):D(u._64I,f+W)})})}}else if(Z=ih(G).y-M.y,!M._25o&&!M.moving&&L(Z)>2&&(u._41o()&&!En(G)?M._25o=1:A&&u.isMovable()&&(M.moving=1)),M._25o)u.ty(M.ty+Z);else if(M.moving){var j=M.lp.y+Z,W=u._tabGap/2;u._7o.each(function(R){var h=R.endY,G=j-R.startY<h-j;j>=R.startY&&h>=j&&u._7Q({tab:A.tab,startY:A.startY+Z,height:A.height,front:G,insertTab:R.tab,position:G?B(0,R.startY-W):D(u._23Q,h+W)})})}},handleWindowMouseUp:function(p){this.handleWindowTouchEnd(p)},handleWindowTouchEnd:function(){var K=this,I=K.tv,O=I._tabPosition,c=I.getTabModel(),P=c._roots,$=K._73o;if(K.moving){var o=I._23o;if(o&&o.insertTab!==o.tab){var G=o.tab,f=P.remove(G),w=P.indexOf(o.insertTab);w>=0&&(o.front||w++,w<=P.size()&&(P.add(G,w),c._38I(G,f,w)))}I._7Q(Y),delete K.moving}else if(!K._25o&&$){G=$.tab;var p=K._74o;if(!p||p.tab===G)if(!G.isDisabled()&&Gr($._75o,K.lp)){var e=function(){var $=P.indexOf(G);c.remove(G),I.onTabClosed(G,$)};I.onTabClosing(G,e)&&e()}else G.isDisabled()||I._8o===G||c.sm().ss(G)}K._25o=K._73o=K._74o=O===Gc||O===Xh?K.x=K.lp=K.tx=Y:K.y=K.lp=K.ty=Y}}),Cf.PropertyView=function(n){var X=this;X._view=kk(1,X),X._canvas=eq(X._view),Hb(X._view,X._79O=Aj()),X._rows=new rp,X._28o=new rp,X._26o={},X._26Q={};var $=X._propertyModel=new fs,j=X.ivm;$.mm(j,X),$.md(j,X),$.mh(j,X),X.dm(n?n:new fs),new ls(X)},kq("PropertyView",$,{ms_ac:[ln,Mi,Zp,Jq,Nl,"categorizable",Tg,To,df,bm,Dn,Yq,bb,ks,"selectRowIndex",dc,"background",Kf,Un,sd,nm,yh],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:Zc,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:ap,_background:k.propertyViewBackground,_expandIcon:k.propertyViewExpandIcon,_collapseIcon:k.propertyViewCollapseIcon,_scrollBarColor:Ge,_scrollBarSize:Yd,_autoHideScrollBar:Vn,_selectBackground:k.propertyViewSelectBackground,_rowHeight:Gf,_rowLineVisible:k.propertyViewRowLineVisible,_rowLineColor:k.propertyViewRowLineColor,_10I:.5,_columnLineVisible:k.propertyViewColumnLineVisible,_columnLineColor:k.propertyViewColumnLineColor,_labelColor:k.propertyViewLabelColor,_labelSelectColor:k.propertyViewLabelSelectColor,_labelFont:k.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(E){0>E&&(E=0),E>1&&(E=1);var N=this,A=N._10I;N._10I=E,N.fp("columnPosition",A,E)},getPropertyName:function(k){return k.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(m,c,a){return a===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(p,y){return y===this._selectRowIndex?this._labelSelectColor:p.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(z){var n=this.getHeight()-this._59I;return n>z&&(z=n),z>0?0:R(z)},isExpanded:function($){if(!$)return!0;var e=this._26o[$];return e?e.isExpanded:!(this._26Q[$]===!1)},toggle:function(T){var u=this;u.isExpanded(T)?u.collapse(T):u.expand(T)},expandAll:function(){this.validate();for(var I in this._26o)this.expand(I)},expand:function(u){if(u&&u!==Cp){var X=this,N=X._26o[u];N&&!N.isExpanded&&(N.isExpanded=!0,X.onExpanded(u),X.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var s in this._26o)this.collapse(s)},collapse:function(M){if(M&&M!==Cp){var E=this,H=E._26o[M];H&&H.isExpanded&&(H.isExpanded=!1,E.onCollapsed(M),E.ivm())}},onCollapsed:function(){},getCategoryName:function(R){if(!this.isCategorizable())return Cp;var y=R.getCategoryName();return y?y:Cp},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(G){var i=this,o=i._dataModel;o!==G&&(o&&(o.umd(i.handlePropertyChange,i),i._selectionModel||o.sm().ums(i.handleSelectionChange,i)),i._dataModel=G,G.md(i.handlePropertyChange,i),i._selectionModel?i._selectionModel._21I(G):G.sm().ms(i.handleSelectionChange,i),i.fp(br,o,G))},isVisible:function(T){return this._visibleFunc?this._visibleFunc(T):!0},onPropertyChanged:function(U){var L=this,i=U.property;Ii[i]?L.ivm():L.iv(),i===Bh&&L._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:Ah},handlePropertyChange:function(J){this._27o===J.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var O=this;O._96I||(O.setSelectRowIndex(-1),O._96I=1,O.iv())},redraw:function(){this.iv()},validateModel:function(){var G=this,L=G._rows,c=G._28o,p={},A=new rp,v=G._27o;G.updateCurrentData(),v!==G._27o&&G.endEditing(),L.clear(),c.clear(),G.getRawProperties().each(function(Y){if(G.isVisible(Y)){A.add(Y);var Z=G.getCategoryName(Y);p[Z]||(c.add(Z,Z===Cp?0:P),p[Z]={isExpanded:G.isExpanded(Z),properties:new rp})}}),G._sortFunc&&A.sort(G._sortFunc);for(var X in G._26o)G._26Q[X]=G.isExpanded(X);G._26o=p,c.each(function(y){y!==Cp&&L.add(y);var h=p[y];h.isExpanded&&A.each(function(i){G.getCategoryName(i)===y&&(h.properties.add(i),L.add({property:i,data:G._27o}))},G)})},validateImpl:function(){var e=this;e._76o(),e._96I&&(e.validateModel(),delete e._96I);var p=e._canvas,Z=e.getWidth(),V=e.getHeight(),B=-e.ty(),R=e._rowHeight,f=e._indent,L=Z-f,$=e._rows,w=$.size(),g=e._9I=f+L*e._10I,K=e._59I=w*R;hn(p,Z,V),e._29I={x:0,y:B,width:Z,height:V},e._31I=s(B/R),e._14I=_((B+V)/R),e._31I<0&&(e._31I=0),e._14I>w&&(e._14I=w);var r,S=sf(p),l=e._background;$r(S,0,-B,1),S.beginPath(),S.rect(0,B,Z,V),S.clip(),S.clearRect(0,B,Z,V),e._93db(S),l&&_e(S,0,0,f,K,l);for(var x=e._31I;x<e._14I;x++){var D=$.get(x),B=R*x;if(Xd(D))l&&_e(S,f,B,L,R,l),r=km(e.isExpanded(D)?e._expandIcon:e._collapseIcon),r&&Cq(S,r,Ih,0,B,f,R),S.save(),S.beginPath(),S.rect(f,B,L,R),S.clip(),e.drawCategoryName(S,D,x,f,B,L,R),S.restore();else{var b=D.property,t=D.data,r=km(b.getIcon()),P=e._selectRowIndex===x?e.getSelectBackground():Y;if(r&&Cq(S,r,Ih,0,B,f,R),P&&_e(S,f,B,L,R,P),S.save(),S.beginPath(),S.rect(f,B,g-f,R),S.clip(),e.drawPropertyName(S,b,x,f,B,g-f,R),S.restore(),!e.isEditing(t,b)){var c=g+1,o=Z-g-1;S.save(),S.beginPath(),S.rect(c,B,o,R),S.clip(),e._87o(e.drawPropertyValue(S,b,e.getValue(t,b),x,c,B,o,R,t),x,c,B,o,R),S.restore()}}e._rowLineVisible&&_e(S,f,B+R-1,L,1,e._rowLineColor)}e._columnLineVisible&&(_e(S,g,0,1,K,e._columnLineColor),_e(S,Z-1,0,1,K)),e._92db(S),e._93I(),S.restore(),e.ty(e.ty())},drawCategoryName:function(m,h,D,j,u,U,B){qq(m,h,this.getCategoryFont(h),this.getCategoryColor(h),j,u,U,B)},drawPropertyName:function(x,d,e,U,M,$,_){return d.drawPropertyName?(d.drawPropertyName(x,d,e,U,M,$,_,this),void 0):(qq(x,this.getPropertyName(d),this.getPropertyFont(d,e),this.getPropertyColor(d,e),U,M,$,_),void 0)},drawPropertyValue:function(q,z,j,n,K,W,r,h,_){return z.drawPropertyValue?z.drawPropertyValue(q,z,j,n,K,W,r,h,_,this):(kj(q,j,z,this.getLabelFont(z,j,n),this.getLabelColor(z,j,n),K,W,r,h,_,this),void 0)},isPropertyEditable:function(H){return H.isEditable()&&this.isEditable()},setProperties:function(u){this._propertyModel.clear(),this.addProperties(u)},addProperties:function(s){if(s){var S=this._propertyModel;s.forEach(function(u){if(!(u instanceof Eb)){var M=ns(u.className);u=se(M?M:Eb,u)}S.add(u)})}},getRowIndexAt:function(v){var L=this,d=s(L.lp(v).y/L._rowHeight);return d>=0&&d<L._rows.size()?d:-1},getPropertyAt:function(J){var p=this,$=p.getRowIndexAt(J);return $>=0?p._rows.get($).property:Y},getToolTip:function(R){var O=this,p=O.getPropertyAt(R),L=O._27o;return p&&L?p.getToolTip(L,O._9I<O.lp(R).x,O):Y}});var ls=function(i){this.pv=i,this.addListeners()};jq(ls,$,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(h){this.getView().style.cursor=h},clear:function(){var $=this;$._62O=$.cp=$.ty=$.p=Y,$.setCursor(Pp)},handle_mousedown:function(M){this.handle_touchstart(M)},handle_touchstart:function(h){var t=this,C=t.pv;vj(h),C.setFocus(h)&&(Qe(h)?(t.cp=ih(h),t.ty=C.ty(),t.p=C.getColumnPosition(),t.handle_touchmove(h)):C.setSelectRowIndex(C.getRowIndexAt(h)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(f){this.handle_touchend(f)},handle_touchend:function(y){var H=this;if(H.cp&&!H._62O){var s=H.pv,W=s.lp(y),o=W.x,t=W.y,U=s._indent,T=s.getRowIndexAt(y),x=s._9I;if(T>=0){var K=s._rowHeight,$=K*T,Q=s._rows.get(T),k=Q.property;if(Xd(Q))km(s.isExpanded(Q)?s._expandIcon:s._collapseIcon)&&o>=0&&U>=o&&t>=$&&$+K>=t?s.toggle(Q):Bs(y)&&s.toggle(Q);else if(o>x&&s.isPropertyEditable(k,y)){var r={x:x+1,y:$,width:s.getWidth()-x-1,height:K},E={x:r.x+s.tx(),y:r.y+s.ty(),width:r.width,height:r.height},d=0,b=s._29I;r.y<b.y?d=r.y-b.y:r.y+K>b.y+b.height&&(d=r.y+K-b.y-b.height),d&&(s.ty(s.ty()-d),E.y-=d),s.beginEditing({data:Q.data,property:k,value:s.getValue(Q.data,k),event:y,rect:r,editorRect:E,view:s})}}s.setSelectRowIndex(T)}H.clear()},handleWindowMouseMove:function(B){this.handleWindowTouchMove(B)},handleWindowTouchMove:function(G){var P=this,$=P.pv,D=P.ty,p=P.cp,b=ih(G),L=P._62O;if("p"===L)$.setTranslateY(D+b.y-p.y);else if("c"===L){var j=$.getWidth()-$._indent;if(j>16){var O=P.p-(p.x-b.x)/j,x=16/j;x>O&&(O=x),O>1-x&&(O=1-x),$.setColumnPosition(O)}}else"s"===L&&$.setTranslateY(D+(p.y-b.y)*$._59I/$._29I.height)},handle_mousemove:function(W){this.handle_touchmove(W)},handle_touchmove:function($){if(!no&&Qe($)){var k=this,l=k.pv,t=L(l.lp($).x-l._9I)<=(hc?8:3);k.cp?k._62O||(t?(k._62O="c",rc(k)):L(ih($).y-k.cp.y)>=2&&(k._62O=k.isV($)?"s":"p",rc(k))):(t?k.setCursor(Jn):k.setCursor(Pp),k.isV($)&&l._43o())}},isV:function(u){var V=this.pv,Z=V._29I;return V._41o()&&Z.x+Z.width-V.lp(u).x<_b},handle_mousewheel:function(q){this.handleScroll(q,q.wheelDelta/40)},handle_DOMMouseScroll:function(o){2===o.axis&&this.handleScroll(o,-o.detail)},handleScroll:function(a,P){var z=this.pv;vj(a),z.endEditing(),z.translate(0,P*z.getRowHeight())},handle_keydown:function(b){var y=this.pv,n=y._rows.size(),X=y._selectRowIndex+(Kb(b)?-1:1);(Kb(b)||Db(b))&&(0>X&&(X=0),X>=n&&(X=n-1),y.setSelectRowIndex(X))}}),Cf.ListView=function(m){this._5o(m),new eh(this)},kq("ListView",$,{ms_ac:[ln,Mi,Zp,Kf,Tg,Un,sd,To,df,Yq,bb,ks,bk,dc],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:ap,_rowHeight:Gf,_rowLineVisible:k.listViewRowLineVisible,_rowLineColor:k.listViewRowLineColor,_scrollBarColor:Ge,_scrollBarSize:Yd,_autoMakeVisible:nj,_autoHideScrollBar:Vn,_selectBackground:k.listViewSelectBackground,_labelColor:k.listViewLabelColor,_labelSelectColor:k.listViewLabelSelectColor,_labelFont:k.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(O){var S=this,c=S._checkMode;S._checkMode=O,S.fp(tm,c,O)},drawRow:function(v,W,d,E,l,s,o){var e=this,i=0,D=e._indent,j=e.getIconWidth(W);e.drawRowBackground(v,W,d,E,l,s,o),e._checkMode&&(vr(v,km(e.getCheckIcon(W)),i+D/2,l+o/2,W,e),i+=D),e.drawIcon(v,W,i,l,j,o),e.drawLabel(v,W,i+j,l,o)}});var eh=function(x){this.list=x,this._lastSelectDataTime=Pe(),this.addListeners()};jq(eh,$,{ms_listener:1,getView:function(){return this.list._view},clear:function(K){var T=this,M=T.list;K&&"d"===T._62O&&!T.dragCancel&&M.handleDragAndDrop(K,"end"),M.draggingData&&(M.draggingData=null,M.redraw()),T.dragCancel=T._62O=T._isV=T._isH=T.cp=T.tx=T.ty=Y},handle_mousedown:function(H){this.handle_touchstart(H)},handle_touchstart:function(Z){var r=this,T=r.list;if(vj(Z),T.setFocus(Z)){var z=T.getDataAt(Z);r.cp=ih(Z),r.tx=T.tx(),r.ty=T.ty(),Qe(Z)?z&&T.handleDragAndDrop&&!r.isV(Z)&&!r.isH(Z)&&(T.draggingData=z,T.redraw(),T.handleDragAndDrop(Z,"prepare")):(z&&r._33o(Z,z),r.clear(Z))}},handleWindowMouseUp:function(f){this.clear(f)},handleWindowTouchEnd:function(G){this.clear(G)},handle_mouseup:function(A){this.handle_touchend(A)},handle_touchend:function(z){var C=this,p=C.list;if(!C._isV&&!C._isH&&C.cp&&!C._62O){var J=p.getDataAt(z);J?(p.isCheckMode()?C._34o(z,J):C._33o(z,J),Bs(z)?p.onDataDoubleClicked(J,z):p.onDataClicked(J,z)):p.handleBackgroundClick(z)}C.clear(z)},handleWindowMouseMove:function(r){this.handleWindowTouchMove(r)},handleWindowTouchMove:function(r){var u=this,o=u.list,F=u._62O,D=u.tx,U=u.ty,C=u.cp,q=ih(r),J=o._29I;"p"===F?o.setTranslate(D+q.x-C.x,U+q.y-C.y):"v"===F?o.ty(U+(C.y-q.y)*o._59I/J.height):"h"===F?o.tx(D+(C.x-q.x)*o._91I/J.width):"d"===F&&(u.dragCancel||o.handleDragAndDrop(r,"between"))},handle_mousemove:function(c){this.handle_touchmove(c)},handle_touchmove:function(l){if(!no&&Qe(l)){var X=this,D=X.list;if(X._isV=X.isV(l),X._isH=X.isH(l),X.cp){if(!X._62O){if(Qf(ih(l),X.cp)<2)return;X._isV?X._62O="v":X._isH?X._62O="h":D.draggingData&&!this.dragCancel?(X._62O="d",D.handleDragAndDrop(l,"begin")):X._62O="p",X._62O&&"d"!==X._62O&&D.draggingData&&(D.draggingData=null,D.redraw()),rc(X)}}else X._isV&&D._43o(),X._isH&&D._42o()}},isV:function(d){var D=this.list,Z=D._29I;return D._41o()&&Z.x+Z.width-D.lp(d).x<_b},isH:function(C){var y=this.list,z=y._29I;return y._40o()&&z.y+z.height-y.lp(C).y<_b},handle_mousewheel:function(C){this.handleScroll(C,C.wheelDelta/40,C.wheelDelta!==C.wheelDeltaX)},handle_DOMMouseScroll:function(Y){this.handleScroll(Y,-Y.detail,1)},handleScroll:function(d,F,l){var X=this.list;vj(d),X.endEditing&&X.endEditing(),l&&X._41o()?X.translate(0,F*X.getRowHeight()):X._40o()&&X.translate(10*F,0)},handle_keydown:function(u){if(!k.isInput(u.target)){var b,S=this.list,l=S.sm(),o=S._rows,V=o.size();if(Lq(u))S.selectAll();else if(gq(u))S.handleDelete&&S.handleDelete(u);else if(xs(u))"d"!==this._62O||this.dragCancel||(S.handleDragAndDrop(u,"cancel"),this.dragCancel=!0);else if(Qg(u))S.isCheckMode()&&(b=S.getFocusData(),b&&S.checkData(b));else if(Kb(u)||Db(u)){var y=S.isCheckMode();if(b=y?S.getFocusData():l.ld()){var j=S.getRowIndex(b);j>=0&&(Kb(u)?0!==j&&(b=o.get(j-1),y?S.setFocusData(b):l.ss(b)):j!==V-1&&(b=o.get(j+1),y?S.setFocusData(b):l.ss(b)))}else V>0&&(b=o.get(0),y?S.setFocusData(b):l.ss(b))}}},_34o:function(M,X){var C=this.list,v=C.lp(M).x;return v>=0&&v<=C._indent?(C.checkData(X),void 0):(C.setFocusData(X),void 0)},_33o:function(E,r){var Y=this.list,Q=Y.sm(),z=Q.ld();if(En(E))Y.isSelected(r)?Q.rs(r):Q.as(r);else if(Bm(E))if(z)for(var G=Y.getRowIndex(z),F=Y.getRowIndex(r);G!==F;)G+=F>G?1:-1,Q.as(Y._rows.get(G));else Q.ss(r);else if(Qe(E)){var m=Pe();if(Q.contains(r)){var W=m-this._lastSelectDataTime;Y.handleDataDoubleSelect&&W>500&&1500>W&&Y.handleDataDoubleSelect(E,r)}Q.ss(r),this._lastSelectDataTime=m}else Q.contains(r)||Q.ss(r)}}),Cf.TreeView=function(C){var q=this;q._35o(),q._5o(C),new Hf(q)},kq("TreeView",$,{ms_ac:[ln,Mi,Zp,"rootVisible",tm,"rootData",To,df,Yq,bb,ks,Tg,Kf,Un,sd,bm,Dn,bk,dc,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:Y,_indent:ap,_rowHeight:Gf,_rowLineVisible:k.treeViewRowLineVisible,_rowLineColor:k.treeViewRowLineColor,_scrollBarColor:Ge,_scrollBarSize:Yd,_autoHideScrollBar:Vn,_expandIcon:k.treeViewExpandIcon,_collapseIcon:k.treeViewCollapseIcon,_autoMakeVisible:nj,_selectBackground:k.treeViewSelectBackground,_labelColor:k.treeViewLabelColor,_labelSelectColor:k.treeViewLabelSelectColor,_labelFont:k.treeViewLabelFont,_doubleClickToToggle:k.treeViewDoubleClickToToggle,drawRow:function(x,z,Z,$,X,k,I){var m=this;m.drawRowBackground(x,z,Z,$,X,k,I),m._97I(x,z,Z,0,X,k,I)},isOnToggleIcon:function(Y){var s=this.getDataAt(Y);if(s){var S=this.getIndent(),B=this.lp(Y).x;if(km(this.getToggleIcon(s))){var M=S*this.getLevel(s);if(B>=M&&M+S>=B)return!0}}return!1}});var Hf=function(N){wj(Hf,this,[N])};jq(Hf,eh,{toggle:function(S,K,H,G){var l=this.list,y=l.lp(S).x;if(km(l.getToggleIcon(K))){var P=H*G;if(y>=P&&P+H>=y)return l.toggle(K),!0}return l.isDoubleClickToToggle()&&Bs(S)?(l.toggle(K),!0):!1},_34o:function(b,g){var W=this.list,S=W.lp(b).x,D=W._levelMap[g._id],p=W._indent,s=p*(D+1);return S>=s&&s+p>=S?(W.checkData(g),void 0):(this.toggle(b,g,p,D)||W.setFocusData(g),void 0)},_33o:function(u,x){var z=this,r=z.list;z.toggle(u,x,r._indent,r.getLevel(x))||Hf.superClass._33o.call(z,u,x)},handle_keydown:function(s){if(Ml(s)||Tb(s)){var k=this.list,I=k._rows,v=k.isCheckMode(),Q=k.sm(),E=v?k.getFocusData():Q.ld();E?E.hasChildren()&&(Ml(s)?k.collapse(E):k.expand(E)):I.size()>0&&(E=I.get(0),v?k.setFocusData(E):Q.ss(E))}else Hf.superClass.handle_keydown.call(this,s)}});var lp=Cf.TableView=function(C){this._98I(),this._5o(C),new qj(this)};kq("TableView",$,{ms_ac:[ln,Mi,Zp,"sortMode",Jq,Nl,Kf,Un,sd,nm,yh,"sortColumn",To,df,Yq,bb,ks,bk,dc],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:ff,_editable:!0,_batchEditable:!1,_rowHeight:Gf,_rowLineVisible:k.tableViewRowLineVisible,_rowLineColor:k.tableViewRowLineColor,_columnLineVisible:k.tableViewColumnLineVisible,_columnLineColor:k.tableViewColumnLineColor,_scrollBarColor:Ge,_scrollBarSize:Yd,_autoHideScrollBar:Vn,_autoMakeVisible:nj,_selectBackground:k.tableViewSelectBackground,_labelColor:k.tableViewLabelColor,_labelSelectColor:k.tableViewLabelSelectColor,_labelFont:k.tableViewLabelFont,getCheckColumn:function(){var I=this;if(!I._31o){var J=I._31o=new $b;J.setEditable(!0),J.setWidth(40),J.getValue=I.getCheckColumValue,J.drawCell=I.drawCheckColumnCell}return I._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(A){var J=this,S=J._39o,t=J.getCheckColumn();A!==J.isCheckMode()&&(A?S.add(t,0):S.remove(t),J.fp(tm,!A,A))},getCheckColumValue:function(i,$,P){return P.isSelected(i)},drawCheckColumnCell:function(N,X,$,M,D,u,o,T,Z){vr(N,Z.getCheckIcon(X),D+o/2,u+T/2,X,Z)}});var qj=function(r){wj(qj,this,[r])};jq(qj,eh,{_34o:function(v,I){var n=this.list,T=n._31o;if(n.isCellEditable(I,T,v)){var b=n._3Q(T),Y=n.lp(v).x;if(b&&Y>=b.startX&&Y<b.startX+T.getWidth())return n.checkData(I),void 0}n._37O(I,v),n.setFocusData(I)},_33o:function(U,c){this.list._37O(c,U),qj.superClass._33o.apply(this,arguments)}});var nf=Cf.TreeTableView=function(J){var H=this,o=H._4o=new $b;H._35o(),H._98I(),H._5o(J),o.setDisplayName("Name"),o.setEditable(!0),o.setWidth(180),o.drawCell=cj,o.getValue=Pn,H._39o.add(o),new tl(H)},cj=function(O,h,e,J,C,z,d,U,a){a._97I(O,h,e,C,z,d,U)},Pn=function(v,I,c){return c.getLabel(v)};kq("TreeTableView",$,{ms_ac:[ln,Mi,Zp,"sortMode",Jq,Nl,Tg,tm,"rootData","rootVisible",To,df,"sortColumn",bm,Dn,Yq,bb,ks,bk,sd,Kf,Un,nm,yh,dc,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:ff,_checkMode:Y,_editable:!0,_batchEditable:!1,_indent:ap,_rowHeight:Gf,_rowLineVisible:k.treeTableViewRowLineVisible,_rowLineColor:k.treeTableViewRowLineColor,_columnLineVisible:k.treeTableViewColumnLineVisible,_columnLineColor:k.treeTableViewColumnLineColor,_expandIcon:k.treeTableViewExpandIcon,_collapseIcon:k.treeTableViewCollapseIcon,_scrollBarColor:Ge,_scrollBarSize:Yd,_autoHideScrollBar:Vn,_autoMakeVisible:nj,_selectBackground:k.treeTableViewSelectBackground,_labelColor:k.treeTableViewLabelColor,_labelSelectColor:k.treeTableViewLabelSelectColor,_labelFont:k.treeTableViewLabelFont,getTreeColumn:function(){return this._4o
}});var tl=function(I){wj(tl,this,[I])};jq(tl,eh,{_34o:function(P,Z){var f=this.list,E=f._4o,K=f._3Q(E),z=f.lp(P).x;if(K){var V=f._indent,F=K.startX+V*f.getLevel(Z);if(km(f.getToggleIcon(Z))&&z>=F&&F+V>=z)return f.toggle(Z),void 0;if(f.isCellEditable(Z,E)&&(F+=V,z>=F&&F+V>=z))return f.checkData(Z),void 0}f._37O(Z,P),f.setFocusData(Z)},_33o:function(f,B){var E=this.list,I=E.lp(f).x;if(km(E.getToggleIcon(B))){var V=E._3Q(E._4o);if(V){var Z=E._indent,L=V.startX+Z*E.getLevel(B);if(I>=L&&L+Z>=I)return E.toggle(B),void 0}}E._37O(B,f),tl.superClass._33o.apply(this,arguments)}});var yk=Cf.TableHeader=function(x){var l=this,B=l._view=kk(1,l),$=l._39o=x.getColumnModel(),E=l.iv;l.tv=l._tableView=x,l._60I=new rp,l._canvas=eq(B),B.style.background=k.tableHeaderBackground||"",B.style.height=je+Md,$.mm(E,l),$.md(E,l),$.mh(E,l),x.mp(function(x){hi[x.property]&&l.iv()},l),new _j(l),l.iv()};kq("TableHeader",$,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",ln,Zp,Tg,"moveBackground","insertColor",nm,yh,"resizable","movable"],_checkIcon:Bo,_movable:!0,_resizable:!0,_labelColor:k.tableHeaderLabelColor,_labelFont:k.tableHeaderLabelFont,_columnLineColor:k.tableHeaderColumnLineColor,_columnLineVisible:k.tableHeaderColumnLineVisible,_sortDescIcon:k.tableHeaderSortDescIcon,_sortAscIcon:k.tableHeaderSortAscIcon,_moveBackground:k.tableHeaderMoveBackground,_insertColor:k.tableHeaderInsertColor,_indent:ap,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(F){return F.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(Y){return Y.getColor()||this._labelColor},getLabelAlign:function(g){return g._align},onPropertyChanged:function(){this.iv()},_5Q:function(E){this._61I=E,this.iv()},getLogicalPoint:function(S){return Zr(S,this._canvas,this.tv.tx())},validateImpl:function(){var E=this,$=E._canvas,P=E.getWidth(),K=E.getHeight(),Y=E.tv,V=E._60I,h=E._61I,H=-Y.tx(),p=0;(P!==$.clientWidth||K!==$.clientHeight)&&hn($,P,K),V.clear(),E._39o._roots.each(function(j){if(j.isVisible()){var c=p+j.getWidth();H+P>=p&&c>=H&&V.add({column:j,startX:p}),p=c}});var a=sf($);if($r(a,-H,0,1),a.beginPath(),a.rect(H,0,P,K),a.clip(),a.clearRect(H,0,P,K),V.each(function(p){var T=p.column,c=p.startX,z=T.getWidth();z>0&&(a.save(),a.beginPath(),a.rect(c,0,z,K),a.clip(),h&&h.column===T||E.drawColumn(a,T,c,0,z,K),E._columnLineVisible&&_e(a,c+z-1,0,1,K,E._columnLineColor),a.restore())}),h){var W=h.column,p=h.startX,f=h.position,z=W.getWidth();a.save(),a.beginPath(),a.rect(p,0,z,K),a.clip(),a.fillStyle=E._moveBackground,a.fill(),E.drawColumn(a,W,p,0,z,K),a.restore(),Sc(a,E._insertColor,f,0,K)}a.restore()},_6Q:function(N){var n=this.tv;return n._31o===N&&n.sm().getSelectionMode()===Rp},drawColumn:function(k,D,Q,V,p,R){var z=this,x=z.tv,O=km(D.getIcon()),y=z.getLabelAlign(D);if(z._6Q(D)){var H=km(z._checkIcon);vr(k,H,Q+p/2,V+R/2,D,z)}else{var n=z.getLabel(D),e=z.getLabelFont(D),o=z.getLabelColor(D),s=Ie(e,n).width,Z=O?z._indent:0;y===wp?(O&&Cq(k,O,Ih,Q,V,Z,R),qq(k,n,e,o,Q+Z,V,p,R,wp)):y===lh?(O&&Cq(k,O,Ih,Q+p-s-Z,V,Z,R),qq(k,n,e,o,Q,V,p,R,lh)):(O&&Cq(k,O,Ih,Q+(p-s-Z)/2,V,Z,R),qq(k,n,e,o,Q+(p-s+Z)/2,V,0,R,wp))}if(D.isSortable()&&x.getSortColumn()===D&&(O=km(D.getSortOrder()===Oo?z._sortAscIcon:z._sortDescIcon))){var j=re(O,D)/2+2;vr(k,O,y===lh?Q+j:Q+p-j,V+R/2,D,x)}}});var _j=function($){var M=this;M.th=$,M.tv=$._tableView,M.addListeners()};jq(_j,$,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(B){this.getView().style.cursor=B},handle_mousemove:function(v){if(!no){var T=this;delete T._29o,T.setCursor(Pp);for(var i=T.th,p=i._60I,m=i.lp(v).x,q=p.size()-1;q>=0;q--){var O=p.get(q),F=O.column,B=O.startX+F.getWidth();if(i.isResizable()&&L(B-m)<=(hc?10:3))return T._29o=O,T.setCursor(Jn),void 0;m>O.startX&&B>m&&(T._29o=O),(F.isClickable()||F.isSortable()||i.isMovable()||T.tv.getCheckColumn&&F===T.tv.getCheckColumn())&&m>O.startX&&B>m&&T.setCursor(uc)}}},handle_mousedown:function(W){this.handle_touchstart(W)},handle_touchstart:function(N){var E=this;vj(N),E.tv.endEditing(),E.handle_mousemove(N),E._29o&&(E.x=ih(N).x,E.lx=E.th.lp(N).x,E.w=E._29o.column.getWidth(),rc(E,N))},handleWindowMouseMove:function(F){this.handleWindowTouchMove(F)},handleWindowTouchMove:function(M){var m=this,N=m.th,i=m.getView().style.cursor,e=m._29o,G=ih(M).x-m.x;if(m.resizing||m.moving||(i===Jn?m.resizing=1:N.isMovable()&&i===uc&&L(G)>2&&(m.moving=1)),m.resizing)e.column.setWidth(m.w+G);else if(m.moving){var K=m.lx+G;N._60I.each(function(V){var S=V.startX,f=S+V.column.getWidth();if(K>=S&&f>=K){var v={column:e.column,startX:e.startX+G,front:f-K>K-S,insertColumn:V.column};v.position=v.front?S:f,N._5Q(v)}})}},_16Q:function(r,A){var g=this,l=g.tv,o=g.th,c=o._checkIcon;if(o._6Q(r)){var P=km(c),L=g.lx,d=r.getWidth(),x=re(P,r);if(L>=A+d/2-x&&A+d/2+x>=L){o.setCheckIcon(c===Ri?Bo:Ri);var q=l.sm(),B=l._rows;return c===Ri?q.rs(B):q.ss(B),l.onCheckColumnClicked(r),!0}}return!1},handleWindowMouseUp:function(F){this.handleWindowTouchEnd(F)},handleWindowTouchEnd:function(Z){var v=this,n=v.tv,x=v.th,z=v._29o;if(v.moving){var j=x._61I;if(j&&j.insertColumn!==j.column){var T=j.column,N=n.getColumnModel()._roots,c=N.remove(T),q=N.indexOf(j.insertColumn);q>=0&&(j.front||q++,q<=N.size()&&(N.add(T,q),n.getColumnModel()._38I(T,c,q)))}x._5Q(Y),delete v.moving}else if(!v.resizing&&z){T=z.column;var m=x.lp(Z).x,_=z.startX,P=!0;if(x.onColumnClicked){var X=x.onColumnClicked(T,Z,_);X===!1&&(P=!1)}if(P&&m>=_&&m<=_+T.getWidth()&&!v._16Q(T,_)){if(T.isSortable()){var D=n.getSortMode(),b=T.getSortOrder();D===ff?n.getSortColumn()===T?(b===ws&&n.setSortColumn(Y),T.setSortOrder(b===Oo?ws:Oo)):n.setSortColumn(T):"bistate"===D&&(n.getSortColumn()===T?T.setSortOrder(b===Oo?ws:Oo):n.setSortColumn(T))}n.onColumnClicked(T,Z,_)}}v._29o=v.resizing=v.x=v.lx=v.w=Y}}),Cf.TablePane=function(a){this.init(new lp(a))},kq("TablePane",$,{ms_v:1,_44o:1}),Cf.TreeTablePane=function(d){this.init(new nf(d))},kq("TreeTablePane",$,{ms_v:1,_44o:1}),Cf.Toolbar=function(I){var H=this,T=H._view=kk(1,H),U=T.style;U.background=k.toolbarBackground||"",U.height=Yn+Md,H._canvas=eq(T),H._30o=new rp,H._90I=new rp,H.setItems(I||[]),T.handleGroupSelectedChanged=function(C){if(C.isSelected()){var f=C.getGroupId();null!=f&&H._items.forEach(function(z){var c=z.element;c&&c!==C&&c.setSelected&&c.getGroupId&&c.getGroupId()===f&&c.setSelected(!1)})}},new jd(H)},kq("Toolbar",$,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[dn,ln,Zp,Mi,dc,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:k.toolbarLabelColor,_labelSelectColor:k.toolbarLabelSelectColor,_labelFont:k.toolbarLabelFont,_selectBackground:k.toolbarSelectBackground,_itemGap:k.toolbarItemGap,_separatorColor:k.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(s){var r=this.getItemInfoAt(s);return r?r.item.toolTip:Y},getLabelColor:function(f){return f&&f.selected&&f.type!==Ri&&f.type!==rg?this._labelSelectColor:this._labelColor},onPropertyChanged:function(t){this.iv(),t.property===dn&&this._items.forEach(function(Q){_i(Q)})},redraw:function(){this.iv()},addItem:function(u,p){var S=this._items;p==Y?S.push(u):S.splice(p,0,u),this.fp(dn,Y,S)},removeItem:function(N){if(N)for(var O=this._items,X=0;X<O.length;X++)N===O[X]&&(O.splice(X,1),this.fp(dn,Y,O))},removeItemById:function(P){if(P!=Y)for(var N=this._items,z=0;z<N.length;z++)if(P===N[z].id){var w=N.splice(z,1)[0];return this.fp(dn,Y,N),w}},getItemById:function(Z){if(Z!=Y)for(var R=this._items,L=0;L<R.length;L++){var m=R[L];if(Z===m.id)return m}},setItemVisible:function(G,U){var N=this.getItemById(G);N&&(N.visible=U)},getItemInfos:function(){return this._30o},getItemInfoAt:function(f){var H=this,q=0,c=H._30o,G=H.lp(f),U=G.x,s=G.y;if(s>=0&&s<=H.getHeight())for(;q<c.size();q++){var y=c.get(q);if(y.startX<=U&&U<=y.endX)return y}return Y},drawItem:function(d,h,v,T,e){if(h.visible===!1)return 0;if(Lj(h.visible)&&!h.visible())return 0;var x=this,Y=h.disabled;Y&&(d.globalAlpha=Xo);var a=x.drawItemImpl(d,h,v,T,e),F=x._itemGap;return Y&&(d.globalAlpha=1),this._currentItem!==h||"separator"===h||h.separator===!0||h.unfocusable||sb(d,x._separatorColor,v-F/2,0,a+F,T),a},drawItemImpl:function(W,s,r,V,G){var M=this,h=M._view,S=M._itemGap,N=V/2,I=s.type,O=s.element,i=s.label;Xd(O)&&(i=O,O=Y);var J,Q=M.getLabelFont(s),d=M.getLabelColor(s),e=s.selected,_=km(s.icon),Z=re(_,s),B=0,p=Z+(i?Ie(Q,i).width:0);if("separator"===s||s.separator===!0)return Sc(W,M._separatorColor,r,V/4,N),1;if(O){_&&vr(W,_,r+Z/2,N,s,M),qq(W,i,Q,d,r+Z,0,0,V);var j=Mn(O);G||M._90I.add(j),j.parentNode!==h&&Hb(h,j),O.iv&&O.iv(),O.validate&&O.validate();var u=j.getBoundingClientRect(),n=u.width,P=j.style;return xb(j),P.left=M.tx()+r+p+Md,P.top=(V-u.height)/2+Md,p+n}return I===rg?J=km(e?he:te):I===Ri&&(J=km(e?Ri:Bo)),J?(B=re(J,s),vr(W,J,r+B/2,N,s,M),r+=B,p+=B):e&&_e(W,r-S/2,0,p+S,V,M.getSelectBackground(s)),_&&vr(W,_,r+Z/2,N,s,M),qq(W,i,Q,d,r+Z,0,0,V),p},validateImpl:function(){var o=this,C=o._canvas,$=o.getWidth(),f=o.getHeight(),q=o._30o,I=o._items;hn(C,$,f);var T=sf(C),e=o._itemGap,Q=e/2;$r(T,o.tx(),0,1),T.clearRect(0,0,$,f);var R=o._90I;o._90I=new rp,q.clear(),I.forEach(function(i){var g=o.drawItem(T,i,Q,f);q.add({item:i,startX:Q,endX:Q+g,width:g}),g&&(Q+=g+e)}),R.each(function(V){o._90I.contains(V)||rn(V)});var k=o._64I;o._64I=B(0,Q),T.restore(),o._stickToRight?(o._65O=0,T=sf(C),Q=$-o._64I+e,$r(T,0,0,1),T.clearRect(0,0,$,f),q.clear(),I.forEach(function($){var w=o.drawItem(T,$,Q,f,!0);q.add({item:$,startX:Q,endX:Q+w,width:w}),w&&(Q+=w+e)}),T.restore()):o.tx(o.tx()),k!==o._64I&&o.onSumWidthChanged(k,o._64I)},onSumWidthChanged:function(){},handleClick:function(M,f){var $=this,t=M.type,h=M.action,W=M.groupId,e=M.selected;M.disabled||(W!=Y?e||(M.selected=!0,this._items.forEach(function(R){R.groupId===W&&M!==R&&(R.selected=!1)}),h&&M.action(M,$,f)):t===Ri||"toggle"===t?(M.selected=!e,h&&M.action(M,$,f)):h&&M.action(M,$,f)),Xk(),$.iv()}});var jd=function(i){this.tb=i,this.addListeners()};jq(jd,$,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(D){this.handleScroll(D,10*(D.wheelDelta/40))},handle_DOMMouseScroll:function(t){this.handleScroll(t,10*-t.detail)},handleScroll:function(Q,k){vj(Q);var b=this.tb;b.isScrollable()&&!b._stickToRight&&(b.tx(b.tx()+k),yg())},handle_mousemove:function(X){var W=this;no||W.setItem(X)},handle_mouseout:function(K){var l=this;K.target===l.getView()?l.tb.setCurrentItem(Y):l.handle_mousemove(K)},handle_mousedown:function(e){this.handle_mousemove(e),this.handle_touchstart(e)},handle_touchstart:function(r){var z=this,E=z.tb,C=r.target;Qe(r)&&(C===z.getView()||C===E._canvas)&&(vj(r),E.setFocus(r)&&(this.setItem(r,!0),(E.isScrollable()||z.info&&!z.info.item.disabled)&&(z.x=ih(r).x,z.tx=E.tx(),rc(z,r))))},handleWindowMouseMove:function(R){this.handleWindowTouchMove(R)},handleWindowTouchMove:function(q){var J=this,z=J.tb;if(!z._stickToRight){var D=ih(q).x-J.x;!J._25o&&L(D)>2&&z.isScrollable()&&(J._25o=1),J._25o&&z.tx(J.tx+D)}},handleWindowMouseUp:function(Y){this.handleWindowTouchEnd(Y)},handleWindowTouchEnd:function($){var K=this,U=K.tb,g=K.info,T=K.tb.getItemInfoAt($);if(!K._25o&&g){var C=g.item;T&&T.item===C&&U.handleClick(C,$)}K._25o=K.x=K.tx=Y,K.setItem()},setItem:function(H,r){var l=this,P=l.tb,b=l.info=H?P.getItemInfoAt(H):Y,i=b?b.item:Y;P.setCurrentItem(i),r&&i&&Lj(i.onDown)&&i.onDown(H)}}),Cf.BorderPane=function(){this._view=kk(1,this),this.iv()},kq("BorderPane",$,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(Z,U){this._12o("leftView",Z),U!=Y&&this.setLeftWidth(U)},getRightView:function(){return this._rightView},setRightView:function(D,E){this._12o("rightView",D),E!=Y&&this.setRightWidth(E)},getTopView:function(){return this._topView},setTopView:function(m,z){this._12o("topView",m),z!=Y&&this.setTopHeight(z)},getBottomView:function(){return this._bottomView},setBottomView:function(K,d){this._12o("bottomView",K),d!=Y&&this.setBottomHeight(d)},getCenterView:function(){return this._centerView},setCenterView:function(B){this._12o("centerView",B)},_12o:function(t,$){var q=this,H="_"+t,P=q._view,p=q[H];p!==$&&(p&&(p.getView?rn(p.getView()):rn(p)),q[H]=$,$&&($.getView?Hb(P,$.getView(),1):Hb(P,$,1)),q.fp(t,p,$))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var v=this,y=v._topView,W=v._bottomView,J=v._leftView,X=v._rightView,f=v._centerView,$=v.getWidth(),H=v.getHeight(),P=0,o=0,m=$,F=H,e=0,x=0,n=0,g=0;y&&(e=v._topHeight==Y?em(y):v._topHeight,o=e),W&&(x=v._bottomHeight==Y?em(W):v._bottomHeight,F=H-x),J&&(n=v._leftWidth==Y?jc(J):v._leftWidth,P=n),X&&(g=v._rightWidth==Y?jc(X):v._rightWidth,m=$-g);var G=B(0,m-P),R=B(0,F-o);y&&dk(y,0,0,$,e),W&&dk(W,0,F,$,x),J&&dk(J,0,o,n,R),X&&dk(X,m,o,g,R),f&&dk(f,P,o,G,R)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);